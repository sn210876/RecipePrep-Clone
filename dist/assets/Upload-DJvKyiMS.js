import{c as ve,W as De,a3 as Y,p as Me,r as b,a4 as Oe,s as C,j as e,w as L,q as ze,f as l,X as K,B as Te,D as I}from"./index-BbNpzWb-.js";import{T as Ae}from"./textarea-B6Lbe98i.js";import{e as Ve}from"./hashtags-Boc0oHZQ.js";import{S as We,a as Be,b as qe,c as Je,d as He}from"./select-CeaS9XdK.js";import{a as V,i as ye,f as be}from"./imageCompression-q737ovES.js";import{I as Q}from"./image-D7T2NpWY.js";import{P as Ge,a as Xe}from"./play-OMbzcLnF.js";import{U as Ye}from"./upload-CPeZPqUt.js";import"./react-icons.esm-DX2Xdr36.js";import"./index-Damah6WK.js";import"./index-BdQq_4o_.js";import"./index-DZtYjUtj.js";import"./index-zKs9YsMw.js";import"./index-Cz5mkhnQ.js";import"./index-BVWTBxJm.js";import"./index-Dhdyzxar.js";import"./index-BsKc1Tsn.js";import"./browser-image-compression-BzWLnoYn.js";/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=ve("Music",[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=ve("Video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]);function we(v){return v.type.startsWith("video/")}var F;(function(v){v.Prompt="PROMPT",v.Camera="CAMERA",v.Photos="PHOTOS"})(F||(F={}));var M;(function(v){v.Rear="REAR",v.Front="FRONT"})(M||(M={}));var Z;(function(v){v.Uri="uri",v.Base64="base64",v.DataUrl="dataUrl"})(Z||(Z={}));class Ze extends De{async getPhoto(s){return new Promise(async(u,o)=>{if(s.webUseInput||s.source===F.Photos)this.fileInputExperience(s,u,o);else if(s.source===F.Prompt){let a=document.querySelector("pwa-action-sheet");a||(a=document.createElement("pwa-action-sheet"),document.body.appendChild(a)),a.header=s.promptLabelHeader||"Photo",a.cancelable=!1,a.options=[{title:s.promptLabelPhoto||"From Photos"},{title:s.promptLabelPicture||"Take Picture"}],a.addEventListener("onSelection",async p=>{p.detail===0?this.fileInputExperience(s,u,o):this.cameraExperience(s,u,o)})}else this.cameraExperience(s,u,o)})}async pickImages(s){return new Promise(async(u,o)=>{this.multipleFileInputExperience(u,o)})}async cameraExperience(s,u,o){if(customElements.get("pwa-camera-modal")){const a=document.createElement("pwa-camera-modal");a.facingMode=s.direction===M.Front?"user":"environment",document.body.appendChild(a);try{await a.componentOnReady(),a.addEventListener("onPhoto",async p=>{const h=p.detail;h===null?o(new Y("User cancelled photos app")):h instanceof Error?o(h):u(await this._getCameraPhoto(h,s)),a.dismiss(),document.body.removeChild(a)}),a.present()}catch{this.fileInputExperience(s,u,o)}}else console.error("Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/web/pwa-elements."),this.fileInputExperience(s,u,o)}fileInputExperience(s,u,o){let a=document.querySelector("#_capacitor-camera-input");const p=()=>{var h;(h=a.parentNode)===null||h===void 0||h.removeChild(a)};a||(a=document.createElement("input"),a.id="_capacitor-camera-input",a.type="file",a.hidden=!0,document.body.appendChild(a),a.addEventListener("change",h=>{const g=a.files[0];let U="jpeg";if(g.type==="image/png"?U="png":g.type==="image/gif"&&(U="gif"),s.resultType==="dataUrl"||s.resultType==="base64"){const N=new FileReader;N.addEventListener("load",()=>{if(s.resultType==="dataUrl")u({dataUrl:N.result,format:U});else if(s.resultType==="base64"){const O=N.result.split(",")[1];u({base64String:O,format:U})}p()}),N.readAsDataURL(g)}else u({webPath:URL.createObjectURL(g),format:U}),p()}),a.addEventListener("cancel",h=>{o(new Y("User cancelled photos app")),p()})),a.accept="image/*",a.capture=!0,s.source===F.Photos||s.source===F.Prompt?a.removeAttribute("capture"):s.direction===M.Front?a.capture="user":s.direction===M.Rear&&(a.capture="environment"),a.click()}multipleFileInputExperience(s,u){let o=document.querySelector("#_capacitor-camera-input-multiple");const a=()=>{var p;(p=o.parentNode)===null||p===void 0||p.removeChild(o)};o||(o=document.createElement("input"),o.id="_capacitor-camera-input-multiple",o.type="file",o.hidden=!0,o.multiple=!0,document.body.appendChild(o),o.addEventListener("change",p=>{const h=[];for(let g=0;g<o.files.length;g++){const U=o.files[g];let N="jpeg";U.type==="image/png"?N="png":U.type==="image/gif"&&(N="gif"),h.push({webPath:URL.createObjectURL(U),format:N})}s({photos:h}),a()}),o.addEventListener("cancel",p=>{u(new Y("User cancelled photos app")),a()})),o.accept="image/*",o.click()}_getCameraPhoto(s,u){return new Promise((o,a)=>{const p=new FileReader,h=s.type.split("/")[1];u.resultType==="uri"?o({webPath:URL.createObjectURL(s),format:h,saved:!1}):(p.readAsDataURL(s),p.onloadend=()=>{const g=p.result;u.resultType==="dataUrl"?o({dataUrl:g,format:h,saved:!1}):o({base64String:g.split(",")[1],format:h,saved:!1})},p.onerror=g=>{a(g)})})}async checkPermissions(){if(typeof navigator>"u"||!navigator.permissions)throw this.unavailable("Permissions API not available in this browser");try{return{camera:(await window.navigator.permissions.query({name:"camera"})).state,photos:"granted"}}catch{throw this.unavailable("Camera permissions are not available in this browser")}}async requestPermissions(){throw this.unimplemented("Not implemented on web.")}async pickLimitedLibraryPhotos(){throw this.unavailable("Not implemented on web.")}async getLimitedLibraryPhotos(){throw this.unavailable("Not implemented on web.")}}const et=Me("Camera",{web:()=>new Ze});function vt({onNavigate:v}){var pe;const[s,u]=b.useState([]),[o,a]=b.useState([]),[p,h]=b.useState(null),[g,U]=b.useState("post"),[N,O]=b.useState(""),[$,ee]=b.useState(""),[W,te]=b.useState(""),[se,je]=b.useState([]),[ae,oe]=b.useState(!1),[re,tt]=b.useState(0);b.useEffect(()=>{const t=Date.now();return console.log("üöÄ Upload component MOUNTED at",t),(async()=>{try{const{value:r}=await I.get({key:"pending_upload_webpath"});if(r){console.log("üîÑ Found pending upload, restoring...");const c=JSON.parse(r),n=l.loading("Loading photo...",{duration:0});try{console.log("üîÑ Fetching from webPath:",c.webPath);const y=await fetch(c.webPath);if(!y.ok)throw new Error("Failed to load cached image");const m=await y.blob(),S=new File([m],`photo-${c.timestamp}.${c.format}`,{type:c.mimeType});console.log("üóúÔ∏è Compressing restored image...");const f=(await V([S]))[0].file,w=URL.createObjectURL(f);u([f]),a([w]),h("image"),await I.remove({key:"pending_upload_webpath"}),console.log("‚úÖ Restored and compressed pending upload"),l.success("Photo loaded!",{id:n})}catch(y){console.error("‚ùå Failed to restore pending upload:",y),l.error("Failed to load photo",{id:n}),await I.remove({key:"pending_upload_webpath"})}}}catch(r){console.error("‚ùå Error checking for pending upload:",r),await I.remove({key:"pending_upload_webpath"})}})(),()=>{console.log("üíÄ Upload component UNMOUNTED at",Date.now(),"lived for",Date.now()-t,"ms")}},[]),b.useEffect(()=>{console.log("üìä State changed - selectedFiles:",s.length,"previewUrls:",o.length,"fileType:",p)},[s,o,p]);const[Ne,B]=b.useState(!1),[ie,Pe]=b.useState(""),[le,q]=b.useState([]),[x,J]=b.useState(null),[ne,ce]=b.useState(!1),[H,z]=b.useState(!1),T=Oe.useRef(null),G=b.useRef(null);b.useEffect(()=>{Ue()},[]);const Ue=async()=>{try{const{data:t}=await C.auth.getUser();if(!t.user)return;const{data:i,error:r}=await C.from("public_recipes").select("id, title, image_url").eq("user_id",t.user.id).order("created_at",{ascending:!1});if(r)throw r;je(i||[])}catch(t){console.error("Error loading recipes:",t)}},Se=t=>new Promise((i,r)=>{const c=document.createElement("video");c.preload="metadata",c.onloadedmetadata=()=>{window.URL.revokeObjectURL(c.src);const n=Math.floor(c.duration);isNaN(n)||n===0?r(new Error("Invalid video duration")):i(n)},c.onerror=()=>{window.URL.revokeObjectURL(c.src),r(new Error("Failed to load video metadata"))},c.src=URL.createObjectURL(t)}),Ce=async t=>{console.log("üîç File select triggered"),console.log("üì± Platform:",L.getPlatform());const i=Array.from(t.target.files||[]);if(console.log("üìÅ Selected files count:",i.length),i.length===0){console.log("‚ö†Ô∏è No files selected");return}console.log("üìù File details:",i.map(d=>({name:d.name,size:d.size,type:d.type})));const r=i.filter(d=>d.type.startsWith("image/")||d.type.startsWith("video/"));if(console.log("üéØ Media files after filter:",r.length),r.length===0){console.log("‚ùå No valid media files"),l.error("Please select at least one image or video");return}if(r.length>4){l.error("You can only upload up to 4 images/videos total");return}console.log("‚úÖ Processing",r.length,"media files");const c=[],n=[];let y=!1;const m=[],S=[];for(const d of r){const f=ye(d),w=d.type.startsWith("video/");if(f)m.push(d);else if(w){if(d.size>100*1024*1024){l.error(`${d.name} is too large (max 100MB for videos)`);continue}try{const j=await Se(d);if(g==="daily"&&j>30){l.error(`${d.name}: Daily videos must be 30 seconds or less`);continue}y=!0,S.push(d)}catch(j){console.error("Video load error:",j),l.error(`Failed to load ${d.name}`);continue}}}if(m.length>0){const d=l.loading("Compressing images...",{duration:0});try{console.log("üóúÔ∏è Starting compression for",m.length,"images");const f=await V(m,(j,k,D)=>{D.isCompressing&&(console.log(`Compressing ${j+1}/${k}: ${Math.round(D.percent)}%`),l.loading(`Compressing image ${j+1}/${k}... ${Math.round(D.percent)}%`,{id:d,duration:0}))});console.log("‚úÖ Compression complete:",f);const w=f.reduce((j,k)=>j+(k.originalSize-k.compressedSize),0);l.success(`Images compressed! Saved ${be(w)}`,{id:d,duration:3e3});for(const j of f){c.push(j.file);const k=URL.createObjectURL(j.file);console.log("üì∏ Created preview URL:",k),n.push(k)}}catch(f){console.error("‚ùå Compression error:",f),l.error(f.message||"Failed to compress images",{id:d});return}}for(const d of S)c.push(d),n.push(URL.createObjectURL(d));if(c.length===0){console.log("‚ùå No valid files to upload"),l.error("No valid files to upload");return}console.log("‚úÖ Setting state with",c.length,"files"),console.log("üì∏ Preview URLs:",n),u(c),a(n),h(y?"video":"image"),console.log("‚úÖ State updated successfully")},de=async()=>{o.forEach(t=>URL.revokeObjectURL(t)),u([]),a([]),h(null),await I.remove({key:"pending_upload_webpath"})},me=async t=>{try{console.log("üì∏ handleCapacitorCamera called with source:",t);const i=await et.getPhoto({quality:90,allowEditing:!1,resultType:Z.Uri,source:t,saveToGallery:t===F.Camera});if(console.log("‚úÖ Camera.getPhoto succeeded:",{hasWebPath:!!i.webPath,hasPath:!!i.path,format:i.format}),!i.webPath){console.error("‚ùå No webPath in image result"),l.error("Failed to get image path");return}console.log("üîÑ Fetching image from webPath:",i.webPath);const r=await fetch(i.webPath);if(!r.ok){console.error("‚ùå Fetch failed:",r.status,r.statusText),l.error("Failed to load image from device");return}const c=await r.blob();console.log("‚úÖ Blob created:",{size:c.size,type:c.type});let n=c.type;(!n||n==="application/octet-stream")&&(n=`image/${i.format||"jpeg"}`,console.log("‚ö†Ô∏è Blob type was empty/generic, using format:",n));const y=new File([c],`photo-${Date.now()}.${i.format||"jpg"}`,{type:n});console.log("‚úÖ File created:",{name:y.name,size:y.size,type:y.type}),console.log("üíæ Saving webPath to Preferences before compression..."),await I.set({key:"pending_upload_webpath",value:JSON.stringify({webPath:i.webPath,format:i.format||"jpeg",mimeType:n,timestamp:Date.now()})}),console.log("‚úÖ Saved to Preferences");const m=l.loading("Compressing image...",{duration:0});try{console.log("üóúÔ∏è Starting compression...");const d=(await V([y]))[0].file;console.log("‚úÖ Compression complete:",{size:d.size}),l.success("Image ready!",{id:m});const f=URL.createObjectURL(d);console.log("‚úÖ Preview URL created:",f),console.log("üîß About to call state setters..."),u(w=>(console.log("üìù Setting selectedFiles from",w.length,"to 1 file"),[d])),console.log("‚úÖ setSelectedFiles called"),a(w=>(console.log("üìù Setting previewUrls from",w.length,"to 1 url:",f.substring(0,50)),[f])),console.log("‚úÖ setPreviewUrls called"),h(w=>(console.log("üìù Setting fileType from",w,"to image"),"image")),console.log("‚úÖ setFileType called"),console.log("‚úÖ All state setters completed"),console.log("üßπ Clearing pending upload from Preferences"),await I.remove({key:"pending_upload_webpath"})}catch(S){console.error("‚ùå Compression error:",S),l.error(S.message||"Failed to compress image",{id:m}),await I.remove({key:"pending_upload_webpath"})}}catch(i){console.error("‚ùå Camera error:",i),i.message!=="User cancelled photos app"&&l.error("Failed to access camera: "+(i.message||"Unknown error"))}},ke=()=>{L.isNativePlatform()?me(F.Camera):l.info("Camera only available on mobile app")},_e=()=>{console.log("üì∑ From Gallery button clicked"),console.log("üì± Platform:",L.getPlatform()),console.log("üì± Is Native:",L.isNativePlatform()),L.isNativePlatform()?(console.log("‚úÖ On native platform - using Capacitor Camera with Photos source"),me(F.Photos)):(console.log("‚úÖ On web platform - triggering file input"),G.current?(console.log("‚úÖ File input ref exists, clicking..."),G.current.click()):console.error("‚ùå File input ref is null!"))},Fe=()=>{T.current&&(H?T.current.pause():T.current.play(),z(!H))},Re=async t=>{if(!t.trim()){q([]);return}ce(!0);try{const c=((await(await fetch(`https://itunes.apple.com/search?term=${encodeURIComponent(t)}&media=music&entity=song&limit=20`)).json()).results||[]).map(n=>{var y;return{id:n.trackId.toString(),name:n.trackName||"Unknown Song",artists:[{name:n.artistName||"Unknown Artist"}],album:{images:[{url:((y=n.artworkUrl100)==null?void 0:y.replace("100x100","300x300"))||"https://via.placeholder.com/300"}]},preview_url:n.previewUrl||null}});q(c)}catch(i){console.error("Music search failed:",i),l.error("Search failed ‚Äî try again"),q([])}finally{ce(!1)}},Ee=async()=>{var t,i,r,c,n,y;if(s.length===0){l.error("Please select an image or video");return}if(g==="post"&&!N.trim()){l.error("Please enter a title");return}if(g==="daily"&&p==="video"&&re>30){l.error("Daily videos must be 30 seconds or less");return}oe(!0);try{const{data:m}=await C.auth.getUser();if(!m.user)throw new Error("Not authenticated");const{data:S}=await C.from("profiles").select("id").eq("id",m.user.id).maybeSingle();S||await C.from("profiles").insert({id:m.user.id,username:((t=m.user.email)==null?void 0:t.split("@")[0])||"user",avatar_url:null});const d=l.loading("Preparing files...",{duration:0}),f=[],w=[],j=s.filter(ye),k=s.filter(we);let D=[];if(j.length>0){l.loading(`Compressing ${j.length} image(s)...`,{id:d});const P=await V(j);D=P.map(_=>_.file);const R=P.reduce((_,E)=>_+(E.originalSize-E.compressedSize),0);console.log(`Images compressed: saved ${be(R)}`)}const ue=[...D,...k],ge=ue.length;let he=0;l.loading(`Uploading ${ge} file(s)...`,{id:d});const Le=ue.map(async P=>{var xe;const R=(xe=P.name.split(".").pop())==null?void 0:xe.toLowerCase(),_=`${m.user.id}/${Date.now()}-${Math.random().toString(36).substr(2,9)}.${R}`,{error:E}=await C.storage.from("posts").upload(_,P,{cacheControl:"3600",upsert:!1});if(E)throw E;he++,l.loading(`Uploaded ${he}/${ge} file(s)...`,{id:d});const{data:A}=C.storage.from("posts").getPublicUrl(_);return{url:A.publicUrl,isVideo:we(P)}});(await Promise.all(Le)).forEach(P=>{P.isVideo?w.push(P.url):f.push(P.url)}),l.success("Upload complete!",{id:d});const Ie=f.length>1?JSON.stringify(f):f.length===1?f[0]:null,$e=w.length>1?JSON.stringify(w):w.length===1?w[0]:null,fe=f[0]||w[0],X={spotify_track_id:(x==null?void 0:x.id)||null,spotify_track_name:(x==null?void 0:x.name)||null,spotify_artist_name:((r=(i=x==null?void 0:x.artists)==null?void 0:i[0])==null?void 0:r.name)||null,spotify_album_art:((y=(n=(c=x==null?void 0:x.album)==null?void 0:c.images)==null?void 0:n[0])==null?void 0:y.url)||null,spotify_preview_url:(x==null?void 0:x.preview_url)||null};if(g==="daily"){const P={user_id:m.user.id,media_url:fe,media_type:p==="image"?"photo":"video",caption:$.trim()||null,duration:p==="video"?re:null,...X},{error:R}=await C.from("dailies").insert(P);if(R)throw R;await C.from("posts").insert({user_id:m.user.id,title:"Daily",caption:$.trim()||null,[p==="image"?"image_url":"video_url"]:fe,...X}),l.success("Daily posted successfully!")}else{let P=W?`${window.location.origin}/#recipe/${W}`:null;const R={user_id:m.user.id,title:N.trim(),caption:$.trim()||null,recipe_url:P,image_url:Ie,video_url:$e,...X},{data:_,error:E}=await C.from("posts").insert(R).select().single();if(E)throw E;const A=Ve($);A.length>0&&_&&await C.rpc("process_post_hashtags",{p_post_id:_.id,p_hashtags:A}),l.success("Post uploaded successfully!")}de(),O(""),ee(""),te(""),J(null),window.history.replaceState({},"","/discover"),v("discover")}catch(m){console.error("Upload error:",m),l.error(m.message||"Failed to upload")}finally{oe(!1)}};return console.log("üîÑ Upload component render:",JSON.stringify({previewUrlsCount:o.length,selectedFilesCount:s.length,fileType:p,previewUrls:o.slice(0,2)})),e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 md:bg-transparent md:relative",children:e.jsxs("div",{className:"absolute inset-x-0 bottom-0 md:relative md:inset-auto bg-gray-50 md:min-h-screen overflow-hidden md:overflow-visible rounded-t-3xl md:rounded-none shadow-2xl md:shadow-none pb-safe",style:{maxHeight:window.innerWidth>=768?"none":"90vh",paddingBottom:"max(10rem, env(safe-area-inset-bottom))"},children:[e.jsx("div",{className:"flex md:hidden items-center justify-center pt-3 pb-2 bg-white",children:e.jsx("div",{className:"w-12 h-1.5 bg-gray-300 rounded-full"})}),e.jsx("div",{className:"sticky top-0 bg-white border-b border-gray-200 z-20",style:{paddingTop:"env(safe-area-inset-top)"},children:e.jsxs("div",{className:"max-w-lg mx-auto px-4 h-14 flex items-center justify-between",children:[e.jsx("button",{type:"button",onClick:t=>{t.preventDefault(),v("discover")},className:"text-gray-600 hover:text-gray-900 font-medium active:scale-95 transition-transform",children:"Cancel"}),e.jsxs("h1",{className:"text-lg font-semibold",children:["New ",g==="daily"?"Daily":"Post"]}),e.jsx("div",{className:"w-16"})]})}),e.jsxs("div",{className:"overflow-y-auto max-h-[calc(90vh-4rem)] md:overflow-visible md:max-h-none overscroll-contain",children:[e.jsxs("div",{className:"max-w-lg mx-auto p-4 space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Post Type"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>U("post"),className:`flex-1 py-3 px-4 rounded-lg font-medium transition-colors ${g==="post"?"bg-gradient-to-r from-orange-600 to-red-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"Post"}),e.jsx("button",{onClick:()=>U("daily"),className:`flex-1 py-3 px-4 rounded-lg font-medium transition-colors ${g==="daily"?"bg-gradient-to-r from-purple-600 to-pink-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"Daily"})]}),g==="daily"&&e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Dailies expire after 24 hours. Videos must be 30 seconds or less."})]}),o.length===0?e.jsxs("div",{className:"space-y-3",children:[L.isNativePlatform()&&e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("button",{type:"button",onClick:ke,className:"border-2 border-dashed border-gray-300 rounded-xl p-6 hover:border-orange-500 transition-colors",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-500 rounded-2xl shadow-lg mx-auto",children:e.jsx(ze,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:"Take Photo"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Use camera"})]})]})}),e.jsx("button",{type:"button",onClick:_e,className:"border-2 border-dashed border-gray-300 rounded-xl p-6 hover:border-orange-500 transition-colors",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-purple-500 to-pink-500 rounded-2xl shadow-lg mx-auto",children:e.jsx(Q,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:"From Gallery"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Choose photo"})]})]})})]}),e.jsx("div",{className:"border-2 border-dashed border-gray-300 rounded-xl p-8 sm:p-12 text-center hover:border-orange-500 transition-colors cursor-pointer",children:e.jsxs("label",{className:"cursor-pointer",children:[e.jsx("input",{ref:G,type:"file",accept:"image/*,video/*",multiple:!0,onChange:Ce,className:"hidden"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-3 sm:gap-4 justify-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 sm:w-20 sm:h-20 bg-gradient-to-br from-orange-500 to-red-500 rounded-2xl shadow-lg",children:e.jsx(Q,{className:"w-8 h-8 sm:w-10 sm:h-10 text-white"})}),e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 sm:w-20 sm:h-20 bg-gradient-to-br from-purple-500 to-pink-500 rounded-2xl shadow-lg",children:e.jsx(Qe,{className:"w-8 h-8 sm:w-10 sm:h-10 text-white"})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-base sm:text-lg font-semibold text-gray-900 mb-1",children:L.isNativePlatform()?"Or select files":"Upload a photo or video"}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500",children:L.isNativePlatform()?"Browse your files":"Click to select a file from your device"})]})]})]})})]}):e.jsxs("div",{className:"space-y-2",children:[(console.log("üìä About to render previews. previewUrls.length:",o.length,"selectedFiles.length:",s.length),null),o.map((t,i)=>{const r=s[i],c=r==null?void 0:r.type.startsWith("video/");return console.log(`üñºÔ∏è Rendering preview ${i}:`,JSON.stringify({url:t.substring(0,50),isVideo:c,fileType:r==null?void 0:r.type,fileName:r==null?void 0:r.name,fileSize:r==null?void 0:r.size})),e.jsxs("div",{className:"relative",children:[c?e.jsx("video",{src:t,controls:!0,className:"w-full max-h-64 object-cover rounded-xl",onError:n=>{console.error("‚ùå Video failed to load:",n),l.error("Failed to load video preview")}}):e.jsx("img",{src:t,alt:`Preview ${i+1}`,className:"w-full max-h-64 object-cover rounded-xl",onLoad:()=>console.log("‚úÖ Image preview loaded successfully"),onError:n=>{console.error("‚ùå Image failed to load:",n),l.error("Failed to load image preview")}}),e.jsx("button",{onClick:de,className:"absolute top-2 right-2 bg-black/50 hover:bg-black/70 text-white rounded-full p-2",children:e.jsx(K,{className:"w-5 h-5"})})]},i)}),s.length<4&&e.jsxs("label",{className:"cursor-pointer",children:[e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:t=>{const i=Array.from(t.target.files||[]),r=4-s.length,c=i.slice(0,r),n=[],y=[];for(const m of c){if(m.size>10*1024*1024){l.error(`${m.name} is too large (max 10MB)`);continue}if(!m.type.startsWith("image/")){l.error(`${m.name} is not an image`);continue}n.push(m),y.push(URL.createObjectURL(m))}n.length>0&&(u([...s,...n]),a([...o,...y]),l.success(`Added ${n.length} image${n.length>1?"s":""}`))},className:"hidden"}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-xl p-6 text-center hover:border-orange-500 transition-colors",children:[e.jsx(Q,{className:"w-8 h-8 mx-auto text-gray-400 mb-2"}),e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Add More Photos"}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:[s.length,"/4 selected"]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Add Music (optional)"}),e.jsxs("button",{onClick:()=>B(!0),className:"text-sm font-medium text-orange-600 hover:text-orange-700 flex items-center gap-1.5",children:[e.jsx(Ke,{className:"w-5 h-5"}),x?"Change Music":"Add Music"]})]}),x&&e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-green-50 rounded-lg border border-green-200",children:[e.jsx("img",{src:(pe=x.album.images[0])==null?void 0:pe.url,loading:"lazy",decoding:"async",alt:"album",className:"w-12 h-12 rounded object-cover"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:x.name}),e.jsx("p",{className:"text-xs text-gray-600 truncate",children:x.artists[0].name})]}),e.jsx("button",{onClick:Fe,className:"bg-green-600 hover:bg-green-700 text-white rounded-full p-2 transition-colors",children:H?e.jsx(Ge,{className:"w-4 h-4"}):e.jsx(Xe,{className:"w-4 h-4 ml-0.5"})}),e.jsx("button",{onClick:()=>J(null),className:"text-red-600",children:e.jsx(K,{className:"w-5 h-5"})}),e.jsx("audio",{ref:T,src:x.preview_url,onEnded:()=>z(!1),onPlay:()=>z(!0),onPause:()=>z(!1)})]})]}),e.jsxs("div",{className:"space-y-4 bg-white rounded-xl p-4 shadow-sm",children:[g==="post"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Title ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:N,onChange:t=>O(t.target.value),placeholder:"Enter a title for your post",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500",maxLength:200}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:[N.length,"/200"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Caption"}),e.jsx(Ae,{value:$,onChange:t=>ee(t.target.value),placeholder:"Write a caption...",className:"min-h-24 resize-none",maxLength:2200}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:[$.length,"/2200"]})]}),g==="post"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Link to Recipe (optional)"}),e.jsxs(We,{value:W,onValueChange:te,children:[e.jsx(Be,{children:e.jsx(qe,{placeholder:"Select a recipe from your collection"})}),e.jsx(Je,{children:se.length===0?e.jsx("div",{className:"p-4 text-center text-sm text-gray-500",children:"No recipes yet. Add some recipes first!"}):se.map(t=>e.jsx(He,{value:t.id,children:e.jsxs("div",{className:"flex items-center gap-2",children:[t.image_url&&e.jsx("img",{src:t.image_url,alt:t.title,className:"w-8 h-8 rounded object-cover",loading:"lazy",decoding:"async"}),e.jsx("span",{children:t.title})]})},t.id))})]})]})]}),s.length>0&&e.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ye,{className:"w-5 h-5 text-orange-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-orange-900",children:"Ready to post"}),e.jsxs("p",{className:"text-xs text-orange-700 mt-1 truncate",children:[s.length," image",s.length>1?"s":""," selected"]}),"              "]})]})})]}),e.jsx("div",{className:"fixed left-0 right-0 px-4 pb-6 bg-gradient-to-t from-white via-white to-transparent z-[60] lg:z-10 lg:bottom-0",style:{bottom:"80px",paddingBottom:"max(1.5rem, env(safe-area-inset-bottom))"},children:e.jsx("div",{className:"max-w-lg mx-auto flex justify-center",children:e.jsx(Te,{onClick:Ee,disabled:s.length===0||g==="post"&&!N.trim()||ae,className:"px-12 sm:px-16 py-5 sm:py-6 text-base sm:text-lg font-semibold bg-gradient-to-r from-orange-600 to-red-600 hover:from-orange-700 hover:to-red-700 shadow-lg rounded-full",children:ae?"Submitting...":"Submit"})})})]}),Ne&&e.jsx("div",{className:"fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white w-full md:max-w-lg rounded-2xl flex flex-col",style:{maxHeight:"85vh",paddingBottom:"env(safe-area-inset-bottom)"},children:[e.jsxs("div",{className:"p-4 border-b flex items-center justify-between flex-shrink-0",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Choose Music"}),e.jsx("button",{onClick:()=>B(!1),children:e.jsx(K,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"p-4 flex-shrink-0",children:e.jsx("input",{type:"text",value:ie,onChange:t=>{Pe(t.target.value),Re(t.target.value)},placeholder:"Search any song...",className:"w-full px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-500",autoFocus:!0})}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-4 pb-4 space-y-2",children:[ne&&e.jsx("p",{className:"text-center text-gray-500 py-8",children:"Searching..."}),le.map(t=>{var i;return e.jsxs("button",{onClick:()=>{J(t),B(!1),l.success("Music added!")},className:"w-full flex items-center gap-3 p-3 rounded-lg hover:bg-gray-100 transition text-left",children:[e.jsx("img",{src:((i=t.album.images[0])==null?void 0:i.url)||"/placeholder.png",loading:"lazy",decoding:"async",alt:"album",className:"w-12 h-12 rounded flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:t.name}),e.jsx("p",{className:"text-xs text-gray-600 truncate",children:t.artists.map(r=>r.name).join(", ")})]}),e.jsx("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded flex-shrink-0",children:"30s Preview"})]},t.id)}),ie&&le.length===0&&!ne&&e.jsx("p",{className:"text-center text-gray-500 py-8",children:"No tracks found"})]})]})})]})})}export{vt as Upload};
