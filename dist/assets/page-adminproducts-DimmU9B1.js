import{r as l,j as e,at as ue,au as Me,n as Ve,Y as le,a6 as ne,H as ce,av as qe,E as Le,aw as Re,U as Ue,_ as Ge,Q as Oe}from"./react-vendor-z9ssXL8w.js";import{f as oe,s as y,C as A,c as I,a as L,b as R,g as U,I as p,S as G,o as O,p as K,q as Y,r as D,B as g,h as de,L as o,T as Ke,D as Ye,i as He,j as Qe,k as We,t as Ze,l as Je}from"./page-addrecipe-Pb6dTsbS.js";import{T as Xe,a as es,b as H,c as Q}from"./page-adminpayouts-D8abdeR0.js";import{u as i}from"./vendor-Clj4czuh.js";import{f as ss}from"./services-BpcRR5rK.js";const W=l.forwardRef(({className:$,...E},S)=>e.jsx(ue,{ref:S,className:oe("peer h-4 w-4 shrink-0 rounded-sm border border-primary shadow focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",$),...E,children:e.jsx(Me,{className:oe("flex items-center justify-center text-current"),children:e.jsx(Ve,{className:"h-4 w-4"})})}));W.displayName=ue.displayName;const me="mealscrape-20";function as(){var te;const[$,E]=l.useState("list"),[S,he]=l.useState([]),[T,pe]=l.useState([]),[xe,Z]=l.useState(!1),[w,ge]=l.useState(""),[P,je]=l.useState("all"),[C,J]=l.useState(1),[X,fe]=l.useState(0),B=50,[rs,ve]=l.useState(null),[j,ye]=l.useState([]),[M,ee]=l.useState(!1),[_e,se]=l.useState(0),[k,be]=l.useState(null),[n,N]=l.useState(null),[we,z]=l.useState(!1),[t,u]=l.useState({product_name:"",category_id:"",asin:"",price:null,brand:"",package_size:"",description:"",image_url:"",is_prime:!1,search_keywords:[]}),[V,q]=l.useState(""),[_,ae]=l.useState(new Set),[Ne,re]=l.useState(!1);l.useEffect(()=>{Ce(),ke(),b()},[P,w,C]);async function Ce(){const{data:{user:s}}=await y.auth.getUser();if(!s){i.error("You must be logged in");return}const{data:a,error:r}=await y.from("admin_users").select("*").eq("user_id",s.id).maybeSingle();if(r||!a){i.error("You do not have admin access"),re(!1);return}re(!0)}async function ke(){try{const s=await ss();pe(s)}catch(s){console.error("Failed to load categories:",s),i.error("Failed to load categories")}}async function b(){Z(!0);try{let s=y.from("amazon_products").select("*",{count:"exact"});P!=="all"&&(s=s.eq("category_id",P)),w.trim()&&(s=s.or(`product_name.ilike.%${w}%,asin.ilike.%${w}%,brand.ilike.%${w}%`));const a=(C-1)*B,r=a+B-1,{data:c,error:d,count:f}=await s.order("created_at",{ascending:!1}).range(a,r);if(d)throw d;he(c||[]),fe(f||0)}catch(s){console.error("Failed to load products:",s),i.error("Failed to load products")}finally{Z(!1)}}function Se(s){var c;const a=(c=s.target.files)==null?void 0:c[0];if(!a)return;if(a.type!=="text/csv"&&!a.name.endsWith(".csv")){i.error("Please upload a CSV file");return}ve(a);const r=new FileReader;r.onload=d=>{var h;const f=(h=d.target)==null?void 0:h.result;Pe(f)},r.readAsText(a)}function Pe(s){const a=s.split(`
`).filter(h=>h.trim());if(a.length<2){i.error("CSV file is empty or invalid");return}const r=a[0].split(",").map(h=>h.trim().toLowerCase()),d=["asin","name","category"].filter(h=>!r.includes(h));if(d.length>0){i.error(`Missing required CSV columns: ${d.join(", ")}`);return}const f=[];for(let h=1;h<a.length;h++){const ie=a[h].split(",").map(x=>x.trim());if(ie.length!==r.length)continue;const m={asin:"",name:"",category:""};r.forEach((x,Be)=>{const v=ie[Be];x==="asin"?m.asin=v:x==="name"?m.name=v:x==="price"?m.price=v:x==="image_url"?m.image_url=v:x==="category"?m.category=v:x==="keywords"?m.keywords=v:x==="brand"?m.brand=v:x==="package_size"?m.package_size=v:x==="is_prime"&&(m.is_prime=v)}),m.asin&&m.name&&m.category&&f.push(m)}if(f.length===0){i.error("No valid products found in CSV");return}ye(f),i.success(`Parsed ${f.length} products from CSV`)}async function ze(){if(j.length===0){i.error("No data to import");return}ee(!0),se(0);const s={success:0,failed:0,errors:[]};for(let a=0;a<j.length;a++){const r=j[a];if(!Fe(r.asin)){s.failed++,s.errors.push(`Invalid ASIN: ${r.asin}`);continue}try{const c={category_id:r.category,product_name:r.name,description:"",amazon_url:`https://www.amazon.com/dp/${r.asin}?tag=${me}`,asin:r.asin,price:r.price?parseFloat(r.price):null,image_url:r.image_url||null,brand:r.brand||null,package_size:r.package_size||null,is_prime:r.is_prime==="true"||r.is_prime==="1",search_keywords:r.keywords?r.keywords.split(";").map(f=>f.trim()):[],popularity_score:0,is_active:!0},{error:d}=await y.from("amazon_products").insert(c);d?(d.code==="23505"?s.errors.push(`Duplicate ASIN: ${r.asin}`):s.errors.push(`${r.asin}: ${d.message}`),s.failed++):s.success++}catch(c){s.failed++,s.errors.push(`${r.asin}: ${c instanceof Error?c.message:"Unknown error"}`)}se(Math.round((a+1)/j.length*100))}be(s),ee(!1),i.success(`Import complete: ${s.success} succeeded, ${s.failed} failed`),b()}function Fe(s){return/^B[A-Z0-9]{9}$/.test(s)}async function Ae(s){if(confirm("Are you sure you want to delete this product?"))try{const{error:a}=await y.from("amazon_products").delete().eq("id",s);if(a)throw a;i.success("Product deleted"),b()}catch(a){console.error("Failed to delete product:",a),i.error("Failed to delete product")}}async function Ie(s){try{const{error:a}=await y.from("amazon_products").update({is_active:!s.is_active}).eq("id",s.id);if(a)throw a;i.success(`Product ${s.is_active?"deactivated":"activated"}`),b()}catch(a){console.error("Failed to toggle product:",a),i.error("Failed to update product")}}async function De(s){try{const a={...s,amazon_url:s.asin?`https://www.amazon.com/dp/${s.asin}?tag=${me}`:s.amazon_url},{error:r}=await y.from("amazon_products").insert(a);if(r)throw r;i.success("Product added successfully"),u({product_name:"",category_id:"",asin:"",price:null,brand:"",package_size:"",description:"",image_url:"",is_prime:!1,search_keywords:[]}),q(""),b()}catch(a){console.error("Failed to add product:",a),i.error("Failed to add product")}}async function $e(){if(n)try{const{error:s}=await y.from("amazon_products").update({product_name:n.product_name,category_id:n.category_id,price:n.price,brand:n.brand,package_size:n.package_size,description:n.description,image_url:n.image_url,is_prime:n.is_prime,search_keywords:n.search_keywords}).eq("id",n.id);if(s)throw s;i.success("Product updated"),z(!1),N(null),b()}catch(s){console.error("Failed to update product:",s),i.error("Failed to update product")}}function Ee(){if(_.size===0){i.error("No products selected");return}confirm(`Delete ${_.size} products?`)&&Promise.all(Array.from(_).map(s=>y.from("amazon_products").delete().eq("id",s))).then(()=>{i.success(`Deleted ${_.size} products`),ae(new Set),b()}).catch(s=>{console.error("Bulk delete failed:",s),i.error("Failed to delete products")})}function Te(){const s=`asin,name,price,image_url,category,keywords,brand,package_size,is_prime
B001E5E3KG,Gold Medal All-Purpose Flour 5lb,4.99,https://m.media-amazon.com/images/I/example.jpg,baking,flour;baking;all-purpose,Gold Medal,5 lb,true
B00I8G8AKO,Domino Pure Cane Granulated Sugar 4lb,3.99,https://m.media-amazon.com/images/I/example.jpg,baking,sugar;white;granulated,Domino,4 lb,true`,a=new Blob([s],{type:"text/csv"}),r=URL.createObjectURL(a),c=document.createElement("a");c.href=r,c.download="sample-products.csv",c.click(),URL.revokeObjectURL(r)}if(!Ne)return e.jsx("div",{className:"max-w-4xl mx-auto p-6",children:e.jsx(A,{children:e.jsx(I,{className:"pt-6",children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(le,{className:"w-16 h-16 mx-auto mb-4 text-red-500"}),e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"Access Denied"}),e.jsx("p",{className:"text-gray-600",children:"You do not have admin privileges to access this page."})]})})})});const F=Math.ceil(X/B);return e.jsxs("div",{className:"max-w-7xl mx-auto p-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Product Management"}),e.jsx("p",{className:"text-gray-600",children:"Manage Amazon affiliate products and bulk imports"})]}),e.jsxs(Xe,{value:$,onValueChange:E,children:[e.jsxs(es,{className:"mb-6",children:[e.jsx(H,{value:"list",children:"Product List"}),e.jsx(H,{value:"import",children:"Bulk Import"}),e.jsx(H,{value:"add",children:"Add Single Product"})]}),e.jsx(Q,{value:"list",children:e.jsxs(A,{children:[e.jsxs(L,{children:[e.jsxs(R,{children:["All Products (",X,")"]}),e.jsx(U,{children:"Search, filter, and manage products"})]}),e.jsxs(I,{children:[e.jsxs("div",{className:"flex gap-4 mb-6",children:[e.jsx("div",{className:"flex-1",children:e.jsx(p,{placeholder:"Search by name, ASIN, or brand...",value:w,onChange:s=>ge(s.target.value),className:"w-full"})}),e.jsxs(G,{value:P,onValueChange:je,children:[e.jsx(O,{className:"w-48",children:e.jsx(K,{placeholder:"All Categories"})}),e.jsxs(Y,{children:[e.jsx(D,{value:"all",children:"All Categories"}),T.map(s=>e.jsxs(D,{value:s.id,children:[s.icon," ",s.name]},s.id))]})]})]}),_.size>0&&e.jsx("div",{className:"mb-4 flex gap-2",children:e.jsxs(g,{variant:"destructive",size:"sm",onClick:Ee,children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Delete Selected (",_.size,")"]})}),xe?e.jsx("div",{className:"text-center py-12",children:e.jsx(ce,{className:"w-8 h-8 animate-spin mx-auto"})}):S.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(qe,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{children:"No products found"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-2",children:S.map(s=>e.jsxs("div",{className:"flex items-center gap-4 p-4 border rounded-lg hover:bg-gray-50",children:[e.jsx(W,{checked:_.has(s.id),onCheckedChange:a=>{const r=new Set(_);a?r.add(s.id):r.delete(s.id),ae(r)}}),s.image_url&&e.jsx("img",{src:s.image_url,alt:s.product_name,className:"w-16 h-16 object-cover rounded"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-medium",children:s.product_name}),e.jsxs("div",{className:"flex gap-2 mt-1 text-sm text-gray-600",children:[e.jsxs("span",{children:["ASIN: ",s.asin]}),s.price&&e.jsxs("span",{children:["• $",s.price.toFixed(2)]}),s.brand&&e.jsxs("span",{children:["• ",s.brand]})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(de,{variant:s.is_active?"default":"secondary",children:s.is_active?"Active":"Inactive"}),e.jsx(g,{size:"sm",variant:"outline",onClick:()=>{N(s),z(!0)},children:e.jsx(Le,{className:"w-4 h-4"})}),e.jsx(g,{size:"sm",variant:"outline",onClick:()=>Ie(s),children:s.is_active?"Deactivate":"Activate"}),e.jsx(g,{size:"sm",variant:"destructive",onClick:()=>Ae(s.id),children:e.jsx(ne,{className:"w-4 h-4"})})]})]},s.id))}),F>1&&e.jsxs("div",{className:"flex justify-center gap-2 mt-6",children:[e.jsx(g,{variant:"outline",size:"sm",onClick:()=>J(s=>Math.max(1,s-1)),disabled:C===1,children:"Previous"}),e.jsxs("span",{className:"py-2 px-4 text-sm",children:["Page ",C," of ",F]}),e.jsx(g,{variant:"outline",size:"sm",onClick:()=>J(s=>Math.min(F,s+1)),disabled:C===F,children:"Next"})]})]})]})]})}),e.jsx(Q,{value:"import",children:e.jsxs(A,{children:[e.jsxs(L,{children:[e.jsx(R,{children:"Bulk Product Import"}),e.jsx(U,{children:"Upload a CSV file to import multiple products at once"})]}),e.jsxs(I,{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs(g,{variant:"outline",onClick:Te,className:"mb-4",children:[e.jsx(Re,{className:"w-4 h-4 mr-2"}),"Download Sample CSV"]}),e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Required columns: asin, name, category"}),e.jsx("p",{className:"text-sm text-gray-600 mb-4",children:"Optional columns: price, image_url, keywords, brand, package_size, is_prime"}),e.jsx(p,{type:"file",accept:".csv",onChange:Se,disabled:M})]}),j.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"font-semibold mb-2",children:["Preview (",j.length," products)"]}),e.jsxs("div",{className:"max-h-64 overflow-y-auto border rounded p-4 space-y-2",children:[j.slice(0,10).map((s,a)=>e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:s.name}),e.jsxs("span",{className:"text-gray-600",children:[" • ASIN: ",s.asin]}),e.jsxs("span",{className:"text-gray-600",children:[" • Category: ",s.category]})]},a)),j.length>10&&e.jsxs("p",{className:"text-sm text-gray-500",children:["...and ",j.length-10," more"]})]}),e.jsx(g,{onClick:ze,disabled:M,className:"mt-4",children:M?e.jsxs(e.Fragment,{children:[e.jsx(ce,{className:"w-4 h-4 mr-2 animate-spin"}),"Importing ",_e,"%"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ue,{className:"w-4 h-4 mr-2"}),"Import ",j.length," Products"]})})]}),k&&e.jsxs("div",{className:"border rounded p-4 bg-gray-50",children:[e.jsx("h3",{className:"font-semibold mb-2",children:"Import Results"}),e.jsxs("div",{className:"flex gap-4 mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"w-5 h-5 text-green-600"}),e.jsxs("span",{className:"text-green-600 font-medium",children:[k.success," succeeded"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"w-5 h-5 text-red-600"}),e.jsxs("span",{className:"text-red-600 font-medium",children:[k.failed," failed"]})]})]}),k.errors.length>0&&e.jsxs("div",{className:"max-h-48 overflow-y-auto",children:[e.jsx("p",{className:"font-medium text-sm mb-2",children:"Errors:"}),k.errors.map((s,a)=>e.jsxs("p",{className:"text-sm text-red-600",children:["• ",s]},a))]})]})]})]})}),e.jsx(Q,{value:"add",children:e.jsxs(A,{children:[e.jsxs(L,{children:[e.jsx(R,{children:"Add Single Product"}),e.jsx(U,{children:"Manually add a new product to the catalog"})]}),e.jsxs(I,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{htmlFor:"asin",children:"ASIN *"}),e.jsx(p,{id:"asin",value:t.asin||"",onChange:s=>u({...t,asin:s.target.value}),placeholder:"B001E5E3KG"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"name",children:"Product Name *"}),e.jsx(p,{id:"name",value:t.product_name||"",onChange:s=>u({...t,product_name:s.target.value}),placeholder:"Gold Medal All-Purpose Flour"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"category",children:"Category *"}),e.jsxs(G,{value:t.category_id||"",onValueChange:s=>u({...t,category_id:s}),children:[e.jsx(O,{children:e.jsx(K,{placeholder:"Select category"})}),e.jsx(Y,{children:T.map(s=>e.jsxs(D,{value:s.id,children:[s.icon," ",s.name]},s.id))})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"price",children:"Price"}),e.jsx(p,{id:"price",type:"number",step:"0.01",value:t.price||"",onChange:s=>u({...t,price:parseFloat(s.target.value)||null}),placeholder:"4.99"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"brand",children:"Brand"}),e.jsx(p,{id:"brand",value:t.brand||"",onChange:s=>u({...t,brand:s.target.value}),placeholder:"Gold Medal"})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"package_size",children:"Package Size"}),e.jsx(p,{id:"package_size",value:t.package_size||"",onChange:s=>u({...t,package_size:s.target.value}),placeholder:"5 lb"})]})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"image_url",children:"Image URL"}),e.jsx(p,{id:"image_url",value:t.image_url||"",onChange:s=>u({...t,image_url:s.target.value}),placeholder:"https://m.media-amazon.com/images/I/..."})]}),e.jsxs("div",{children:[e.jsx(o,{htmlFor:"description",children:"Description"}),e.jsx(Ke,{id:"description",value:t.description||"",onChange:s=>u({...t,description:s.target.value}),placeholder:"Product description...",rows:3})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Keywords"}),e.jsx("div",{className:"flex gap-2 mb-2",children:e.jsx(p,{value:V,onChange:s=>q(s.target.value),placeholder:"Enter keyword and press Enter",onKeyDown:s=>{s.key==="Enter"&&V.trim()&&(s.preventDefault(),u({...t,search_keywords:[...t.search_keywords||[],V.trim()]}),q(""))}})}),e.jsx("div",{className:"flex flex-wrap gap-2",children:(te=t.search_keywords)==null?void 0:te.map((s,a)=>e.jsxs(de,{variant:"secondary",className:"cursor-pointer",onClick:()=>{var r;u({...t,search_keywords:(r=t.search_keywords)==null?void 0:r.filter((c,d)=>d!==a)})},children:[s," ×"]},a))})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{id:"is_prime",checked:t.is_prime||!1,onCheckedChange:s=>u({...t,is_prime:!!s})}),e.jsx(o,{htmlFor:"is_prime",children:"Amazon Prime eligible"})]}),e.jsxs(g,{onClick:()=>De(t),disabled:!t.asin||!t.product_name||!t.category_id,children:[e.jsx(Oe,{className:"w-4 h-4 mr-2"}),"Add Product"]})]})]})})]}),e.jsx(Ye,{open:we,onOpenChange:z,children:e.jsxs(He,{className:"max-w-2xl max-h-[80vh] overflow-y-auto",children:[e.jsxs(Qe,{children:[e.jsx(We,{children:"Edit Product"}),e.jsx(Ze,{children:"Update product information"})]}),n&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(o,{children:"Product Name"}),e.jsx(p,{value:n.product_name,onChange:s=>N({...n,product_name:s.target.value})})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Category"}),e.jsxs(G,{value:n.category_id,onValueChange:s=>N({...n,category_id:s}),children:[e.jsx(O,{children:e.jsx(K,{})}),e.jsx(Y,{children:T.map(s=>e.jsxs(D,{value:s.id,children:[s.icon," ",s.name]},s.id))})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(o,{children:"Price"}),e.jsx(p,{type:"number",step:"0.01",value:n.price||"",onChange:s=>N({...n,price:parseFloat(s.target.value)||null})})]}),e.jsxs("div",{children:[e.jsx(o,{children:"Brand"}),e.jsx(p,{value:n.brand||"",onChange:s=>N({...n,brand:s.target.value})})]})]})]}),e.jsxs(Je,{children:[e.jsx(g,{variant:"outline",onClick:()=>z(!1),children:"Cancel"}),e.jsx(g,{onClick:$e,children:"Save Changes"})]})]})})]})}const os=Object.freeze(Object.defineProperty({__proto__:null,AdminProducts:as},Symbol.toStringTag,{value:"Module"}));export{os as A,W as C};
