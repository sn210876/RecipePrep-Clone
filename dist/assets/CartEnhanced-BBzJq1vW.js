import{r as l,s as m,f as t,j as e,C as x,t as ee,v as se,B as n,S as z,m as h,I as A,z as k}from"./index-BxbvCLt6.js";import{S as ae,a as re,b as te,c as oe,d as P}from"./select-3V8DpKAW.js";import{B as q}from"./badge-DnoLq4YS.js";import{g as le,s as ne,d as ce,a as f,c as ie}from"./amazonProductService-DRldnz8d.js";import{S as de}from"./search-CYZJNwNb.js";import{P as E}from"./package-gBcstM8o.js";import{E as F}from"./external-link-Bd9oD5x8.js";import{M as me}from"./minus-DGExF-0p.js";import{T as xe}from"./trash-2-D-f8tCue.js";import{C as he}from"./credit-card-DUrhG3m5.js";import"./react-icons.esm-DXx3z0uL.js";import"./index-DMw0seIa.js";import"./index-BdQq_4o_.js";import"./index-DW8FhmHM.js";import"./index-DS93o9T5.js";import"./index-BItjzvVO.js";import"./index-CbJhEsde.js";import"./index--MoHVi7U.js";import"./index-B8ZTZloB.js";function Fe({onNavigate:j}={}){const[i,u]=l.useState([]),[T,I]=l.useState(!0),[g,$]=l.useState(null),[B,L]=l.useState([]),[N,U]=l.useState([]),[d,R]=l.useState("all"),[p,Q]=l.useState(""),[V,y]=l.useState(!1),[b,M]=l.useState(!0),v=l.useRef(null),Y=()=>{var s;(s=v.current)==null||s.scrollIntoView({behavior:"smooth",block:"start"})};l.useEffect(()=>{C(),G(),_()},[]),l.useEffect(()=>{_()},[d,p]);const C=async()=>{try{const{data:s}=await m.auth.getUser();if(!s.user)return;$(s.user.id);const{data:a,error:r}=await m.from("cart_items").select("*").eq("user_id",s.user.id).order("created_at",{ascending:!1});if(r)throw r;u(a||[])}catch(s){console.error("Error loading cart:",s),t.error("Failed to load cart")}finally{I(!1)}},G=async()=>{try{const s=await le();L(s)}catch(s){console.error("Error loading categories:",s)}},_=async()=>{y(!0);try{let s;if(p.trim())s=await ne(p,d==="all"?void 0:d);else if(d!=="all")s=await ce(d);else{const{data:a,error:r}=await m.from("amazon_products").select("*").eq("is_active",!0).order("popularity_score",{ascending:!1}).limit(24);if(r)throw r;s=a||[]}U(s)}catch(s){console.error("Error loading products:",s),t.error("Failed to load products")}finally{y(!1)}},H=async s=>{if(!g){t.error("Please sign in to add items to cart");return}try{await ie(g,s,"1",s.package_size||""),await C(),t.success(`Added ${s.product_name} to cart`)}catch(a){console.error("Error adding to cart:",a),t.error("Failed to add item to cart")}},w=async(s,a)=>{try{const{error:r}=await m.from("cart_items").update({quantity:a}).eq("id",s);if(r)throw r;u(o=>o.map(c=>c.id===s?{...c,quantity:a}:c)),t.success("Quantity updated")}catch(r){console.error("Error updating quantity:",r),t.error("Failed to update quantity")}},O=async s=>{try{const{error:a}=await m.from("cart_items").delete().eq("id",s);if(a)throw a;u(r=>r.filter(o=>o.id!==s)),t.success("Item removed from cart")}catch(a){console.error("Error removing item:",a),t.error("Failed to remove item")}},W=async()=>{if(g&&confirm("Are you sure you want to clear your entire cart?"))try{const{error:s}=await m.from("cart_items").delete().eq("user_id",g);if(s)throw s;u([]),t.success("Cart cleared")}catch(s){console.error("Error clearing cart:",s),t.error("Failed to clear cart")}},D=()=>i.reduce((s,a)=>{const r=a.price||0,o=parseFloat(a.quantity)||1;return s+r*o},0),J=()=>{if(i.length===0){t.error("Your cart is empty");return}const s=i.filter(r=>r.asin),a=i.filter(r=>!r.asin&&r.amazon_product_url);if(s.length>0){const r=K(s);window.open(r,"_blank"),a.length>0?(t.success(`Added ${s.length} items to Amazon cart. Opening ${a.length} additional items...`),a.forEach((o,c)=>{setTimeout(()=>{window.open(f(o.amazon_product_url),"_blank")},(c+1)*300)})):t.success(`Added ${s.length} items to Amazon cart!`)}else a.length>0?(a.forEach((r,o)=>{setTimeout(()=>{window.open(f(r.amazon_product_url),"_blank")},o*300)}),t.success("Opening Amazon product pages...")):t.error("No Amazon products in cart")},K=s=>{const a="mealscrape-20",r="https://www.amazon.com/gp/aws/cart/add.html",o=new URLSearchParams;return s.forEach((c,X)=>{const S=X+1;o.append(`ASIN.${S}`,c.asin);const Z=parseInt(c.quantity)||1;o.append(`Quantity.${S}`,Z.toString())}),o.append("tag",a),`${r}?${o.toString()}`};return T?e.jsx("div",{className:"flex items-center justify-center h-screen bg-gradient-to-br from-slate-50 via-white to-orange-50",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-600"})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-white to-orange-50 pb-32",children:e.jsxs("div",{className:"max-w-7xl mx-auto p-4 md:p-6",children:[e.jsxs(x,{className:"mb-6 border-4 border-orange-500",children:[e.jsx(ee,{className:"bg-gradient-to-r from-orange-50 to-amber-50 text-center",children:e.jsxs("div",{children:[e.jsx(se,{className:"text-lg sm:text-xl mb-2",children:"Amazon Product Catalog"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Browse and add pantry staples to your cart"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 justify-center",children:[e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>M(!b),className:"w-full sm:w-auto",children:[b?"Hide":"Show"," Catalog"]}),e.jsxs(n,{variant:"outline",size:"sm",onClick:Y,className:"w-full sm:w-auto bg-orange-50 hover:bg-orange-100 border-orange-300",children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),"Show Cart"]})]})]})}),b&&e.jsxs(h,{className:"pt-6",children:[e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(de,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx(A,{type:"text",placeholder:"Search products...",value:p,onChange:s=>Q(s.target.value),className:"pl-10 h-12"})]}),e.jsxs(ae,{value:d,onValueChange:R,children:[e.jsx(re,{className:"h-12",children:e.jsx(te,{placeholder:"All Categories"})}),e.jsxs(oe,{children:[e.jsx(P,{value:"all",children:"All Categories"}),B.map(s=>e.jsx(P,{value:s.id,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:s.icon}),e.jsx("span",{children:s.name})]})},s.id))]})]})]}),V?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-600"})}):N.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(E,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{children:"No products found. Try a different search or category."})]}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4",children:N.map(s=>e.jsxs(x,{className:"overflow-hidden hover:shadow-lg transition-shadow group border-4 border-orange-500",children:[e.jsx("div",{className:"aspect-square bg-gray-100 flex items-center justify-center p-4",children:s.image_url?e.jsx("img",{src:s.image_url,alt:s.product_name,className:"w-full h-full object-contain"}):e.jsx(E,{className:"w-16 h-16 text-gray-300"})}),e.jsxs(h,{className:"p-3",children:[e.jsx("h3",{className:"font-semibold text-sm line-clamp-2 mb-1 min-h-[2.5rem]",children:s.product_name}),s.brand&&e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:s.brand}),s.package_size&&e.jsx(q,{variant:"secondary",className:"text-xs mb-2",children:s.package_size}),s.price&&e.jsxs("p",{className:"text-lg font-bold text-orange-600 mb-2",children:["$",s.price.toFixed(2)]}),s.is_prime&&e.jsx(q,{className:"bg-blue-500 text-white text-xs mb-2",children:"Prime"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(n,{size:"sm",className:"flex-1 bg-orange-500 hover:bg-orange-600 text-white",onClick:()=>H(s),children:[e.jsx(k,{className:"w-4 h-4 mr-1"}),"Add"]}),e.jsx(n,{size:"sm",variant:"outline",asChild:!0,children:e.jsx("a",{href:f(s.amazon_url),target:"_blank",rel:"noopener noreferrer",children:e.jsx(F,{className:"w-4 h-4"})})})]})]})]},s.id))})]})]}),e.jsx("div",{ref:v,children:i.length===0?e.jsx(x,{className:"w-full max-w-sm mx-auto border-4 border-orange-500",children:e.jsxs(h,{className:"flex flex-col items-center justify-center py-12 px-6",children:[e.jsx(z,{className:"w-16 h-16 text-gray-300 mb-4"}),e.jsx("p",{className:"text-gray-500 text-center mb-4 text-sm md:text-base",children:"Your cart is empty. Browse products above or add items from your meal planner!"}),e.jsx(n,{onClick:()=>j==null?void 0:j("meal-planner"),className:"bg-orange-600 hover:bg-orange-700 text-white",children:"Go to Meal Planner"})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Your Cart"}),e.jsx(n,{variant:"outline",size:"sm",onClick:W,className:"text-xs md:text-sm border-red-500 text-red-600 hover:bg-red-50 hover:text-red-700 hover:border-red-600",children:"Clear All"})]}),e.jsx("div",{className:"space-y-3 md:space-y-4 mb-6",children:i.map(s=>e.jsx(x,{className:"overflow-hidden hover:shadow-md transition-shadow border-4 border-orange-500",children:e.jsx(h,{className:"p-3 md:p-4",children:e.jsxs("div",{className:"flex gap-3 md:gap-4",children:[s.image_url&&e.jsx("div",{className:"shrink-0",children:e.jsx("img",{src:s.image_url,alt:s.amazon_product_name||s.ingredient_name,className:"w-20 h-20 md:w-24 md:h-24 object-cover rounded-lg bg-slate-100"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-sm md:text-lg text-slate-900 line-clamp-2 mb-1",children:s.amazon_product_name||s.ingredient_name}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-slate-100 rounded-lg w-fit p-1",children:[e.jsx(n,{size:"sm",variant:"ghost",onClick:()=>{const a=parseFloat(s.quantity)||1;a>1&&w(s.id,(a-1).toString())},className:"h-7 w-7 p-0 hover:bg-slate-200",children:e.jsx(me,{className:"w-3 h-3"})}),e.jsx(A,{type:"text",value:s.quantity,onChange:a=>w(s.id,a.target.value),className:"w-12 md:w-16 text-center text-sm h-7 border-0 bg-transparent"}),e.jsx(n,{size:"sm",variant:"ghost",onClick:()=>{const a=parseFloat(s.quantity)||1;w(s.id,(a+1).toString())},className:"h-7 w-7 p-0 hover:bg-slate-200",children:e.jsx(k,{className:"w-3 h-3"})})]}),e.jsx("span",{className:"text-xs md:text-sm text-gray-600",children:s.unit})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2 justify-between",children:[s.price&&e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm md:text-lg font-semibold text-orange-600",children:["$",(s.price*(parseFloat(s.quantity)||1)).toFixed(2)]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["$",s.price.toFixed(2)," each"]})]}),e.jsxs("div",{className:"flex gap-1 flex-col",children:[s.amazon_product_url&&e.jsxs("a",{href:f(s.amazon_product_url),target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center gap-1 text-xs md:text-sm text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded px-2 py-1 transition-colors",children:[e.jsx(F,{className:"w-3 h-3"}),e.jsx("span",{className:"hidden sm:inline",children:"View"})]}),e.jsxs(n,{size:"sm",variant:"ghost",onClick:()=>O(s.id),className:"text-red-600 hover:text-red-700 hover:bg-red-50 text-xs md:text-sm h-7 px-2",children:[e.jsx(xe,{className:"w-3 h-3 md:w-4 md:h-4 mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Remove"})]})]})]})]})})},s.id))}),e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx(x,{className:"mb-4 bg-slate-50 border-4 border-orange-500",children:e.jsx(h,{className:"p-4 md:p-6",children:e.jsxs("div",{className:"space-y-2 text-sm md:text-base",children:[e.jsxs("div",{className:"flex justify-between text-slate-700",children:[e.jsxs("span",{children:["Subtotal (",i.length," items)"]}),e.jsxs("span",{className:"font-medium",children:["$",D().toFixed(2)]})]}),e.jsx("div",{className:"flex justify-between text-slate-600 text-xs md:text-sm",children:e.jsx("span",{children:"Prices from Amazon â€¢ Shipping & taxes calculated at checkout"})})]})})}),e.jsx("div",{className:"fixed bottom-[80px] lg:relative lg:bottom-0 left-0 right-0 z-[150] lg:z-10 pointer-events-none",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-3 pointer-events-auto flex flex-col items-center",children:[e.jsxs(n,{className:"w-auto bg-gradient-to-r from-orange-600 to-red-600 hover:from-orange-700 hover:to-red-700 text-white font-semibold h-12 md:h-14 shadow-lg rounded-full transition-all transform active:scale-95 px-6",size:"lg",onClick:J,children:[e.jsx(he,{className:"w-5 h-5 mr-2"}),"Send To Amazon Cart"]}),e.jsx("p",{className:"text-xs text-center text-gray-500 mt-2"})]})})]})]})})]})})}export{Fe as Cart};
