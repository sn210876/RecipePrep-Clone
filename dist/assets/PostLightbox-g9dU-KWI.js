import{c as C,r as l,j as e,B as i,X as _,h as D,s as r,f as k}from"./index-Cf-ALqSY.js";import{D as q,g as E,h as H,a as B}from"./dialog-BOIgpWFS.js";import{C as R}from"./CommentModal-B8MQ5MWs.js";import{C as T,a as $}from"./chevron-right-BLBmYMGO.js";import{H as F}from"./heart-DD4jJHqG.js";/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q=C("Crown",[["path",{d:"M11.562 3.266a.5.5 0 0 1 .876 0L15.39 8.87a1 1 0 0 0 1.516.294L21.183 5.5a.5.5 0 0 1 .798.519l-2.834 10.246a1 1 0 0 1-.956.734H5.81a1 1 0 0 1-.957-.734L2.02 6.02a.5.5 0 0 1 .798-.519l4.276 3.664a1 1 0 0 0 1.516-.294z",key:"1vdc57"}],["path",{d:"M5 21h14",key:"11awu3"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U=C("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]);function V({media:o,initialIndex:y=0,open:h,onOpenChange:w,postId:t,onLikeUpdate:n}){const[s,f]=l.useState(y),[v,u]=l.useState(!1),[O,m]=l.useState(0),[g,N]=l.useState(null),[p,b]=l.useState(!1);l.useEffect(()=>{(async()=>{var j;if(!t||!h)return;const{data:c}=await r.auth.getUser(),x=((j=c.user)==null?void 0:j.id)||null;if(N(x),!x)return;const{data:S}=await r.from("likes").select("id").eq("post_id",t).eq("user_id",x).maybeSingle();u(!!S);const{count:M}=await r.from("likes").select("*",{count:"exact",head:!0}).eq("post_id",t);m(M||0)})()},[t,h]);const z=async()=>{if(!t||!g){k.error("Please sign in to like posts");return}try{v?(await r.from("likes").delete().eq("post_id",t).eq("user_id",g),u(!1),m(a=>Math.max(0,a-1))):(await r.from("likes").insert({post_id:t,user_id:g}),u(!0),m(a=>a+1)),n&&n()}catch(a){console.error("Error toggling like:",a),k.error("Failed to update like")}},L=()=>{s<o.length-1&&f(s+1)},P=()=>{s>0&&f(s-1)},d=o[s];return e.jsxs(q,{open:h,onOpenChange:w,children:[e.jsxs(E,{children:[e.jsx(H,{className:"z-[9999998] bg-black/95"}),e.jsx(B,{className:"max-w-[95vw] max-h-[95vh] p-0 bg-black border-0 overflow-hidden z-[9999999]",children:e.jsxs("div",{className:"relative w-full h-full flex items-center justify-center",children:[e.jsx(i,{variant:"ghost",size:"icon",className:"absolute top-2 right-2 z-[10] bg-white/95 hover:bg-white shadow-lg rounded-full min-h-[44px] min-w-[44px] touch-manipulation active:scale-95",onClick:()=>w(!1),children:e.jsx(_,{className:"w-5 h-5"})}),o.length>1&&s>0&&e.jsx(i,{variant:"ghost",size:"icon",className:"absolute left-2 top-1/2 -translate-y-1/2 z-[10] bg-white/95 hover:bg-white shadow-lg rounded-full min-h-[44px] min-w-[44px] touch-manipulation active:scale-95",onClick:P,children:e.jsx(T,{className:"w-6 h-6"})}),o.length>1&&s<o.length-1&&e.jsx(i,{variant:"ghost",size:"icon",className:"absolute right-2 top-1/2 -translate-y-1/2 z-[10] bg-white/95 hover:bg-white shadow-lg rounded-full min-h-[44px] min-w-[44px] touch-manipulation active:scale-95",onClick:L,children:e.jsx($,{className:"w-6 h-6"})}),d.type==="video"?e.jsx("video",{src:d.url,controls:!0,className:"max-w-full max-h-[95vh] w-auto h-auto",autoPlay:!0}):e.jsx("img",{src:d.url,alt:"Post",className:"max-w-full max-h-[95vh] w-auto h-auto object-contain",loading:"lazy"}),o.length>1&&e.jsx("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 flex gap-1.5",children:o.map((a,c)=>e.jsx("div",{className:`w-2 h-2 rounded-full transition-all ${c===s?"bg-white w-6":"bg-white/50"}`},c))}),t&&e.jsxs("div",{className:"absolute bottom-4 right-4 flex flex-col gap-3 z-[10]",children:[e.jsx(i,{variant:"ghost",size:"icon",onClick:a=>{a.stopPropagation(),z()},className:"bg-white/95 hover:bg-white shadow-lg rounded-full min-h-[48px] min-w-[48px] touch-manipulation active:scale-95",children:e.jsx(F,{className:`w-6 h-6 ${v?"fill-red-500 text-red-500":"text-gray-700"}`})}),e.jsx(i,{variant:"ghost",size:"icon",onClick:a=>{a.stopPropagation(),b(!0)},className:"bg-white/95 hover:bg-white shadow-lg rounded-full min-h-[48px] min-w-[48px] touch-manipulation active:scale-95",children:e.jsx(D,{className:"w-6 h-6 text-gray-700"})})]})]})})]}),p&&t&&e.jsx(R,{postId:t,isOpen:p,onClose:()=>b(!1),onCommentPosted:()=>{n&&n()}})]})}export{Q as C,V as P,U as a};
