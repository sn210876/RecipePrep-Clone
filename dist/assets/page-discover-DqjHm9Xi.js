const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/services-TCLpZZGf.js","assets/page-addrecipe-DiItHnEU.js","assets/capacitor-vendor-Dh3Cr3CD.js","assets/react-vendor-CdxBdSXn.js","assets/vendor-Bm4oc8-A.js","assets/supabase-vendor-D9HjG51c.js","assets/page-grocerylist-BWuPGfVx.js","assets/page-adminproducts-DHDRaIIe.js","assets/page-adminpayouts-CXMXNcRe.js","assets/page-blog-2K1uxyE3.js"])))=>i.map(i=>d[i]);
import{_ as bs}from"./capacitor-vendor-Dh3Cr3CD.js";import{r as n,j as e,aq as Qe,aZ as Bs,a_ as Vs,aQ as ls,a$ as Hs,b0 as Ws,M as ws,aT as Xs,Q as Ys,b1 as Js,b2 as Ks,b3 as vs,b4 as js,b5 as Gs,b6 as ys,b7 as Xe,b8 as Ye,X as De,b9 as Qs,K as Zs,Z as et,ba as st,aS as tt,bb as at,N as rt,bc as Ie,bd as ts,aM as os,be as cs,bf as We,bg as lt,bh as it,a6 as is,bi as ns,ao as nt,bj as ot,bk as ct,aL as dt,bl as mt,aY as xs,bm as ut}from"./react-vendor-CdxBdSXn.js";import{B as D,D as Se,y as Je,z as Ke,i as Ce,A as ht,k as Ae,h as Ve,s as d,I as xt,j as Ge,u as gt,T as ft}from"./page-addrecipe-DiItHnEU.js";import{u as S}from"./vendor-Bm4oc8-A.js";import{S as as,f as pt,g as bt,h as wt,i as vt,j as jt,k as yt,l as Nt,m as kt}from"./page-adminpayouts-CXMXNcRe.js";import{C as gs}from"./page-adminproducts-DHDRaIIe.js";import{F as fs}from"./services-TCLpZZGf.js";import{D as _t,a as St,b as Ct,c as ps}from"./page-blog-2K1uxyE3.js";function Mt({recipe:a,onClose:E}){var k;console.log("[CookMode] Recipe videoUrl:",a.videoUrl);const[w,z]=n.useState(0),[A,V]=n.useState(new Set),[q,ee]=n.useState(new Set),[I,T]=n.useState(!1),[se,G]=n.useState(!1),[U,N]=n.useState(0),[re,Q]=n.useState(!0),[Y,de]=n.useState(!1),[le,te]=n.useState(a.servings||4),[O,p]=n.useState(!1),m=n.useRef(null),ne=n.useRef(null),v=a.steps&&a.steps.length>0?a.steps:a.instructions.map((i,t)=>({stepNumber:t+1,instruction:i,technique:"",duration:void 0}));n.useEffect(()=>{if(I&&!se&&U>0){const i=setInterval(()=>{N(t=>t<=1?(T(!1),G(!1),re&&W(),0):t-1)},1e3);return()=>clearInterval(i)}},[I,se,U,re]);const W=()=>{const i=new(window.AudioContext||window.webkitAudioContext),t=i.createOscillator(),u=i.createGain();t.connect(u),u.connect(i.destination),t.frequency.value=800,t.type="sine",u.gain.setValueAtTime(.3,i.currentTime),u.gain.exponentialRampToValueAtTime(.01,i.currentTime+.5),t.start(i.currentTime),t.stop(i.currentTime+.5)},he=i=>{m.current=i.touches[0].clientX},me=i=>{ne.current=i.touches[0].clientX},ve=()=>{if(!m.current||!ne.current)return;const i=m.current-ne.current;Math.abs(i)>50&&(i>0&&w<v.length-1?fe():i<0&&w>0&&ue()),m.current=null,ne.current=null},fe=()=>{w<v.length-1&&(z(w+1),xe())},ue=()=>{w>0&&(z(w-1),xe())},xe=()=>{T(!1),G(!1),N(0)},be=()=>{const i=v[w];if(i!=null&&i.duration){const t=i.duration.match(/(\d+)/);if(t){const u=parseInt(t[1]);N(u*60),T(!0),G(!1)}}},ze=()=>{I?G(!se):be()},ge=i=>{const t=Math.floor(i/60),u=i%60;return`${t}:${u.toString().padStart(2,"0")}`},Ne=i=>{V(t=>{const u=new Set(t);return u.has(i)?u.delete(i):u.add(i),u})},je=i=>{ee(t=>{const u=new Set(t);return u.has(i)?u.delete(i):u.add(i),u})},c=i=>{const t=i.toLowerCase();return t.includes("salt")?"ðŸ§‚":t.includes("pepper")?"ðŸŒ¶ï¸":t.includes("water")?"ðŸ’§":t.includes("oil")||t.includes("olive")?"ðŸ«’":t.includes("vinegar")?"ðŸ¾":t.includes("soy sauce")||t.includes("sauce")?"ðŸ¥«":t.includes("honey")?"ðŸ¯":t.includes("garlic")||t.includes("clove")?"ðŸ§„":t.includes("ginger")?"ðŸ«š":t.includes("onion")?"ðŸ§…":t.includes("tomato")?"ðŸ…":t.includes("lemon")||t.includes("lime")?"ðŸ‹":t.includes("orange")?"ðŸŠ":t.includes("apple")?"ðŸŽ":t.includes("banana")?"ðŸŒ":t.includes("strawberry")||t.includes("berry")?"ðŸ“":t.includes("carrot")?"ðŸ¥•":t.includes("potato")?"ðŸ¥”":t.includes("broccoli")?"ðŸ¥¦":t.includes("mushroom")?"ðŸ„":t.includes("avocado")?"ðŸ¥‘":t.includes("corn")?"ðŸŒ½":t.includes("eggplant")?"ðŸ†":t.includes("cucumber")?"ðŸ¥’":t.includes("lettuce")||t.includes("salad")?"ðŸ¥—":t.includes("cheese")?"ðŸ§€":t.includes("milk")?"ðŸ¥›":t.includes("cream")?"ðŸ¦":t.includes("butter")?"ðŸ§ˆ":t.includes("egg")?"ðŸ¥š":t.includes("chicken")?"ðŸ—":t.includes("beef")||t.includes("steak")?"ðŸ¥©":t.includes("pork")||t.includes("bacon")?"ðŸ¥“":t.includes("fish")||t.includes("salmon")?"ðŸŸ":t.includes("shrimp")||t.includes("prawn")?"ðŸ¦":t.includes("rice")?"ðŸš":t.includes("pasta")||t.includes("noodle")?"ðŸ":t.includes("bread")?"ðŸž":t.includes("flour")?"ðŸŒ¾":t.includes("sugar")?"ðŸ¬":t.includes("chocolate")?"ðŸ«":t.includes("vanilla")?"ðŸŸ«":t.includes("cinnamon")||t.includes("spice")?"ðŸŒ°":t.includes("basil")||t.includes("herb")||t.includes("parsley")||t.includes("cilantro")?"ðŸŒ¿":t.includes("chili")||t.includes("jalapeno")?"ðŸŒ¶ï¸":t.includes("coconut")?"ðŸ¥¥":t.includes("peanut")||t.includes("nut")?"ðŸ¥œ":t.includes("wine")?"ðŸ·":t.includes("beer")?"ðŸº":t.includes("coffee")?"â˜•":t.includes("tea")?"ðŸµ":"ðŸ¥˜"},L=A.size===a.ingredients.length,$=(w+1)/v.length*100,r=(i,t)=>{const u=t.toLowerCase();return u.includes("cup")?{quantity:Math.round(i*240),unit:"ml"}:u.includes("tablespoon")||u.includes("tbsp")?{quantity:Math.round(i*15),unit:"ml"}:u.includes("teaspoon")||u.includes("tsp")?{quantity:Math.round(i*5),unit:"ml"}:u.includes("fluid ounce")||u.includes("fl oz")?{quantity:Math.round(i*30),unit:"ml"}:u.includes("pint")?{quantity:Math.round(i*473),unit:"ml"}:u.includes("quart")?{quantity:Math.round(i*946),unit:"ml"}:u.includes("gallon")?{quantity:(i*3.785).toFixed(2),unit:"L"}:u.includes("pound")||u.includes("lb")?{quantity:Math.round(i*454),unit:"g"}:u.includes("ounce")||u.includes("oz")?{quantity:Math.round(i*28),unit:"g"}:u.includes("Â°f")||u.includes("fahrenheit")?{quantity:Math.round((i-32)*5/9),unit:"Â°C"}:{quantity:i,unit:t}},h=(i,t)=>{const u=a.servings||4,X=le/u;let B=parseFloat(i);if(i.includes("/")){const C=i.split(" ");let oe=0,Re=C[C.length-1];C.length>1&&(oe=parseFloat(C[0]));const[pe,Ue]=Re.split("/").map(parseFloat);B=oe+pe/Ue}if(isNaN(B))return{quantity:i,unit:t};let ae=B*X,J=t;if(O){const C=r(ae,t);ae=typeof C.quantity=="string"?parseFloat(C.quantity):C.quantity,J=C.unit}if(ae%1===0)return{quantity:ae.toString(),unit:J};if(ae<1&&!O){const C=ae;return Math.abs(C-.25)<.05?{quantity:"1/4",unit:J}:Math.abs(C-.33)<.05?{quantity:"1/3",unit:J}:Math.abs(C-.5)<.05?{quantity:"1/2",unit:J}:Math.abs(C-.67)<.05?{quantity:"2/3",unit:J}:Math.abs(C-.75)<.05?{quantity:"3/4",unit:J}:{quantity:ae.toFixed(2),unit:J}}else if(ae>=1&&!O){const C=Math.floor(ae),oe=ae-C;return oe<.05?{quantity:C.toString(),unit:J}:Math.abs(oe-.25)<.05?{quantity:`${C} 1/4`,unit:J}:Math.abs(oe-.33)<.05?{quantity:`${C} 1/3`,unit:J}:Math.abs(oe-.5)<.05?{quantity:`${C} 1/2`,unit:J}:Math.abs(oe-.67)<.05?{quantity:`${C} 2/3`,unit:J}:Math.abs(oe-.75)<.05?{quantity:`${C} 3/4`,unit:J}:{quantity:ae.toFixed(2),unit:J}}else return{quantity:ae.toFixed(1),unit:J}};return e.jsx("div",{className:"fixed inset-0 z-50 bg-white overflow-hidden",children:e.jsxs("div",{className:"h-full flex flex-col",children:[e.jsxs("div",{className:"bg-gradient-to-r from-orange-500 to-red-600 text-white px-2 py-2 sm:px-4 sm:py-3 flex items-center justify-between shadow-lg flex-shrink-0",children:[e.jsxs("div",{className:"flex-1 min-w-0 px-2",children:[e.jsx("h2",{className:"text-base sm:text-lg md:text-xl font-bold truncate text-center",children:a.title}),e.jsxs("p",{className:"text-orange-100 text-[10px] sm:text-xs text-center",children:["Step ",w+1," of ",v.length]})]}),e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 flex-shrink-0",children:[a.videoUrl&&e.jsx(D,{variant:"ghost",size:"icon",onClick:()=>window.open(a.videoUrl,"_blank"),className:"text-white hover:bg-white/20 h-8 w-8 sm:h-9 sm:w-9",title:"Watch recipe video",children:e.jsx(Qe,{className:"w-4 h-4 sm:w-5 sm:h-5"})}),e.jsx(D,{variant:"ghost",size:"icon",onClick:()=>Q(!re),className:"text-white hover:bg-white/20 h-8 w-8 sm:h-9 sm:w-9",children:re?e.jsx(Bs,{className:"w-4 h-4 sm:w-5 sm:h-5"}):e.jsx(Vs,{className:"w-4 h-4 sm:w-5 sm:h-5"})})]})]}),e.jsx("div",{className:"w-full bg-gray-200 h-1 sm:h-1.5 flex-shrink-0",children:e.jsx("div",{className:"bg-orange-600 h-full transition-all duration-300",style:{width:`${$}%`}})}),e.jsx("div",{className:"absolute top-20 left-4 z-50",children:e.jsxs(D,{onClick:E,className:"bg-white/95 hover:bg-white text-orange-600 border-2 border-orange-500 h-12 px-5 flex items-center gap-2 font-bold rounded-xl shadow-xl active:scale-95 transition-all",title:"Back to recipes",children:[e.jsx(ls,{className:"w-5 h-5"}),e.jsx("span",{className:"text-sm",children:"Back"})]})}),e.jsx("div",{className:"flex-1 min-h-0 overflow-y-auto",children:e.jsxs("div",{className:"p-3 sm:p-4 md:p-6 space-y-3 sm:space-y-4 pb-24",children:[e.jsxs("div",{className:"relative w-full h-40 sm:h-48 md:h-64 rounded-lg sm:rounded-xl overflow-hidden shadow-lg flex-shrink-0",children:[e.jsx("img",{src:a.imageUrl,alt:a.title,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/60 via-black/20 to-transparent"}),e.jsxs("div",{className:"absolute bottom-2 left-2 right-2 sm:bottom-3 sm:left-3 sm:right-3 md:bottom-4 md:left-4 md:right-4",children:[e.jsx("h3",{className:"text-white text-base sm:text-lg md:text-xl font-bold drop-shadow-lg line-clamp-1",children:a.title}),e.jsxs("p",{className:"text-white/90 text-[10px] sm:text-xs md:text-sm mt-0.5 sm:mt-1 drop-shadow",children:[a.prepTime+a.cookTime," min â€¢ ",a.servings," servings"]})]})]}),e.jsxs("div",{className:`rounded-lg sm:rounded-xl p-3 sm:p-4 border-2 shadow-sm ${Y?"bg-orange-50 border-orange-300":"bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-300"}`,children:[e.jsx(D,{onClick:()=>de(!Y),className:`w-full font-semibold h-10 sm:h-11 text-sm sm:text-base ${Y?"bg-orange-600 hover:bg-orange-700":"bg-gradient-to-r from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700"}`,children:Y?e.jsxs(e.Fragment,{children:[e.jsx(Hs,{className:"w-4 h-4 mr-2"}),"Disable Voice Control"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ws,{className:"w-4 h-4 mr-2"}),"Enable Voice Control"]})}),e.jsx("p",{className:"text-[10px] sm:text-xs text-gray-600 text-center mt-2",children:Y?'Say "Next", "Previous", "Repeat", or "Read ingredients"':"Navigate recipes hands-free with voice commands"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-emerald-50 to-teal-50 rounded-lg sm:rounded-xl p-3 sm:p-4 border-2 border-emerald-200 shadow-sm space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ws,{className:"w-4 h-4 sm:w-5 sm:h-5 text-emerald-600"}),e.jsx("span",{className:"text-xs sm:text-sm font-semibold text-gray-900",children:"Servings"})]}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsx(D,{variant:"outline",size:"sm",onClick:()=>te(Math.max(1,le-1)),className:"h-7 w-7 sm:h-8 sm:w-8 p-0",children:e.jsx(Xs,{className:"w-3 h-3 sm:w-4 sm:h-4"})}),e.jsx("span",{className:"text-base sm:text-lg font-bold text-gray-900 min-w-[1.5rem] sm:min-w-[2rem] text-center",children:le}),e.jsx(D,{variant:"outline",size:"sm",onClick:()=>te(le+1),className:"h-7 w-7 sm:h-8 sm:w-8 p-0",children:e.jsx(Ys,{className:"w-3 h-3 sm:w-4 sm:h-4"})})]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t border-emerald-200",children:[e.jsx("span",{className:"text-xs sm:text-sm font-semibold text-gray-900",children:"Units"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{variant:O?"outline":"default",size:"sm",onClick:()=>p(!1),className:`h-7 px-2 sm:px-3 text-xs sm:text-sm ${O?"":"bg-emerald-600 hover:bg-emerald-700"}`,children:"US"}),e.jsx(D,{variant:O?"default":"outline",size:"sm",onClick:()=>p(!0),className:`h-7 px-2 sm:px-3 text-xs sm:text-sm ${O?"bg-emerald-600 hover:bg-emerald-700":""}`,children:"Metric"})]})]}),le!==a.servings&&e.jsxs("p",{className:"text-[10px] sm:text-xs text-emerald-700 text-center",children:["Scaled from original ",a.servings," servings"]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-cyan-50 rounded-lg sm:rounded-xl p-3 sm:p-4 border-2 border-blue-200 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2 sm:mb-3",children:[e.jsxs("h3",{className:"text-sm sm:text-base md:text-lg font-bold text-gray-900 flex items-center gap-2",children:[L?e.jsx(Js,{className:"w-4 h-4 sm:w-5 sm:h-5 text-orange-600"}):e.jsx(Ks,{className:"w-4 h-4 sm:w-5 sm:h-5 text-gray-400"}),"Ingredients"]}),e.jsxs("span",{className:"text-[10px] sm:text-xs text-gray-600",children:[A.size,"/",a.ingredients.length]})]}),e.jsx("div",{className:"space-y-2",children:a.ingredients.map((i,t)=>{const u=h(i.quantity,i.unit);return e.jsxs("div",{className:`flex items-center gap-2 sm:gap-3 p-2 sm:p-2.5 rounded-lg transition-all ${A.has(t)?"bg-orange-100 border border-orange-300":"bg-white border border-gray-200"}`,children:[e.jsx("div",{className:"w-8 h-8 sm:w-10 sm:h-10 rounded-lg bg-gray-100 flex items-center justify-center text-lg sm:text-xl flex-shrink-0",children:c(i.name)}),e.jsx(gs,{id:`ingredient-${t}`,checked:A.has(t),onCheckedChange:()=>Ne(t),className:"flex-shrink-0"}),e.jsxs("label",{htmlFor:`ingredient-${t}`,className:`text-xs sm:text-sm cursor-pointer flex-1 min-w-0 ${A.has(t)?"text-gray-500 line-through":"text-gray-900"}`,children:[e.jsxs("span",{className:"font-semibold",children:[u.quantity," ",u.unit]})," ",i.name]})]},t)})})]}),e.jsxs("div",{className:"touch-pan-y select-none relative",onTouchStart:he,onTouchMove:me,onTouchEnd:ve,children:[e.jsx("div",{className:`bg-white rounded-lg sm:rounded-xl shadow-lg border-2 p-4 sm:p-6 md:p-8 transition-all ${q.has(w)?"border-orange-600 bg-orange-50":"border-gray-200"}`,children:e.jsxs("div",{className:"px-16 sm:px-20 md:px-24 -mx-4 sm:-mx-6 md:-mx-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3 sm:mb-4",children:[e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 flex-1 min-w-0",children:[e.jsx(gs,{id:`step-${w}`,checked:q.has(w),onCheckedChange:()=>je(w),className:"w-5 h-5 sm:w-6 sm:h-6 flex-shrink-0"}),e.jsxs("h3",{className:`font-bold text-lg sm:text-xl md:text-2xl ${q.has(w)?"text-gray-500 line-through":"text-gray-900"}`,children:["Step ",w+1]})]}),((k=v[w])==null?void 0:k.duration)&&e.jsxs("div",{className:"flex items-center gap-1 sm:gap-2 flex-shrink-0",children:[e.jsxs(D,{variant:"outline",size:"sm",onClick:ze,className:`gap-1 sm:gap-2 h-8 sm:h-9 text-xs sm:text-sm px-2 sm:px-3 ${I&&!se?"border-orange-600 bg-orange-50":"border-blue-300"}`,children:[I&&!se?e.jsx(vs,{className:"w-3 h-3 sm:w-4 sm:h-4"}):e.jsx(js,{className:"w-3 h-3 sm:w-4 sm:h-4"}),e.jsx("span",{className:"hidden sm:inline",children:I&&!se?"Pause":"Start"})]}),I&&e.jsx(D,{variant:"outline",size:"sm",onClick:xe,className:"h-8 w-8 sm:h-9 sm:w-9 p-0",children:e.jsx(Gs,{className:"w-3 h-3 sm:w-4 sm:h-4"})})]})]}),I&&e.jsxs("div",{className:`mb-3 sm:mb-4 p-3 sm:p-4 md:p-6 rounded-lg sm:rounded-xl text-center ${U<=10?"bg-red-100 border-2 border-red-300 animate-pulse":"bg-orange-100 border-2 border-orange-300"}`,children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 sm:gap-3",children:[e.jsx(ys,{className:`w-4 h-4 sm:w-5 sm:h-5 ${U<=10?"text-red-600":"text-orange-600"}`}),e.jsx("span",{className:`font-mono text-3xl sm:text-4xl md:text-5xl font-bold ${U<=10?"text-red-600":"text-orange-600"}`,children:ge(U)})]}),se&&e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 mt-2",children:"Timer paused"})]}),e.jsx("p",{className:"text-sm sm:text-base md:text-lg text-gray-700 leading-relaxed",children:v[w].instruction}),e.jsx("p",{className:"text-[10px] sm:text-xs text-gray-400 text-center mt-4 sm:mt-6",children:"ðŸ‘† Swipe left or right to navigate"})]})}),e.jsx("div",{className:"absolute top-1/2 left-0 right-0 -translate-y-1/2 pointer-events-none px-2 sm:px-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[w>0&&e.jsx(D,{variant:"ghost",size:"icon",onClick:ue,className:"pointer-events-auto bg-white/60 hover:bg-white/80 backdrop-blur-sm shadow-lg rounded-full w-12 h-12 sm:w-14 sm:h-14 touch-manipulation active:scale-95 transition-all z-50",children:e.jsx(Xe,{className:"w-6 h-6 sm:w-7 sm:h-7 text-gray-900"})}),e.jsx("div",{className:"flex-1"}),w<v.length-1&&e.jsx(D,{variant:"ghost",size:"icon",onClick:fe,className:"pointer-events-auto bg-orange-500/60 hover:bg-orange-500/80 backdrop-blur-sm shadow-lg rounded-full w-12 h-12 sm:w-14 sm:h-14 touch-manipulation active:scale-95 transition-all z-50",children:e.jsx(Ye,{className:"w-6 h-6 sm:w-7 sm:h-7 text-white"})})]})})]})]})}),e.jsx("div",{className:"bg-white border-t-2 border-gray-200 px-3 py-2 sm:px-4 sm:py-3 shadow-lg flex-shrink-0 safe-area-bottom",children:e.jsxs("div",{className:"flex items-center justify-between gap-2 sm:gap-3 max-w-4xl mx-auto",children:[e.jsxs(D,{variant:"outline",size:"lg",onClick:ue,disabled:w===0,className:"gap-1 sm:gap-2 text-xs sm:text-sm px-4 sm:px-6 min-h-[44px] sm:min-h-[48px] touch-manipulation active:scale-95 transition-all font-semibold",children:[e.jsx(Xe,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsx("span",{className:"hidden xs:inline",children:"Previous"}),e.jsx("span",{className:"xs:hidden",children:"Prev"})]}),e.jsx("div",{className:"flex-1 text-center px-2",children:e.jsx("p",{className:"text-[10px] sm:text-xs text-gray-600 font-medium",children:Y?'Say "Next" or swipe':"ðŸ‘ˆ Swipe to navigate ðŸ‘‰"})}),e.jsxs(D,{size:"lg",onClick:fe,disabled:w===v.length-1,className:"bg-gradient-to-r from-orange-500 to-red-600 hover:from-orange-600 hover:to-red-700 gap-1 sm:gap-2 text-xs sm:text-sm px-4 sm:px-6 min-h-[44px] sm:min-h-[48px] touch-manipulation active:scale-95 transition-all font-semibold shadow-md",children:[e.jsx("span",{children:"Next"}),e.jsx(Ye,{className:"w-4 h-4 sm:w-5 sm:h-5"})]})]})})]})})}function Et({src:a,alt:E,open:w,onOpenChange:z}){return e.jsx(Se,{open:w,onOpenChange:z,children:e.jsxs(Je,{children:[e.jsx(Ke,{className:"z-[9999998]"}),e.jsx(Ce,{className:"max-w-[95vw] max-h-[95vh] p-0 bg-black border-0 overflow-hidden z-[9999999]",children:e.jsxs("div",{className:"relative w-full h-full flex items-center justify-center",children:[e.jsx(D,{variant:"ghost",size:"icon",className:"absolute top-2 right-2 z-[10] bg-white/95 hover:bg-white shadow-lg rounded-full min-h-[44px] min-w-[44px] touch-manipulation active:scale-95",onClick:()=>z(!1),children:e.jsx(De,{className:"w-5 h-5"})}),e.jsx("img",{src:a,alt:E,className:"max-w-full max-h-[95vh] w-auto h-auto object-contain",loading:"lazy"})]})})]})})}function Ns({recipe:a,open:E,onOpenChange:w}){var O,p,m,ne;const{state:z,dispatch:A,saveRecipe:V,removeRecipe:q}=ht(),[ee,I]=n.useState(!1),[T,se]=n.useState({}),[G,U]=n.useState({}),[N,re]=n.useState(!1),Q=z.savedRecipes.some(v=>v.id===a.id),Y=a.steps&&a.steps.length>0||a.instructions&&a.instructions.length>0;if(n.useEffect(()=>{E&&(se({}),U({}),I(!1))},[E,a.id]),n.useEffect(()=>(E?document.body.style.overflow="hidden":document.body.style.overflow="unset",()=>{document.body.style.overflow="unset"}),[E]),ee&&Y)return e.jsx(Mt,{recipe:a,onClose:()=>I(!1)});const de=async()=>{try{Q?(await q(a.id),S.success("Recipe removed from your collection")):(await V(a),S.success("Recipe saved to your collection"))}catch{S.error("Failed to update recipe")}},le=()=>{a.ingredients.forEach(v=>{const W={id:`${a.id}-${v.name}-${Date.now()}`,name:v.name,quantity:parseFloat(v.quantity)||1,unit:v.unit,categoryId:"cat-7",checked:!1,sourceRecipeIds:[a.id]};A({type:"ADD_GROCERY_ITEM",payload:W})}),S.success("Ingredients added to grocery list")},te={Easy:"bg-orange-100 text-orange-700 border-orange-200",Medium:"bg-amber-100 text-amber-700 border-amber-200",Hard:"bg-red-100 text-red-700 border-red-200"};return e.jsxs(e.Fragment,{children:[e.jsx("style",{children:`
          [data-radix-dialog-overlay] {
            z-index: 99998 !important;
          }
          [data-radix-dialog-content] {
            z-index: 99999 !important;
          }
        `}),e.jsx(Se,{open:E,onOpenChange:w,modal:!0,children:e.jsxs(Ce,{className:"max-w-4xl w-[85%] h-[85vh] p-0 gap-0 overflow-hidden rounded-xl border",onPointerDownOutside:v=>v.preventDefault(),onInteractOutside:v=>v.preventDefault(),onEscapeKeyDown:v=>v.preventDefault(),children:[e.jsx(Ae,{className:"sr-only",children:a.title}),e.jsx("div",{className:"h-full overflow-y-auto overscroll-contain scroll-smooth",children:e.jsxs("div",{className:"relative",children:[e.jsx(D,{variant:"ghost",size:"icon",className:"sticky top-2 right-2 float-right z-[100000] bg-white/95 hover:bg-white shadow-lg rounded-full min-h-[44px] min-w-[44px] touch-manipulation active:scale-95 cursor-pointer",onClick:v=>{v.stopPropagation(),w(!1)},children:e.jsx(De,{className:"w-5 h-5"})}),e.jsxs("div",{className:"relative w-full h-48 sm:h-56 bg-gray-100 mb-4",children:[e.jsx("img",{src:(O=a.imageUrl)!=null&&O.includes("instagram.com")||(p=a.imageUrl)!=null&&p.includes("cdninstagram.com")?`https://vohvdarghgqskzqjclux.supabase.co/functions/v1/image-proxy?url=${encodeURIComponent(a.imageUrl.replace(/&amp;/g,"&"))}`:a.imageUrl,alt:a.title,className:"w-full h-full object-cover",loading:"lazy"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-transparent pointer-events-none"}),e.jsx(D,{variant:"ghost",size:"icon",onClick:v=>{v.stopPropagation(),re(!0)},className:"absolute bottom-3 right-3 z-20 bg-black/60 hover:bg-black/80 text-white rounded-full min-h-[40px] min-w-[40px] touch-manipulation active:scale-95 backdrop-blur-sm",children:e.jsx(Qs,{className:"w-5 h-5"})}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-3 sm:p-4 text-white z-10",children:[e.jsx("h1",{className:"text-xl sm:text-2xl font-bold mb-2 leading-tight pr-12",children:a.title}),e.jsxs("div",{className:"flex flex-wrap gap-1 sm:gap-1.5",children:[e.jsx(Ve,{className:"bg-white/95 text-gray-900 hover:bg-white text-[10px] sm:text-xs px-2 py-0.5",children:a.cuisineType}),e.jsx(Ve,{variant:"outline",className:`${te[a.difficulty]} border text-[10px] sm:text-xs px-2 py-0.5`,children:a.difficulty}),a.dietaryTags.slice(0,2).map(v=>e.jsx(Ve,{variant:"secondary",className:"bg-white/90 text-gray-900 text-[10px] sm:text-xs px-2 py-0.5",children:v},v)),a.dietaryTags.length>2&&e.jsxs(Ve,{variant:"secondary",className:"bg-white/90 text-gray-900 text-[10px] sm:text-xs px-2 py-0.5",children:["+",a.dietaryTags.length-2]})]})]})]}),e.jsxs("div",{className:"p-4 sm:p-6 pb-8 bg-white relative z-20",children:[e.jsxs("div",{className:"grid grid-cols-3 gap-2 mb-4 sm:mb-6",children:[e.jsxs("div",{className:"flex flex-col items-center gap-1.5 sm:gap-2 p-2.5 sm:p-3 bg-gradient-to-br from-orange-50 to-amber-50 rounded-lg border border-orange-100",children:[e.jsx("div",{className:"bg-primary p-1.5 sm:p-2 rounded-lg",children:e.jsx(Zs,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 text-white"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-[10px] sm:text-xs text-gray-600 font-medium",children:"Total"}),e.jsxs("p",{className:"text-xs sm:text-sm font-bold text-gray-900",children:[a.prepTime+a.cookTime,"m"]})]})]}),e.jsxs("div",{className:"flex flex-col items-center gap-1.5 sm:gap-2 p-2.5 sm:p-3 bg-gradient-to-br from-blue-50 to-cyan-50 rounded-lg border border-blue-100",children:[e.jsx("div",{className:"bg-blue-500 p-1.5 sm:p-2 rounded-lg",children:e.jsx(ws,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 text-white"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-[10px] sm:text-xs text-gray-600 font-medium",children:"Serves"}),e.jsx("p",{className:"text-xs sm:text-sm font-bold text-gray-900",children:a.servings})]})]}),e.jsxs("div",{className:"flex flex-col items-center gap-1.5 sm:gap-2 p-2.5 sm:p-3 bg-gradient-to-br from-amber-50 to-orange-50 rounded-lg border border-amber-100",children:[e.jsx("div",{className:"bg-amber-500 p-1.5 sm:p-2 rounded-lg",children:e.jsx(ys,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 text-white"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-[10px] sm:text-xs text-gray-600 font-medium",children:"Prep"}),e.jsxs("p",{className:"text-xs sm:text-sm font-bold text-gray-900",children:[a.prepTime,"m"]})]})]})]}),Y&&e.jsxs("div",{className:"mb-2 sm:mb-3",children:[e.jsxs(D,{size:"lg",onClick:()=>I(!0),className:"w-full bg-accent hover:bg-accent/90 text-white text-sm sm:text-base min-h-[48px] sm:min-h-[52px] gap-2 shadow-lg hover:shadow-xl active:scale-[0.98] transition-all touch-manipulation",children:[e.jsx(et,{className:"w-4 h-4 sm:w-5 sm:h-5"}),"Start Cooking"]}),e.jsx("p",{className:"text-center text-[10px] sm:text-xs text-gray-600 mt-2 px-2",children:"Step-by-step mode with timers and ingredient checklist"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 mb-3 sm:mb-4",children:[e.jsxs(D,{size:"lg",onClick:de,className:"gap-2 min-h-[44px] sm:min-h-[48px] touch-manipulation active:scale-95 transition-all text-xs sm:text-sm font-semibold bg-orange-500 hover:bg-orange-600 text-white border-2 border-orange-600",children:[e.jsx(st,{className:`w-4 h-4 flex-shrink-0 ${Q?"fill-current":""}`}),e.jsx("span",{className:"truncate",children:Q?"Saved":"Save"})]}),e.jsxs(D,{onClick:le,size:"lg",className:"gap-2 bg-green-500 hover:bg-green-600 text-white border-2 border-green-600 min-h-[44px] sm:min-h-[48px] touch-manipulation active:scale-95 transition-all text-xs sm:text-sm font-semibold",children:[e.jsx(tt,{className:"w-4 h-4 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:"Grocery List"})]})]}),e.jsx(as,{className:"my-3 sm:my-4"}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"bg-orange-100 p-2 rounded-lg",children:e.jsx(at,{className:"w-4 h-4 text-primary"})}),e.jsx("h2",{className:"text-lg sm:text-xl font-bold text-gray-900",children:"Ingredients"})]}),e.jsx("div",{className:"bg-gradient-to-br from-gray-50 to-white border border-gray-200 rounded-lg p-3 sm:p-4",children:e.jsx("div",{className:"space-y-2",children:a.ingredients.map((v,W)=>e.jsxs("label",{className:"flex items-start gap-2 sm:gap-3 p-2 rounded-lg hover:bg-orange-50 transition-colors min-h-[40px] sm:min-h-[44px] cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:T[W]||!1,onChange:he=>{se(me=>({...me,[W]:he.target.checked}))},className:"mt-1 w-4 h-4 sm:w-5 sm:h-5 text-primary border-gray-300 rounded focus:ring-primary focus:ring-2 cursor-pointer flex-shrink-0"}),e.jsxs("div",{className:`flex-1 text-xs sm:text-sm text-gray-700 leading-relaxed transition-all ${T[W]?"line-through opacity-50":""}`,children:[e.jsxs("span",{className:"font-semibold text-primary",children:[v.quantity," ",v.unit]})," ",v.name]})]},W))})})]}),e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx("div",{className:"bg-blue-100 p-2 rounded-lg",children:e.jsx(rt,{className:"w-4 h-4 text-blue-600"})}),e.jsx("h2",{className:"text-lg sm:text-xl font-bold text-gray-900",children:"Instructions"})]}),e.jsx("div",{className:"bg-gradient-to-br from-gray-50 to-white border border-gray-200 rounded-lg p-3 sm:p-4",children:e.jsx("ol",{className:"space-y-3 sm:space-y-4",children:a.instructions.map((v,W)=>e.jsx("li",{className:"flex gap-2 sm:gap-3",children:e.jsxs("label",{className:"flex gap-2 sm:gap-3 items-start cursor-pointer w-full min-h-[40px] sm:min-h-[44px] p-2 rounded-lg hover:bg-blue-50 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:G[W]||!1,onChange:he=>{U(me=>({...me,[W]:he.target.checked}))},className:"mt-1 w-4 h-4 sm:w-5 sm:h-5 text-primary border-gray-300 rounded focus:ring-primary focus:ring-2 cursor-pointer flex-shrink-0"}),e.jsx("div",{className:"flex-shrink-0 w-6 h-6 sm:w-7 sm:h-7 rounded-full bg-primary text-white flex items-center justify-center font-bold text-xs sm:text-sm shadow-md",children:W+1}),e.jsx("p",{className:`text-xs sm:text-sm text-gray-700 pt-0.5 leading-relaxed transition-all ${G[W]?"line-through opacity-50":""}`,children:v})]})},W))})})]}),a.notes&&e.jsxs(e.Fragment,{children:[e.jsx(as,{className:"my-3 sm:my-4"}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-bold text-gray-900 mb-3",children:"Notes"}),e.jsx("div",{className:"bg-amber-50 border border-amber-200 rounded-lg p-3 sm:p-4",children:e.jsx("p",{className:"text-xs sm:text-sm text-gray-700 leading-relaxed",children:a.notes})})]})]}),a.sourceUrl&&e.jsxs(e.Fragment,{children:[e.jsx(as,{className:"my-3 sm:my-4"}),e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-3 bg-gray-50 border border-gray-200 rounded-lg p-3 sm:p-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 text-xs sm:text-sm mb-1",children:"Recipe Source"}),e.jsx("p",{className:"text-xs text-gray-600",children:"View original recipe"})]}),e.jsx(D,{variant:"outline",size:"sm",asChild:!0,className:"gap-2 hover:bg-white min-h-[40px] touch-manipulation active:scale-95 transition-all w-full sm:w-auto text-xs sm:text-sm",children:e.jsxs("a",{href:a.sourceUrl,target:"_blank",rel:"noopener noreferrer",children:[e.jsx(Qe,{className:"w-4 h-4"}),"Visit Source"]})})]})]})]})]})})]})}),e.jsx(Et,{src:(m=a.imageUrl)!=null&&m.includes("instagram.com")||(ne=a.imageUrl)!=null&&ne.includes("cdninstagram.com")?`https://vohvdarghgqskzqjclux.supabase.co/functions/v1/image-proxy?url=${encodeURIComponent(a.imageUrl.replace(/&amp;/g,"&"))}`:a.imageUrl,alt:a.title,open:N,onOpenChange:re})]})}const Pt=a=>{if(!a){console.log("[imageUtils] âš ï¸ No image URL provided");return}if(console.log("[imageUtils] ðŸ“¥ Input URL:",a),a.includes("vohvdarghgqskzqjclux.supabase.co/storage"))return console.log("[imageUtils] âœ… Supabase storage URL - returning directly"),a;if(a.includes("instagram.com")||a.includes("cdninstagram.com")){console.warn("[imageUtils] âš ï¸ Instagram URL detected - this should have been reuploaded");const E=a.replace(/&amp;/g,"&"),w=`https://vohvdarghgqskzqjclux.supabase.co/functions/v1/image-proxy?url=${encodeURIComponent(E)}`;return console.log("[imageUtils] ðŸ”„ Attempting to proxy:",w),w}return console.log("[imageUtils] âž¡ï¸ Other URL - returning directly"),a},rs=()=>e.jsxs("div",{className:"flex gap-2 sm:gap-3 animate-pulse",children:[e.jsx("div",{className:"w-7 h-7 sm:w-8 sm:h-8 rounded-full bg-gray-300 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsxs("div",{className:"bg-gray-200 rounded-2xl px-3 py-2 space-y-2",children:[e.jsx("div",{className:"h-3 bg-gray-300 rounded w-24"}),e.jsx("div",{className:"h-3 bg-gray-300 rounded w-full"}),e.jsx("div",{className:"h-3 bg-gray-300 rounded w-3/4"})]}),e.jsx("div",{className:"h-2 bg-gray-200 rounded w-16 ml-3"})]})]}),Dt=()=>e.jsxs("div",{className:"space-y-3 animate-pulse",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(a=>e.jsx("div",{className:"w-4 h-4 bg-gray-300 rounded"},a))}),e.jsx("div",{className:"h-4 bg-gray-300 rounded w-24"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-4 bg-gray-300 rounded w-20"}),e.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(a=>e.jsx("div",{className:"w-5 h-5 bg-gray-300 rounded"},a))})]})]});function ds({postId:a,isOpen:E,onClose:w,onCommentPosted:z}){const[A,V]=n.useState([]),[q,ee]=n.useState(""),[I,T]=n.useState(!1),[se,G]=n.useState(!1),[U,N]=n.useState(null),[re,Q]=n.useState(0),[Y,de]=n.useState(0),[le,te]=n.useState(0),[O,p]=n.useState(0),[m,ne]=n.useState(null),[v,W]=n.useState(null),[he,me]=n.useState(!1),ve=n.useRef(null),[fe,ue]=n.useState(!1),[xe,be]=n.useState(0);n.useEffect(()=>{E&&a&&(console.log("[CommentModal] ðŸ”µ Modal opened with postId:",a),ze())},[E,a]);const ze=async()=>{var r,h;T(!0);try{console.log("[CommentModal] ðŸŸ¡ Starting to load data for post:",a);const{data:k}=await d.auth.getUser(),i=((r=k.user)==null?void 0:r.id)||null;N(i);const{data:t,error:u}=await d.from("posts").select("*").eq("id",a).maybeSingle();if(console.log("[CommentModal] ðŸ“¦ Raw post data:",t),console.log("[CommentModal] ðŸ“‹ Post columns:",t?Object.keys(t):"none"),u)throw u;if(!t){console.log("[CommentModal] âš ï¸ Post not found!"),S.error("Post not found"),w();return}console.log("[CommentModal] ðŸ” Post fields:",{id:t.id,title:t.title,image_url:t.image_url,recipe_id:t.recipe_id,recipe_url:t.recipe_url,hasImageUrl:!!t.image_url});let X=null;if(t.recipe_id){console.log("[CommentModal] ðŸ”„ Fetching recipe with ID:",t.recipe_id);const{data:C,error:oe}=await d.from("public_recipes").select("image_url, video_url, title").eq("id",t.recipe_id).maybeSingle();console.log("[CommentModal] ðŸ“¦ Recipe data:",C),X=C,C&&console.log("[CommentModal] ðŸ” Recipe fields:",{id:t.recipe_id,title:C.title,image_url:C.image_url,hasImageUrl:!!C.image_url})}!t.image_url&&(X!=null&&X.image_url)?(console.log("[CommentModal] âœ… Using recipe image as fallback:",X.image_url),t.image_url=X.image_url):t.image_url||console.log("[CommentModal] ðŸš¨ NO IMAGE AVAILABLE"),ne(t);const[B,ae,J]=await Promise.all([d.from("post_ratings").select("rating").eq("post_id",a),d.from("comments").select("id, text, created_at, user_id, profiles!comments_user_id_fkey(username, avatar_url)").eq("post_id",a).order("created_at",{ascending:!0}),i?d.from("post_ratings").select("rating").eq("post_id",a).eq("user_id",i).maybeSingle():Promise.resolve({data:null,error:null})]);if(B.data&&B.data.length>0){const C=B.data.reduce((oe,Re)=>oe+Re.rating,0)/B.data.length;te(C),p(B.data.length)}ae.data&&V(ae.data.map(C=>({...C,profiles:Array.isArray(C.profiles)?C.profiles[0]:C.profiles}))),Q(((h=J.data)==null?void 0:h.rating)||0),t.spotify_preview_url&&setTimeout(()=>{},500)}catch(k){console.error("[CommentModal] ðŸ’¥ Error loading modal data:",k),S.error("Failed to load post details")}finally{T(!1)}},ge=async()=>{try{const{data:r,error:h}=await d.from("comments").select("*").eq("post_id",a).order("created_at",{ascending:!0});if(h)throw h;if(!r||r.length===0){V([]);return}const k=[...new Set(r.map(B=>B.user_id))],{data:i,error:t}=await d.from("profiles").select("id, username, avatar_url").in("id",k);if(t)throw t;const u=new Map((i||[]).map(B=>[B.id,B])),X=r.map(B=>({...B,profiles:u.get(B.user_id)||{username:"Unknown User",avatar_url:null}}));V(X)}catch(r){console.error("Error reloading comments:",r)}},Ne=async()=>{try{const{data:r,error:h}=await d.from("post_ratings").select("rating").eq("post_id",a);if(h)throw h;if(r&&r.length>0){const k=r.reduce((i,t)=>i+t.rating,0)/r.length;te(k),p(r.length)}else te(0),p(0)}catch(r){console.error("Error reloading ratings:",r)}},je=async r=>{if(!U){S.error("Please log in to rate");return}try{const{error:h}=await d.from("post_ratings").upsert({post_id:a,user_id:U,rating:r},{onConflict:"post_id,user_id"});if(h)throw h;Q(r),await Ne(),z&&z(),S.success("Rating submitted!")}catch(h){console.error("Error submitting rating:",h),S.error("Failed to submit rating")}},c=async r=>{if(r.preventDefault(),!(!q.trim()||!U)){G(!0);try{const{data:h}=await d.from("posts").select("user_id").eq("id",a).maybeSingle(),{error:k}=await d.from("comments").insert({post_id:a,user_id:U,text:q.trim()});if(k)throw k;h&&h.user_id!==U&&await d.from("notifications").insert({user_id:h.user_id,actor_id:U,type:"comment",post_id:a}),ee(""),await ge(),S.success("Comment posted!"),z&&z()}catch(h){console.error("Error posting comment:",h),S.error("Failed to post comment")}finally{G(!1)}}},L=async r=>{if(confirm("Delete this comment?"))try{const{error:h}=await d.from("comments").delete().eq("id",r).eq("user_id",U);if(h)throw h;await ge(),S.success("Comment deleted"),z&&z()}catch(h){console.error("Error deleting comment:",h),S.error("Failed to delete comment")}},$=()=>{ve.current&&(fe?ve.current.pause():ve.current.play().catch(r=>console.log("Play failed:",r)),ue(!fe))};return!m&&I?e.jsx(Se,{open:E&&!he,onOpenChange:w,children:e.jsxs(Je,{children:[e.jsx(Ke,{className:"z-[10000000]"}),e.jsx(Ce,{className:"max-w-lg w-[95vw] h-[90vh] sm:max-h-[85vh] p-0 gap-0 overflow-hidden z-[10000001] flex flex-col",onInteractOutside:r=>r.preventDefault(),onEscapeKeyDown:r=>r.preventDefault(),children:e.jsxs("div",{className:"flex flex-col h-full overflow-hidden",children:[e.jsx("div",{className:"flex-1 overflow-y-auto px-3 py-2 sm:px-4 sm:py-3 space-y-2 sm:space-y-3 min-h-[100px] max-h-[35vh] sm:max-h-none",children:e.jsx("button",{onClick:w,className:"absolute top-2 right-2 w-8 h-8 bg-black/70 backdrop-blur-sm text-white rounded-full flex items-center justify-center hover:bg-black/90 z-10",children:e.jsx(De,{className:"w-5 h-5"})})}),e.jsxs("div",{className:"flex-1 flex flex-col bg-white min-h-0",children:[e.jsxs("div",{className:"px-3 py-2 sm:px-4 sm:py-3 border-b flex-shrink-0 space-y-2 animate-pulse",children:[e.jsx("div",{className:"h-4 bg-gray-300 rounded w-3/4"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-full"})]}),e.jsx("div",{className:"px-3 py-2 sm:px-4 sm:py-3 border-b flex-shrink-0",children:e.jsx(Dt,{})}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-3 py-2 sm:px-4 sm:py-3 space-y-3 min-h-[100px]",children:[e.jsx(rs,{}),e.jsx(rs,{}),e.jsx(rs,{})]}),e.jsx("div",{className:"border-t px-3 py-3 sm:px-4 sm:py-4 bg-white flex-shrink-0",children:e.jsxs("div",{className:"flex gap-2 animate-pulse",children:[e.jsx("div",{className:"flex-1 h-9 sm:h-10 bg-gray-200 rounded-lg"}),e.jsx("div",{className:"h-9 w-9 sm:h-10 sm:w-10 bg-gray-300 rounded-lg"})]})})]})]})})]})}):e.jsxs(e.Fragment,{children:[e.jsx(Se,{open:E&&!he,onOpenChange:w,children:e.jsxs(Je,{children:[e.jsx(Ke,{className:"z-[10000000]"}),e.jsxs(Ce,{className:`
    max-w-5xl
    w-[calc(100vw-1rem)]
    sm:w-[95vw]
    h-[calc(100vh-2rem)]
    sm:h-[85vh]
    p-0
    gap-0
    overflow-hidden
    z-[10000001]
    mx-2
    sm:mx-auto
  `,onInteractOutside:r=>r.preventDefault(),onEscapeKeyDown:r=>r.preventDefault(),children:[e.jsx("button",{onClick:w,className:"absolute top-2 right-2 sm:top-4 sm:right-4 w-8 h-8 bg-black/70 backdrop-blur-sm text-white rounded-full flex items-center justify-center hover:bg-black/90 z-50",children:e.jsx(De,{className:"w-5 h-5"})}),e.jsxs("div",{className:"flex flex-col sm:flex-row h-full overflow-hidden",children:[e.jsxs("div",{className:"w-full sm:w-1/2 flex flex-col bg-black sm:border-r border-gray-200",children:[e.jsxs("div",{className:"w-full h-[35vh] sm:h-[70%] bg-black flex items-center justify-center relative overflow-hidden flex-shrink-0",children:[(()=>{let r=[],h=[];if(m!=null&&m.image_url)try{const t=JSON.parse(m.image_url);Array.isArray(t)?t.forEach(u=>{r.push(u),h.push("image")}):(r.push(t),h.push("image"))}catch{r.push(m.image_url),h.push("image")}if(m!=null&&m.video_url)try{const t=JSON.parse(m.video_url);Array.isArray(t)?t.forEach(u=>{r.push(u),h.push("video")}):(r.push(t),h.push("video"))}catch{r.push(m.video_url),h.push("video")}if(r.length===0)return e.jsxs("div",{className:"text-white text-center",children:[e.jsx("p",{children:"No media available"}),e.jsxs("p",{className:"text-xs mt-2",children:["Post ID: ",a]})]});const k=r[xe],i=h[xe];return e.jsxs(e.Fragment,{children:[i==="video"?e.jsx("video",{src:k,controls:!0,playsInline:!0,className:"w-full h-full object-contain",preload:"metadata"},k):e.jsx("img",{src:Pt(k),alt:m.title||"Post",className:"w-full h-full object-contain"},k),r.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>be(t=>t===0?r.length-1:t-1),className:"absolute left-2 top-1/2 -translate-y-1/2 w-8 h-8 bg-black/70 backdrop-blur-sm text-white rounded-full flex items-center justify-center hover:bg-black/90 z-10",children:e.jsx(Xe,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>be(t=>t===r.length-1?0:t+1),className:"absolute right-2 top-1/2 -translate-y-1/2 w-8 h-8 bg-black/70 backdrop-blur-sm text-white rounded-full flex items-center justify-center hover:bg-black/90 z-10",children:e.jsx(Ye,{className:"w-5 h-5"})}),e.jsx("div",{className:"absolute bottom-2 left-1/2 -translate-x-1/2 flex gap-1.5 z-10",children:r.map((t,u)=>e.jsx("button",{onClick:()=>be(u),className:`w-1.5 h-1.5 rounded-full transition-all ${u===xe?"bg-white w-4":"bg-white/50"}`},u))})]})]})})(),(m==null?void 0:m.spotify_preview_url)&&e.jsxs("div",{className:"absolute bottom-2 left-2 right-2 z-10",children:[e.jsxs("button",{onClick:$,className:"bg-black/70 hover:bg-black/90 backdrop-blur-sm text-white px-2 py-1.5 sm:px-3 sm:py-2 rounded-full shadow-lg transition-all flex items-center gap-2 w-full",children:[fe?e.jsx(vs,{className:"w-4 h-4 sm:w-5 sm:h-5"}):e.jsx(js,{className:"w-4 h-4 sm:w-5 sm:h-5"}),e.jsxs("div",{className:"text-left text-[10px] sm:text-xs flex-1 min-w-0",children:[e.jsx("div",{className:"font-semibold truncate",children:m.spotify_track_name}),e.jsx("div",{className:"text-white/80 truncate",children:m.spotify_artist_name})]})]}),e.jsx("audio",{ref:ve,src:m.spotify_preview_url,onPlay:()=>ue(!0),onPause:()=>ue(!1),onEnded:()=>ue(!1)})]})]}),e.jsx("div",{className:"flex-1 sm:flex-none sm:h-[30%] bg-white overflow-y-auto",children:e.jsxs("div",{className:"p-3 sm:p-4 space-y-3",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-sm sm:text-base truncate",children:(m==null?void 0:m.title)||"Post"}),(m==null?void 0:m.caption)&&e.jsx("p",{className:"text-xs sm:text-sm text-gray-600 mt-0.5 line-clamp-2",children:m.caption})]}),e.jsxs("div",{className:"space-y-1.5",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex items-center",children:[1,2,3,4,5].map(r=>e.jsx("span",{className:`text-sm sm:text-base ${r<=le?"opacity-100":"opacity-20 grayscale"}`,children:"ðŸ”¥"},r))}),e.jsxs("span",{className:"text-xs sm:text-sm text-gray-600",children:[le>0?le.toFixed(1):"No ratings",O>0&&` (${O})`]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-xs sm:text-sm text-gray-700 font-medium",children:"Your rating:"}),e.jsx("div",{className:"flex items-center gap-0.5 sm:gap-1",children:[1,2,3,4,5].map(r=>e.jsx("button",{type:"button",onClick:()=>je(r),onMouseEnter:()=>de(r),onMouseLeave:()=>de(0),className:"transition-transform active:scale-110 touch-manipulation p-1",children:e.jsx("span",{className:`text-base sm:text-lg ${r<=(Y||re)?"opacity-100":"opacity-20 grayscale"}`,children:"ðŸ”¥"})},r))})]})]}),((m==null?void 0:m.recipe_id)||(m==null?void 0:m.recipe_url))&&e.jsxs(D,{onClick:async()=>{if(m.recipe_id){const{getRecipeById:r}=await bs(async()=>{const{getRecipeById:k}=await import("./services-TCLpZZGf.js").then(i=>i.a2);return{getRecipeById:k}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9])),h=await r(m.recipe_id);h?(W(h),me(!0)):S.error("Recipe not found")}else m.recipe_url&&window.open(m.recipe_url,"_blank")},variant:"outline",size:"sm",className:"border-orange-600 text-orange-600 hover:bg-orange-50 w-full",children:[e.jsx(Qe,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4 mr-1.5"}),e.jsx("span",{className:"text-xs sm:text-sm",children:"View Recipe"})]})]})})]}),e.jsxs("div",{className:"w-full sm:w-1/2 flex flex-col bg-white min-h-0",children:[e.jsx("div",{className:"px-3 py-2 sm:px-4 sm:py-3 border-b flex-shrink-0",children:e.jsx("h3",{className:"font-bold text-sm sm:text-base",children:"Comments"})}),e.jsx("div",{className:"flex-1 overflow-y-auto px-3 py-2 sm:px-4 sm:py-3 space-y-2 sm:space-y-3 min-h-0",children:I?e.jsx("div",{className:"text-center py-8",children:e.jsx("div",{className:"inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-orange-600"})}):A.length===0?e.jsx("div",{className:"text-center py-8 sm:py-12 text-gray-500 text-xs sm:text-sm",children:"No comments yet. Be the first to comment!"}):A.map(r=>{var h,k,i,t,u;return e.jsxs("div",{className:"flex gap-2 sm:gap-3 group",children:[(h=r.profiles)!=null&&h.avatar_url?e.jsx("img",{src:r.profiles.avatar_url,alt:r.profiles.username,className:"w-7 h-7 sm:w-8 sm:h-8 rounded-full object-cover flex-shrink-0"}):e.jsx("div",{className:"w-7 h-7 sm:w-8 sm:h-8 rounded-full bg-gradient-to-br from-orange-500 to-red-500 flex items-center justify-center text-white font-medium text-xs flex-shrink-0",children:(t=(i=(k=r.profiles)==null?void 0:k.username)==null?void 0:i[0])==null?void 0:t.toUpperCase()}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"bg-gray-100 rounded-2xl px-3 py-2 relative",children:[e.jsx("button",{onClick:()=>{var X;return window.location.href=`/${((X=r.profiles)==null?void 0:X.username)||"user"}`},className:"font-semibold text-xs sm:text-sm hover:underline",children:(u=r.profiles)==null?void 0:u.username}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-700 break-words mt-0.5",children:r.text}),U===r.user_id&&e.jsx("button",{onClick:()=>L(r.id),className:"absolute top-1 right-1 p-1.5 bg-red-500 hover:bg-red-600 text-white rounded-full opacity-0 group-hover:opacity-100 transition-opacity touch-manipulation",title:"Delete comment",children:e.jsx(De,{className:"w-3 h-3"})})]}),e.jsx("p",{className:"text-[10px] sm:text-xs text-gray-400 mt-1 px-3",children:new Date(r.created_at).toLocaleDateString()})]})]},r.id)})}),e.jsx("form",{onSubmit:c,className:"border-t px-3 py-3 sm:px-4 sm:py-4 bg-white flex-shrink-0",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(xt,{value:q,onChange:r=>ee(r.target.value),placeholder:"Add a comment...",disabled:se,className:"flex-1 text-xs sm:text-sm h-9 sm:h-10"}),e.jsx(D,{type:"submit",disabled:!q.trim()||se,size:"icon",className:"bg-gradient-to-r from-orange-600 to-red-600 hover:from-orange-700 hover:to-red-700 flex-shrink-0 h-9 w-9 sm:h-10 sm:w-10",children:e.jsx(Ie,{className:"w-3.5 h-3.5 sm:w-4 sm:h-4"})})]})})]})]})]})]})}),v&&e.jsx(Ns,{recipe:v,open:!!v,onOpenChange:r=>{r||(W(null),me(!1))}})]})}function Ht(a){if(!a)return[];const E=/#(\w+)/g,w=a.match(E);return w?w.map(z=>z.slice(1).toLowerCase()).filter((z,A,V)=>V.indexOf(z)===A):[]}function zt(a,E){return a&&a.split(/(\s+)/g).map((z,A)=>{if(z.startsWith("#")){const V=z.slice(1);return ts.createElement("span",{key:A,onClick:q=>{q.stopPropagation(),E(V)},className:"text-blue-600 hover:text-blue-700 cursor-pointer font-semibold"},z)}return z.startsWith("http://")||z.startsWith("https://")?ts.createElement("a",{key:A,href:z,target:"_blank",rel:"noopener noreferrer",onClick:V=>V.stopPropagation(),className:"text-blue-600 hover:underline"},z):ts.createElement("span",{key:A},z)})}function ks({media:a,initialIndex:E=0,open:w,onOpenChange:z,postId:A,onLikeUpdate:V}){const[q,ee]=n.useState(E),[I,T]=n.useState(!1),[se,G]=n.useState(0),[U,N]=n.useState(null),[re,Q]=n.useState(!1);n.useEffect(()=>{(async()=>{var W;if(!A||!w)return;const{data:p}=await d.auth.getUser(),m=((W=p.user)==null?void 0:W.id)||null;if(N(m),!m)return;const{data:ne}=await d.from("likes").select("id").eq("post_id",A).eq("user_id",m).maybeSingle();T(!!ne);const{count:v}=await d.from("likes").select("*",{count:"exact",head:!0}).eq("post_id",A);G(v||0)})()},[A,w]);const Y=async()=>{if(!A||!U){S.error("Please sign in to like posts");return}try{I?(await d.from("likes").delete().eq("post_id",A).eq("user_id",U),T(!1),G(O=>Math.max(0,O-1))):(await d.from("likes").insert({post_id:A,user_id:U}),T(!0),G(O=>O+1)),V&&V()}catch(O){console.error("Error toggling like:",O),S.error("Failed to update like")}},de=()=>{q<a.length-1&&ee(q+1)},le=()=>{q>0&&ee(q-1)},te=a[q];return e.jsxs(Se,{open:w,onOpenChange:z,children:[e.jsxs(Je,{children:[e.jsx(Ke,{className:"z-[9999998] bg-black/95"}),e.jsx(Ce,{className:"max-w-[95vw] max-h-[95vh] p-0 bg-black border-0 overflow-hidden z-[9999999]",children:e.jsxs("div",{className:"relative w-full h-full flex items-center justify-center",children:[e.jsx(D,{variant:"ghost",size:"icon",className:"absolute top-2 right-2 z-[10] bg-white/95 hover:bg-white shadow-lg rounded-full min-h-[44px] min-w-[44px] touch-manipulation active:scale-95",onClick:()=>z(!1),children:e.jsx(De,{className:"w-5 h-5"})}),a.length>1&&q>0&&e.jsx(D,{variant:"ghost",size:"icon",className:"absolute left-2 top-1/2 -translate-y-1/2 z-[10] bg-white/95 hover:bg-white shadow-lg rounded-full min-h-[44px] min-w-[44px] touch-manipulation active:scale-95",onClick:le,children:e.jsx(Xe,{className:"w-6 h-6"})}),a.length>1&&q<a.length-1&&e.jsx(D,{variant:"ghost",size:"icon",className:"absolute right-2 top-1/2 -translate-y-1/2 z-[10] bg-white/95 hover:bg-white shadow-lg rounded-full min-h-[44px] min-w-[44px] touch-manipulation active:scale-95",onClick:de,children:e.jsx(Ye,{className:"w-6 h-6"})}),te.type==="video"?e.jsx("video",{src:te.url,controls:!0,className:"max-w-full max-h-[95vh] w-auto h-auto",autoPlay:!0}):e.jsx("img",{src:te.url,alt:"Post",className:"max-w-full max-h-[95vh] w-auto h-auto object-contain",loading:"lazy"}),a.length>1&&e.jsx("div",{className:"absolute bottom-4 left-1/2 -translate-x-1/2 flex gap-1.5",children:a.map((O,p)=>e.jsx("div",{className:`w-2 h-2 rounded-full transition-all ${p===q?"bg-white w-6":"bg-white/50"}`},p))}),A&&e.jsxs("div",{className:"absolute bottom-4 right-4 flex flex-col gap-3 z-[10]",children:[e.jsx(D,{variant:"ghost",size:"icon",onClick:O=>{O.stopPropagation(),Y()},className:"bg-white/95 hover:bg-white shadow-lg rounded-full min-h-[48px] min-w-[48px] touch-manipulation active:scale-95",children:e.jsx(os,{className:`w-6 h-6 ${I?"fill-red-500 text-red-500":"text-gray-700"}`})}),e.jsx(D,{variant:"ghost",size:"icon",onClick:O=>{O.stopPropagation(),Q(!0)},className:"bg-white/95 hover:bg-white shadow-lg rounded-full min-h-[48px] min-w-[48px] touch-manipulation active:scale-95",children:e.jsx(cs,{className:"w-6 h-6 text-gray-700"})})]})]})})]}),re&&A&&e.jsx(ds,{postId:A,isOpen:re,onClose:()=>Q(!1),onCommentPosted:()=>{V&&V()}})]})}function Tt({userId:a,currentUserId:E,posts:w,isFollowing:z,onBack:A,onToggleFollow:V,onMessage:q,onRefresh:ee}){var Ne,je;const I=w.filter(c=>c.user_id===a),[T,se]=n.useState(null),[G,U]=n.useState(null),[N,re]=n.useState(new Set),[Q,Y]=n.useState(null),[de,le]=n.useState(0),[te,O]=n.useState(0),[p,m]=n.useState(!1),[ne,v]=n.useState(!1),[W,he]=n.useState([]),[me,ve]=n.useState([]),[fe,ue]=n.useState(null);n.useEffect(()=>{const c=async()=>{const{data:r}=await d.from("profiles").select("username, avatar_url, bio, banner_url").eq("id",a).maybeSingle();r&&se(r)},L=async()=>{const{count:r}=await d.from("follows").select("*",{count:"exact",head:!0}).eq("following_id",a),{count:h}=await d.from("follows").select("*",{count:"exact",head:!0}).eq("follower_id",a);le(r||0),O(h||0)},$=async()=>{if(!E)return;const{data:r}=await d.from("likes").select("post_id").eq("user_id",E).in("post_id",I.map(h=>h.id));r&&re(new Set(r.map(h=>h.post_id)))};c(),L(),$()},[a,E,I.length]);const xe=async()=>{const{data:c}=await d.from("follows").select("follower_id, profiles:follower_id(id, username, avatar_url)").eq("following_id",a);he(c||[]),m(!0)},be=async()=>{const{data:c}=await d.from("follows").select("following_id, profiles:following_id(id, username, avatar_url)").eq("follower_id",a);ve(c||[]),v(!0)},ze=async c=>{if(!E)return;const{error:L}=await d.from("comments").delete().eq("id",c).eq("user_id",E);L?S.error("Failed to delete comment"):(S.success("Comment deleted"),ee&&ee())},ge=async c=>{if(!E)return;const L=N.has(c);try{if(L)await d.from("likes").delete().match({post_id:c,user_id:E}),re($=>{const r=new Set($);return r.delete(c),r});else{await d.from("likes").insert({post_id:c,user_id:E});const $=I.find(r=>r.id===c);$&&$.user_id!==E&&await d.from("notifications").insert({user_id:$.user_id,actor_id:E,type:"like",post_id:c}),re(r=>new Set(r).add(c))}}catch($){console.error("Error toggling like:",$),S.error("Failed to update like")}};return e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-20",children:[e.jsx("div",{className:"sticky top-0 z-10 bg-white border-b border-gray-200 px-4 py-3 shadow-sm",children:e.jsxs(D,{onClick:A,variant:"ghost",className:"min-h-[44px] gap-2 touch-manipulation active:scale-95 transition-all",children:[e.jsx(ls,{className:"w-5 h-5"}),"Back to Feed"]})}),e.jsxs("div",{className:"bg-white border-b border-gray-200",children:[e.jsx("div",{className:"relative h-32",children:T!=null&&T.banner_url?e.jsx("img",{src:T.banner_url,alt:"Banner",className:"w-full h-full object-cover",loading:"lazy"}):e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-orange-100 to-amber-100"})}),e.jsxs("div",{className:"relative px-4 pb-3",children:[e.jsxs("div",{className:"flex items-start gap-3 -mt-10",children:[e.jsx("div",{className:"relative flex-shrink-0",children:T!=null&&T.avatar_url?e.jsx("img",{src:T.avatar_url,alt:T.username,className:"w-20 h-20 rounded-full object-cover border-4 border-white shadow-lg"}):e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-orange-500 to-red-500 flex items-center justify-center text-white text-2xl font-bold border-4 border-white shadow-lg",children:(je=(Ne=T==null?void 0:T.username)==null?void 0:Ne[0])==null?void 0:je.toUpperCase()})}),e.jsx("div",{className:"flex-1 pt-10 min-w-0",children:T!=null&&T.bio?e.jsx("p",{className:"text-sm text-gray-700 line-clamp-2 break-words",children:T.bio}):e.jsx("p",{className:"text-sm text-gray-400 italic",children:"No bio"})})]}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-900 truncate",children:(T==null?void 0:T.username)||"Loading..."}),a==="51ad04fa-6d63-4c45-9423-76183eea7b39"&&e.jsx(We,{className:"w-5 h-5 text-yellow-500 fill-yellow-500 flex-shrink-0"})]}),a!==E&&e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsxs(D,{onClick:()=>{q&&T&&q(a,T.username)},variant:"outline",size:"sm",className:"flex-1 min-h-[44px] touch-manipulation active:scale-95 transition-all",children:[e.jsx(Ie,{className:"w-4 h-4 mr-2 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:"Message"})]}),e.jsx(D,{onClick:()=>V(a),variant:z?"outline":"default",size:"sm",className:`flex-1 min-h-[44px] touch-manipulation active:scale-95 transition-all ${z?"":"bg-orange-500 hover:bg-orange-600"}`,children:z?e.jsxs(e.Fragment,{children:[e.jsx(lt,{className:"w-4 h-4 mr-2 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:"Supporting"})]}):e.jsxs(e.Fragment,{children:[e.jsx(it,{className:"w-4 h-4 mr-2 flex-shrink-0"}),e.jsx("span",{className:"truncate",children:"Support"})]})})]})]}),e.jsx("div",{className:"px-4 py-3 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-center gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-base font-bold",children:I.length}),e.jsx("div",{className:"text-xs text-gray-500",children:"posts"})]}),e.jsxs("button",{onClick:xe,className:"text-center hover:bg-gray-50 px-3 py-1 rounded-lg transition-colors min-h-[44px] touch-manipulation active:scale-95",children:[e.jsx("div",{className:"text-base font-bold",children:de}),e.jsx("div",{className:"text-xs text-gray-500",children:"supporters"})]}),e.jsxs("button",{onClick:be,className:"text-center hover:bg-gray-50 px-3 py-1 rounded-lg transition-colors min-h-[44px] touch-manipulation active:scale-95",children:[e.jsx("div",{className:"text-base font-bold",children:te}),e.jsx("div",{className:"text-xs text-gray-500",children:"supporting"})]})]})})]}),e.jsx("div",{className:"p-4",children:I.length===0?e.jsx("div",{className:"text-center py-12 text-gray-500",children:"No posts yet"}):e.jsx("div",{className:"space-y-4",children:I.map(c=>{var $,r,h;const L=N.has(c.id);return e.jsxs("div",{className:"bg-white rounded-lg shadow-sm overflow-hidden",children:[e.jsxs("div",{className:"relative",children:[(()=>{const k=[],i=[];if(c.image_url)try{const X=JSON.parse(c.image_url);Array.isArray(X)?X.forEach(B=>{k.push(B),i.push("image")}):(k.push(X),i.push("image"))}catch{k.push(c.image_url),i.push("image")}c.video_url&&(k.push(c.video_url),i.push("video"));const t=k[0];return i[0]==="video"?e.jsx("video",{src:t,controls:!0,className:"w-full aspect-square object-cover"}):e.jsx("img",{src:t,alt:c.title||"Post",className:"w-full aspect-square object-cover cursor-pointer",loading:"lazy",onClick:()=>{Y({media:k.map((X,B)=>({url:X,type:i[B]})),initialIndex:0,postId:c.id})}})})(),c.title&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent px-3 py-2",children:e.jsx("h3",{className:"text-white text-sm font-semibold line-clamp-2",children:c.title})})]}),e.jsxs("div",{className:"p-3",children:[e.jsxs("div",{className:"flex gap-4 mb-2",children:[e.jsx("button",{onClick:()=>ge(c.id),className:"transition-transform hover:scale-110 active:scale-95 min-h-[44px] min-w-[44px] flex items-center justify-center -ml-2 touch-manipulation",children:e.jsx(os,{className:`w-6 h-6 ${L?"fill-red-500 text-red-500":"text-gray-600"}`})}),e.jsx("button",{onClick:()=>U(c.id),className:"transition-transform hover:scale-110 active:scale-95 min-h-[44px] min-w-[44px] flex items-center justify-center -ml-2 touch-manipulation",children:e.jsx(cs,{className:"w-6 h-6 text-gray-600"})})]}),e.jsxs("div",{className:"text-sm text-gray-600 mb-2",children:[(($=c._count)==null?void 0:$.likes)||0," ",((r=c._count)==null?void 0:r.likes)===1?"like":"likes"]}),c.caption&&e.jsx("p",{className:"text-sm leading-relaxed break-words",children:c.caption}),c.latest_comment&&e.jsxs("div",{className:"mt-3 relative",onTouchStart:()=>{var k;return((k=c.latest_comment)==null?void 0:k.user_id)===E&&ue(c.latest_comment.id)},onTouchEnd:()=>setTimeout(()=>ue(null),3e3),children:[e.jsxs("div",{className:"flex items-start gap-2 pr-10",children:[e.jsx("span",{className:"font-semibold text-sm flex-shrink-0",children:(h=c.latest_comment.profiles)==null?void 0:h.username}),e.jsx("span",{className:"text-sm text-gray-700 break-words",children:c.latest_comment.text})]}),c.latest_comment.user_id===E&&fe===c.latest_comment.id&&e.jsx("button",{onClick:k=>{k.stopPropagation(),ze(c.latest_comment.id)},className:"absolute top-0 right-0 w-10 h-10 bg-red-500 text-white rounded-full flex items-center justify-center shadow-lg hover:bg-red-600 active:scale-90 z-10 touch-manipulation",title:"Delete comment",children:e.jsx(is,{className:"w-4 h-4"})})]}),c._count&&c._count.comments>0&&e.jsxs("button",{onClick:()=>U(c.id),className:"text-sm text-gray-500 mt-2 hover:text-gray-700 block min-h-[36px] touch-manipulation",children:["View all ",c._count.comments," ",c._count.comments===1?"comment":"comments"]})]})]},c.id)})})}),G&&(()=>{const c=I.find($=>$.id===G),L=c&&E&&E===c.user_id;return c?e.jsx("div",{className:"fixed inset-0 bg-black/60 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"relative bg-white rounded-xl shadow-xl max-w-lg w-full max-h-[90vh] overflow-hidden",children:[e.jsx(ds,{postId:G,isOpen:!0,onClose:()=>U(null)}),e.jsx("button",{onClick:()=>U(null),className:"absolute top-3 left-3 bg-black/50 backdrop-blur-md text-white p-2.5 rounded-full shadow hover:bg-black/70 z-[100] min-h-[44px] min-w-[44px] touch-manipulation active:scale-95",title:"Close",children:e.jsx(ls,{className:"w-5 h-5"})}),L&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{const $=prompt("Edit your caption:");$&&d.from("posts").update({caption:$}).eq("id",G).eq("user_id",E).then(({error:r})=>{r?S.error("Failed to update post"):(S.success("Post updated"),ee&&ee())})},className:"absolute top-3 right-14 bg-blue-600 text-white p-2.5 rounded-full shadow hover:bg-blue-700 z-[100] min-h-[44px] min-w-[44px] touch-manipulation active:scale-95",title:"Edit post",children:"âœï¸"}),e.jsx("button",{onClick:async()=>{if(!confirm("Delete this post?"))return;const{error:$}=await d.from("posts").delete().eq("id",G);$?(console.error("Delete error:",$),S.error("Failed to delete post")):(S.success("Post deleted"),U(null),ee&&ee())},className:"absolute top-3 right-3 bg-red-600 text-white p-2.5 rounded-full shadow hover:bg-red-700 z-[100] min-h-[44px] min-w-[44px] touch-manipulation active:scale-95",title:"Delete post",children:e.jsx(is,{className:"w-5 h-5"})})]})]})}):null})(),e.jsx(Se,{open:p,onOpenChange:m,children:e.jsxs(Ce,{className:"max-w-sm",style:{pointerEvents:"auto"},onPointerDown:c=>c.stopPropagation(),children:[e.jsx(Ge,{children:e.jsx(Ae,{children:"Supporters"})}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",style:{pointerEvents:"auto"},children:W.length===0?e.jsx("p",{className:"text-center text-gray-500 py-8",children:"No supporters yet"}):W.map(c=>{var r,h,k;const L=(r=c.profiles)==null?void 0:r.username,$=(h=c.profiles)==null?void 0:h.avatar_url;return e.jsxs("div",{onPointerDown:i=>{i.stopPropagation(),console.log("CLICK DETECTED - Supporter:",L),m(!1),window.location.href=`/${L}`},className:"flex items-center gap-3 p-3 hover:bg-gray-100 rounded-lg cursor-pointer transition-colors select-none",style:{pointerEvents:"auto",touchAction:"manipulation",userSelect:"none"},children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-orange-400 to-red-400 flex items-center justify-center text-white font-bold flex-shrink-0 overflow-hidden pointer-events-none",children:$?e.jsx("img",{src:$,alt:L,className:"w-full h-full object-cover pointer-events-none",draggable:!1}):((k=L==null?void 0:L[0])==null?void 0:k.toUpperCase())||e.jsx(ns,{className:"w-5 h-5"})}),e.jsx("span",{className:"font-medium truncate pointer-events-none",children:L||"User"})]},c.follower_id)})})]})}),e.jsx(Se,{open:ne,onOpenChange:v,children:e.jsxs(Ce,{className:"max-w-sm",style:{pointerEvents:"auto"},onPointerDown:c=>c.stopPropagation(),children:[e.jsx(Ge,{children:e.jsx(Ae,{children:"Supporting"})}),e.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto",style:{pointerEvents:"auto"},children:me.length===0?e.jsx("p",{className:"text-center text-gray-500 py-8",children:"Not supporting anyone yet"}):me.map(c=>{var r,h,k;const L=(r=c.profiles)==null?void 0:r.username,$=(h=c.profiles)==null?void 0:h.avatar_url;return e.jsxs("div",{onPointerDown:i=>{i.stopPropagation(),console.log("CLICK DETECTED - Following:",L),v(!1),window.location.href=`/${L}`},className:"flex items-center gap-3 p-3 hover:bg-gray-100 rounded-lg cursor-pointer transition-colors select-none",style:{pointerEvents:"auto",touchAction:"manipulation",userSelect:"none"},children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-orange-400 to-red-400 flex items-center justify-center text-white font-bold flex-shrink-0 overflow-hidden pointer-events-none",children:$?e.jsx("img",{src:$,alt:L,className:"w-full h-full object-cover pointer-events-none",draggable:!1}):((k=L==null?void 0:L[0])==null?void 0:k.toUpperCase())||e.jsx(ns,{className:"w-5 h-5"})}),e.jsx("span",{className:"font-medium truncate pointer-events-none",children:L||"User"})]},c.following_id)})})]})}),Q&&e.jsx(ks,{media:Q.media,initialIndex:Q.initialIndex,postId:Q.postId,open:!!Q,onOpenChange:c=>{c||Y(null)},onLikeUpdate:()=>{ee&&ee()}})]})}const He=a=>a?a.includes("/functions/v1/image-proxy")||a.includes("supabase.co/storage/v1/object/public/")?a:a.includes("instagram.com")||a.includes("cdninstagram.com")||a.includes("fbcdn.net")?`https://vohvdarghgqskzqjclux.supabase.co/functions/v1/image-proxy?url=${encodeURIComponent(a)}`:(console.log("[Discover] VITE_SUPABASE_URL:","https://vohvdarghgqskzqjclux.supabase.co"),a):null;function qt({onNavigateToMessages:a,onNavigate:E,sharedPostId:w,onPostViewed:z}={}){const{isAdmin:A}=gt(),[V,q]=n.useState([]),[ee,I]=n.useState(!0),[T,se]=n.useState(0),[G,U]=n.useState(!0),[N,re]=n.useState(null),[Q,Y]=n.useState(null),[de,le]=n.useState({}),[te,O]=n.useState(null),[p,m]=n.useState(null),[ne,v]=n.useState(!1),[W,he]=n.useState(new Set),[me,ve]=n.useState(null),[fe,ue]=n.useState(""),[xe,be]=n.useState([]),[ze,ge]=n.useState(!1),[Ne,je]=n.useState(null),c=n.useRef(null),L=n.useRef(null),[$,r]=n.useState(null),[h,k]=n.useState(0),[i,t]=n.useState(!1),[u,X]=n.useState([]),[B,ae]=n.useState(null),[J,C]=n.useState("followers"),[oe,Re]=n.useState([]),[pe,Ue]=n.useState(new Set),[$t,Rt]=n.useState(new Map),[_s,Ze]=n.useState(!1),[Ss,Cs]=n.useState({}),[Le,es]=n.useState(null),ss=10;n.useEffect(()=>{d.auth.getUser().then(async({data:s})=>{var o;const l=((o=s.user)==null?void 0:o.id)||null;if(re(l),l){const{data:M}=await d.from("follows").select("following_id").eq("follower_id",l);M&&he(new Set(M.map(b=>b.following_id)))}})},[]),n.useEffect(()=>{const s=l=>{L.current&&!L.current.contains(l.target)&&t(!1)};return i&&document.addEventListener("mousedown",s),()=>{document.removeEventListener("mousedown",s)}},[i]),n.useEffect(()=>{const s=()=>{const M=window.location.pathname.match(/^\/post\/([a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12})$/i);if(M){const b=M[1];console.log("[Discover] Opening shared post from URL:",b),Y(b),window.history.replaceState({},"","/discover")}};s(),window.addEventListener("popstate",s);const l=o=>{o.detail&&Y(o.detail)};return window.addEventListener("open-shared-post",l),()=>{window.removeEventListener("popstate",s),window.removeEventListener("open-shared-post",l)}},[]),n.useEffect(()=>{if(!N)return;const s=async()=>{try{const{data:o,error:M}=await d.from("notifications").select("*").eq("user_id",N).neq("type","message").order("created_at",{ascending:!1}).limit(20);if(M){console.error("[Notifications] Error loading notifications:",M);return}if(o){console.log("[Notifications] Loaded notifications:",o),console.log("[Notifications] Unread count:",o.filter(_=>!_.read).length);const b=[...new Set(o.map(_=>_.actor_id).filter(Boolean))];if(b.length>0){const{data:_}=await d.from("profiles").select("id, username, avatar_url").in("id",b),H=new Map((_||[]).map(R=>[R.id,R])),F=o.map(R=>({...R,actor:R.actor_id?H.get(R.actor_id):null}));X(F)}else X(o);const j=o.filter(_=>!_.read).length;console.log("[Notifications] Setting unread count to:",j),k(j)}}catch(o){console.error("[Notifications] Exception:",o)}};s();const l=d.channel("notifications-changes").on("postgres_changes",{event:"INSERT",schema:"public",table:"notifications",filter:`user_id=eq.${N}`},()=>{s()}).on("postgres_changes",{event:"UPDATE",schema:"public",table:"notifications",filter:`user_id=eq.${N}`},()=>{s()}).subscribe();return()=>{d.removeChannel(l)}},[N]),n.useEffect(()=>{w&&N&&(async()=>{const{data:l}=await d.from("posts").select("*, profiles(username, avatar_url), likes(user_id), comments(id)").eq("id",w).maybeSingle();l&&(Y(w),z&&z())})()},[w,N,z]);const Fe=n.useCallback(async(s,l=!1)=>{try{let o=[];if($){const{data:y}=await d.from("hashtags").select("id").eq("tag",$.toLowerCase()).maybeSingle();if(y){const{data:qe}=await d.from("post_hashtags").select("post_id").eq("hashtag_id",y.id);if(o=(qe||[]).map(Pe=>Pe.post_id),o.length===0){q([]),U(!1),I(!1);return}}else{q([]),U(!1),I(!1);return}}let M=d.from("posts").select("*").order("created_at",{ascending:!1}).range(s*ss,(s+1)*ss-1);o.length>0&&(M=M.in("id",o));const{data:b,error:j}=await M;if(j)throw console.error("Error fetching posts:",j),j;if(!b||b.length===0){l&&q([]),U(!1),I(!1);return}const _=b.map(y=>y.id),H=[...new Set(b.map(y=>y.user_id))],{data:{user:F}}=await d.auth.getUser(),R=F?await fs.getBlockedUserIds(F.id):[],Me=F?await fs.getUsersWhoBlockedMe(F.id):[],ke=b.filter(y=>!R.includes(y.user_id)&&!Me.includes(y.user_id));if(ke.length===0){l&&q([]),U(!1),I(!1);return}const _e=ke.map(y=>y.id),Ee=[...new Set(ke.map(y=>y.user_id))],ye=[];Ee.length>0?ye.push(d.from("profiles").select("id, username, avatar_url").in("id",Ee)):ye.push(Promise.resolve({data:[],error:null})),_e.length>0?ye.push(d.from("likes").select("user_id, post_id").in("post_id",_e),d.from("comments").select("id, text, created_at, user_id, post_id, rating").in("post_id",_e).order("created_at",{ascending:!1}),d.from("post_ratings").select("rating, post_id").in("post_id",_e)):ye.push(Promise.resolve({data:[],error:null}),Promise.resolve({data:[],error:null}),Promise.resolve({data:[],error:null}));const[Oe,x,P,ie]=await Promise.all(ye),Z=[...new Set((P.data||[]).map(y=>y.user_id))],{data:Te}=await d.from("profiles").select("id, username").in("id",Z),f=new Map((Oe.data||[]).map(y=>[y.id,y])),g=new Map((Te||[]).map(y=>[y.id,y])),K=new Map;(x.data||[]).forEach(y=>{K.has(y.post_id)||K.set(y.post_id,[]),K.get(y.post_id).push(y)});const we=new Map;(P.data||[]).forEach(y=>{we.has(y.post_id)||we.set(y.post_id,[]);const qe={...y,profiles:g.get(y.user_id)||{username:"User"}};we.get(y.post_id).push(qe)});const ce=new Map;(ie.data||[]).forEach(y=>{ce.has(y.post_id)||ce.set(y.post_id,[]),ce.get(y.post_id).push(y.rating)});const $e={};ce.forEach((y,qe)=>{const Pe=y.length,Be=Pe>0?y.reduce((As,Os)=>As+Os,0)/Pe:0;$e[qe]={average:Be,count:Pe}});const hs=ke.map(y=>{const qe=f.get(y.user_id)||{username:"User",avatar_url:null},Pe=K.get(y.id)||[],Be=we.get(y.id)||[];return{...y,profiles:qe,likes:Pe,comments:Be.slice(0,2),_count:{likes:Pe.length,comments:Be.length}}});le(y=>({...y,...$e})),l?(q(hs),se(0)):q(y=>[...y,...hs]),U(ke.length===ss)}catch(o){console.error("Error fetching posts:",o),S.error("Failed to load posts")}finally{I(!1)}},[$]);n.useEffect(()=>{let s=!0,l=null;return(async()=>{s&&await Fe(0,!0)})(),l=d.channel("posts-and-comments-changes").on("postgres_changes",{event:"INSERT",schema:"public",table:"posts"},async M=>{if(!s)return;const b=M.new,{data:j}=await d.from("profiles").select("username, avatar_url").eq("id",b.user_id).maybeSingle(),_={...b,profiles:j||{username:"User",avatar_url:null},likes:[],comments:[],_count:{likes:0,comments:0}};q(H=>H.some(F=>F.id===_.id)?H:[_,...H])}).subscribe(),()=>{s=!1,l&&d.removeChannel(l)}},[Fe]);const Ms=()=>{const s=T+1;se(s),Fe(s)},Es=async s=>{if(N)try{if(W.has(s)){const{error:o}=await d.from("follows").delete().eq("follower_id",N).eq("following_id",s);if(o)throw o;he(M=>{const b=new Set(M);return b.delete(s),b}),S.success("Unsupported")}else{const{error:o}=await d.from("follows").insert({follower_id:N,following_id:s});if(o)throw o;await d.from("notifications").insert({user_id:s,actor_id:N,type:"follow"}),he(M=>new Set([...M,s])),S.success("Supporting!")}}catch(l){console.error("Error toggling follow:",l),S.error("Failed to update follow status")}},Ps=async()=>{if(te)try{const{error:s}=await d.from("posts").delete().eq("id",te);if(s)throw s;q(l=>l.filter(o=>o.id!==te)),S.success("Post deleted"),O(null)}catch(s){console.error("Error deleting post:",s),S.error("Failed to delete post")}},Ds=async()=>{if(p)try{v(!0);const s=[],l=[];for(let F=0;F<p.newMediaFiles.length;F++){const R=p.newMediaFiles[F],Me=p.newMediaTypes[F],ke=R.name.split(".").pop(),_e=`${N}/${Date.now()}-${Math.random().toString(36).substring(7)}.${ke}`,{error:Ee}=await d.storage.from("posts").upload(_e,R);if(Ee)throw Ee;const{data:ye}=d.storage.from("posts").getPublicUrl(_e);Me==="video"?l.push(ye.publicUrl):s.push(ye.publicUrl)}const o=p.currentMedia.filter(F=>F.type==="image"&&!p.deletedMedia.includes(F.url)).map(F=>F.url),M=p.currentMedia.filter(F=>F.type==="video"&&!p.deletedMedia.includes(F.url)).map(F=>F.url),b=[...o,...s],j=[...M,...l],_={title:p.title.trim()||null,caption:p.caption.trim()||null,recipe_url:p.recipeUrl.trim()||null,image_url:b.length>0?JSON.stringify(b):null,video_url:j.length>0?JSON.stringify(j):null},{error:H}=await d.from("posts").update(_).eq("id",p.id);if(H)throw H;q(F=>F.map(R=>R.id===p.id?{...R,..._}:R)),S.success("Post updated"),m(null)}catch(s){console.error("Error updating post:",s),S.error("Failed to update post")}finally{v(!1)}},zs=async s=>{var M;if(!N)return;const l=V.find(b=>b.id===s),o=(M=l==null?void 0:l.likes)==null?void 0:M.some(b=>b.user_id===N);q(b=>b.map(j=>j.id===s?{...j,likes:o?j.likes.filter(_=>_.user_id!==N):[...j.likes,{user_id:N}],_count:{...j._count,likes:o?j._count.likes-1:j._count.likes+1}}:j));try{o?await d.from("likes").delete().match({post_id:s,user_id:N}):(await d.from("likes").insert({post_id:s,user_id:N}),l&&l.user_id!==N&&await d.from("notifications").insert({user_id:l.user_id,actor_id:N,type:"like",post_id:s}))}catch(b){console.error("Error toggling like:",b),S.error("Failed to update like"),q(j=>j.map(_=>_.id===s?{..._,likes:o?[..._.likes,{user_id:N}]:_.likes.filter(H=>H.user_id!==N),_count:{..._._count,likes:o?_._count.likes+1:_._count.likes-1}}:_))}},Ts=()=>e.jsxs("div",{className:"bg-white border-4 border-orange-500 mb-2 animate-pulse",children:[e.jsxs("div",{className:"px-4 py-3 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gray-300"}),e.jsxs("div",{className:"flex-1 space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-300 rounded w-32"}),e.jsx("div",{className:"h-3 bg-gray-300 rounded w-24"})]})]}),e.jsx("div",{className:"bg-gray-300 h-96 w-full"}),e.jsxs("div",{className:"px-4 py-3 space-y-3",children:[e.jsx("div",{className:"h-4 bg-gray-300 rounded w-full"}),e.jsx("div",{className:"h-4 bg-gray-300 rounded w-3/4"}),e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"h-9 w-20 bg-gray-300 rounded-full"}),e.jsx("div",{className:"h-9 w-20 bg-gray-300 rounded-full"}),e.jsx("div",{className:"h-9 w-20 bg-gray-300 rounded-full ml-auto"})]})]})]});if(ee&&V.length===0)return e.jsx("div",{className:"min-h-screen bg-gray-50 pb-32",children:e.jsx("div",{className:"max-w-sm mx-auto w-full pt-24",children:[...Array(3)].map((s,l)=>e.jsx(Ts,{},l))})});const ms=async s=>{try{const{data:l,error:o}=await d.from("profiles").select("id, username, avatar_url").ilike("username",`${s}%`).limit(10);if(o){console.error("[Search] Error:",o),S.error("Search failed"),be([]),ge(!1);return}be(l||[]),ge(!0)}catch(l){console.error("[Search] Exception:",l),be([]),ge(!1)}},qs=s=>{if(ue(s),c.current&&clearTimeout(c.current),!s.trim()){be([]),ge(!1);return}c.current=setTimeout(()=>{ms(s)},300)},$s=async s=>{await d.from("notifications").update({read:!0}).eq("id",s),X(l=>l.map(o=>o.id===s?{...o,read:!0}:o)),k(l=>Math.max(0,l-1))},Rs=s=>{s.key==="Enter"&&fe.trim()&&(s.preventDefault(),c.current&&clearTimeout(c.current),xe.length>0?(je(xe[0].id),ge(!1),ue("")):ms(fe))},Us=async s=>{if(ae(s),C("followers"),Ue(new Set),Ze(!1),N){const{data:l}=await d.from("follows").select("following_id, profiles:following_id(id, username, avatar_url)").eq("follower_id",N);Re(l||[])}},Ls=async s=>{var j,_;const l=V.find(H=>H.id===s);if(!l)return;const o=((j=l.profiles)==null?void 0:j.username)||"someone",M=`${window.location.origin}/${o}?post=${s}`,b={title:l.title||"Check out this recipe on MealScrape!",text:l.caption?`${l.caption}

Shared via MealScrape`:"I found this fire recipe on MealScrape!",url:M};if(navigator.share&&((_=navigator.canShare)!=null&&_.call(navigator,b)))try{await navigator.share(b),S.success("Shared successfully!")}catch(H){H.name!=="AbortError"&&(console.error("Native share failed:",H),us(M))}else us(M)},us=s=>{navigator.clipboard.writeText(s).then(()=>{S.success("Link copied to clipboard!")}).catch(()=>{S.error("Failed to copy link")})},Fs=s=>{var b;const l=V.find(j=>j.id===s);if(!l)return;const M=`https://mealscrape.com/${((b=l.profiles)==null?void 0:b.username)||"user"}?post=${s}`;navigator.clipboard.writeText(M).then(()=>{Ze(!0),S.success("Link copied!"),setTimeout(()=>Ze(!1),2e3)}).catch(j=>{console.error("Failed to copy:",j),S.error("Failed to copy link")})},Is=async()=>{var b;if(!B||pe.size===0)return;const s=V.find(j=>j.id===B);if(!s)return;const o=`https://mealscrape.com/${((b=s.profiles)==null?void 0:b.username)||"user"}?post=${B}`,M=`Check out this recipe: ${s.title||"Shared post"}
${o}`;try{for(const j of pe){let _=null;const{data:H}=await d.from("conversations").select("id").or(`and(user1_id.eq.${N},user2_id.eq.${j}),and(user1_id.eq.${j},user2_id.eq.${N})`).maybeSingle();if(H)_=H.id;else{const{data:F,error:R}=await d.from("conversations").insert({user1_id:N,user2_id:j}).select().single();if(R)throw R;_=F.id}await d.from("direct_messages").insert({conversation_id:_,sender_id:N,content:M}),await d.from("conversations").update({updated_at:new Date().toISOString(),last_message_at:new Date().toISOString()}).eq("id",_)}if(S.success(`Shared with ${pe.size} ${pe.size===1?"person":"people"}!`),ae(null),Ue(new Set),pe.size===1&&a){const j=Array.from(pe)[0],_=oe.find(H=>H.following_id===j);_!=null&&_.profiles&&a(j,_.profiles.username)}}catch(j){console.error("Error sharing post:",j),S.error("Failed to share post")}};return e.jsx("div",{className:"min-h-screen bg-gray-50 pb-32 overflow-x-hidden",children:e.jsxs("div",{className:"max-w-sm lg:max-w-md mx-auto w-full",onClick:()=>{t(!1),ge(!1)},children:[e.jsx("div",{className:"fixed top-14 left-0 right-0 z-20 bg-white border-b border-gray-200 p-3 lg:px-6 max-w-sm lg:max-w-md mx-auto shadow-sm",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(nt,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),e.jsx("input",{type:"text",value:fe,onChange:s=>qs(s.target.value),onKeyDown:Rs,placeholder:"Search users...",className:"w-full pl-9 pr-3 py-2.5 text-sm bg-gray-50 border border-gray-200 rounded-full focus:outline-none focus:ring-2 focus:ring-orange-500 focus:bg-white transition-colors"}),ze&&e.jsx("div",{className:"absolute left-0 right-0 top-full mt-2 bg-white border border-gray-200 rounded-lg max-h-60 overflow-y-auto shadow-lg z-50",children:xe.length>0?xe.map(s=>e.jsxs("button",{onClick:()=>{je(s.id),ge(!1),ue("")},className:"w-full flex items-center gap-2 p-2 hover:bg-gray-50 transition-colors border-b border-gray-100 last:border-0",children:[e.jsx("div",{className:"w-7 h-7 rounded-full bg-gradient-to-br from-orange-400 to-red-400 overflow-hidden flex items-center justify-center",children:s.avatar_url?e.jsx("img",{src:s.avatar_url,alt:s.username,className:"w-full h-full object-cover",loading:"lazy",decoding:"async"}):e.jsx("span",{className:"text-white font-semibold text-sm",children:s.username.charAt(0).toUpperCase()})}),e.jsx("span",{className:"font-medium text-gray-900",children:s.username})]},s.id)):e.jsx("div",{className:"p-4 text-center text-gray-500 text-sm",children:"No users found"})})]}),e.jsxs("div",{ref:L,className:"relative",children:[e.jsxs("button",{onClick:async s=>{s.stopPropagation(),!i&&N&&(await d.from("notifications").update({read:!0}).eq("user_id",N).eq("read",!1).neq("type","message"),k(0),X(l=>l.map(o=>({...o,read:!0})))),t(!i)},className:"relative p-2.5 hover:bg-gray-100 rounded-full transition-colors flex-shrink-0 bg-gray-50",children:[e.jsx(ot,{className:"w-5 h-5 text-gray-700"}),h>0&&e.jsx("span",{className:"absolute top-0 right-0 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center font-semibold",children:h>9?"9+":h})]}),i&&e.jsx("div",{className:"absolute right-0 top-full mt-3 w-80 bg-white border border-gray-200 rounded-xl max-h-80 overflow-y-auto shadow-2xl z-[100]",children:u.length===0?e.jsx("div",{className:"p-4 text-center text-gray-500 text-sm",children:"No notifications yet"}):u.map(s=>{var l;return e.jsx("div",{onClick:()=>{var o;s.read||$s(s.id),t(!1),s.post_id&&(s.type==="like"||s.type==="comment")?Y(s.post_id):s.type==="follow"&&((o=s.actor)!=null&&o.username)&&(window.location.href=`/${s.actor.username}`)},className:`p-3 border-b border-gray-100 hover:bg-gray-50 cursor-pointer ${s.read?"":"bg-blue-50"}`,children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("p",{className:"text-sm",children:[e.jsx("span",{className:"font-semibold",children:((l=s.actor)==null?void 0:l.username)||"Someone"}),s.type==="follow"&&" started following you",s.type==="like"&&" loved your post",s.type==="comment"&&" commented on your post",s.type==="message"&&" sent you a message"]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[new Date(s.created_at).toLocaleDateString()," at"," ",new Date(s.created_at).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})]})]}),!s.read&&e.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full flex-shrink-0"})]})},s.id)})})]})]})}),e.jsxs("div",{className:"pt-24",style:{paddingTop:"calc(5rem + env(safe-area-inset-top))"},children:[$&&e.jsxs("div",{className:"bg-blue-50 border-b border-blue-200 p-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ct,{className:"w-4 h-4 text-blue-600"}),e.jsxs("span",{className:"text-sm font-semibold text-blue-900",children:["Posts tagged with #",$]})]}),e.jsx(D,{variant:"ghost",size:"sm",onClick:()=>r(null),className:"text-blue-600 hover:text-blue-700",children:"Clear"})]}),Ne?e.jsx(Tt,{userId:Ne,currentUserId:N,posts:V,isFollowing:W.has(Ne),onBack:()=>je(null),onToggleFollow:Es,onMessage:(s,l)=>{a&&a(s,l)},onRefresh:()=>Fe(0,!0)}):V.length===0?e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-gray-500",children:"No posts yet. Be the first to share!"})}):e.jsxs(e.Fragment,{children:[V.map(s=>{var b,j,_,H,F,R,Me,ke,_e,Ee,ye,Oe;console.log("[Discover] Post ID:",s.id),console.log("[Discover] Raw image_url:",s.image_url),console.log("[Discover] Raw video_url:",s.video_url);const l=(b=s.likes)==null?void 0:b.some(x=>x.user_id===N),o=((j=s.comments)==null?void 0:j.slice(0,2))||[],M=s.user_id===N;return e.jsxs("div",{className:"bg-white border-4 border-orange-500 mb-2 flex flex-col min-h-0",children:[e.jsxs("div",{className:"px-4 py-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[(_=s.profiles)!=null&&_.avatar_url?e.jsx("img",{src:s.profiles.avatar_url,alt:s.profiles.username,loading:"lazy",decoding:"async",className:"w-8 h-8 rounded-full object-cover"}):e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-br from-orange-500 to-red-500 flex items-center justify-center text-white font-medium text-sm",children:((R=(F=(H=s.profiles)==null?void 0:H.username)==null?void 0:F[0])==null?void 0:R.toUpperCase())||e.jsx(ns,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("button",{onClick:()=>{var x;window.location.href=`/${(x=s.profiles)==null?void 0:x.username}`},className:"font-semibold text-sm hover:underline cursor-pointer",children:(Me=s.profiles)==null?void 0:Me.username}),s.user_id==="51ad04fa-6d63-4c45-9423-76183eea7b39"&&e.jsx(We,{className:"w-4 h-4 text-yellow-500 fill-yellow-500"})]})]}),(M||A)&&e.jsxs(_t,{children:[e.jsx(St,{asChild:!0,children:e.jsx("button",{className:"p-2 hover:bg-gray-100 rounded-full",children:e.jsx(dt,{className:"w-5 h-5 text-gray-600"})})}),e.jsxs(Ct,{align:"end",children:[e.jsxs(ps,{onClick:()=>{let x=[];if(s.image_url)try{const P=JSON.parse(s.image_url);Array.isArray(P)?x.push(...P.map(ie=>({url:ie,type:"image"}))):x.push({url:P,type:"image"})}catch{s.image_url.includes(",")?x.push(...s.image_url.split(",").map(P=>({url:P.trim(),type:"image"}))):x.push({url:s.image_url,type:"image"})}if(s.video_url)try{const P=JSON.parse(s.video_url);Array.isArray(P)?x.push(...P.map(ie=>({url:ie,type:"video"}))):x.push({url:P,type:"video"})}catch{s.video_url.includes(",")?x.push(...s.video_url.split(",").map(P=>({url:P.trim(),type:"video"}))):x.push({url:s.video_url,type:"video"})}m({id:s.id,title:s.title||"",caption:s.caption||"",recipeUrl:s.recipe_url||"",currentMedia:x,deletedMedia:[],newMediaFiles:[],newMediaPreviews:[],newMediaTypes:[]})},className:"cursor-pointer",children:[e.jsx(mt,{className:"w-4 h-4 mr-2"}),"Edit post"]}),e.jsxs(ps,{onClick:()=>O(s.id),className:"cursor-pointer text-red-600",children:[e.jsx(is,{className:"w-4 h-4 mr-2"}),"Delete post"]})]})]})]}),e.jsxs("div",{className:"relative",children:[s.image_url||s.video_url?(()=>{let x=[],P=[];const ie=f=>{const g=[".mp4",".mov",".webm",".avi",".mkv"],K=f.toLowerCase();return g.some(we=>K.includes(we))};if(s.image_url)try{const f=JSON.parse(s.image_url);if(Array.isArray(f))f.forEach(g=>{const K=He(g);K&&(x.push(K),P.push(ie(g)?"video":"image"))});else{const g=He(f);g&&(x.push(g),P.push(ie(f)?"video":"image"))}}catch{if(s.image_url.includes(","))s.image_url.split(",").forEach(f=>{const g=f.trim(),K=He(g);K&&(x.push(K),P.push(ie(g)?"video":"image"))});else{const f=He(s.image_url);f&&(x.push(f),P.push(ie(s.image_url)?"video":"image"))}}if(s.video_url)try{const f=JSON.parse(s.video_url);Array.isArray(f)?f.forEach(g=>{g.includes("instagram.com")||(x.push(g),P.push("video"))}):f.includes("instagram.com")||(x.push(f),P.push("video"))}catch{s.video_url.includes("instagram.com")||(x.push(s.video_url),P.push("video"))}if(x.length===0)return console.log("[Discover] âŒ NO MEDIA FOUND for post:",s.id),e.jsx("div",{className:"w-full aspect-square bg-gray-200 flex items-center justify-center",children:e.jsx("p",{className:"text-gray-500",children:"No media available"})});console.log("[Discover] ðŸ“Š Media parsed for post:",s.id),console.log("[Discover] ðŸ“Š mediaUrls:",x),console.log("[Discover] ðŸ“Š mediaTypes:",P),x.forEach((f,g)=>{P[g]==="video"&&console.log("[Discover] ðŸŽ¥ Video URL at index",g,":",f)});const Z=Ss[s.id]||0,Te=f=>{Cs(g=>({...g,[s.id]:typeof f=="function"?f(g[s.id]||0):f}))};return x.length===1?(console.log("[Discover] âœ“ Single media:",x[0]),P[0]==="video"?e.jsx("video",{src:x[0],controls:!0,playsInline:!0,className:"w-full aspect-square object-cover bg-black",preload:"auto",onClick:f=>{const g=f.target.getBoundingClientRect();if(f.clientY-g.top<g.height-40){const ce=f.target;ce.paused?ce.play().catch($e=>console.error("[Discover] Play failed:",$e)):ce.pause()}},onError:f=>{const g=f.target;console.error("[Discover] Single video failed:",x[0]),console.error("[Discover] Video error details:",{error:g.error,networkState:g.networkState,readyState:g.readyState,src:g.src}),S.error("Video failed to load")},onLoadStart:()=>{console.log("[Discover] Single video loading:",x[0])},onCanPlay:()=>{console.log("[Discover] Single video can play:",x[0])}},x[0]):e.jsx("img",{src:x[0],alt:s.title||"Post",loading:"lazy",decoding:"async",className:"w-full aspect-square object-cover cursor-pointer",onClick:()=>{es({media:x.map((f,g)=>({url:f,type:P[g]})),initialIndex:0,postId:s.id})},onError:f=>{var K;console.error("[Discover] Image failed to load:",x[0]);const g=f.target;g.style.display="none",(K=g.parentElement)==null||K.classList.add("bg-gray-200")}})):e.jsxs("div",{className:"relative w-full aspect-square bg-black",children:[P[Z]==="video"?e.jsx("video",{src:x[Z],controls:!0,playsInline:!0,className:"w-full h-full object-cover",preload:"auto",onClick:f=>{f.stopPropagation();const g=f.target.getBoundingClientRect();if(f.clientY-g.top<g.height-40){const ce=f.target;ce.paused?ce.play().catch($e=>console.error("[Discover] Play failed:",$e)):ce.pause()}},onError:f=>{const g=f.target;console.error("[Discover] Carousel video failed:",x[Z]),console.error("[Discover] Video error details:",{error:g.error,networkState:g.networkState,readyState:g.readyState,src:g.src}),S.error("Video failed to load")},onLoadStart:()=>{console.log("[Discover] Video loading...")},onCanPlay:()=>{console.log("[Discover] Video can play")}},x[Z]):e.jsx("img",{src:x[Z],loading:"lazy",decoding:"async",alt:`${s.title||"Post"} ${Z+1}`,className:"w-full h-full object-cover cursor-pointer",onClick:()=>{es({media:x.map((f,g)=>({url:f,type:P[g]})),initialIndex:Z,postId:s.id})},onError:f=>{var K;console.error("[Discover] Carousel image failed:",x[Z]);const g=f.target;g.style.display="none",(K=g.parentElement)==null||K.classList.add("bg-gray-200")}},x[Z]),Z>0&&e.jsx("button",{onClick:f=>{f.stopPropagation(),Te(g=>g-1)},className:"absolute left-2 top-1/2 -translate-y-1/2 bg-black/50 hover:bg-black/70 text-white rounded-full p-2 transition-colors z-10",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})}),Z<x.length-1&&e.jsx("button",{onClick:f=>{f.stopPropagation(),Te(g=>g+1)},className:"absolute right-2 top-1/2 -translate-y-1/2 bg-black/50 hover:bg-black/70 text-white rounded-full p-2 transition-colors z-10",children:e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}),e.jsx("div",{className:"absolute bottom-3 left-0 right-0 flex justify-center gap-1.5 z-10",children:x.map((f,g)=>e.jsx("button",{onClick:K=>{K.stopPropagation(),Te(g)},className:`w-2 h-2 rounded-full transition-all ${g===Z?"bg-white w-6":"bg-white/50"}`},g))}),P[Z]!=="video"&&e.jsx("div",{onTouchStart:f=>{const g=f.touches[0];f.currentTarget.touchStartX=g.clientX},onTouchEnd:f=>{const g=f.changedTouches[0],we=f.currentTarget.touchStartX-g.clientX;Math.abs(we)>50&&(we>0&&Z<x.length-1?Te(ce=>ce+1):we<0&&Z>0&&Te(ce=>ce-1))},className:"absolute inset-0"})]})})():e.jsx("div",{className:"w-full aspect-square bg-gray-200 flex items-center justify-center",children:e.jsx("p",{className:"text-gray-500",children:"No media"})}),s.spotify_preview_url&&e.jsxs("div",{className:"absolute top-4 right-4 z-10",children:[e.jsxs("button",{onClick:x=>{x.stopPropagation();const P=document.getElementById(`audio-${s.id}`),ie=x.currentTarget.querySelector(".play-icon");document.querySelectorAll("audio").forEach(Z=>{Z.id!==`audio-${s.id}`&&Z.pause()}),P.paused?(P.play(),ie&&(ie.textContent="â¸ï¸")):(P.pause(),ie&&(ie.textContent="â–¶ï¸"))},className:"bg-black/70 hover:bg-black/90 backdrop-blur-sm text-white px-3 py-2 rounded-full shadow-lg transition-all flex items-center gap-2",children:[e.jsx("span",{className:"text-xl play-icon",children:"â–¶ï¸"}),e.jsxs("div",{className:"text-left text-xs max-w-32",children:[e.jsx("div",{className:"font-semibold truncate",children:s.spotify_track_name}),e.jsx("div",{className:"text-white/80 truncate",children:s.spotify_artist_name})]})]}),e.jsx("audio",{id:`audio-${s.id}`,src:s.spotify_preview_url})]}),s.title&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent px-4 py-3",children:e.jsx("h3",{className:"text-white text-sm font-semibold",children:s.title})}),de[s.id]&&de[s.id].count>0&&e.jsx("div",{className:"absolute bottom-3 right-3 z-20",children:e.jsxs("div",{className:"flex items-center gap-1 bg-black/70 backdrop-blur-sm px-2.5 py-1.5 rounded-full shadow-lg",children:[e.jsx("span",{className:"text-lg",children:"ðŸ”¥"}),e.jsx("span",{className:"text-white text-xs font-bold",children:de[s.id].average.toFixed(1)}),e.jsxs("span",{className:"text-white/70 text-xs",children:["(",de[s.id].count,")"]})]})})]}),e.jsxs("div",{className:"px-4 py-3 space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("button",{onClick:()=>zs(s.id),className:"transition-transform hover:scale-110 relative",children:[e.jsx(os,{className:`w-7 h-7 ${l?"fill-red-500 text-red-500":"text-gray-700"}`}),((ke=s._count)==null?void 0:ke.likes)&&s._count.likes>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-yellow-500 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center",children:s._count.likes})]}),e.jsxs("button",{onClick:()=>Y(s.id),className:"transition-transform hover:scale-110 relative",children:[e.jsx(cs,{className:"w-7 h-7 text-gray-700"}),((_e=s._count)==null?void 0:_e.comments)&&s._count.comments>0&&e.jsx("span",{className:"absolute -top-1 -right-1 bg-yellow-500 text-white text-xs font-bold rounded-full w-5 h-5 flex items-center justify-center",children:s._count.comments})]}),e.jsx("button",{onClick:()=>Us(s.id),className:"ml-auto transition-transform hover:scale-110",children:e.jsx(Ie,{className:"w-7 h-7 text-gray-700 hover:text-orange-600 transition-colors"})})]}),s.caption&&e.jsxs("div",{className:"text-sm break-words overflow-wrap-anywhere",children:[e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx("span",{className:"font-semibold",children:(Ee=s.profiles)==null?void 0:Ee.username}),s.user_id==="51ad04fa-6d63-4c45-9423-76183eea7b39"&&e.jsx(We,{className:"w-3 h-3 text-yellow-500 fill-yellow-500"})]})," ",e.jsx("span",{className:"text-gray-700 break-all",children:zt(s.caption,x=>{r(x),je(null)})})]}),(((ye=s._count)==null?void 0:ye.comments)||0)>0&&e.jsxs("button",{onClick:()=>Y(s.id),className:"text-sm text-gray-500 hover:text-gray-700",children:["View all ",(Oe=s._count)==null?void 0:Oe.comments," comments"]}),o.map(x=>{var P;return e.jsxs("div",{className:"text-sm",children:[e.jsxs("span",{className:"inline-flex items-center gap-1",children:[e.jsx("span",{className:"font-semibold",children:(P=x.profiles)==null?void 0:P.username}),x.user_id==="51ad04fa-6d63-4c45-9423-76183eea7b39"&&e.jsx(We,{className:"w-3 h-3 text-yellow-500 fill-yellow-500"})]})," ",e.jsx("span",{className:"text-gray-700",children:x.text})]},x.id)}),(s.recipe_id||s.recipe_url)&&e.jsxs(D,{onClick:async()=>{if(s.recipe_id){const{getRecipeById:x}=await bs(async()=>{const{getRecipeById:ie}=await import("./services-TCLpZZGf.js").then(Z=>Z.a2);return{getRecipeById:ie}},__vite__mapDeps([0,1,2,3,4,5,6,7,8,9])),P=await x(s.recipe_id);P?ve(P):S.error("Recipe not found")}else s.recipe_url&&window.open(s.recipe_url,"_blank")},variant:"outline",size:"sm",className:"w-full mt-2 border-orange-600 text-orange-600 hover:bg-orange-50",children:[e.jsx(Qe,{className:"w-4 h-4 mr-2"}),"View Recipe"]}),e.jsx("div",{className:"text-xs text-gray-400 uppercase pt-1",children:new Date(s.created_at).toLocaleDateString()})]})]},s.id)}),G&&e.jsx("div",{className:"py-8 text-center",children:e.jsx(D,{onClick:Ms,variant:"outline",children:"Load More"})})]})]}),Q&&e.jsx(ds,{postId:Q,isOpen:!!Q,onClose:()=>Y(null),onCommentPosted:()=>{}}),e.jsx(pt,{open:!!te,onOpenChange:s=>!s&&O(null),children:e.jsxs(bt,{children:[e.jsxs(wt,{children:[e.jsx(vt,{children:"Delete post?"}),e.jsx(jt,{children:"This action cannot be undone. This will permanently delete your post."})]}),e.jsxs(yt,{children:[e.jsx(Nt,{children:"Cancel"}),e.jsx(kt,{onClick:Ps,className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})}),e.jsx(Se,{open:!!p,onOpenChange:s=>!s&&m(null),children:e.jsxs(Ce,{className:"sm:max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Ge,{children:e.jsx(Ae,{children:"Edit Post"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Title"}),e.jsx("input",{type:"text",value:(p==null?void 0:p.title)||"",onChange:s=>m(l=>l?{...l,title:s.target.value}:null),placeholder:"Recipe title...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Caption"}),e.jsx(ft,{value:(p==null?void 0:p.caption)||"",onChange:s=>m(l=>l?{...l,caption:s.target.value}:null),placeholder:"Write a caption...",rows:3,className:"w-full"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Recipe Link"}),e.jsx("input",{type:"url",value:(p==null?void 0:p.recipeUrl)||"",onChange:s=>m(l=>l?{...l,recipeUrl:s.target.value}:null),placeholder:"https://...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),p&&p.currentMedia.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Current Media"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:p.currentMedia.filter(s=>!p.deletedMedia.includes(s.url)).map((s,l)=>e.jsxs("div",{className:"relative group",children:[s.type==="video"?e.jsx("video",{src:s.url,className:"w-full h-32 object-cover rounded-lg border border-gray-200",muted:!0}):e.jsx("img",{src:s.url,alt:`Media ${l+1}`,className:"w-full h-32 object-cover rounded-lg border border-gray-200",loading:"lazy"}),e.jsx("div",{className:"absolute top-1 left-1 bg-black/70 text-white text-xs px-2 py-0.5 rounded",children:s.type==="video"?"ðŸŽ¥":"ðŸ–¼ï¸"}),e.jsx("button",{onClick:()=>{m(o=>o?{...o,deletedMedia:[...o.deletedMedia,s.url]}:null)},className:"absolute top-1 right-1 bg-red-500 hover:bg-red-600 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(De,{className:"w-4 h-4"})})]},l))})]}),p&&p.newMediaPreviews.length>0&&e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block text-green-600",children:"New Media to Add"}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:p.newMediaPreviews.map((s,l)=>e.jsxs("div",{className:"relative group",children:[p.newMediaTypes[l]==="video"?e.jsx("video",{src:s,className:"w-full h-32 object-cover rounded-lg border-2 border-green-500",muted:!0}):e.jsx("img",{src:s,alt:`New media ${l+1}`,className:"w-full h-32 object-cover rounded-lg border-2 border-green-500",loading:"lazy"}),e.jsx("div",{className:"absolute top-1 left-1 bg-black/70 text-white text-xs px-2 py-0.5 rounded",children:p.newMediaTypes[l]==="video"?"ðŸŽ¥ New":"ðŸ–¼ï¸ New"}),e.jsx("button",{onClick:()=>{m(o=>o?(URL.revokeObjectURL(o.newMediaPreviews[l]),{...o,newMediaFiles:o.newMediaFiles.filter((M,b)=>b!==l),newMediaPreviews:o.newMediaPreviews.filter((M,b)=>b!==l),newMediaTypes:o.newMediaTypes.filter((M,b)=>b!==l)}):null)},className:"absolute top-1 right-1 bg-red-500 hover:bg-red-600 text-white rounded-full p-1 opacity-0 group-hover:opacity-100 transition-opacity",children:e.jsx(De,{className:"w-4 h-4"})})]},l))})]}),p&&(()=>{const l=p.currentMedia.filter(o=>!p.deletedMedia.includes(o.url)).length+p.newMediaFiles.length;return l>=4?e.jsx("p",{className:"text-sm text-gray-500",children:"Maximum 4 media files reached"}):e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Add More Media"}),e.jsx("input",{type:"file",accept:"image/*,video/*",multiple:!0,onChange:o=>{const M=Array.from(o.target.files||[]),b=4-l,j=M.slice(0,b),_=[],H=[],F=[];for(const R of j){const Me=R.type.startsWith("video/")?52428800:10485760;if(R.size>Me){S.error(`${R.name} is too large (max ${R.type.startsWith("video/")?"50MB":"10MB"})`);continue}_.push(R),H.push(URL.createObjectURL(R)),F.push(R.type.startsWith("video/")?"video":"image")}_.length>0&&m(R=>R?{...R,newMediaFiles:[...R.newMediaFiles,..._],newMediaPreviews:[...R.newMediaPreviews,...H],newMediaTypes:[...R.newMediaTypes,...F]}:null),o.target.value=""},className:"w-full px-3 py-2 border border-gray-300 rounded-md"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Images: max 10MB | Videos: max 50MB | Total: ",l,"/4"]})]})})()]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4 border-t",children:[e.jsx(D,{variant:"outline",onClick:()=>m(null),children:"Cancel"}),e.jsx(D,{onClick:Ds,disabled:ne,className:"bg-orange-500 hover:bg-orange-600",children:ne?"Saving...":"Save Changes"})]})]})}),me&&e.jsx(Ns,{recipe:me,open:!!me,onOpenChange:s=>!s&&ve(null)}),e.jsx(Se,{open:!!B,onOpenChange:s=>!s&&ae(null),children:e.jsxs(Ce,{className:"sm:max-w-md max-h-[80vh] overflow-y-auto",children:[e.jsx(Ge,{children:e.jsx(Ae,{children:"Share"})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2 border-b border-gray-200",children:[e.jsx("button",{onClick:()=>C("followers"),className:`flex-1 py-2 px-4 font-medium transition-colors ${J==="followers"?"text-orange-600 border-b-2 border-orange-600":"text-gray-500 hover:text-gray-700"}`,children:"Send to Followers"}),e.jsx("button",{onClick:()=>C("link"),className:`flex-1 py-2 px-4 font-medium transition-colors ${J==="link"?"text-orange-600 border-b-2 border-orange-600":"text-gray-500 hover:text-gray-700"}`,children:"Share Link"})]}),J==="followers"&&e.jsx("div",{className:"space-y-4",children:oe.length===0?e.jsx("div",{className:"text-center py-8 text-gray-500",children:"You don't have any followers yet"}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"max-h-64 overflow-y-auto space-y-2",children:oe.map(s=>{var M,b;const l=s.profiles,o=pe.has(s.following_id);return e.jsxs("button",{onClick:()=>{const j=new Set(pe);o?j.delete(s.following_id):j.add(s.following_id),Ue(j)},className:`w-full flex items-center gap-3 p-3 rounded-lg transition-colors ${o?"bg-orange-50 border-2 border-orange-500":"hover:bg-gray-50 border-2 border-transparent"}`,children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-gradient-to-br from-orange-400 to-red-400 flex items-center justify-center text-white font-semibold overflow-hidden",children:l!=null&&l.avatar_url?e.jsx("img",{src:l.avatar_url,alt:l.username,className:"w-full h-full object-cover",loading:"lazy"}):(b=(M=l==null?void 0:l.username)==null?void 0:M[0])==null?void 0:b.toUpperCase()}),e.jsx("div",{className:"flex-1 text-left",children:e.jsx("div",{className:"font-semibold",children:l==null?void 0:l.username})}),o&&e.jsx(xs,{className:"w-5 h-5 text-orange-600"})]},s.following_id)})}),e.jsxs(D,{onClick:Is,disabled:pe.size===0,className:"w-full bg-orange-500 hover:bg-orange-600",children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Send to ",pe.size," ",pe.size===1?"person":"people"]})]})}),J==="link"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs(D,{onClick:()=>B&&Ls(B),className:"w-full bg-blue-500 hover:bg-blue-600",children:[e.jsx(Ie,{className:"w-4 h-4 mr-2"}),"Share via Apps"]}),e.jsx(D,{onClick:()=>B&&Fs(B),variant:"outline",className:"w-full",children:_s?e.jsxs(e.Fragment,{children:[e.jsx(xs,{className:"w-4 h-4 mr-2"}),"Link Copied!"]}):e.jsxs(e.Fragment,{children:[e.jsx(ut,{className:"w-4 h-4 mr-2"}),"Copy Link"]})})]})]})]})}),Le&&e.jsx(ks,{media:Le.media,initialIndex:Le.initialIndex,postId:Le.postId,open:!!Le,onOpenChange:s=>{s||es(null)},onLikeUpdate:()=>{Fe(1,!0)}})]})})}const Wt=Object.freeze(Object.defineProperty({__proto__:null,Discover:qt},Symbol.toStringTag,{value:"Module"}));export{Mt as C,Wt as D,ks as P,Ns as R,ds as a,Ht as e};
