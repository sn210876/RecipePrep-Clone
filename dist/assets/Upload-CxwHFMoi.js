import{c as Ce,W as Oe,a3 as Q,p as ze,r as j,a4 as Te,s as R,j as e,w as _,q as we,f as o,X as Z,B as Ve,D as M}from"./index-JyBq9rLv.js";import{T as Ae}from"./textarea-RoGjTudR.js";import{e as We}from"./hashtags-aptYOYLE.js";import{S as Be,a as qe,b as Ge,c as Je,d as He}from"./select-gEZz8QiH.js";import{a as O,i as je,f as Ne}from"./imageCompression-q737ovES.js";import{I as B}from"./image-DCiVdYN7.js";import{P as Xe,a as Ye}from"./play-CJYI-rbH.js";import{U as Ke}from"./upload-BdvOihJe.js";import"./react-icons.esm-Dmzb-FaV.js";import"./index-BaoHEetE.js";import"./index-BdQq_4o_.js";import"./index-hoBPq4ct.js";import"./index-CRMZdbwC.js";import"./index-BImAK-cm.js";import"./index-B5V1zg6h.js";import"./index-DUr4xt7P.js";import"./index-Dp6MyVgh.js";import"./browser-image-compression-BzWLnoYn.js";/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=Ce("Music",[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=Ce("Video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]);function Ue(P){return P.type.startsWith("video/")}var k;(function(P){P.Prompt="PROMPT",P.Camera="CAMERA",P.Photos="PHOTOS"})(k||(k={}));var z;(function(P){P.Rear="REAR",P.Front="FRONT"})(z||(z={}));var ee;(function(P){P.Uri="uri",P.Base64="base64",P.DataUrl="dataUrl"})(ee||(ee={}));class Ze extends Oe{async getPhoto(s){return new Promise(async(g,i)=>{if(s.webUseInput||s.source===k.Photos)this.fileInputExperience(s,g,i);else if(s.source===k.Prompt){let r=document.querySelector("pwa-action-sheet");r||(r=document.createElement("pwa-action-sheet"),document.body.appendChild(r)),r.header=s.promptLabelHeader||"Photo",r.cancelable=!1,r.options=[{title:s.promptLabelPhoto||"From Photos"},{title:s.promptLabelPicture||"Take Picture"}],r.addEventListener("onSelection",async p=>{p.detail===0?this.fileInputExperience(s,g,i):this.cameraExperience(s,g,i)})}else this.cameraExperience(s,g,i)})}async pickImages(s){return new Promise(async(g,i)=>{this.multipleFileInputExperience(g,i)})}async cameraExperience(s,g,i){if(customElements.get("pwa-camera-modal")){const r=document.createElement("pwa-camera-modal");r.facingMode=s.direction===z.Front?"user":"environment",document.body.appendChild(r);try{await r.componentOnReady(),r.addEventListener("onPhoto",async p=>{const x=p.detail;x===null?i(new Q("User cancelled photos app")):x instanceof Error?i(x):g(await this._getCameraPhoto(x,s)),r.dismiss(),document.body.removeChild(r)}),r.present()}catch{this.fileInputExperience(s,g,i)}}else console.error("Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/web/pwa-elements."),this.fileInputExperience(s,g,i)}fileInputExperience(s,g,i){let r=document.querySelector("#_capacitor-camera-input");const p=()=>{var x;(x=r.parentNode)===null||x===void 0||x.removeChild(r)};r||(r=document.createElement("input"),r.id="_capacitor-camera-input",r.type="file",r.hidden=!0,document.body.appendChild(r),r.addEventListener("change",x=>{const h=r.files[0];let S="jpeg";if(h.type==="image/png"?S="png":h.type==="image/gif"&&(S="gif"),s.resultType==="dataUrl"||s.resultType==="base64"){const U=new FileReader;U.addEventListener("load",()=>{if(s.resultType==="dataUrl")g({dataUrl:U.result,format:S});else if(s.resultType==="base64"){const T=U.result.split(",")[1];g({base64String:T,format:S})}p()}),U.readAsDataURL(h)}else g({webPath:URL.createObjectURL(h),format:S}),p()}),r.addEventListener("cancel",x=>{i(new Q("User cancelled photos app")),p()})),r.accept="image/*",r.capture=!0,s.source===k.Photos||s.source===k.Prompt?r.removeAttribute("capture"):s.direction===z.Front?r.capture="user":s.direction===z.Rear&&(r.capture="environment"),r.click()}multipleFileInputExperience(s,g){let i=document.querySelector("#_capacitor-camera-input-multiple");const r=()=>{var p;(p=i.parentNode)===null||p===void 0||p.removeChild(i)};i||(i=document.createElement("input"),i.id="_capacitor-camera-input-multiple",i.type="file",i.hidden=!0,i.multiple=!0,document.body.appendChild(i),i.addEventListener("change",p=>{const x=[];for(let h=0;h<i.files.length;h++){const S=i.files[h];let U="jpeg";S.type==="image/png"?U="png":S.type==="image/gif"&&(U="gif"),x.push({webPath:URL.createObjectURL(S),format:U})}s({photos:x}),r()}),i.addEventListener("cancel",p=>{g(new Q("User cancelled photos app")),r()})),i.accept="image/*",i.click()}_getCameraPhoto(s,g){return new Promise((i,r)=>{const p=new FileReader,x=s.type.split("/")[1];g.resultType==="uri"?i({webPath:URL.createObjectURL(s),format:x,saved:!1}):(p.readAsDataURL(s),p.onloadend=()=>{const h=p.result;g.resultType==="dataUrl"?i({dataUrl:h,format:x,saved:!1}):i({base64String:h.split(",")[1],format:x,saved:!1})},p.onerror=h=>{r(h)})})}async checkPermissions(){if(typeof navigator>"u"||!navigator.permissions)throw this.unavailable("Permissions API not available in this browser");try{return{camera:(await window.navigator.permissions.query({name:"camera"})).state,photos:"granted"}}catch{throw this.unavailable("Camera permissions are not available in this browser")}}async requestPermissions(){throw this.unimplemented("Not implemented on web.")}async pickLimitedLibraryPhotos(){throw this.unavailable("Not implemented on web.")}async getLimitedLibraryPhotos(){throw this.unavailable("Not implemented on web.")}}const et=ze("Camera",{web:()=>new Ze});function wt({onNavigate:P}){var fe;const[s,g]=j.useState([]),[i,r]=j.useState([]),[p,x]=j.useState(null),[h,S]=j.useState("post"),[U,T]=j.useState(""),[D,te]=j.useState(""),[q,se]=j.useState(""),[ae,Se]=j.useState([]),[oe,re]=j.useState(!1),[ie,tt]=j.useState(0);j.useEffect(()=>{const t=Date.now();return console.log("üöÄ Upload component MOUNTED at",t),(async()=>{try{const{value:a}=await M.get({key:"pending_upload_webpath"});if(a){console.log("üîÑ Found pending upload, restoring...");const m=JSON.parse(a),c=o.loading("Loading photo...",{duration:0});try{console.log("üîÑ Fetching from webPath:",m.webPath);const b=await fetch(m.webPath);if(!b.ok)throw new Error("Failed to load cached image");const f=await b.blob(),u=new File([f],`photo-${m.timestamp}.${m.format}`,{type:m.mimeType});console.log("üóúÔ∏è Compressing restored image...");const d=(await O([u]))[0].file,v=URL.createObjectURL(d);g(y=>[...y,d]),r(y=>[...y,v]),x("image"),await M.remove({key:"pending_upload_webpath"}),console.log("‚úÖ Restored and compressed pending upload"),o.success("Photo loaded!",{id:c})}catch(b){console.error("‚ùå Failed to restore pending upload:",b),o.error("Failed to load photo",{id:c}),await M.remove({key:"pending_upload_webpath"})}}}catch(a){console.error("‚ùå Error checking for pending upload:",a),await M.remove({key:"pending_upload_webpath"})}})(),()=>{console.log("üíÄ Upload component UNMOUNTED at",Date.now(),"lived for",Date.now()-t,"ms")}},[]),j.useEffect(()=>{console.log("üìä State changed - selectedFiles:",s.length,"previewUrls:",i.length,"fileType:",p)},[s,i,p]);const[Fe,G]=j.useState(!1),[le,ke]=j.useState(""),[ne,J]=j.useState([]),[w,H]=j.useState(null),[ce,de]=j.useState(!1),[X,V]=j.useState(!1),A=Te.useRef(null),Y=j.useRef(null);j.useEffect(()=>{Re()},[]);const Re=async()=>{try{const{data:t}=await R.auth.getUser();if(!t.user)return;const{data:l,error:a}=await R.from("public_recipes").select("id, title, image_url").eq("user_id",t.user.id).order("created_at",{ascending:!1});if(a)throw a;Se(l||[])}catch(t){console.error("Error loading recipes:",t)}},me=t=>new Promise((l,a)=>{const m=document.createElement("video");m.preload="metadata",m.onloadedmetadata=()=>{window.URL.revokeObjectURL(m.src);const c=Math.floor(m.duration);isNaN(c)||c===0?a(new Error("Invalid video duration")):l(c)},m.onerror=()=>{window.URL.revokeObjectURL(m.src),a(new Error("Failed to load video metadata"))},m.src=URL.createObjectURL(t)}),_e=async t=>{console.log("üîç File select triggered"),console.log("üì± Platform:",_.getPlatform());const l=Array.from(t.target.files||[]);if(console.log("üìÅ Selected files count:",l.length),l.length===0){console.log("‚ö†Ô∏è No files selected");return}console.log("üìù File details:",l.map(n=>({name:n.name,size:n.size,type:n.type})));const a=l.filter(n=>n.type.startsWith("image/")||n.type.startsWith("video/"));if(console.log("üéØ Media files after filter:",a.length),a.length===0){console.log("‚ùå No valid media files"),o.error("Please select at least one image or video");return}if(a.length>4){o.error("You can only upload up to 4 images/videos total");return}console.log("‚úÖ Processing",a.length,"media files");const m=[],c=[];let b=!1;const f=[],u=[];for(const n of a){const d=je(n),v=n.type.startsWith("video/");if(d)f.push(n);else if(v){if(n.size>100*1024*1024){o.error(`${n.name} is too large (max 100MB for videos)`);continue}try{const y=await me(n);if(h==="daily"&&y>30){o.error(`${n.name}: Daily videos must be 30 seconds or less`);continue}b=!0,u.push(n)}catch(y){console.error("Video load error:",y),o.error(`Failed to load ${n.name}`);continue}}}if(f.length>0){const n=o.loading("Compressing images...",{duration:0});try{console.log("üóúÔ∏è Starting compression for",f.length,"images");const d=await O(f,(y,N,$)=>{$.isCompressing&&(console.log(`Compressing ${y+1}/${N}: ${Math.round($.percent)}%`),o.loading(`Compressing image ${y+1}/${N}... ${Math.round($.percent)}%`,{id:n,duration:0}))});console.log("‚úÖ Compression complete:",d);const v=d.reduce((y,N)=>y+(N.originalSize-N.compressedSize),0);o.success(`Images compressed! Saved ${Ne(v)}`,{id:n,duration:3e3});for(const y of d){m.push(y.file);const N=URL.createObjectURL(y.file);console.log("üì∏ Created preview URL:",N),c.push(N)}}catch(d){console.error("‚ùå Compression error:",d),o.error(d.message||"Failed to compress images",{id:n});return}}for(const n of u)m.push(n),c.push(URL.createObjectURL(n));if(m.length===0){console.log("‚ùå No valid files to upload"),o.error("No valid files to upload");return}console.log("‚úÖ Setting state with",m.length,"files"),console.log("üì∏ Preview URLs:",c),g(m),r(c),x(b?"video":"image"),console.log("‚úÖ State updated successfully")},pe=async()=>{i.forEach(t=>URL.revokeObjectURL(t)),g([]),r([]),x(null),await M.remove({key:"pending_upload_webpath"})},ue=async t=>{if(s.length>=4){o.error("Maximum 4 photos allowed");return}const l=o.loading(t===k.Camera?"Opening camera...":"Opening gallery...",{duration:0});try{console.log("üì∏ handleCapacitorCamera called with source:",t),console.log("üìä Current state:",{selectedFiles:s.length,previewUrls:i.length});const a=await et.getPhoto({quality:90,allowEditing:!1,resultType:ee.Uri,source:t,saveToGallery:t===k.Camera});if(console.log("‚úÖ Camera.getPhoto succeeded:",{hasWebPath:!!a.webPath,hasPath:!!a.path,format:a.format}),o.loading("Processing image...",{id:l}),!a.webPath){console.error("‚ùå No webPath in image result"),o.error("Failed to get image path",{id:l});return}console.log("üîÑ Fetching image from webPath:",a.webPath);const m=await fetch(a.webPath);if(!m.ok){console.error("‚ùå Fetch failed:",m.status,m.statusText),o.error("Failed to load image from device",{id:l});return}const c=await m.blob();console.log("‚úÖ Blob created:",{size:c.size,type:c.type});let b=c.type;(!b||b==="application/octet-stream")&&(b=`image/${a.format||"jpeg"}`,console.log("‚ö†Ô∏è Blob type was empty/generic, using format:",b));const f=new File([c],`photo-${Date.now()}.${a.format||"jpg"}`,{type:b});console.log("‚úÖ File created:",{name:f.name,size:f.size,type:f.type}),console.log("üíæ Saving to Preferences for recovery..."),await M.set({key:"pending_upload_webpath",value:JSON.stringify({webPath:a.webPath,format:a.format||"jpeg",mimeType:b,timestamp:Date.now()})}),o.loading("Compressing image...",{id:l});try{console.log("üóúÔ∏è Starting compression...");const n=(await O([f]))[0].file;console.log("‚úÖ Compression complete:",{size:n.size});const d=URL.createObjectURL(n);console.log("‚úÖ Preview URL created:",d),console.log("üîß Appending to existing files..."),console.log("üìä Before update:",{selectedFiles:s.length,previewUrls:i.length}),g(y=>{const N=[...y,n];return console.log("üìä Updated selectedFiles:",N.length),N}),r(y=>{const N=[...y,d];return console.log("üìä Updated previewUrls:",N.length),N}),x("image"),console.log("‚úÖ State updated successfully - photo added to existing collection"),await M.remove({key:"pending_upload_webpath"});const v=s.length+1;o.success(t===k.Camera?`Photo ${v}/4 captured!`:`Photo ${v}/4 added!`,{id:l})}catch(u){console.error("‚ùå Compression error:",u),o.error(u.message||"Failed to compress image",{id:l}),await M.remove({key:"pending_upload_webpath"})}}catch(a){console.error("‚ùå Camera/Gallery error:",a),a.message!=="User cancelled photos app"?o.error(`Failed to ${t===k.Camera?"capture photo":"select from gallery"}`,{id:l}):o.dismiss(l)}},ge=()=>{_.isNativePlatform()?ue(k.Camera):o.info("Camera only available on mobile app")},he=()=>{console.log("üì∑ From Gallery button clicked"),console.log("üì± Platform:",_.getPlatform()),console.log("üì± Is Native:",_.isNativePlatform()),_.isNativePlatform()?(console.log("‚úÖ On native platform - using Capacitor Camera with Photos source"),ue(k.Photos)):(console.log("‚úÖ On web platform - triggering file input"),Y.current?(console.log("‚úÖ File input ref exists, clicking..."),Y.current.click()):console.error("‚ùå File input ref is null!"))},Le=()=>{A.current&&(X?A.current.pause():A.current.play(),V(!X))},$e=async t=>{if(!t.trim()){J([]);return}de(!0);try{const m=((await(await fetch(`https://itunes.apple.com/search?term=${encodeURIComponent(t)}&media=music&entity=song&limit=20`)).json()).results||[]).map(c=>{var b;return{id:c.trackId.toString(),name:c.trackName||"Unknown Song",artists:[{name:c.artistName||"Unknown Artist"}],album:{images:[{url:((b=c.artworkUrl100)==null?void 0:b.replace("100x100","300x300"))||"https://via.placeholder.com/300"}]},preview_url:c.previewUrl||null}});J(m)}catch(l){console.error("Music search failed:",l),o.error("Search failed ‚Äî try again"),J([])}finally{de(!1)}},Ee=async()=>{var t,l,a,m,c,b;if(s.length===0){o.error("Please select an image or video");return}if(h==="post"&&!U.trim()){o.error("Please enter a title");return}if(h==="daily"&&p==="video"&&ie>30){o.error("Daily videos must be 30 seconds or less");return}re(!0);try{const{data:f}=await R.auth.getUser();if(!f.user)throw new Error("Not authenticated");const{data:u}=await R.from("profiles").select("id").eq("id",f.user.id).maybeSingle();u||await R.from("profiles").insert({id:f.user.id,username:((t=f.user.email)==null?void 0:t.split("@")[0])||"user",avatar_url:null});const n=o.loading("Preparing files...",{duration:0}),d=[],v=[],y=s.filter(je),N=s.filter(Ue);let $=[];if(y.length>0){o.loading(`Compressing ${y.length} image(s)...`,{id:n});const C=await O(y);$=C.map(L=>L.file);const E=C.reduce((L,I)=>L+(I.originalSize-I.compressedSize),0);console.log(`Images compressed: saved ${Ne(E)}`)}const F=[...$,...N],xe=F.length;let ye=0;o.loading(`Uploading ${xe} file(s)...`,{id:n});const Ie=F.map(async C=>{var ve;const E=(ve=C.name.split(".").pop())==null?void 0:ve.toLowerCase(),L=`${f.user.id}/${Date.now()}-${Math.random().toString(36).substr(2,9)}.${E}`,{error:I}=await R.storage.from("posts").upload(L,C,{cacheControl:"3600",upsert:!1});if(I)throw I;ye++,o.loading(`Uploaded ${ye}/${xe} file(s)...`,{id:n});const{data:W}=R.storage.from("posts").getPublicUrl(L);return{url:W.publicUrl,isVideo:Ue(C)}});(await Promise.all(Ie)).forEach(C=>{C.isVideo?v.push(C.url):d.push(C.url)}),o.success("Upload complete!",{id:n});const Me=d.length>1?JSON.stringify(d):d.length===1?d[0]:null,De=v.length>1?JSON.stringify(v):v.length===1?v[0]:null,be=d[0]||v[0],K={spotify_track_id:(w==null?void 0:w.id)||null,spotify_track_name:(w==null?void 0:w.name)||null,spotify_artist_name:((a=(l=w==null?void 0:w.artists)==null?void 0:l[0])==null?void 0:a.name)||null,spotify_album_art:((b=(c=(m=w==null?void 0:w.album)==null?void 0:m.images)==null?void 0:c[0])==null?void 0:b.url)||null,spotify_preview_url:(w==null?void 0:w.preview_url)||null};if(h==="daily"){const C={user_id:f.user.id,media_url:be,media_type:p==="image"?"photo":"video",caption:D.trim()||null,duration:p==="video"?ie:null,...K},{error:E}=await R.from("dailies").insert(C);if(E)throw E;await R.from("posts").insert({user_id:f.user.id,title:"Daily",caption:D.trim()||null,[p==="image"?"image_url":"video_url"]:be,...K}),o.success("Daily posted successfully!")}else{let C=q?`${window.location.origin}/#recipe/${q}`:null;const E={user_id:f.user.id,title:U.trim(),caption:D.trim()||null,recipe_url:C,image_url:Me,video_url:De,...K},{data:L,error:I}=await R.from("posts").insert(E).select().single();if(I)throw I;const W=We(D);W.length>0&&L&&await R.rpc("process_post_hashtags",{p_post_id:L.id,p_hashtags:W}),o.success("Post uploaded successfully!")}pe(),T(""),te(""),se(""),H(null),window.history.replaceState({},"","/discover"),P("discover")}catch(f){console.error("Upload error:",f),o.error(f.message||"Failed to upload")}finally{re(!1)}};return console.log("üîÑ Upload component render:",JSON.stringify({previewUrlsCount:i.length,selectedFilesCount:s.length,fileType:p,previewUrls:i.slice(0,2)})),e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 md:bg-transparent md:relative",children:e.jsxs("div",{className:"absolute inset-x-0 bottom-0 md:relative md:inset-auto bg-gray-50 md:min-h-screen overflow-hidden md:overflow-visible rounded-t-3xl md:rounded-none shadow-2xl md:shadow-none pb-safe",style:{maxHeight:window.innerWidth>=768?"none":"90vh",paddingBottom:"max(10rem, env(safe-area-inset-bottom))"},children:[e.jsx("div",{className:"flex md:hidden items-center justify-center pt-3 pb-2 bg-white",children:e.jsx("div",{className:"w-12 h-1.5 bg-gray-300 rounded-full"})}),e.jsx("div",{className:"sticky top-0 bg-white border-b border-gray-200 z-20",style:{paddingTop:"env(safe-area-inset-top)"},children:e.jsxs("div",{className:"max-w-lg mx-auto px-4 h-14 flex items-center justify-between",children:[e.jsx("button",{type:"button",onClick:t=>{t.preventDefault(),P("discover")},className:"text-gray-600 hover:text-gray-900 font-medium active:scale-95 transition-transform",children:"Cancel"}),e.jsxs("h1",{className:"text-lg font-semibold",children:["New ",h==="daily"?"Daily":"Post"]}),e.jsx("div",{className:"w-16"})]})}),e.jsxs("div",{className:"overflow-y-auto max-h-[calc(90vh-4rem)] md:overflow-visible md:max-h-none overscroll-contain",children:[e.jsxs("div",{className:"max-w-lg mx-auto p-4 space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Post Type"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>S("post"),className:`flex-1 py-3 px-4 rounded-lg font-medium transition-colors ${h==="post"?"bg-gradient-to-r from-orange-600 to-red-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"Post"}),e.jsx("button",{onClick:()=>S("daily"),className:`flex-1 py-3 px-4 rounded-lg font-medium transition-colors ${h==="daily"?"bg-gradient-to-r from-purple-600 to-pink-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"Daily"})]}),h==="daily"&&e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Dailies expire after 24 hours. Videos must be 30 seconds or less."})]}),i.length===0?e.jsxs("div",{className:"space-y-3",children:[_.isNativePlatform()&&e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("button",{type:"button",onClick:ge,className:"border-2 border-dashed border-gray-300 rounded-xl p-6 hover:border-orange-500 transition-colors",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-500 rounded-2xl shadow-lg mx-auto",children:e.jsx(we,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:"Take Photo"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Use camera"})]})]})}),e.jsx("button",{type:"button",onClick:he,className:"border-2 border-dashed border-gray-300 rounded-xl p-6 hover:border-orange-500 transition-colors",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-purple-500 to-pink-500 rounded-2xl shadow-lg mx-auto",children:e.jsx(B,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:"From Gallery"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Choose photo"})]})]})})]}),e.jsx("div",{className:"border-2 border-dashed border-gray-300 rounded-xl p-8 sm:p-12 text-center hover:border-orange-500 transition-colors cursor-pointer",children:e.jsxs("label",{className:"cursor-pointer",children:[e.jsx("input",{ref:Y,type:"file",accept:"image/*,video/*",multiple:!0,onChange:_e,className:"hidden"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-3 sm:gap-4 justify-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 sm:w-20 sm:h-20 bg-gradient-to-br from-orange-500 to-red-500 rounded-2xl shadow-lg",children:e.jsx(B,{className:"w-8 h-8 sm:w-10 sm:h-10 text-white"})}),e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 sm:w-20 sm:h-20 bg-gradient-to-br from-purple-500 to-pink-500 rounded-2xl shadow-lg",children:e.jsx(Pe,{className:"w-8 h-8 sm:w-10 sm:h-10 text-white"})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-base sm:text-lg font-semibold text-gray-900 mb-1",children:_.isNativePlatform()?"Or select files":"Upload a photo or video"}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500",children:_.isNativePlatform()?"Browse your files":"Click to select a file from your device"})]})]})]})})]}):e.jsxs("div",{className:"space-y-2",children:[(console.log("üìä About to render previews. previewUrls.length:",i.length,"selectedFiles.length:",s.length),null),i.map((t,l)=>{const a=s[l],m=a==null?void 0:a.type.startsWith("video/");return console.log(`üñºÔ∏è Rendering preview ${l}:`,JSON.stringify({url:t.substring(0,50),isVideo:m,fileType:a==null?void 0:a.type,fileName:a==null?void 0:a.name,fileSize:a==null?void 0:a.size})),e.jsxs("div",{className:"relative",children:[m?e.jsx("video",{src:t,controls:!0,className:"w-full max-h-64 object-cover rounded-xl",onError:c=>{console.error("‚ùå Video failed to load:",c),o.error("Failed to load video preview")}}):e.jsx("img",{src:t,alt:`Preview ${l+1}`,className:"w-full max-h-64 object-cover rounded-xl",onLoad:()=>console.log("‚úÖ Image preview loaded successfully"),onError:c=>{console.error("‚ùå Image failed to load:",c),o.error("Failed to load image preview")}}),e.jsx("button",{onClick:pe,className:"absolute top-2 right-2 bg-black/50 hover:bg-black/70 text-white rounded-full p-2",children:e.jsx(Z,{className:"w-5 h-5"})})]},l)}),s.length<4&&e.jsxs("div",{className:"space-y-3",children:[_.isNativePlatform()&&e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("button",{type:"button",onClick:ge,className:"border-2 border-dashed border-gray-300 rounded-xl p-4 hover:border-orange-500 transition-colors",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-12 h-12 bg-gradient-to-br from-blue-500 to-indigo-500 rounded-xl shadow-lg mx-auto",children:e.jsx(we,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:"Take Photo"}),e.jsxs("p",{className:"text-xs text-gray-400",children:[s.length,"/4"]})]})]})}),e.jsx("button",{type:"button",onClick:he,className:"border-2 border-dashed border-gray-300 rounded-xl p-4 hover:border-orange-500 transition-colors",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-500 rounded-xl shadow-lg mx-auto",children:e.jsx(B,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:"From Gallery"}),e.jsxs("p",{className:"text-xs text-gray-400",children:[s.length,"/4"]})]})]})})]}),e.jsxs("label",{className:"cursor-pointer block",children:[e.jsx("input",{type:"file",accept:"image/*,video/*",multiple:!0,onChange:async t=>{const l=Array.from(t.target.files||[]),a=4-s.length,m=l.slice(0,a),c=[],b=[];let f=!1;for(const u of m){const n=u.type.startsWith("image/"),d=u.type.startsWith("video/");if(!n&&!d){o.error(`${u.name} is not a valid image or video`);continue}if(d){if(u.size>100*1024*1024){o.error(`${u.name} is too large (max 100MB for videos)`);continue}try{const v=await me(u);if(h==="daily"&&v>30){o.error(`${u.name}: Daily videos must be 30 seconds or less`);continue}f=!0}catch{o.error(`Failed to load ${u.name}`);continue}}else if(u.size>10*1024*1024){o.error(`${u.name} is too large (max 10MB for images)`);continue}c.push(u),b.push(URL.createObjectURL(u))}if(c.length>0){const u=c.filter(d=>d.type.startsWith("image/")),n=c.filter(d=>d.type.startsWith("video/"));if(u.length>0){const d=o.loading("Compressing images...",{duration:0});try{const v=await O(u),y=v.map(F=>F.file);g(F=>[...F,...y,...n]);const N=v.map(F=>URL.createObjectURL(F.file)),$=n.map(F=>URL.createObjectURL(F));r(F=>[...F,...N,...$]),o.success(`Added ${c.length} file${c.length>1?"s":""}`,{id:d})}catch(v){o.error(v.message||"Failed to process files",{id:d});return}}else g(d=>[...d,...n]),r(d=>[...d,...b]),o.success(`Added ${c.length} video${c.length>1?"s":""}`);x(f||p==="video"?"video":"image")}},className:"hidden"}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-xl p-6 text-center hover:border-orange-500 transition-colors",children:[e.jsxs("div",{className:"flex gap-2 justify-center mb-2",children:[e.jsx(B,{className:"w-8 h-8 text-gray-400"}),e.jsx(Pe,{className:"w-8 h-8 text-gray-400"})]}),e.jsx("p",{className:"text-sm font-medium text-gray-600",children:_.isNativePlatform()?"Or browse files":"Add More Media"}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:[s.length,"/4 selected"]})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Add Music (optional)"}),e.jsxs("button",{onClick:()=>G(!0),className:"text-sm font-medium text-orange-600 hover:text-orange-700 flex items-center gap-1.5",children:[e.jsx(Qe,{className:"w-5 h-5"}),w?"Change Music":"Add Music"]})]}),w&&e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-green-50 rounded-lg border border-green-200",children:[e.jsx("img",{src:(fe=w.album.images[0])==null?void 0:fe.url,loading:"lazy",decoding:"async",alt:"album",className:"w-12 h-12 rounded object-cover"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:w.name}),e.jsx("p",{className:"text-xs text-gray-600 truncate",children:w.artists[0].name})]}),e.jsx("button",{onClick:Le,className:"bg-green-600 hover:bg-green-700 text-white rounded-full p-2 transition-colors",children:X?e.jsx(Xe,{className:"w-4 h-4"}):e.jsx(Ye,{className:"w-4 h-4 ml-0.5"})}),e.jsx("button",{onClick:()=>H(null),className:"text-red-600",children:e.jsx(Z,{className:"w-5 h-5"})}),e.jsx("audio",{ref:A,src:w.preview_url,onEnded:()=>V(!1),onPlay:()=>V(!0),onPause:()=>V(!1)})]})]}),e.jsxs("div",{className:"space-y-4 bg-white rounded-xl p-4 shadow-sm",children:[h==="post"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Title ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:U,onChange:t=>T(t.target.value),placeholder:"Enter a title for your post",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500",maxLength:200}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:[U.length,"/200"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Caption"}),e.jsx(Ae,{value:D,onChange:t=>te(t.target.value),placeholder:"Write a caption...",className:"min-h-24 resize-none",maxLength:2200}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:[D.length,"/2200"]})]}),h==="post"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Link to Recipe (optional)"}),e.jsxs(Be,{value:q,onValueChange:se,children:[e.jsx(qe,{children:e.jsx(Ge,{placeholder:"Select a recipe from your collection"})}),e.jsx(Je,{children:ae.length===0?e.jsx("div",{className:"p-4 text-center text-sm text-gray-500",children:"No recipes yet. Add some recipes first!"}):ae.map(t=>e.jsx(He,{value:t.id,children:e.jsxs("div",{className:"flex items-center gap-2",children:[t.image_url&&e.jsx("img",{src:t.image_url,alt:t.title,className:"w-8 h-8 rounded object-cover",loading:"lazy",decoding:"async"}),e.jsx("span",{children:t.title})]})},t.id))})]})]})]}),s.length>0&&e.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ke,{className:"w-5 h-5 text-orange-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-orange-900",children:"Ready to post"}),e.jsx("p",{className:"text-xs text-orange-700 mt-1 truncate",children:(()=>{const t=s.filter(a=>a.type.startsWith("image/")).length,l=s.filter(a=>a.type.startsWith("video/")).length;return t>0&&l>0?`${t} image${t>1?"s":""} & ${l} video${l>1?"s":""} selected`:l>0?`${l} video${l>1?"s":""} selected`:`${t} image${t>1?"s":""} selected`})()})]})]})})]}),e.jsx("div",{className:"fixed left-0 right-0 px-4 pb-6 bg-gradient-to-t from-white via-white to-transparent z-[60] lg:z-10 lg:bottom-0",style:{bottom:"80px",paddingBottom:"max(1.5rem, env(safe-area-inset-bottom))"},children:e.jsx("div",{className:"max-w-lg mx-auto flex justify-center",children:e.jsx(Ve,{onClick:Ee,disabled:s.length===0||h==="post"&&!U.trim()||oe,className:"px-12 sm:px-16 py-5 sm:py-6 text-base sm:text-lg font-semibold bg-gradient-to-r from-orange-600 to-red-600 hover:from-orange-700 hover:to-red-700 shadow-lg rounded-full",children:oe?"Submitting...":"Submit"})})})]}),Fe&&e.jsx("div",{className:"fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white w-full md:max-w-lg rounded-2xl flex flex-col",style:{maxHeight:"85vh",paddingBottom:"env(safe-area-inset-bottom)"},children:[e.jsxs("div",{className:"p-4 border-b flex items-center justify-between flex-shrink-0",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Choose Music"}),e.jsx("button",{onClick:()=>G(!1),children:e.jsx(Z,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"p-4 flex-shrink-0",children:e.jsx("input",{type:"text",value:le,onChange:t=>{ke(t.target.value),$e(t.target.value)},placeholder:"Search any song...",className:"w-full px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-500",autoFocus:!0})}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-4 pb-4 space-y-2",children:[ce&&e.jsx("p",{className:"text-center text-gray-500 py-8",children:"Searching..."}),ne.map(t=>{var l;return e.jsxs("button",{onClick:()=>{H(t),G(!1),o.success("Music added!")},className:"w-full flex items-center gap-3 p-3 rounded-lg hover:bg-gray-100 transition text-left",children:[e.jsx("img",{src:((l=t.album.images[0])==null?void 0:l.url)||"/placeholder.png",loading:"lazy",decoding:"async",alt:"album",className:"w-12 h-12 rounded flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:t.name}),e.jsx("p",{className:"text-xs text-gray-600 truncate",children:t.artists.map(a=>a.name).join(", ")})]}),e.jsx("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded flex-shrink-0",children:"30s Preview"})]},t.id)}),le&&ne.length===0&&!ce&&e.jsx("p",{className:"text-center text-gray-500 py-8",children:"No tracks found"})]})]})})]})})}export{wt as Upload};
