import{r as l,j as e,L as S,C as c,t as d,v as m,m as u,Y as J,x as k,I,B as j,y as L}from"./index-BbNpzWb-.js";import{B as K}from"./badge-BXAReK95.js";import{r as n,D as M}from"./referralService-BC2OBgZP.js";import{S as Q,a as W,b as Z,c as ee,d as g}from"./select-CeaS9XdK.js";import{D as se,f as re,a as ae,b as te,c as ie,d as le}from"./dialog-BJLRolJB.js";import{U as ne}from"./users-CtauTY85.js";import{C as q}from"./circle-check-BzCQiJ55.js";import{C as oe}from"./copy-xgCT5aY0.js";import{S as ce}from"./share-2-CfoPeYC9.js";import{C as F}from"./circle-x-BewHy8FG.js";import{C as de}from"./clock-BigOonJj.js";import"./react-icons.esm-DX2Xdr36.js";import"./index-Damah6WK.js";import"./index-BdQq_4o_.js";import"./index-DZtYjUtj.js";import"./index-zKs9YsMw.js";import"./index-Cz5mkhnQ.js";import"./index-BVWTBxJm.js";import"./index-Dhdyzxar.js";import"./index-BsKc1Tsn.js";import"./index-skxEDSIg.js";import"./index-DdjLTF4I.js";const me=1,ue=1e6;let b=0;function xe(){return b=(b+1)%Number.MAX_SAFE_INTEGER,b.toString()}const w=new Map,U=a=>{if(w.has(a))return;const t=setTimeout(()=>{w.delete(a),f({type:"REMOVE_TOAST",toastId:a})},ue);w.set(a,t)},pe=(a,t)=>{switch(t.type){case"ADD_TOAST":return{...a,toasts:[t.toast,...a.toasts].slice(0,me)};case"UPDATE_TOAST":return{...a,toasts:a.toasts.map(i=>i.id===t.toast.id?{...i,...t.toast}:i)};case"DISMISS_TOAST":{const{toastId:i}=t;return i?U(i):a.toasts.forEach(s=>{U(s.id)}),{...a,toasts:a.toasts.map(s=>s.id===i||i===void 0?{...s,open:!1}:s)}}case"REMOVE_TOAST":return t.toastId===void 0?{...a,toasts:[]}:{...a,toasts:a.toasts.filter(i=>i.id!==t.toastId)}}},y=[];let N={toasts:[]};function f(a){N=pe(N,a),y.forEach(t=>{t(N)})}function he({...a}){const t=xe(),i=x=>f({type:"UPDATE_TOAST",toast:{...x,id:t}}),s=()=>f({type:"DISMISS_TOAST",toastId:t});return f({type:"ADD_TOAST",toast:{...a,id:t,open:!0,onOpenChange:x=>{x||s()}}}),{id:t,dismiss:s,update:i}}function fe(){const[a,t]=l.useState(N);return l.useEffect(()=>(y.push(t),()=>{const i=y.indexOf(t);i>-1&&y.splice(i,1)}),[a]),{...a,toast:he,dismiss:i=>f({type:"DISMISS_TOAST",toastId:i})}}function Fe(){var A;const{toast:a}=fe(),[t,i]=l.useState(""),[s,x]=l.useState(null),[_,$]=l.useState([]),[V,T]=l.useState(!0),[H,C]=l.useState(!1),[E,D]=l.useState(!1),[p,B]=l.useState("paypal"),[v,R]=l.useState("");l.useEffect(()=>{P()},[]);const P=async()=>{T(!0);try{const[r,o,h]=await Promise.all([n.getUserReferralCode(),n.getUserReferralStats(),n.getPayoutHistory()]);r&&i(r),o&&x(o),$(h)}catch(r){console.error("Error loading referral data:",r),a({title:"Error",description:"Failed to load referral data",variant:"destructive"})}finally{T(!1)}},O=()=>{if(!t)return;const r=n.getReferralLink(t);navigator.clipboard.writeText(r),a({title:"Copied!",description:"Referral link copied to clipboard"})},Y=async()=>{if(!t)return;const r=n.getReferralLink(t);if(navigator.share)try{await navigator.share({title:"Join MealScrape!",text:"Check out this amazing recipe app! Use my referral link:",url:r})}catch{console.log("Share cancelled or failed")}else O()},z=async()=>{if(!v.trim()){a({title:"Error",description:"Please enter your payout email",variant:"destructive"});return}D(!0);try{const r=await n.requestPayout(p,v);r.success?(a({title:"Payout Requested!",description:"Your payout request has been submitted and will be processed soon."}),C(!1),R(""),P()):a({title:"Error",description:r.error||"Failed to request payout",variant:"destructive"})}catch{a({title:"Error",description:"Failed to request payout",variant:"destructive"})}finally{D(!1)}},G=r=>{const o={pending:{variant:"secondary",icon:de,label:"Pending"},processing:{variant:"default",icon:S,label:"Processing"},paid:{variant:"default",icon:q,label:"Paid"},failed:{variant:"destructive",icon:F,label:"Failed"},cancelled:{variant:"outline",icon:F,label:"Cancelled"}},h=o[r]||o.pending,X=h.icon;return e.jsxs(K,{variant:h.variant,className:"flex items-center gap-1",children:[e.jsx(X,{className:"h-3 w-3"}),h.label]})};return V?e.jsx("div",{className:"container mx-auto p-4 max-w-6xl",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(S,{className:"h-8 w-8 animate-spin"})})}):e.jsxs("div",{className:"container mx-auto p-4 max-w-6xl space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Referral Rewards"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Earn $5 for every 10 friends who join using your referral link!"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs(c,{className:"border-4 border-orange-500",children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"Total Referrals"}),e.jsx(ne,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(u,{children:[e.jsx("div",{className:"text-2xl font-bold",children:(s==null?void 0:s.completed_referrals)||0}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[(s==null?void 0:s.pending_referrals)||0," pending"]})]})]}),e.jsxs(c,{className:"border-4 border-orange-500",children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"Unrewarded"}),e.jsx(J,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(u,{children:[e.jsx("div",{className:"text-2xl font-bold",children:(s==null?void 0:s.unrewarded_referrals)||0}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Next payout at ",(s==null?void 0:s.next_payout_at)||10]})]})]}),e.jsxs(c,{className:"border-4 border-orange-500",children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"Total Earned"}),e.jsx(M,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(u,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["$",((A=s==null?void 0:s.total_earned)==null?void 0:A.toFixed(2))||"0.00"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[(s==null?void 0:s.rewards_claimed)||0," payouts claimed"]})]})]}),e.jsxs(c,{className:"border-4 border-orange-500",children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(m,{className:"text-sm font-medium",children:"Next Reward"}),e.jsx(q,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(u,{children:[e.jsx("div",{className:"text-2xl font-bold",children:s!=null&&s.eligible_for_payout?"$5.00":"$0.00"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s!=null&&s.eligible_for_payout?"Ready!":"Keep referring"})]})]})]}),e.jsxs(c,{className:"border-4 border-orange-500",children:[e.jsxs(d,{children:[e.jsx(m,{children:"Your Referral Link"}),e.jsx(k,{children:"Share this link with friends. You earn $5 for every 10 people who sign up!"})]}),e.jsxs(u,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(I,{readOnly:!0,value:t?n.getReferralLink(t):"Loading...",className:"font-mono"}),e.jsx(j,{onClick:O,variant:"outline",size:"icon",children:e.jsx(oe,{className:"h-4 w-4"})}),e.jsx(j,{onClick:Y,variant:"outline",size:"icon",children:e.jsx(ce,{className:"h-4 w-4"})})]}),e.jsxs(se,{open:H,onOpenChange:C,children:[e.jsx(re,{asChild:!0,children:e.jsxs(j,{className:"w-full",disabled:!(s!=null&&s.eligible_for_payout),children:[e.jsx(M,{className:"h-4 w-4 mr-2"}),"Request $5 Payout"]})}),e.jsxs(ae,{children:[e.jsxs(te,{children:[e.jsx(ie,{children:"Request Payout"}),e.jsx(le,{children:"Enter your payment details to receive your $5 reward"})]}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"payout-method",children:"Payment Method"}),e.jsxs(Q,{value:p,onValueChange:B,children:[e.jsx(W,{id:"payout-method",children:e.jsx(Z,{})}),e.jsxs(ee,{children:[e.jsx(g,{value:"paypal",children:"PayPal"}),e.jsx(g,{value:"venmo",children:"Venmo"}),e.jsx(g,{value:"cashapp",children:"Cash App"}),e.jsx(g,{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"payout-email",children:"Email / Username"}),e.jsx(I,{id:"payout-email",type:"text",placeholder:"your@email.com or @username",value:v,onChange:r=>R(r.target.value)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Enter your ",p==="paypal"?"PayPal email":p==="venmo"?"Venmo username":p==="cashapp"?"Cash App tag":"payment details"]})]}),e.jsx(j,{className:"w-full",onClick:z,disabled:E,children:E?e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"h-4 w-4 mr-2 animate-spin"}),"Submitting..."]}):e.jsx(e.Fragment,{children:"Submit Request"})})]})]})]})]})]}),e.jsxs(c,{className:"border-4 border-orange-500",children:[e.jsxs(d,{children:[e.jsx(m,{children:"Payout History"}),e.jsx(k,{children:"Track all your referral payout requests"})]}),e.jsx(u,{children:_.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No payout history yet. Start referring friends to earn rewards!"}):e.jsx("div",{className:"space-y-4",children:_.map(r=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"font-medium",children:["$",r.reward_amount.toFixed(2)]}),G(r.payout_status)]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[r.payout_method&&e.jsx("span",{className:"capitalize",children:r.payout_method}),r.payout_email&&e.jsxs("span",{children:[" • ",r.payout_email]})]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Requested: ",new Date(r.requested_at).toLocaleDateString(),r.paid_at&&e.jsxs(e.Fragment,{children:[" • Paid: ",new Date(r.paid_at).toLocaleDateString()]})]}),r.failure_reason&&e.jsx("div",{className:"text-xs text-destructive",children:r.failure_reason})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[r.referral_count," referrals"]})]},r.id))})})]})]})}export{Fe as default};
