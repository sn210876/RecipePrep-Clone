import{c as be,W as $e,a2 as J,p as Me,r as x,a3 as De,s as U,j as e,w as $,q as Oe,X,f as i,B as ze}from"./index-BxbvCLt6.js";import{T as Ve}from"./textarea-DT8Gcu1W.js";import{e as Ae}from"./hashtags-CRZ0KQEm.js";import{S as Te,a as We,b as qe,c as Be,d as He}from"./select-3V8DpKAW.js";import{i as fe,a as Y,f as xe}from"./imageCompression-DrFzx_NO.js";import{I as K}from"./image-DWJO125R.js";import{P as Ge,a as Je}from"./play-PAvbGSxu.js";import{U as Xe}from"./upload-C-mqIWM3.js";import"./react-icons.esm-DXx3z0uL.js";import"./index-DMw0seIa.js";import"./index-BdQq_4o_.js";import"./index-DW8FhmHM.js";import"./index-DS93o9T5.js";import"./index-BItjzvVO.js";import"./index-CbJhEsde.js";import"./index--MoHVi7U.js";import"./index-B8ZTZloB.js";/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=be("Music",[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=be("Video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]);function ye(y){return y.type.startsWith("video/")}var L;(function(y){y.Prompt="PROMPT",y.Camera="CAMERA",y.Photos="PHOTOS"})(L||(L={}));var M;(function(y){y.Rear="REAR",y.Front="FRONT"})(M||(M={}));var Q;(function(y){y.Uri="uri",y.Base64="base64",y.DataUrl="dataUrl"})(Q||(Q={}));class Qe extends $e{async getPhoto(t){return new Promise(async(d,r)=>{if(t.webUseInput||t.source===L.Photos)this.fileInputExperience(t,d,r);else if(t.source===L.Prompt){let a=document.querySelector("pwa-action-sheet");a||(a=document.createElement("pwa-action-sheet"),document.body.appendChild(a)),a.header=t.promptLabelHeader||"Photo",a.cancelable=!1,a.options=[{title:t.promptLabelPhoto||"From Photos"},{title:t.promptLabelPicture||"Take Picture"}],a.addEventListener("onSelection",async m=>{m.detail===0?this.fileInputExperience(t,d,r):this.cameraExperience(t,d,r)})}else this.cameraExperience(t,d,r)})}async pickImages(t){return new Promise(async(d,r)=>{this.multipleFileInputExperience(d,r)})}async cameraExperience(t,d,r){if(customElements.get("pwa-camera-modal")){const a=document.createElement("pwa-camera-modal");a.facingMode=t.direction===M.Front?"user":"environment",document.body.appendChild(a);try{await a.componentOnReady(),a.addEventListener("onPhoto",async m=>{const g=m.detail;g===null?r(new J("User cancelled photos app")):g instanceof Error?r(g):d(await this._getCameraPhoto(g,t)),a.dismiss(),document.body.removeChild(a)}),a.present()}catch{this.fileInputExperience(t,d,r)}}else console.error("Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/web/pwa-elements."),this.fileInputExperience(t,d,r)}fileInputExperience(t,d,r){let a=document.querySelector("#_capacitor-camera-input");const m=()=>{var g;(g=a.parentNode)===null||g===void 0||g.removeChild(a)};a||(a=document.createElement("input"),a.id="_capacitor-camera-input",a.type="file",a.hidden=!0,document.body.appendChild(a),a.addEventListener("change",g=>{const n=a.files[0];let P="jpeg";if(n.type==="image/png"?P="png":n.type==="image/gif"&&(P="gif"),t.resultType==="dataUrl"||t.resultType==="base64"){const b=new FileReader;b.addEventListener("load",()=>{if(t.resultType==="dataUrl")d({dataUrl:b.result,format:P});else if(t.resultType==="base64"){const D=b.result.split(",")[1];d({base64String:D,format:P})}m()}),b.readAsDataURL(n)}else d({webPath:URL.createObjectURL(n),format:P}),m()}),a.addEventListener("cancel",g=>{r(new J("User cancelled photos app")),m()})),a.accept="image/*",a.capture=!0,t.source===L.Photos||t.source===L.Prompt?a.removeAttribute("capture"):t.direction===M.Front?a.capture="user":t.direction===M.Rear&&(a.capture="environment"),a.click()}multipleFileInputExperience(t,d){let r=document.querySelector("#_capacitor-camera-input-multiple");const a=()=>{var m;(m=r.parentNode)===null||m===void 0||m.removeChild(r)};r||(r=document.createElement("input"),r.id="_capacitor-camera-input-multiple",r.type="file",r.hidden=!0,r.multiple=!0,document.body.appendChild(r),r.addEventListener("change",m=>{const g=[];for(let n=0;n<r.files.length;n++){const P=r.files[n];let b="jpeg";P.type==="image/png"?b="png":P.type==="image/gif"&&(b="gif"),g.push({webPath:URL.createObjectURL(P),format:b})}t({photos:g}),a()}),r.addEventListener("cancel",m=>{d(new J("User cancelled photos app")),a()})),r.accept="image/*",r.click()}_getCameraPhoto(t,d){return new Promise((r,a)=>{const m=new FileReader,g=t.type.split("/")[1];d.resultType==="uri"?r({webPath:URL.createObjectURL(t),format:g,saved:!1}):(m.readAsDataURL(t),m.onloadend=()=>{const n=m.result;d.resultType==="dataUrl"?r({dataUrl:n,format:g,saved:!1}):r({base64String:n.split(",")[1],format:g,saved:!1})},m.onerror=n=>{a(n)})})}async checkPermissions(){if(typeof navigator>"u"||!navigator.permissions)throw this.unavailable("Permissions API not available in this browser");try{return{camera:(await window.navigator.permissions.query({name:"camera"})).state,photos:"granted"}}catch{throw this.unavailable("Camera permissions are not available in this browser")}}async requestPermissions(){throw this.unimplemented("Not implemented on web.")}async pickLimitedLibraryPhotos(){throw this.unavailable("Not implemented on web.")}async getLimitedLibraryPhotos(){throw this.unavailable("Not implemented on web.")}}const Ze=Me("Camera",{web:()=>new Qe});function bt({onNavigate:y}){var de;const[t,d]=x.useState([]),[r,a]=x.useState([]),[m,g]=x.useState(null),[n,P]=x.useState("post"),[b,D]=x.useState(""),[E,Z]=x.useState(""),[A,ee]=x.useState(""),[te,ve]=x.useState([]),[se,ae]=x.useState(!1),[re,et]=x.useState(0),[we,T]=x.useState(!1),[ie,je]=x.useState(""),[oe,W]=x.useState([]),[f,q]=x.useState(null),[le,ne]=x.useState(!1),[B,O]=x.useState(!1),z=De.useRef(null),H=x.useRef(null);x.useEffect(()=>{Ne()},[]);const Ne=async()=>{try{const{data:s}=await U.auth.getUser();if(!s.user)return;const{data:o,error:u}=await U.from("public_recipes").select("id, title, image_url").eq("user_id",s.user.id).order("created_at",{ascending:!1});if(u)throw u;ve(o||[])}catch(s){console.error("Error loading recipes:",s)}},Pe=s=>new Promise((o,u)=>{const h=document.createElement("video");h.preload="metadata",h.onloadedmetadata=()=>{window.URL.revokeObjectURL(h.src);const p=Math.floor(h.duration);isNaN(p)||p===0?u(new Error("Invalid video duration")):o(p)},h.onerror=()=>{window.URL.revokeObjectURL(h.src),u(new Error("Failed to load video metadata"))},h.src=URL.createObjectURL(s)}),Ue=async s=>{console.log("ðŸ” File select triggered");const o=Array.from(s.target.files||[]);if(console.log("ðŸ“ Selected files count:",o.length),o.length===0){console.log("âš ï¸ No files selected");return}const u=o.filter(l=>l.type.startsWith("image/")||l.type.startsWith("video/"));if(console.log("ðŸŽ¯ Media files after filter:",u.length),console.log("ðŸ“ File types:",o.map(l=>l.type)),u.length===0){console.log("âŒ No valid media files"),i.error("Please select at least one image or video");return}if(u.length>4){i.error("You can only upload up to 4 images/videos total");return}console.log("âœ… Processing",u.length,"media files");const h=[],p=[];let v=!1;const c=[],_=[];for(const l of u){const N=fe(l),S=l.type.startsWith("video/");if(N)c.push(l);else if(S){if(l.size>100*1024*1024){i.error(`${l.name} is too large (max 100MB for videos)`);continue}try{const w=await Pe(l);if(n==="daily"&&w>30){i.error(`${l.name}: Daily videos must be 30 seconds or less`);continue}v=!0,_.push(l)}catch(w){console.error("Video load error:",w),i.error(`Failed to load ${l.name}`);continue}}}if(c.length>0){const l=i.loading("Compressing images...",{duration:0});try{const N=await Y(c,(w,F,I)=>{I.isCompressing&&i.loading(`Compressing image ${w+1}/${F}... ${Math.round(I.percent)}%`,{id:l,duration:0})}),S=N.reduce((w,F)=>w+(F.originalSize-F.compressedSize),0);i.success(`Images compressed! Saved ${xe(S)}`,{id:l,duration:3e3});for(const w of N)h.push(w.file),p.push(URL.createObjectURL(w.file))}catch(N){i.error(N.message||"Failed to compress images",{id:l});return}}for(const l of _)h.push(l),p.push(URL.createObjectURL(l));if(h.length===0){i.error("No valid files to upload");return}d(h),a(p),g(v?"video":"image")},ce=()=>{r.forEach(s=>URL.revokeObjectURL(s)),d([]),a([]),g(null)},Se=async s=>{try{const o=await Ze.getPhoto({quality:90,allowEditing:!1,resultType:Q.Uri,source:s});if(!o.webPath){i.error("Failed to get image");return}const h=await(await fetch(o.webPath)).blob(),p=new File([h],`photo-${Date.now()}.${o.format}`,{type:`image/${o.format}`}),v=i.loading("Compressing image...",{duration:0});try{const _=(await Y([p]))[0].file;i.success("Image ready!",{id:v}),d([_]),a([URL.createObjectURL(_)]),g("image")}catch(c){i.error(c.message||"Failed to compress image",{id:v})}}catch(o){o.message!=="User cancelled photos app"&&(console.error("Camera error:",o),i.error("Failed to access camera"))}},Ce=()=>{$.isNativePlatform()?Se(L.Camera):i.info("Camera only available on mobile app")},Re=()=>{console.log("ðŸ“· From Gallery button clicked"),$.isNativePlatform()&&(console.log("âœ… On native platform"),H.current?(console.log("ðŸ“‚ Triggering file input"),H.current.click()):console.log("âŒ File input ref not found"))},ke=()=>{z.current&&(B?z.current.pause():z.current.play(),O(!B))},_e=async s=>{if(!s.trim()){W([]);return}ne(!0);try{const h=((await(await fetch(`https://itunes.apple.com/search?term=${encodeURIComponent(s)}&media=music&entity=song&limit=20`)).json()).results||[]).map(p=>{var v;return{id:p.trackId.toString(),name:p.trackName||"Unknown Song",artists:[{name:p.artistName||"Unknown Artist"}],album:{images:[{url:((v=p.artworkUrl100)==null?void 0:v.replace("100x100","300x300"))||"https://via.placeholder.com/300"}]},preview_url:p.previewUrl||null}});W(h)}catch(o){console.error("Music search failed:",o),i.error("Search failed â€” try again"),W([])}finally{ne(!1)}},Le=async()=>{var s,o,u,h,p,v;if(t.length===0){i.error("Please select an image or video");return}if(n==="post"&&!b.trim()){i.error("Please enter a title");return}if(n==="daily"&&m==="video"&&re>30){i.error("Daily videos must be 30 seconds or less");return}ae(!0);try{const{data:c}=await U.auth.getUser();if(!c.user)throw new Error("Not authenticated");const{data:_}=await U.from("profiles").select("id").eq("id",c.user.id).maybeSingle();_||await U.from("profiles").insert({id:c.user.id,username:((s=c.user.email)==null?void 0:s.split("@")[0])||"user",avatar_url:null});const l=i.loading("Preparing files...",{duration:0}),N=[],S=[],w=t.filter(fe),F=t.filter(ye);let I=[];if(w.length>0){i.loading(`Compressing ${w.length} image(s)...`,{id:l});const j=await Y(w);I=j.map(C=>C.file);const R=j.reduce((C,k)=>C+(k.originalSize-k.compressedSize),0);console.log(`Images compressed: saved ${xe(R)}`)}const me=[...I,...F],ue=me.length;let pe=0;i.loading(`Uploading ${ue} file(s)...`,{id:l});const Ee=me.map(async j=>{var ge;const R=(ge=j.name.split(".").pop())==null?void 0:ge.toLowerCase(),C=`${c.user.id}/${Date.now()}-${Math.random().toString(36).substr(2,9)}.${R}`,{error:k}=await U.storage.from("posts").upload(C,j,{cacheControl:"3600",upsert:!1});if(k)throw k;pe++,i.loading(`Uploaded ${pe}/${ue} file(s)...`,{id:l});const{data:V}=U.storage.from("posts").getPublicUrl(C);return{url:V.publicUrl,isVideo:ye(j)}});(await Promise.all(Ee)).forEach(j=>{j.isVideo?S.push(j.url):N.push(j.url)}),i.success("Upload complete!",{id:l});const Fe=N.length>1?JSON.stringify(N):N.length===1?N[0]:null,Ie=S.length>1?JSON.stringify(S):S.length===1?S[0]:null,he=N[0]||S[0],G={spotify_track_id:(f==null?void 0:f.id)||null,spotify_track_name:(f==null?void 0:f.name)||null,spotify_artist_name:((u=(o=f==null?void 0:f.artists)==null?void 0:o[0])==null?void 0:u.name)||null,spotify_album_art:((v=(p=(h=f==null?void 0:f.album)==null?void 0:h.images)==null?void 0:p[0])==null?void 0:v.url)||null,spotify_preview_url:(f==null?void 0:f.preview_url)||null};if(n==="daily"){const j={user_id:c.user.id,media_url:he,media_type:m==="image"?"photo":"video",caption:E.trim()||null,duration:m==="video"?re:null,...G},{error:R}=await U.from("dailies").insert(j);if(R)throw R;await U.from("posts").insert({user_id:c.user.id,title:"Daily",caption:E.trim()||null,[m==="image"?"image_url":"video_url"]:he,...G}),i.success("Daily posted successfully!")}else{let j=A?`${window.location.origin}/#recipe/${A}`:null;const R={user_id:c.user.id,title:b.trim(),caption:E.trim()||null,recipe_url:j,image_url:Fe,video_url:Ie,...G},{data:C,error:k}=await U.from("posts").insert(R).select().single();if(k)throw k;const V=Ae(E);V.length>0&&C&&await U.rpc("process_post_hashtags",{p_post_id:C.id,p_hashtags:V}),i.success("Post uploaded successfully!")}ce(),D(""),Z(""),ee(""),q(null),window.history.replaceState({},"","/discover"),y("discover")}catch(c){console.error("Upload error:",c),i.error(c.message||"Failed to upload")}finally{ae(!1)}};return e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 md:bg-transparent md:relative",children:e.jsxs("div",{className:"absolute inset-x-0 bottom-0 md:relative md:inset-auto bg-gray-50 md:min-h-screen overflow-hidden md:overflow-visible rounded-t-3xl md:rounded-none shadow-2xl md:shadow-none pb-safe",style:{maxHeight:window.innerWidth>=768?"none":"90vh",paddingBottom:"max(10rem, env(safe-area-inset-bottom))"},children:[e.jsx("div",{className:"flex md:hidden items-center justify-center pt-3 pb-2 bg-white",children:e.jsx("div",{className:"w-12 h-1.5 bg-gray-300 rounded-full"})}),e.jsx("div",{className:"sticky top-0 bg-white border-b border-gray-200 z-20",style:{paddingTop:"env(safe-area-inset-top)"},children:e.jsxs("div",{className:"max-w-lg mx-auto px-4 h-14 flex items-center justify-between",children:[e.jsx("button",{type:"button",onClick:s=>{s.preventDefault(),y("discover")},className:"text-gray-600 hover:text-gray-900 font-medium active:scale-95 transition-transform",children:"Cancel"}),e.jsxs("h1",{className:"text-lg font-semibold",children:["New ",n==="daily"?"Daily":"Post"]}),e.jsx("div",{className:"w-16"})]})}),e.jsxs("div",{className:"overflow-y-auto max-h-[calc(90vh-4rem)] md:overflow-visible md:max-h-none overscroll-contain",children:[e.jsxs("div",{className:"max-w-lg mx-auto p-4 space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Post Type"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>P("post"),className:`flex-1 py-3 px-4 rounded-lg font-medium transition-colors ${n==="post"?"bg-gradient-to-r from-orange-600 to-red-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"Post"}),e.jsx("button",{onClick:()=>P("daily"),className:`flex-1 py-3 px-4 rounded-lg font-medium transition-colors ${n==="daily"?"bg-gradient-to-r from-purple-600 to-pink-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"Daily"})]}),n==="daily"&&e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Dailies expire after 24 hours. Videos must be 30 seconds or less."})]}),r.length===0?e.jsxs("div",{className:"space-y-3",children:[$.isNativePlatform()&&e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("button",{type:"button",onClick:Ce,className:"border-2 border-dashed border-gray-300 rounded-xl p-6 hover:border-orange-500 transition-colors",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-500 rounded-2xl shadow-lg mx-auto",children:e.jsx(Oe,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:"Take Photo"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Use camera"})]})]})}),e.jsx("button",{type:"button",onClick:Re,className:"border-2 border-dashed border-gray-300 rounded-xl p-6 hover:border-orange-500 transition-colors",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-purple-500 to-pink-500 rounded-2xl shadow-lg mx-auto",children:e.jsx(K,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:"From Gallery"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Choose photo"})]})]})})]}),e.jsx("div",{className:"border-2 border-dashed border-gray-300 rounded-xl p-8 sm:p-12 text-center hover:border-orange-500 transition-colors cursor-pointer",children:e.jsxs("label",{className:"cursor-pointer",children:[e.jsx("input",{ref:H,type:"file",accept:"image/*,video/*",multiple:!0,onChange:Ue,className:"hidden"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-3 sm:gap-4 justify-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 sm:w-20 sm:h-20 bg-gradient-to-br from-orange-500 to-red-500 rounded-2xl shadow-lg",children:e.jsx(K,{className:"w-8 h-8 sm:w-10 sm:h-10 text-white"})}),e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 sm:w-20 sm:h-20 bg-gradient-to-br from-purple-500 to-pink-500 rounded-2xl shadow-lg",children:e.jsx(Ke,{className:"w-8 h-8 sm:w-10 sm:h-10 text-white"})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-base sm:text-lg font-semibold text-gray-900 mb-1",children:$.isNativePlatform()?"Or select files":"Upload a photo or video"}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500",children:$.isNativePlatform()?"Browse your files":"Click to select a file from your device"})]})]})]})})]}):e.jsxs("div",{className:"space-y-2",children:[r.map((s,o)=>{const u=t[o],h=u==null?void 0:u.type.startsWith("video/");return e.jsxs("div",{className:"relative",children:[h?e.jsx("video",{src:s,controls:!0,className:"w-full aspect-square object-cover rounded-xl"}):e.jsx("img",{src:s,alt:`Preview ${o+1}`,className:"w-full aspect-square object-cover rounded-xl",loading:"lazy",decoding:"async"}),e.jsx("button",{onClick:ce,className:"absolute top-2 right-2 bg-black/50 hover:bg-black/70 text-white rounded-full p-2",children:e.jsx(X,{className:"w-5 h-5"})})]},o)}),t.length<4&&e.jsxs("label",{className:"cursor-pointer",children:[e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:s=>{const o=Array.from(s.target.files||[]),u=4-t.length,h=o.slice(0,u),p=[],v=[];for(const c of h){if(c.size>10*1024*1024){i.error(`${c.name} is too large (max 10MB)`);continue}if(!c.type.startsWith("image/")){i.error(`${c.name} is not an image`);continue}p.push(c),v.push(URL.createObjectURL(c))}p.length>0&&(d([...t,...p]),a([...r,...v]),i.success(`Added ${p.length} image${p.length>1?"s":""}`))},className:"hidden"}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-xl p-6 text-center hover:border-orange-500 transition-colors",children:[e.jsx(K,{className:"w-8 h-8 mx-auto text-gray-400 mb-2"}),e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Add More Photos"}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:[t.length,"/4 selected"]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Add Music (optional)"}),e.jsxs("button",{onClick:()=>T(!0),className:"text-sm font-medium text-orange-600 hover:text-orange-700 flex items-center gap-1.5",children:[e.jsx(Ye,{className:"w-5 h-5"}),f?"Change Music":"Add Music"]})]}),f&&e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-green-50 rounded-lg border border-green-200",children:[e.jsx("img",{src:(de=f.album.images[0])==null?void 0:de.url,loading:"lazy",decoding:"async",alt:"album",className:"w-12 h-12 rounded object-cover"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:f.name}),e.jsx("p",{className:"text-xs text-gray-600 truncate",children:f.artists[0].name})]}),e.jsx("button",{onClick:ke,className:"bg-green-600 hover:bg-green-700 text-white rounded-full p-2 transition-colors",children:B?e.jsx(Ge,{className:"w-4 h-4"}):e.jsx(Je,{className:"w-4 h-4 ml-0.5"})}),e.jsx("button",{onClick:()=>q(null),className:"text-red-600",children:e.jsx(X,{className:"w-5 h-5"})}),e.jsx("audio",{ref:z,src:f.preview_url,onEnded:()=>O(!1),onPlay:()=>O(!0),onPause:()=>O(!1)})]})]}),e.jsxs("div",{className:"space-y-4 bg-white rounded-xl p-4 shadow-sm",children:[n==="post"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Title ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:b,onChange:s=>D(s.target.value),placeholder:"Enter a title for your post",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500",maxLength:200}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:[b.length,"/200"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Caption"}),e.jsx(Ve,{value:E,onChange:s=>Z(s.target.value),placeholder:"Write a caption...",className:"min-h-24 resize-none",maxLength:2200}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:[E.length,"/2200"]})]}),n==="post"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Link to Recipe (optional)"}),e.jsxs(Te,{value:A,onValueChange:ee,children:[e.jsx(We,{children:e.jsx(qe,{placeholder:"Select a recipe from your collection"})}),e.jsx(Be,{children:te.length===0?e.jsx("div",{className:"p-4 text-center text-sm text-gray-500",children:"No recipes yet. Add some recipes first!"}):te.map(s=>e.jsx(He,{value:s.id,children:e.jsxs("div",{className:"flex items-center gap-2",children:[s.image_url&&e.jsx("img",{src:s.image_url,alt:s.title,className:"w-8 h-8 rounded object-cover",loading:"lazy",decoding:"async"}),e.jsx("span",{children:s.title})]})},s.id))})]})]})]}),t.length>0&&e.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Xe,{className:"w-5 h-5 text-orange-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-orange-900",children:"Ready to post"}),e.jsxs("p",{className:"text-xs text-orange-700 mt-1 truncate",children:[t.length," image",t.length>1?"s":""," selected"]}),"              "]})]})})]}),e.jsx("div",{className:"fixed left-0 right-0 px-4 pb-6 bg-gradient-to-t from-white via-white to-transparent z-[60] lg:z-10 lg:bottom-0",style:{bottom:"80px",paddingBottom:"max(1.5rem, env(safe-area-inset-bottom))"},children:e.jsx("div",{className:"max-w-lg mx-auto flex justify-center",children:e.jsx(ze,{onClick:Le,disabled:t.length===0||n==="post"&&!b.trim()||se,className:"px-12 sm:px-16 py-5 sm:py-6 text-base sm:text-lg font-semibold bg-gradient-to-r from-orange-600 to-red-600 hover:from-orange-700 hover:to-red-700 shadow-lg rounded-full",children:se?"Submitting...":"Submit"})})})]}),we&&e.jsx("div",{className:"fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white w-full md:max-w-lg rounded-2xl flex flex-col",style:{maxHeight:"85vh",paddingBottom:"env(safe-area-inset-bottom)"},children:[e.jsxs("div",{className:"p-4 border-b flex items-center justify-between flex-shrink-0",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Choose Music"}),e.jsx("button",{onClick:()=>T(!1),children:e.jsx(X,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"p-4 flex-shrink-0",children:e.jsx("input",{type:"text",value:ie,onChange:s=>{je(s.target.value),_e(s.target.value)},placeholder:"Search any song...",className:"w-full px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-500",autoFocus:!0})}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-4 pb-4 space-y-2",children:[le&&e.jsx("p",{className:"text-center text-gray-500 py-8",children:"Searching..."}),oe.map(s=>{var o;return e.jsxs("button",{onClick:()=>{q(s),T(!1),i.success("Music added!")},className:"w-full flex items-center gap-3 p-3 rounded-lg hover:bg-gray-100 transition text-left",children:[e.jsx("img",{src:((o=s.album.images[0])==null?void 0:o.url)||"/placeholder.png",loading:"lazy",decoding:"async",alt:"album",className:"w-12 h-12 rounded flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:s.name}),e.jsx("p",{className:"text-xs text-gray-600 truncate",children:s.artists.map(u=>u.name).join(", ")})]}),e.jsx("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded flex-shrink-0",children:"30s Preview"})]},s.id)}),ie&&oe.length===0&&!le&&e.jsx("p",{className:"text-center text-gray-500 py-8",children:"No tracks found"})]})]})})]})})}export{bt as Upload};
