import{s as i}from"./index-CW8L4bB6.js";const u="mealscrape-20";function p(e){try{const r=new URL(e);return r.searchParams.has("tag")||r.searchParams.set("tag",u),r.toString()}catch{return e.includes("?")?`${e}&tag=${u}`:`${e}?tag=${u}`}}async function m(){const{data:e,error:r}=await i.from("product_categories").select("*").order("sort_order");if(r)throw r;return e||[]}async function f(e){const{data:r,error:a}=await i.from("amazon_products").select("*").eq("category_id",e).eq("is_active",!0).order("popularity_score",{ascending:!1});if(a)throw a;return r||[]}async function g(e,r){let a=i.from("amazon_products").select("*").eq("is_active",!0);r&&(a=a.eq("category_id",r)),e.trim()&&(a=a.or(`product_name.ilike.%${e}%,description.ilike.%${e}%,search_keywords.cs.{${e}}`));const{data:n,error:o}=await a.order("popularity_score",{ascending:!1}).limit(50);if(o)throw o;return n||[]}async function y(e,r=5){const a=e.toLowerCase().trim(),{data:n,error:o}=await i.from("ingredient_product_mappings").select(`
      amazon_product_id,
      confidence_score,
      amazon_products (*)
    `).eq("ingredient_name",a).order("confidence_score",{ascending:!1}).limit(r);if(o&&console.error("Error fetching mappings:",o),n&&n.length>0)return n.filter(d=>d.amazon_products).map(d=>d.amazon_products);const t=a.split(",")[0].trim();let c=i.from("amazon_products").select("*").eq("is_active",!0);c=c.or(`product_name.ilike.%${t}%,search_keywords.cs.{${t}}`);const{data:s,error:_}=await c.order("popularity_score",{ascending:!1}).limit(r);if(_)throw _;return s||[]}async function h(e,r,a="1",n="",o,t){const{data:c,error:s}=await i.from("cart_items").insert({user_id:e,ingredient_name:r.product_name,quantity:a,unit:n,amazon_product_url:p(r.amazon_url),amazon_product_name:r.product_name,price:r.price,image_url:r.image_url,asin:r.asin,source_recipe_id:o,delivery_service:null}).select().single();if(s)throw s;return c}async function w(e,r){const a=r.map(t=>({user_id:e,ingredient_name:t.product.product_name,quantity:t.quantity,unit:t.unit,amazon_product_url:p(t.product.amazon_url),amazon_product_name:t.product.product_name,price:t.product.price,image_url:t.product.image_url,asin:t.product.asin,source_recipe_id:t.sourceRecipeId,delivery_service:t.deliveryService||null})),{data:n,error:o}=await i.from("cart_items").insert(a).select();if(o)throw o;return n}export{p as a,w as b,h as c,f as d,y as f,m as g,g as s};
