import{c as ve,W as De,a3 as Y,p as Me,r as b,a4 as Oe,s as _,j as e,w as L,q as ze,f as i,X as K,B as Te,D as $}from"./index-CFcEIvk0.js";import{T as Ve}from"./textarea-DIRikLtS.js";import{e as Ae}from"./hashtags-1ujTHTnX.js";import{S as We,a as Be,b as qe,c as Je,d as Ge}from"./select-Ba2KGhgz.js";import{a as A,i as ye,f as be}from"./imageCompression-q737ovES.js";import{I as Q}from"./image-CHeVt-RA.js";import{P as He,a as Xe}from"./play-C1kiyYHw.js";import{U as Ye}from"./upload-DiONSu9X.js";import"./react-icons.esm-DuzKoBVU.js";import"./index-1QZ8LZ03.js";import"./index-BdQq_4o_.js";import"./index-ge_6xC-6.js";import"./index-COl3SmFl.js";import"./index-DOmoM7Cu.js";import"./index-BSlGnwL5.js";import"./index-RaeGI0Z2.js";import"./index-D4QaU0nE.js";import"./browser-image-compression-BzWLnoYn.js";/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=ve("Music",[["path",{d:"M9 18V5l12-2v13",key:"1jmyc2"}],["circle",{cx:"6",cy:"18",r:"3",key:"fqmcym"}],["circle",{cx:"18",cy:"16",r:"3",key:"1hluhg"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qe=ve("Video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]);function we(w){return w.type.startsWith("video/")}var C;(function(w){w.Prompt="PROMPT",w.Camera="CAMERA",w.Photos="PHOTOS"})(C||(C={}));var M;(function(w){w.Rear="REAR",w.Front="FRONT"})(M||(M={}));var Z;(function(w){w.Uri="uri",w.Base64="base64",w.DataUrl="dataUrl"})(Z||(Z={}));class Ze extends De{async getPhoto(a){return new Promise(async(u,r)=>{if(a.webUseInput||a.source===C.Photos)this.fileInputExperience(a,u,r);else if(a.source===C.Prompt){let o=document.querySelector("pwa-action-sheet");o||(o=document.createElement("pwa-action-sheet"),document.body.appendChild(o)),o.header=a.promptLabelHeader||"Photo",o.cancelable=!1,o.options=[{title:a.promptLabelPhoto||"From Photos"},{title:a.promptLabelPicture||"Take Picture"}],o.addEventListener("onSelection",async p=>{p.detail===0?this.fileInputExperience(a,u,r):this.cameraExperience(a,u,r)})}else this.cameraExperience(a,u,r)})}async pickImages(a){return new Promise(async(u,r)=>{this.multipleFileInputExperience(u,r)})}async cameraExperience(a,u,r){if(customElements.get("pwa-camera-modal")){const o=document.createElement("pwa-camera-modal");o.facingMode=a.direction===M.Front?"user":"environment",document.body.appendChild(o);try{await o.componentOnReady(),o.addEventListener("onPhoto",async p=>{const h=p.detail;h===null?r(new Y("User cancelled photos app")):h instanceof Error?r(h):u(await this._getCameraPhoto(h,a)),o.dismiss(),document.body.removeChild(o)}),o.present()}catch{this.fileInputExperience(a,u,r)}}else console.error("Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/web/pwa-elements."),this.fileInputExperience(a,u,r)}fileInputExperience(a,u,r){let o=document.querySelector("#_capacitor-camera-input");const p=()=>{var h;(h=o.parentNode)===null||h===void 0||h.removeChild(o)};o||(o=document.createElement("input"),o.id="_capacitor-camera-input",o.type="file",o.hidden=!0,document.body.appendChild(o),o.addEventListener("change",h=>{const g=o.files[0];let P="jpeg";if(g.type==="image/png"?P="png":g.type==="image/gif"&&(P="gif"),a.resultType==="dataUrl"||a.resultType==="base64"){const j=new FileReader;j.addEventListener("load",()=>{if(a.resultType==="dataUrl")u({dataUrl:j.result,format:P});else if(a.resultType==="base64"){const O=j.result.split(",")[1];u({base64String:O,format:P})}p()}),j.readAsDataURL(g)}else u({webPath:URL.createObjectURL(g),format:P}),p()}),o.addEventListener("cancel",h=>{r(new Y("User cancelled photos app")),p()})),o.accept="image/*",o.capture=!0,a.source===C.Photos||a.source===C.Prompt?o.removeAttribute("capture"):a.direction===M.Front?o.capture="user":a.direction===M.Rear&&(o.capture="environment"),o.click()}multipleFileInputExperience(a,u){let r=document.querySelector("#_capacitor-camera-input-multiple");const o=()=>{var p;(p=r.parentNode)===null||p===void 0||p.removeChild(r)};r||(r=document.createElement("input"),r.id="_capacitor-camera-input-multiple",r.type="file",r.hidden=!0,r.multiple=!0,document.body.appendChild(r),r.addEventListener("change",p=>{const h=[];for(let g=0;g<r.files.length;g++){const P=r.files[g];let j="jpeg";P.type==="image/png"?j="png":P.type==="image/gif"&&(j="gif"),h.push({webPath:URL.createObjectURL(P),format:j})}a({photos:h}),o()}),r.addEventListener("cancel",p=>{u(new Y("User cancelled photos app")),o()})),r.accept="image/*",r.click()}_getCameraPhoto(a,u){return new Promise((r,o)=>{const p=new FileReader,h=a.type.split("/")[1];u.resultType==="uri"?r({webPath:URL.createObjectURL(a),format:h,saved:!1}):(p.readAsDataURL(a),p.onloadend=()=>{const g=p.result;u.resultType==="dataUrl"?r({dataUrl:g,format:h,saved:!1}):r({base64String:g.split(",")[1],format:h,saved:!1})},p.onerror=g=>{o(g)})})}async checkPermissions(){if(typeof navigator>"u"||!navigator.permissions)throw this.unavailable("Permissions API not available in this browser");try{return{camera:(await window.navigator.permissions.query({name:"camera"})).state,photos:"granted"}}catch{throw this.unavailable("Camera permissions are not available in this browser")}}async requestPermissions(){throw this.unimplemented("Not implemented on web.")}async pickLimitedLibraryPhotos(){throw this.unavailable("Not implemented on web.")}async getLimitedLibraryPhotos(){throw this.unavailable("Not implemented on web.")}}const et=Me("Camera",{web:()=>new Ze});function vt({onNavigate:w}){var pe;const[a,u]=b.useState([]),[r,o]=b.useState([]),[p,h]=b.useState(null),[g,P]=b.useState("post"),[j,O]=b.useState(""),[I,ee]=b.useState(""),[W,te]=b.useState(""),[se,je]=b.useState([]),[ae,oe]=b.useState(!1),[re,tt]=b.useState(0);b.useEffect(()=>{const t=Date.now();return console.log("üöÄ Upload component MOUNTED at",t),(async()=>{try{const{value:s}=await $.get({key:"pending_upload_webpath"});if(s){console.log("üîÑ Found pending upload, restoring...");const c=JSON.parse(s),l=i.loading("Loading photo...",{duration:0});try{console.log("üîÑ Fetching from webPath:",c.webPath);const f=await fetch(c.webPath);if(!f.ok)throw new Error("Failed to load cached image");const m=await f.blob(),S=new File([m],`photo-${c.timestamp}.${c.format}`,{type:c.mimeType});console.log("üóúÔ∏è Compressing restored image...");const y=(await A([S]))[0].file,U=URL.createObjectURL(y);u([y]),o([U]),h("image"),await $.remove({key:"pending_upload_webpath"}),console.log("‚úÖ Restored and compressed pending upload"),i.success("Photo loaded!",{id:l})}catch(f){console.error("‚ùå Failed to restore pending upload:",f),i.error("Failed to load photo",{id:l}),await $.remove({key:"pending_upload_webpath"})}}}catch(s){console.error("‚ùå Error checking for pending upload:",s),await $.remove({key:"pending_upload_webpath"})}})(),()=>{console.log("üíÄ Upload component UNMOUNTED at",Date.now(),"lived for",Date.now()-t,"ms")}},[]),b.useEffect(()=>{console.log("üìä State changed - selectedFiles:",a.length,"previewUrls:",r.length,"fileType:",p)},[a,r,p]);const[Ne,B]=b.useState(!1),[ie,Pe]=b.useState(""),[le,q]=b.useState([]),[x,J]=b.useState(null),[ne,ce]=b.useState(!1),[G,z]=b.useState(!1),T=Oe.useRef(null),H=b.useRef(null);b.useEffect(()=>{Ue()},[]);const Ue=async()=>{try{const{data:t}=await _.auth.getUser();if(!t.user)return;const{data:n,error:s}=await _.from("public_recipes").select("id, title, image_url").eq("user_id",t.user.id).order("created_at",{ascending:!1});if(s)throw s;je(n||[])}catch(t){console.error("Error loading recipes:",t)}},Ce=t=>new Promise((n,s)=>{const c=document.createElement("video");c.preload="metadata",c.onloadedmetadata=()=>{window.URL.revokeObjectURL(c.src);const l=Math.floor(c.duration);isNaN(l)||l===0?s(new Error("Invalid video duration")):n(l)},c.onerror=()=>{window.URL.revokeObjectURL(c.src),s(new Error("Failed to load video metadata"))},c.src=URL.createObjectURL(t)}),Se=async t=>{console.log("üîç File select triggered"),console.log("üì± Platform:",L.getPlatform());const n=Array.from(t.target.files||[]);if(console.log("üìÅ Selected files count:",n.length),n.length===0){console.log("‚ö†Ô∏è No files selected");return}console.log("üìù File details:",n.map(d=>({name:d.name,size:d.size,type:d.type})));const s=n.filter(d=>d.type.startsWith("image/")||d.type.startsWith("video/"));if(console.log("üéØ Media files after filter:",s.length),s.length===0){console.log("‚ùå No valid media files"),i.error("Please select at least one image or video");return}if(s.length>4){i.error("You can only upload up to 4 images/videos total");return}console.log("‚úÖ Processing",s.length,"media files");const c=[],l=[];let f=!1;const m=[],S=[];for(const d of s){const y=ye(d),U=d.type.startsWith("video/");if(y)m.push(d);else if(U){if(d.size>100*1024*1024){i.error(`${d.name} is too large (max 100MB for videos)`);continue}try{const v=await Ce(d);if(g==="daily"&&v>30){i.error(`${d.name}: Daily videos must be 30 seconds or less`);continue}f=!0,S.push(d)}catch(v){console.error("Video load error:",v),i.error(`Failed to load ${d.name}`);continue}}}if(m.length>0){const d=i.loading("Compressing images...",{duration:0});try{console.log("üóúÔ∏è Starting compression for",m.length,"images");const y=await A(m,(v,k,D)=>{D.isCompressing&&(console.log(`Compressing ${v+1}/${k}: ${Math.round(D.percent)}%`),i.loading(`Compressing image ${v+1}/${k}... ${Math.round(D.percent)}%`,{id:d,duration:0}))});console.log("‚úÖ Compression complete:",y);const U=y.reduce((v,k)=>v+(k.originalSize-k.compressedSize),0);i.success(`Images compressed! Saved ${be(U)}`,{id:d,duration:3e3});for(const v of y){c.push(v.file);const k=URL.createObjectURL(v.file);console.log("üì∏ Created preview URL:",k),l.push(k)}}catch(y){console.error("‚ùå Compression error:",y),i.error(y.message||"Failed to compress images",{id:d});return}}for(const d of S)c.push(d),l.push(URL.createObjectURL(d));if(c.length===0){console.log("‚ùå No valid files to upload"),i.error("No valid files to upload");return}console.log("‚úÖ Setting state with",c.length,"files"),console.log("üì∏ Preview URLs:",l),u(c),o(l),h(f?"video":"image"),console.log("‚úÖ State updated successfully")},de=async()=>{r.forEach(t=>URL.revokeObjectURL(t)),u([]),o([]),h(null),await $.remove({key:"pending_upload_webpath"})},me=async t=>{const n=i.loading(t===C.Camera?"Opening camera...":"Opening gallery...",{duration:0});try{console.log("üì∏ handleCapacitorCamera called with source:",t);const s=await et.getPhoto({quality:90,allowEditing:!1,resultType:Z.Uri,source:t,saveToGallery:t===C.Camera});if(console.log("‚úÖ Camera.getPhoto succeeded:",{hasWebPath:!!s.webPath,hasPath:!!s.path,format:s.format}),i.loading("Processing image...",{id:n}),!s.webPath){console.error("‚ùå No webPath in image result"),i.error("Failed to get image path",{id:n});return}console.log("üîÑ Fetching image from webPath:",s.webPath);const c=await fetch(s.webPath);if(!c.ok){console.error("‚ùå Fetch failed:",c.status,c.statusText),i.error("Failed to load image from device",{id:n});return}const l=await c.blob();console.log("‚úÖ Blob created:",{size:l.size,type:l.type});let f=l.type;(!f||f==="application/octet-stream")&&(f=`image/${s.format||"jpeg"}`,console.log("‚ö†Ô∏è Blob type was empty/generic, using format:",f));const m=new File([l],`photo-${Date.now()}.${s.format||"jpg"}`,{type:f});console.log("‚úÖ File created:",{name:m.name,size:m.size,type:m.type}),console.log("üíæ Saving to Preferences for recovery..."),await $.set({key:"pending_upload_webpath",value:JSON.stringify({webPath:s.webPath,format:s.format||"jpeg",mimeType:f,timestamp:Date.now()})}),i.loading("Compressing image...",{id:n});try{console.log("üóúÔ∏è Starting compression...");const d=(await A([m]))[0].file;console.log("‚úÖ Compression complete:",{size:d.size});const y=URL.createObjectURL(d);console.log("‚úÖ Preview URL created:",y),console.log("üîß Setting state immediately..."),u([d]),o([y]),h("image"),console.log("‚úÖ State updated successfully"),await $.remove({key:"pending_upload_webpath"}),i.success(t===C.Camera?"Photo captured!":"Photo selected!",{id:n})}catch(S){console.error("‚ùå Compression error:",S),i.error(S.message||"Failed to compress image",{id:n}),await $.remove({key:"pending_upload_webpath"})}}catch(s){console.error("‚ùå Camera/Gallery error:",s),s.message!=="User cancelled photos app"?i.error(`Failed to ${t===C.Camera?"capture photo":"select from gallery"}`,{id:n}):i.dismiss(n)}},_e=()=>{L.isNativePlatform()?me(C.Camera):i.info("Camera only available on mobile app")},ke=()=>{console.log("üì∑ From Gallery button clicked"),console.log("üì± Platform:",L.getPlatform()),console.log("üì± Is Native:",L.isNativePlatform()),L.isNativePlatform()?(console.log("‚úÖ On native platform - using Capacitor Camera with Photos source"),me(C.Photos)):(console.log("‚úÖ On web platform - triggering file input"),H.current?(console.log("‚úÖ File input ref exists, clicking..."),H.current.click()):console.error("‚ùå File input ref is null!"))},Re=()=>{T.current&&(G?T.current.pause():T.current.play(),z(!G))},Fe=async t=>{if(!t.trim()){q([]);return}ce(!0);try{const c=((await(await fetch(`https://itunes.apple.com/search?term=${encodeURIComponent(t)}&media=music&entity=song&limit=20`)).json()).results||[]).map(l=>{var f;return{id:l.trackId.toString(),name:l.trackName||"Unknown Song",artists:[{name:l.artistName||"Unknown Artist"}],album:{images:[{url:((f=l.artworkUrl100)==null?void 0:f.replace("100x100","300x300"))||"https://via.placeholder.com/300"}]},preview_url:l.previewUrl||null}});q(c)}catch(n){console.error("Music search failed:",n),i.error("Search failed ‚Äî try again"),q([])}finally{ce(!1)}},Ee=async()=>{var t,n,s,c,l,f;if(a.length===0){i.error("Please select an image or video");return}if(g==="post"&&!j.trim()){i.error("Please enter a title");return}if(g==="daily"&&p==="video"&&re>30){i.error("Daily videos must be 30 seconds or less");return}oe(!0);try{const{data:m}=await _.auth.getUser();if(!m.user)throw new Error("Not authenticated");const{data:S}=await _.from("profiles").select("id").eq("id",m.user.id).maybeSingle();S||await _.from("profiles").insert({id:m.user.id,username:((t=m.user.email)==null?void 0:t.split("@")[0])||"user",avatar_url:null});const d=i.loading("Preparing files...",{duration:0}),y=[],U=[],v=a.filter(ye),k=a.filter(we);let D=[];if(v.length>0){i.loading(`Compressing ${v.length} image(s)...`,{id:d});const N=await A(v);D=N.map(R=>R.file);const F=N.reduce((R,E)=>R+(E.originalSize-E.compressedSize),0);console.log(`Images compressed: saved ${be(F)}`)}const ue=[...D,...k],ge=ue.length;let he=0;i.loading(`Uploading ${ge} file(s)...`,{id:d});const Le=ue.map(async N=>{var xe;const F=(xe=N.name.split(".").pop())==null?void 0:xe.toLowerCase(),R=`${m.user.id}/${Date.now()}-${Math.random().toString(36).substr(2,9)}.${F}`,{error:E}=await _.storage.from("posts").upload(R,N,{cacheControl:"3600",upsert:!1});if(E)throw E;he++,i.loading(`Uploaded ${he}/${ge} file(s)...`,{id:d});const{data:V}=_.storage.from("posts").getPublicUrl(R);return{url:V.publicUrl,isVideo:we(N)}});(await Promise.all(Le)).forEach(N=>{N.isVideo?U.push(N.url):y.push(N.url)}),i.success("Upload complete!",{id:d});const $e=y.length>1?JSON.stringify(y):y.length===1?y[0]:null,Ie=U.length>1?JSON.stringify(U):U.length===1?U[0]:null,fe=y[0]||U[0],X={spotify_track_id:(x==null?void 0:x.id)||null,spotify_track_name:(x==null?void 0:x.name)||null,spotify_artist_name:((s=(n=x==null?void 0:x.artists)==null?void 0:n[0])==null?void 0:s.name)||null,spotify_album_art:((f=(l=(c=x==null?void 0:x.album)==null?void 0:c.images)==null?void 0:l[0])==null?void 0:f.url)||null,spotify_preview_url:(x==null?void 0:x.preview_url)||null};if(g==="daily"){const N={user_id:m.user.id,media_url:fe,media_type:p==="image"?"photo":"video",caption:I.trim()||null,duration:p==="video"?re:null,...X},{error:F}=await _.from("dailies").insert(N);if(F)throw F;await _.from("posts").insert({user_id:m.user.id,title:"Daily",caption:I.trim()||null,[p==="image"?"image_url":"video_url"]:fe,...X}),i.success("Daily posted successfully!")}else{let N=W?`${window.location.origin}/#recipe/${W}`:null;const F={user_id:m.user.id,title:j.trim(),caption:I.trim()||null,recipe_url:N,image_url:$e,video_url:Ie,...X},{data:R,error:E}=await _.from("posts").insert(F).select().single();if(E)throw E;const V=Ae(I);V.length>0&&R&&await _.rpc("process_post_hashtags",{p_post_id:R.id,p_hashtags:V}),i.success("Post uploaded successfully!")}de(),O(""),ee(""),te(""),J(null),window.history.replaceState({},"","/discover"),w("discover")}catch(m){console.error("Upload error:",m),i.error(m.message||"Failed to upload")}finally{oe(!1)}};return console.log("üîÑ Upload component render:",JSON.stringify({previewUrlsCount:r.length,selectedFilesCount:a.length,fileType:p,previewUrls:r.slice(0,2)})),e.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 md:bg-transparent md:relative",children:e.jsxs("div",{className:"absolute inset-x-0 bottom-0 md:relative md:inset-auto bg-gray-50 md:min-h-screen overflow-hidden md:overflow-visible rounded-t-3xl md:rounded-none shadow-2xl md:shadow-none pb-safe",style:{maxHeight:window.innerWidth>=768?"none":"90vh",paddingBottom:"max(10rem, env(safe-area-inset-bottom))"},children:[e.jsx("div",{className:"flex md:hidden items-center justify-center pt-3 pb-2 bg-white",children:e.jsx("div",{className:"w-12 h-1.5 bg-gray-300 rounded-full"})}),e.jsx("div",{className:"sticky top-0 bg-white border-b border-gray-200 z-20",style:{paddingTop:"env(safe-area-inset-top)"},children:e.jsxs("div",{className:"max-w-lg mx-auto px-4 h-14 flex items-center justify-between",children:[e.jsx("button",{type:"button",onClick:t=>{t.preventDefault(),w("discover")},className:"text-gray-600 hover:text-gray-900 font-medium active:scale-95 transition-transform",children:"Cancel"}),e.jsxs("h1",{className:"text-lg font-semibold",children:["New ",g==="daily"?"Daily":"Post"]}),e.jsx("div",{className:"w-16"})]})}),e.jsxs("div",{className:"overflow-y-auto max-h-[calc(90vh-4rem)] md:overflow-visible md:max-h-none overscroll-contain",children:[e.jsxs("div",{className:"max-w-lg mx-auto p-4 space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700 mb-2 block",children:"Post Type"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>P("post"),className:`flex-1 py-3 px-4 rounded-lg font-medium transition-colors ${g==="post"?"bg-gradient-to-r from-orange-600 to-red-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"Post"}),e.jsx("button",{onClick:()=>P("daily"),className:`flex-1 py-3 px-4 rounded-lg font-medium transition-colors ${g==="daily"?"bg-gradient-to-r from-purple-600 to-pink-600 text-white":"bg-gray-100 text-gray-600 hover:bg-gray-200"}`,children:"Daily"})]}),g==="daily"&&e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"Dailies expire after 24 hours. Videos must be 30 seconds or less."})]}),r.length===0?e.jsxs("div",{className:"space-y-3",children:[L.isNativePlatform()&&e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsx("button",{type:"button",onClick:_e,className:"border-2 border-dashed border-gray-300 rounded-xl p-6 hover:border-orange-500 transition-colors",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-blue-500 to-indigo-500 rounded-2xl shadow-lg mx-auto",children:e.jsx(ze,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:"Take Photo"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Use camera"})]})]})}),e.jsx("button",{type:"button",onClick:ke,className:"border-2 border-dashed border-gray-300 rounded-xl p-6 hover:border-orange-500 transition-colors",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-gradient-to-br from-purple-500 to-pink-500 rounded-2xl shadow-lg mx-auto",children:e.jsx(Q,{className:"w-8 h-8 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-gray-900",children:"From Gallery"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Choose photo"})]})]})})]}),e.jsx("div",{className:"border-2 border-dashed border-gray-300 rounded-xl p-8 sm:p-12 text-center hover:border-orange-500 transition-colors cursor-pointer",children:e.jsxs("label",{className:"cursor-pointer",children:[e.jsx("input",{ref:H,type:"file",accept:"image/*,video/*",multiple:!0,onChange:Se,className:"hidden"}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-3 sm:gap-4 justify-center",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 sm:w-20 sm:h-20 bg-gradient-to-br from-orange-500 to-red-500 rounded-2xl shadow-lg",children:e.jsx(Q,{className:"w-8 h-8 sm:w-10 sm:h-10 text-white"})}),e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 sm:w-20 sm:h-20 bg-gradient-to-br from-purple-500 to-pink-500 rounded-2xl shadow-lg",children:e.jsx(Qe,{className:"w-8 h-8 sm:w-10 sm:h-10 text-white"})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-base sm:text-lg font-semibold text-gray-900 mb-1",children:L.isNativePlatform()?"Or select files":"Upload a photo or video"}),e.jsx("p",{className:"text-xs sm:text-sm text-gray-500",children:L.isNativePlatform()?"Browse your files":"Click to select a file from your device"})]})]})]})})]}):e.jsxs("div",{className:"space-y-2",children:[(console.log("üìä About to render previews. previewUrls.length:",r.length,"selectedFiles.length:",a.length),null),r.map((t,n)=>{const s=a[n],c=s==null?void 0:s.type.startsWith("video/");return console.log(`üñºÔ∏è Rendering preview ${n}:`,JSON.stringify({url:t.substring(0,50),isVideo:c,fileType:s==null?void 0:s.type,fileName:s==null?void 0:s.name,fileSize:s==null?void 0:s.size})),e.jsxs("div",{className:"relative",children:[c?e.jsx("video",{src:t,controls:!0,className:"w-full max-h-64 object-cover rounded-xl",onError:l=>{console.error("‚ùå Video failed to load:",l),i.error("Failed to load video preview")}}):e.jsx("img",{src:t,alt:`Preview ${n+1}`,className:"w-full max-h-64 object-cover rounded-xl",onLoad:()=>console.log("‚úÖ Image preview loaded successfully"),onError:l=>{console.error("‚ùå Image failed to load:",l),i.error("Failed to load image preview")}}),e.jsx("button",{onClick:de,className:"absolute top-2 right-2 bg-black/50 hover:bg-black/70 text-white rounded-full p-2",children:e.jsx(K,{className:"w-5 h-5"})})]},n)}),a.length<4&&e.jsxs("label",{className:"cursor-pointer",children:[e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:t=>{const n=Array.from(t.target.files||[]),s=4-a.length,c=n.slice(0,s),l=[],f=[];for(const m of c){if(m.size>10*1024*1024){i.error(`${m.name} is too large (max 10MB)`);continue}if(!m.type.startsWith("image/")){i.error(`${m.name} is not an image`);continue}l.push(m),f.push(URL.createObjectURL(m))}l.length>0&&(u([...a,...l]),o([...r,...f]),i.success(`Added ${l.length} image${l.length>1?"s":""}`))},className:"hidden"}),e.jsxs("div",{className:"border-2 border-dashed border-gray-300 rounded-xl p-6 text-center hover:border-orange-500 transition-colors",children:[e.jsx(Q,{className:"w-8 h-8 mx-auto text-gray-400 mb-2"}),e.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Add More Photos"}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:[a.length,"/4 selected"]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-xl p-4 shadow-sm space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Add Music (optional)"}),e.jsxs("button",{onClick:()=>B(!0),className:"text-sm font-medium text-orange-600 hover:text-orange-700 flex items-center gap-1.5",children:[e.jsx(Ke,{className:"w-5 h-5"}),x?"Change Music":"Add Music"]})]}),x&&e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-green-50 rounded-lg border border-green-200",children:[e.jsx("img",{src:(pe=x.album.images[0])==null?void 0:pe.url,loading:"lazy",decoding:"async",alt:"album",className:"w-12 h-12 rounded object-cover"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:x.name}),e.jsx("p",{className:"text-xs text-gray-600 truncate",children:x.artists[0].name})]}),e.jsx("button",{onClick:Re,className:"bg-green-600 hover:bg-green-700 text-white rounded-full p-2 transition-colors",children:G?e.jsx(He,{className:"w-4 h-4"}):e.jsx(Xe,{className:"w-4 h-4 ml-0.5"})}),e.jsx("button",{onClick:()=>J(null),className:"text-red-600",children:e.jsx(K,{className:"w-5 h-5"})}),e.jsx("audio",{ref:T,src:x.preview_url,onEnded:()=>z(!1),onPlay:()=>z(!0),onPause:()=>z(!1)})]})]}),e.jsxs("div",{className:"space-y-4 bg-white rounded-xl p-4 shadow-sm",children:[g==="post"&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:["Title ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("input",{type:"text",value:j,onChange:t=>O(t.target.value),placeholder:"Enter a title for your post",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-orange-500",maxLength:200}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:[j.length,"/200"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Caption"}),e.jsx(Ve,{value:I,onChange:t=>ee(t.target.value),placeholder:"Write a caption...",className:"min-h-24 resize-none",maxLength:2200}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1",children:[I.length,"/2200"]})]}),g==="post"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Link to Recipe (optional)"}),e.jsxs(We,{value:W,onValueChange:te,children:[e.jsx(Be,{children:e.jsx(qe,{placeholder:"Select a recipe from your collection"})}),e.jsx(Je,{children:se.length===0?e.jsx("div",{className:"p-4 text-center text-sm text-gray-500",children:"No recipes yet. Add some recipes first!"}):se.map(t=>e.jsx(Ge,{value:t.id,children:e.jsxs("div",{className:"flex items-center gap-2",children:[t.image_url&&e.jsx("img",{src:t.image_url,alt:t.title,className:"w-8 h-8 rounded object-cover",loading:"lazy",decoding:"async"}),e.jsx("span",{children:t.title})]})},t.id))})]})]})]}),a.length>0&&e.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-xl p-4",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(Ye,{className:"w-5 h-5 text-orange-600 flex-shrink-0 mt-0.5"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium text-orange-900",children:"Ready to post"}),e.jsxs("p",{className:"text-xs text-orange-700 mt-1 truncate",children:[a.length," image",a.length>1?"s":""," selected"]}),"              "]})]})})]}),e.jsx("div",{className:"fixed left-0 right-0 px-4 pb-6 bg-gradient-to-t from-white via-white to-transparent z-[60] lg:z-10 lg:bottom-0",style:{bottom:"80px",paddingBottom:"max(1.5rem, env(safe-area-inset-bottom))"},children:e.jsx("div",{className:"max-w-lg mx-auto flex justify-center",children:e.jsx(Te,{onClick:Ee,disabled:a.length===0||g==="post"&&!j.trim()||ae,className:"px-12 sm:px-16 py-5 sm:py-6 text-base sm:text-lg font-semibold bg-gradient-to-r from-orange-600 to-red-600 hover:from-orange-700 hover:to-red-700 shadow-lg rounded-full",children:ae?"Submitting...":"Submit"})})})]}),Ne&&e.jsx("div",{className:"fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-white w-full md:max-w-lg rounded-2xl flex flex-col",style:{maxHeight:"85vh",paddingBottom:"env(safe-area-inset-bottom)"},children:[e.jsxs("div",{className:"p-4 border-b flex items-center justify-between flex-shrink-0",children:[e.jsx("h3",{className:"font-semibold text-lg",children:"Choose Music"}),e.jsx("button",{onClick:()=>B(!1),children:e.jsx(K,{className:"w-6 h-6"})})]}),e.jsx("div",{className:"p-4 flex-shrink-0",children:e.jsx("input",{type:"text",value:ie,onChange:t=>{Pe(t.target.value),Fe(t.target.value)},placeholder:"Search any song...",className:"w-full px-4 py-3 rounded-xl border border-gray-300 focus:outline-none focus:ring-2 focus:ring-orange-500",autoFocus:!0})}),e.jsxs("div",{className:"flex-1 overflow-y-auto px-4 pb-4 space-y-2",children:[ne&&e.jsx("p",{className:"text-center text-gray-500 py-8",children:"Searching..."}),le.map(t=>{var n;return e.jsxs("button",{onClick:()=>{J(t),B(!1),i.success("Music added!")},className:"w-full flex items-center gap-3 p-3 rounded-lg hover:bg-gray-100 transition text-left",children:[e.jsx("img",{src:((n=t.album.images[0])==null?void 0:n.url)||"/placeholder.png",loading:"lazy",decoding:"async",alt:"album",className:"w-12 h-12 rounded flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"font-medium text-sm truncate",children:t.name}),e.jsx("p",{className:"text-xs text-gray-600 truncate",children:t.artists.map(s=>s.name).join(", ")})]}),e.jsx("span",{className:"text-xs bg-blue-100 text-blue-700 px-2 py-1 rounded flex-shrink-0",children:"30s Preview"})]},t.id)}),ie&&le.length===0&&!ne&&e.jsx("p",{className:"text-center text-gray-500 py-8",children:"No tracks found"})]})]})})]})})}export{vt as Upload};
