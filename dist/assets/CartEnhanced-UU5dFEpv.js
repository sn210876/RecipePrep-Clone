import{r as i,s as x,f as l,j as e,C as p,t as te,v as re,B as c,S as q,m as f,I as F,z as E}from"./index-CFcEIvk0.js";import{S as oe,a as le,b as ne,c as ie,d as T}from"./select-Ba2KGhgz.js";import{B as I}from"./badge-BB_ADSGZ.js";import{g as ce,s as de,d as me,a as j,c as xe}from"./amazonProductService-Bzr1CW8E.js";import{d as he,o as y}from"./deviceDetection-FvJ19bzx.js";import{S as ue}from"./search-qtF7ksML.js";import{P as $}from"./package-Bu5cBEoT.js";import{E as B}from"./external-link-CLHMAqsC.js";import{M as ge}from"./minus-BAED4zdy.js";import{T as pe}from"./trash-2-B8KKquOg.js";import{C as fe}from"./credit-card-Bcwdmo5b.js";import"./react-icons.esm-DuzKoBVU.js";import"./index-1QZ8LZ03.js";import"./index-BdQq_4o_.js";import"./index-ge_6xC-6.js";import"./index-COl3SmFl.js";import"./index-DOmoM7Cu.js";import"./index-BSlGnwL5.js";import"./index-RaeGI0Z2.js";import"./index-D4QaU0nE.js";function Me({onNavigate:v}={}){const[d,b]=i.useState([]),[M,U]=i.useState(!0),[h,L]=i.useState(null),[O,R]=i.useState([]),[C,Q]=i.useState([]),[u,V]=i.useState("all"),[w,D]=i.useState(""),[Y,z]=i.useState(!1),[N,G]=i.useState(!0),S=i.useRef(null),H=()=>{var a;(a=S.current)==null||a.scrollIntoView({behavior:"smooth",block:"start"})};i.useEffect(()=>{k(),W(),A()},[]),i.useEffect(()=>{A()},[u,w]);const k=async()=>{try{const{data:a}=await x.auth.getUser();if(!a.user)return;L(a.user.id);const{data:s,error:t}=await x.from("cart_items").select("*").eq("user_id",a.user.id).order("created_at",{ascending:!1});if(t)throw t;b(s||[])}catch(a){console.error("Error loading cart:",a),l.error("Failed to load cart")}finally{U(!1)}},W=async()=>{try{const a=await ce();R(a)}catch(a){console.error("Error loading categories:",a)}},A=async()=>{z(!0);try{let a;if(w.trim())a=await de(w,u==="all"?void 0:u);else if(u!=="all")a=await me(u);else{const{data:s,error:t}=await x.from("amazon_products").select("*").eq("is_active",!0).order("popularity_score",{ascending:!1}).limit(16);if(t)throw t;a=s||[]}Q(a)}catch(a){console.error("Error loading products:",a),l.error("Failed to load products")}finally{z(!1)}},J=async a=>{if(!h){l.error("Please sign in to add items to cart");return}try{await xe(h,a,"1",a.package_size||""),await k(),l.success(`Added ${a.product_name} to cart`)}catch(s){console.error("Error adding to cart:",s),l.error("Failed to add item to cart")}},_=async(a,s)=>{try{const{error:t}=await x.from("cart_items").update({quantity:s}).eq("id",a);if(t)throw t;b(n=>n.map(r=>r.id===a?{...r,quantity:s}:r)),l.success("Quantity updated")}catch(t){console.error("Error updating quantity:",t),l.error("Failed to update quantity")}},K=async a=>{try{const{error:s}=await x.from("cart_items").delete().eq("id",a);if(s)throw s;b(t=>t.filter(n=>n.id!==a)),l.success("Item removed from cart")}catch(s){console.error("Error removing item:",s),l.error("Failed to remove item")}},X=async()=>{if(h&&confirm("Are you sure you want to clear your entire cart?"))try{const{error:a}=await x.from("cart_items").delete().eq("user_id",h);if(a)throw a;b([]),l.success("Cart cleared")}catch(a){console.error("Error clearing cart:",a),l.error("Failed to clear cart")}},P=()=>d.reduce((a,s)=>{const t=s.price||0,n=parseFloat(s.quantity)||1;return a+t*n},0),Z=async()=>{if(d.length===0){l.error("Your cart is empty");return}const a=he(),s=d.filter(r=>r.asin),t=d.filter(r=>!r.asin&&r.amazon_product_url),n=a.isMobile?"mobile_browser_forced":"desktop_cart_api";if(h&&await ae(n,a),a.isMobile){s.length>0&&l.info("Opening items in browser to preserve your affiliate commission...");const r=[...s.map(o=>({url:`https://www.amazon.com/dp/${o.asin}`,name:o.amazon_product_name||o.ingredient_name})),...t.map(o=>({url:o.amazon_product_url,name:o.amazon_product_name||o.ingredient_name}))];for(let o=0;o<r.length;o++){const m=r[o];await new Promise(se=>setTimeout(se,o*400));const g=j(m.url,{mobile:!0,source:"mobile_cart"});await y(g)}l.success(`Opened ${r.length} items in browser with affiliate tracking`)}else if(s.length>0){const r=ee(s);if(await y(r),t.length>0){l.success(`Added ${s.length} items to Amazon cart. Opening ${t.length} additional items...`);for(let o=0;o<t.length;o++){const m=t[o];await new Promise(g=>setTimeout(g,(o+1)*300)),await y(j(m.amazon_product_url,{mobile:!1}))}}else l.success(`Added ${s.length} items to Amazon cart with affiliate tracking!`)}else if(t.length>0){for(let r=0;r<t.length;r++){const o=t[r];await new Promise(m=>setTimeout(m,r*300)),await y(j(o.amazon_product_url,{mobile:!1}))}l.success("Opened Amazon product pages with affiliate tracking!")}else l.error("No Amazon products in cart")},ee=a=>{const s="mealscrape-20",t="https://www.amazon.com/gp/aws/cart/add.html",n=new URLSearchParams;return a.forEach((r,o)=>{const m=o+1;n.append(`ASIN.${m}`,r.asin);const g=parseInt(r.quantity)||1;n.append(`Quantity.${m}`,g.toString())}),n.append("tag",s),n.append("linkCode","ll1"),n.append("ref","nosim"),n.append("utm_source","mealscrape"),n.append("utm_medium","web_cart"),`${t}?${n.toString()}`},ae=async(a,s)=>{try{await x.from("amazon_service_clicks").insert({user_id:h,service_type:"amazon",clicked_at:new Date().toISOString(),item_count:d.length,estimated_value:P(),checkout_method:a,device_type:s.isMobile?"mobile":"desktop",os:s.os,browser:s.browser})}catch(t){console.error("Error tracking checkout:",t)}};return M?e.jsx("div",{className:"flex items-center justify-center h-screen bg-gradient-to-br from-slate-50 via-white to-orange-50",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-600"})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-white to-orange-50 pb-32",children:e.jsxs("div",{className:"max-w-7xl mx-auto p-4 md:p-6",children:[e.jsxs(p,{className:"mb-6 border-4 border-orange-500",children:[e.jsx(te,{className:"bg-gradient-to-r from-orange-50 to-amber-50 text-center",children:e.jsxs("div",{children:[e.jsx(re,{className:"text-lg sm:text-xl mb-2",children:"Amazon Product Catalog"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Browse and add pantry staples to your cart"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 justify-center",children:[e.jsxs(c,{variant:"outline",size:"sm",onClick:()=>G(!N),className:"w-full sm:w-auto",children:[N?"Hide":"Show"," Catalog"]}),e.jsxs(c,{variant:"outline",size:"sm",onClick:H,className:"w-full sm:w-auto bg-orange-50 hover:bg-orange-100 border-orange-300",children:[e.jsx(q,{className:"w-4 h-4 mr-2"}),"Show Cart"]})]})]})}),N&&e.jsxs(f,{className:"pt-6",children:[e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(ue,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx(F,{type:"text",placeholder:"Search products...",value:w,onChange:a=>D(a.target.value),className:"pl-10 h-12"})]}),e.jsxs(oe,{value:u,onValueChange:V,children:[e.jsx(le,{className:"h-12",children:e.jsx(ne,{placeholder:"All Categories"})}),e.jsxs(ie,{children:[e.jsx(T,{value:"all",children:"All Categories"}),O.map(a=>e.jsx(T,{value:a.id,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:a.icon}),e.jsx("span",{children:a.name})]})},a.id))]})]})]}),Y?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-600"})}):C.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx($,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{children:"No products found. Try a different search or category."})]}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4",children:C.map(a=>e.jsxs(p,{className:"overflow-hidden hover:shadow-lg transition-shadow group border-4 border-orange-500",children:[e.jsx("div",{className:"aspect-square bg-gray-100 flex items-center justify-center p-4",children:a.image_url?e.jsx("img",{src:a.image_url,alt:a.product_name,className:"w-full h-full object-contain",loading:"lazy",decoding:"async"}):e.jsx($,{className:"w-16 h-16 text-gray-300"})}),e.jsxs(f,{className:"p-3",children:[e.jsx("h3",{className:"font-semibold text-sm line-clamp-2 mb-1 min-h-[2.5rem]",children:a.product_name}),a.brand&&e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:a.brand}),a.package_size&&e.jsx(I,{variant:"secondary",className:"text-xs mb-2",children:a.package_size}),a.price&&e.jsxs("p",{className:"text-lg font-bold text-orange-600 mb-2",children:["$",a.price.toFixed(2)]}),a.is_prime&&e.jsx(I,{className:"bg-blue-500 text-white text-xs mb-2",children:"Prime"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(c,{size:"sm",className:"flex-1 bg-orange-500 hover:bg-orange-600 text-white",onClick:()=>J(a),children:[e.jsx(E,{className:"w-4 h-4 mr-1"}),"Add"]}),e.jsx(c,{size:"sm",variant:"outline",asChild:!0,children:e.jsx("a",{href:j(a.amazon_url),target:"_blank",rel:"noopener noreferrer",children:e.jsx(B,{className:"w-4 h-4"})})})]})]})]},a.id))})]})]}),e.jsx("div",{ref:S,children:d.length===0?e.jsx(p,{className:"w-full max-w-sm mx-auto border-4 border-orange-500",children:e.jsxs(f,{className:"flex flex-col items-center justify-center py-12 px-6",children:[e.jsx(q,{className:"w-16 h-16 text-gray-300 mb-4"}),e.jsx("p",{className:"text-gray-500 text-center mb-4 text-sm md:text-base",children:"Your cart is empty. Browse products above or add items from your meal planner!"}),e.jsx(c,{onClick:()=>v==null?void 0:v("meal-planner"),className:"bg-orange-600 hover:bg-orange-700 text-white",children:"Go to Meal Planner"})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Your Cart"}),e.jsx(c,{variant:"outline",size:"sm",onClick:X,className:"text-xs md:text-sm border-red-500 text-red-600 hover:bg-red-50 hover:text-red-700 hover:border-red-600",children:"Clear All"})]}),e.jsx("div",{className:"space-y-3 md:space-y-4 mb-6",children:d.map(a=>e.jsx(p,{className:"overflow-hidden hover:shadow-md transition-shadow border-4 border-orange-500",children:e.jsx(f,{className:"p-3 md:p-4",children:e.jsxs("div",{className:"flex gap-3 md:gap-4",children:[a.image_url&&e.jsx("div",{className:"shrink-0",children:e.jsx("img",{src:a.image_url,alt:a.amazon_product_name||a.ingredient_name,className:"w-20 h-20 md:w-24 md:h-24 object-cover rounded-lg bg-slate-100",loading:"lazy",decoding:"async"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-sm md:text-lg text-slate-900 line-clamp-2 mb-1",children:a.amazon_product_name||a.ingredient_name}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-slate-100 rounded-lg w-fit p-1",children:[e.jsx(c,{size:"sm",variant:"ghost",onClick:()=>{const s=parseFloat(a.quantity)||1;s>1&&_(a.id,(s-1).toString())},className:"h-7 w-7 p-0 hover:bg-slate-200",children:e.jsx(ge,{className:"w-3 h-3"})}),e.jsx(F,{type:"text",value:a.quantity,onChange:s=>_(a.id,s.target.value),className:"w-12 md:w-16 text-center text-sm h-7 border-0 bg-transparent"}),e.jsx(c,{size:"sm",variant:"ghost",onClick:()=>{const s=parseFloat(a.quantity)||1;_(a.id,(s+1).toString())},className:"h-7 w-7 p-0 hover:bg-slate-200",children:e.jsx(E,{className:"w-3 h-3"})})]}),e.jsx("span",{className:"text-xs md:text-sm text-gray-600",children:a.unit})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2 justify-between",children:[a.price&&e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm md:text-lg font-semibold text-orange-600",children:["$",(a.price*(parseFloat(a.quantity)||1)).toFixed(2)]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["$",a.price.toFixed(2)," each"]})]}),e.jsxs("div",{className:"flex gap-1 flex-col",children:[a.amazon_product_url&&e.jsxs("a",{href:j(a.amazon_product_url),target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center gap-1 text-xs md:text-sm text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded px-2 py-1 transition-colors",children:[e.jsx(B,{className:"w-3 h-3"}),e.jsx("span",{className:"hidden sm:inline",children:"View"})]}),e.jsxs(c,{size:"sm",variant:"ghost",onClick:()=>K(a.id),className:"text-red-600 hover:text-red-700 hover:bg-red-50 text-xs md:text-sm h-7 px-2",children:[e.jsx(pe,{className:"w-3 h-3 md:w-4 md:h-4 mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Remove"})]})]})]})]})})},a.id))}),e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx(p,{className:"mb-4 bg-slate-50 border-4 border-orange-500",children:e.jsx(f,{className:"p-4 md:p-6",children:e.jsxs("div",{className:"space-y-2 text-sm md:text-base",children:[e.jsxs("div",{className:"flex justify-between text-slate-700",children:[e.jsxs("span",{children:["Subtotal (",d.length," items)"]}),e.jsxs("span",{className:"font-medium",children:["$",P().toFixed(2)]})]}),e.jsx("div",{className:"flex justify-between text-slate-600 text-xs md:text-sm",children:e.jsx("span",{children:"Prices from Amazon â€¢ Shipping & taxes calculated at checkout"})})]})})}),e.jsx("div",{className:"fixed bottom-[80px] lg:relative lg:bottom-0 left-0 right-0 z-[150] lg:z-10 pointer-events-none",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-3 pointer-events-auto flex flex-col items-center",children:[e.jsxs(c,{className:"w-auto bg-gradient-to-r from-orange-600 to-red-600 hover:from-orange-700 hover:to-red-700 text-white font-semibold h-12 md:h-14 shadow-lg rounded-full transition-all transform active:scale-95 px-6",size:"lg",onClick:Z,children:[e.jsx(fe,{className:"w-5 h-5 mr-2"}),"Send To Amazon Cart"]}),e.jsx("p",{className:"text-xs text-center text-gray-500 mt-2"})]})})]})]})})]})})}export{Me as Cart};
