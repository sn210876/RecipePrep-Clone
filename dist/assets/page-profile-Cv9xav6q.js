import{r as m,j as e,bi as Ze,b7 as Ke,B as xe,bf as Ye,bN as es,aL as ge,ar as ss,bO as rs,U as as,bl as fe,a6 as V,aQ as ls,X as pe}from"./react-vendor-z9ssXL8w.js";import{D as re,i as ae,j as Ie,k as qe,s as c,B as E,t as ts,L as K,I as be,T as we,l as is,F as os,G as Y,v as ee,H as je}from"./page-addrecipe-Pb6dTsbS.js";import{u as o}from"./vendor-Clj4czuh.js";import{f as ve,g as ye,h as Ne,i as _e,j as ke,k as Ue,l as Ce,m as Pe}from"./page-adminpayouts-D8abdeR0.js";import{a as ns,P as ds}from"./page-discover-C_JktAEP.js";import{D as Se,a as De,b as Ee,c as se}from"./page-blog-DTt-yulm.js";import"./ui-vendor-BA32w1ww.js";import"./capacitor-vendor-Dh3Cr3CD.js";import"./services-BpcRR5rK.js";import"./supabase-vendor-DpDh9Ika.js";import"./page-grocerylist-9H8dAkfw.js";import"./page-adminproducts-DimmU9B1.js";function cs({isOpen:h,onClose:f,userId:k,type:n}){const[j,A]=m.useState([]),[$,C]=m.useState(!0);m.useEffect(()=>{if(!h)return;(async()=>{C(!0);try{if(n==="followers"){const{data:w}=await c.from("follows").select("follower_id, profiles:follower_id(id, username, avatar_url)").eq("following_id",k);w&&A(w.map(b=>b.profiles).filter(Boolean))}else{const{data:w}=await c.from("follows").select("following_id, profiles:following_id(id, username, avatar_url)").eq("follower_id",k);w&&A(w.map(b=>b.profiles).filter(Boolean))}}catch(w){console.error("Error loading users:",w)}finally{C(!1)}})()},[h,k,n]);const q=d=>{f(),window.location.href=`/profile/${d}`};return e.jsx(re,{open:h,onOpenChange:f,children:e.jsxs(ae,{className:"max-w-sm max-h-[70vh]",children:[e.jsx(Ie,{children:e.jsx(qe,{children:n==="followers"?"Supporters":"Supporting"})}),e.jsx("div",{className:"overflow-y-auto max-h-[calc(70vh-8rem)]",children:$?e.jsx("div",{className:"space-y-3 py-4",children:[1,2,3].map(d=>e.jsxs("div",{className:"flex items-center gap-3 p-3 animate-pulse",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gray-200"}),e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"h-4 bg-gray-200 rounded w-24"})})]},d))}):j.length===0?e.jsx("div",{className:"text-center py-12 text-gray-500",children:n==="followers"?"No supporters yet":"Not supporting anyone yet"}):e.jsx("div",{className:"space-y-1",children:j.map(d=>{var w;return e.jsxs("button",{onClick:()=>q(d.username),className:"w-full flex items-center gap-3 p-3 hover:bg-gray-50 rounded-lg transition-colors text-left",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-orange-400 to-red-400 flex items-center justify-center text-white font-bold flex-shrink-0 overflow-hidden",children:d.avatar_url?e.jsx("img",{src:d.avatar_url,alt:d.username,className:"w-full h-full object-cover"}):((w=d.username[0])==null?void 0:w.toUpperCase())||e.jsx(Ze,{className:"w-6 h-6"})}),e.jsx("span",{className:"font-medium text-gray-900 truncate",children:d.username})]},d.id)})})})]})})}const ms=()=>e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-32 overflow-x-hidden animate-pulse",children:[e.jsx("div",{className:"sticky top-0 bg-white border-b border-gray-200 z-30",children:e.jsxs("div",{className:"max-w-lg mx-auto px-4 h-14 flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 bg-gray-200 rounded-full"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-32"})]})}),e.jsxs("div",{className:"max-w-lg mx-auto w-full",children:[e.jsxs("div",{className:"bg-white border-b border-gray-200",children:[e.jsx("div",{className:"h-28 sm:h-32 bg-gray-200"}),e.jsxs("div",{className:"relative px-4 pb-3",children:[e.jsxs("div",{className:"flex items-start gap-3 -mt-10",children:[e.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 rounded-full bg-gray-300 border-4 border-white"}),e.jsxs("div",{className:"flex-1 pt-8 sm:pt-11 space-y-2",children:[e.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4 mx-auto"}),e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2 mx-auto"})]})]}),e.jsx("div",{className:"mt-4 flex justify-center",children:e.jsx("div",{className:"h-10 bg-gray-200 rounded-full w-32"})})]}),e.jsx("div",{className:"px-4 py-3 sm:py-4 border-t border-gray-200",children:e.jsx("div",{className:"flex justify-center gap-8 sm:gap-10",children:[1,2,3].map(h=>e.jsxs("div",{className:"text-center px-3 py-2",children:[e.jsx("div",{className:"h-6 w-12 bg-gray-200 rounded mx-auto mb-1"}),e.jsx("div",{className:"h-3 w-16 bg-gray-200 rounded"})]},h))})})]}),e.jsx("div",{className:"border-b border-gray-200 bg-white py-3",children:e.jsx("div",{className:"h-4 w-16 bg-gray-200 rounded mx-auto"})}),e.jsx("div",{className:"grid grid-cols-3 gap-0.5 sm:gap-1",children:[...Array(9)].map((h,f)=>e.jsx("div",{className:"aspect-square bg-gray-200"},f))})]})]}),I=h=>h?h.includes("/functions/v1/image-proxy")||h.includes("supabase.co/storage/v1/object/public/")?h:h.includes("instagram.com")||h.includes("cdninstagram.com")||h.includes("fbcdn.net")?`https://vohvdarghgqskzqjclux.supabase.co/functions/v1/image-proxy?url=${encodeURIComponent(h)}`:h:null;console.log("[Profile] VITE_SUPABASE_URL:","https://vohvdarghgqskzqjclux.supabase.co");const us=h=>{const f=h.trim();return f.length===0?"Username required":f.length>20?"Max 20 characters":f.includes(" ")?"No spaces allowed":/^[a-zA-Z0-9._]+$/.test(f)?/^[._]/.test(f)||/[._]$/.test(f)?"Cannot start or end with _ or .":null:"Only letters, numbers, _ . allowed"};function Us({username:h}){var ue;const[f,k]=m.useState([]),[n,j]=m.useState(null),[A,$]=m.useState(!0),[C,q]=m.useState(!1),[d,w]=m.useState(null),[b,ze]=m.useState(null),[P,Be]=m.useState(!1),[Me,F]=m.useState(!1),[L,le]=m.useState(""),[U,te]=m.useState(""),[W,ie]=m.useState(""),[z,B]=m.useState(null),[M,oe]=m.useState(null),[G,Ae]=m.useState(!1),[O,R]=m.useState(!1),[ne,J]=m.useState(!1),[Q,X]=m.useState(null),[$e,Z]=m.useState(!1),[Fe,de]=m.useState("followers"),[u,N]=m.useState(null),[ce,me]=m.useState(!1),[T,H]=m.useState(null);m.useEffect(()=>{let s=!0;return(async()=>{var t;if(s)try{const{data:{user:a}}=await c.auth.getUser();if(!a){o.error("Please log in"),window.history.pushState({},"","/");return}w(a.id);let l=null,i=null;if(h){const{data:x,error:D}=await c.from("profiles").select("id, username, avatar_url, banner_url, bio, link").ilike("username",h).single();if(!s)return;if(D||!x){s&&o.error("User not found"),s&&window.history.pushState({},"","/discover"),s&&$(!1);return}l=x,i=x.id}else{const{data:x}=await c.from("profiles").select("id, username, avatar_url, banner_url, bio, link").eq("id",a.id).single();if(x)l=x;else{const D=((t=a.email)==null?void 0:t.split("@")[0])||"user";await c.from("profiles").insert({id:a.id,username:D}),l={id:a.id,username:D,avatar_url:null}}i=a.id}if(!s)return;ze(i),Be(a.id===i);const[g,p,_,v,y,S]=await Promise.all([c.from("follows").select("*",{count:"exact",head:!0}).eq("following_id",i),c.from("follows").select("*",{count:"exact",head:!0}).eq("follower_id",i),a.id!==i?c.from("follows").select("id").eq("follower_id",a.id).eq("following_id",i).maybeSingle():Promise.resolve({data:null}),a.id!==i?c.from("blocked_users").select("id").eq("blocker_id",a.id).eq("blocked_id",i).maybeSingle():Promise.resolve({data:null}),c.from("posts").select("id, user_id, title, image_url, video_url, caption, recipe_url, recipe_id, created_at").eq("user_id",i).order("created_at",{ascending:!1}),os()]);if(!s)return;R(!!_.data),J(!!v.data),k(y.data||[]),Ae(S),j({...l,followers_count:g.count||0,following_count:p.count||0}),!h&&(l!=null&&l.username)&&window.history.replaceState({},"",`/profile/${l.username}`)}catch{s&&o.error("Failed to load profile")}finally{s&&$(!1)}})(),()=>{s=!1}},[h]),m.useEffect(()=>{const r=new URLSearchParams(window.location.search).get("post");r&&(B(r),window.history.replaceState({},"",window.location.pathname))},[]);const Le=async s=>{var a;const r=(a=s.target.files)==null?void 0:a[0];if(!r||!d)return;if(!Y(r)){o.error("Please select an image");return}q(!0);const t=o.loading("Compressing avatar...",{duration:0});try{const l=r.size,i=await ee(r,{maxWidthOrHeight:400,maxSizeMB:.1},x=>{x.isCompressing&&o.loading(`Compressing... ${Math.round(x.percent)}%`,{id:t,duration:0})});o.loading("Uploading avatar...",{id:t,duration:0});const p=`${d}/avatar.jpg`,{error:_}=await c.storage.from("avatars").upload(p,i.file,{upsert:!0});if(_)throw _;const{data:{publicUrl:v}}=c.storage.from("avatars").getPublicUrl(p),{error:y}=await c.from("profiles").update({avatar_url:v+"?t="+Date.now()}).eq("id",d);if(y)throw y;j(x=>x?{...x,avatar_url:v+"?t="+Date.now()}:null);const S=Math.round((l-i.compressedSize)/l*100);o.success(`Avatar updated! ${je(l)} → ${je(i.compressedSize)} (${S}% smaller)`,{id:t,duration:4e3})}catch(l){o.error("Upload failed: "+l.message,{id:t})}finally{q(!1)}},Oe=async s=>{var a;const r=(a=s.target.files)==null?void 0:a[0];if(!r||!d)return;if(!Y(r)){o.error("Please select an image");return}q(!0);const t=o.loading("Compressing banner...",{duration:0});try{const l=r.size,i=await ee(r,{maxWidthOrHeight:1200,maxSizeMB:.3},x=>{x.isCompressing&&o.loading(`Compressing... ${Math.round(x.percent)}%`,{id:t,duration:0})});o.loading("Uploading banner...",{id:t,duration:0});const p=`${d}/banner.jpg`,{error:_}=await c.storage.from("banners").upload(p,i.file,{upsert:!0});if(_)throw _;const{data:{publicUrl:v}}=c.storage.from("banners").getPublicUrl(p),{error:y}=await c.from("profiles").update({banner_url:v+"?t="+Date.now()}).eq("id",d);if(y)throw y;j(x=>x?{...x,banner_url:v+"?t="+Date.now()}:null);const S=Math.round((l-i.compressedSize)/l*100);o.success(`Banner updated! Saved ${S}% bandwidth`,{id:t,duration:3e3})}catch(l){o.error("Upload failed: "+l.message,{id:t})}finally{q(!1)}},Re=async()=>{d&&(await c.from("profiles").update({avatar_url:null}).eq("id",d),j(s=>s?{...s,avatar_url:null}:null),o.success("Avatar removed"))},Te=async()=>{d&&(await c.from("profiles").update({banner_url:null}).eq("id",d),j(s=>s?{...s,banner_url:null}:null),o.success("Banner removed"))},He=async()=>{if(!d)return;const s=us(L);if(s){X(s),o.error(s);return}X(null);const r=U.trim().split(`
`);if(r.length>3){o.error("Maximum 3 lines allowed");return}if(r.some(l=>l.length>40)){o.error("Maximum 40 characters per line");return}const t={},a=L.trim();if(a!==(n==null?void 0:n.username)&&(t.username=a),U.trim()!==((n==null?void 0:n.bio)||"").trim()&&(t.bio=U.trim()||null),W.trim()!==((n==null?void 0:n.link)||"").trim()&&(t.link=W.trim()||null),Object.keys(t).length>0){const{error:l}=await c.from("profiles").update(t).eq("id",d);if(l){l.message.includes("profiles_username_key")?o.error("Username already taken"):o.error("Failed to update profile");return}j(i=>i?{...i,...t}:null),o.success("Profile updated!"),t.username&&window.history.replaceState({},"",`/profile/${t.username}`)}F(!1)},Ve=async s=>{var i;const r=(i=s.target.files)==null?void 0:i[0];if(!r||!u)return;const t=r.type.startsWith("video/"),a=Y(r);if(!a&&!t){o.error("Please select an image or video file");return}me(!0);const l=o.loading("Processing file...",{duration:0});try{let g=r;if(a){const x=r.size,D=await ee(r,{maxWidthOrHeight:1200,maxSizeMB:.5},he=>{he.isCompressing&&o.loading(`Compressing image... ${Math.round(he.percent)}%`,{id:l,duration:0})});g=D.file;const hs=((x-D.compressedSize)/(1024*1024)).toFixed(1);o.loading("Uploading compressed image...",{id:l,duration:0})}else o.loading("Uploading video...",{id:l,duration:0});const p=g.name.split(".").pop(),_=`${Math.random()}.${p}`,v=`${d}/${_}`,{error:y}=await c.storage.from("posts").upload(v,g);if(y)throw y;const{data:{publicUrl:S}}=c.storage.from("posts").getPublicUrl(v);N(x=>x?{...x,photoUrl:S,isVideo:t}:null),o.success("File uploaded!",{id:l})}catch(g){console.error("Upload error:",g),o.error("Failed to upload file. Please try again.",{id:l})}finally{me(!1)}},We=()=>{N(s=>s?{...s,imageUrl:null}:null),o.success("Photo removed")},Ge=()=>{N(s=>s?{...s,videoUrl:null}:null),o.success("Video removed")},Je=async()=>{var s,r;if(u)try{const t=((s=u.imageUrl)==null?void 0:s.trim())||null,a=((r=u.videoUrl)==null?void 0:r.trim())||null,l={caption:u.caption.trim()||null,recipe_url:u.recipeUrl.trim()||null,image_url:t,video_url:a},{error:i}=await c.from("posts").update(l).eq("id",u.id);if(i)throw console.error("Supabase error:",i),i;k(g=>g.map(p=>p.id===u.id?{...p,caption:u.caption.trim()||null,image_url:t,video_url:a,recipe_url:u.recipeUrl.trim()||null}:p)),o.success("Post updated!"),N(null)}catch(t){console.error("Edit error:",t),o.error((t==null?void 0:t.message)||"Failed to update post")}},Qe=async()=>{if(T)try{const{error:s}=await c.from("posts").delete().eq("id",T);if(s)throw s;k(r=>r.filter(t=>t.id!==T)),o.success("Post deleted!"),H(null)}catch(s){console.error("Delete error:",s),o.error("Failed to delete post")}},Xe=async()=>{if(!(!d||!b))try{if(ne){const{error:s}=await c.from("blocked_users").delete().eq("blocker_id",d).eq("blocked_id",b);if(s)throw s;J(!1),o.success("User unblocked")}else{const{error:s}=await c.from("blocked_users").insert({blocker_id:d,blocked_id:b});if(s)throw s;O&&(await c.from("follows").delete().eq("follower_id",d).eq("following_id",b),R(!1)),J(!0),o.success("User blocked")}}catch(s){console.error("Block error:",s),o.error("Failed to update block status")}};return A?e.jsx(ms,{}):n?e.jsxs("div",{className:"min-h-screen bg-gray-50 pb-32 overflow-x-hidden",style:{paddingBottom:"max(8rem, env(safe-area-inset-bottom))"},children:[e.jsx("button",{onClick:()=>window.history.back(),className:"fixed left-4 z-50 p-2 bg-white/90 backdrop-blur-sm hover:bg-white rounded-full shadow-lg transition-all",style:{top:"calc(60px + env(safe-area-inset-top))"},children:e.jsx(Ke,{className:"w-7 h-7 text-gray-900"})}),e.jsxs("div",{className:"max-w-lg mx-auto w-full",children:[e.jsxs("div",{className:"bg-white border-b border-gray-200",children:[e.jsxs("div",{className:"relative h-28 sm:h-32",children:[n.banner_url?e.jsx("img",{src:n.banner_url,alt:"Banner",className:"w-full h-full object-cover",loading:"lazy"}):e.jsx("div",{className:"w-full h-full bg-gradient-to-br from-orange-100 to-amber-100"}),P&&e.jsxs("label",{className:"absolute top-2 right-2 bg-white rounded-full p-2 shadow-lg cursor-pointer hover:bg-gray-50",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:Oe,disabled:C,className:"hidden"}),e.jsx(xe,{className:"w-4 h-4 text-gray-600"})]})]}),e.jsxs("div",{className:"relative px-4 pb-3",children:[e.jsxs("div",{className:"flex items-start gap-3 -mt-10",children:[e.jsxs("div",{className:"flex-shrink-0",children:[e.jsxs("div",{className:"relative z-10 w-16 h-16 sm:w-20 sm:h-20",children:[n.avatar_url?e.jsx("img",{src:n.avatar_url,alt:n.username,className:"w-16 h-16 sm:w-20 sm:h-20 rounded-full object-cover border-4 border-white shadow-lg",loading:"lazy",decoding:"async"}):e.jsx("div",{className:"w-16 h-16 sm:w-20 sm:h-20 rounded-full bg-gradient-to-br from-orange-500 to-red-500 flex items-center justify-center text-white text-xl sm:text-2xl font-bold border-4 border-white shadow-lg",children:n.username[0].toUpperCase()}),P&&e.jsxs("label",{className:"absolute -bottom-1 -right-1 bg-white rounded-full p-1.5 shadow-md cursor-pointer hover:bg-gray-50 z-20",children:[e.jsx("input",{type:"file",accept:"image/*",onChange:Le,disabled:C,className:"hidden"}),e.jsx(xe,{className:"w-3 h-3 sm:w-4 sm:h-4 text-gray-700"})]})]}),e.jsx("div",{className:"mt-1",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h2",{className:"text-lg sm:text-xl font-bold text-gray-900",children:n.username}),G&&e.jsx(Ye,{className:"w-4 h-4 sm:w-5 sm:h-5 text-yellow-500 fill-yellow-500"})]})})]}),e.jsxs("div",{className:"flex-1 pt-8 sm:pt-11 text-center min-w-0 max-w-[60%]",children:[n.bio?e.jsx("div",{className:"space-y-1 sm:space-y-2 mt-2",children:n.bio.split(`
`).slice(0,3).map((s,r)=>e.jsx("p",{className:"text-xs sm:text-sm font-medium text-gray-800 italic tracking-wide leading-snug",style:{wordBreak:"break-word"},children:s.slice(0,40)},r))}):e.jsx("p",{className:"text-xs sm:text-sm text-gray-400 italic font-light mt-3",children:P?"Tap Edit Profile to add a bio":"No bio yet"}),n.link&&e.jsx("a",{href:n.link,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-blue-600 hover:text-blue-800 mt-2 block underline break-all",children:n.link})]})]}),P&&e.jsx("div",{className:"mt-4 flex justify-center px-2",children:e.jsxs("button",{onClick:()=>{le(n.username||""),te(n.bio||""),ie(n.link||""),F(!0)},className:"inline-flex items-center gap-2 px-4 sm:px-6 py-2 sm:py-2.5 bg-orange-600 text-white text-sm sm:text-base font-medium rounded-full hover:bg-orange-700 shadow-md",children:[e.jsx(es,{className:"w-4 h-4"}),"Edit Profile"]})})]}),!P&&e.jsx("div",{className:"px-4 py-3 border-t border-gray-200",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(E,{onClick:async()=>{if(!(!d||!b))try{O?(await c.from("follows").delete().eq("follower_id",d).eq("following_id",b),R(!1),j(s=>s?{...s,followers_count:(s.followers_count||0)-1}:null),o.success("Unsupported")):(await c.from("follows").insert({follower_id:d,following_id:b}),R(!0),j(s=>s?{...s,followers_count:(s.followers_count||0)+1}:null),o.success("Supporting!"))}catch{o.error("Failed to update")}},className:`flex-1 h-10 text-sm ${O?"bg-gray-200 text-gray-900 hover:bg-gray-300":"bg-gradient-to-r from-orange-500 to-red-500 text-white hover:from-orange-600 hover:to-red-600"}`,children:O?"Supporting":"Support"}),e.jsx(E,{onClick:()=>{n!=null&&n.username&&(window.location.href=`/messages?user=${n.username}`)},className:"flex-1 h-10 text-sm bg-white border-2 border-gray-300 text-gray-900 hover:bg-gray-50",children:"Message"}),e.jsxs(Se,{children:[e.jsx(De,{asChild:!0,children:e.jsx(E,{className:"h-10 px-3 bg-white border-2 border-gray-300 text-gray-900 hover:bg-gray-50",children:e.jsx(ge,{className:"w-4 h-4"})})}),e.jsx(Ee,{align:"end",children:e.jsxs(se,{onClick:Xe,className:"text-red-600 focus:text-red-600",children:[e.jsx(ss,{className:"w-4 h-4 mr-2"}),ne?"Unblock User":"Block User"]})})]})]})}),e.jsx("div",{className:"px-4 py-3 sm:py-4 border-t border-gray-200",children:e.jsxs("div",{className:"flex justify-center gap-8 sm:gap-10",children:[e.jsxs("div",{className:"text-center px-3 py-2",children:[e.jsx("div",{className:"text-lg sm:text-xl font-bold",children:f.length}),e.jsx("div",{className:"text-xs text-gray-500",children:"posts"})]}),e.jsxs("button",{onClick:()=>{de("followers"),Z(!0)},className:"text-center hover:bg-gray-50 px-3 py-2 rounded-lg transition-colors",children:[e.jsx("div",{className:"text-lg sm:text-xl font-bold",children:n.followers_count||0}),e.jsx("div",{className:"text-xs text-gray-500",children:"supporters"})]}),e.jsxs("button",{onClick:()=>{de("following"),Z(!0)},className:"text-center hover:bg-gray-50 px-3 py-2 rounded-lg transition-colors",children:[e.jsx("div",{className:"text-lg sm:text-xl font-bold",children:n.following_count||0}),e.jsx("div",{className:"text-xs text-gray-500",children:"supporting"})]})]})})]}),e.jsx("div",{className:"border-b border-gray-200 bg-white",children:e.jsxs("div",{className:"flex items-center justify-center gap-2 py-3",children:[e.jsx(rs,{className:"w-5 h-5 text-gray-900"}),e.jsx("span",{className:"text-sm font-semibold uppercase tracking-wider",children:"Posts"})]})}),f.length===0?e.jsxs("div",{className:"text-center py-12 sm:py-16 px-4",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 sm:w-20 sm:h-20 bg-gradient-to-br from-orange-500 to-red-500 rounded-2xl shadow-lg mb-4",children:e.jsx(as,{className:"w-8 h-8 sm:w-10 sm:h-10 text-white"})}),e.jsx("p",{className:"text-gray-900 font-semibold text-base sm:text-lg mb-2",children:"No posts yet"}),e.jsx("p",{className:"text-sm sm:text-base text-gray-500",children:"Share your first recipe!"})]}):e.jsx("div",{className:"grid grid-cols-3 gap-0.5 sm:gap-1",children:f.map(s=>{console.log("[Profile Grid] Post ID:",s.id,"Raw image_url:",s.image_url);const r=I(s.image_url);let t=r;if(r)try{const a=JSON.parse(r);Array.isArray(a)&&a.length>0&&(t=I(a[0]))}catch{if(r.includes(",")){const a=r.split(",").map(l=>l.trim());t=I(a[0])}}return e.jsxs("div",{className:"aspect-square bg-gray-100 overflow-hidden relative group",children:[e.jsxs("div",{onClick:()=>{const a=[],l=[];if(s.image_url)try{const i=JSON.parse(s.image_url);if(Array.isArray(i))i.forEach(g=>{const p=I(g);p&&(a.push(p),l.push("image"))});else{const g=I(i);g&&(a.push(g),l.push("image"))}}catch{if(s.image_url.includes(","))s.image_url.split(",").forEach(i=>{const g=I(i.trim());g&&(a.push(g),l.push("image"))});else{const i=I(s.image_url);i&&(a.push(i),l.push("image"))}}s.video_url&&(a.push(s.video_url),l.push("video")),oe({media:a.map((i,g)=>({url:i,type:l[g]})),initialIndex:0,postId:s.id})},className:"cursor-pointer hover:opacity-90 w-full h-full",children:[t?e.jsx("img",{src:t,alt:s.title||"Post",className:"w-full h-full object-cover",loading:"lazy",decoding:"async",onError:a=>{console.error("[Profile] Image failed to load:",t);const l=a.target;l.style.display="none";const i=l.parentElement;i&&(i.innerHTML='<div class="w-full h-full bg-gray-200 flex items-center justify-center text-gray-400 text-xs">No image</div>')}}):s.video_url?e.jsx("video",{src:s.video_url,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full bg-gray-200 flex items-center justify-center text-gray-400 text-xs",children:"No media"}),s.title&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-2",children:e.jsx("p",{className:"text-white text-xs font-semibold truncate",children:s.title})})]}),(P||G)&&e.jsx("div",{className:"absolute top-2 right-2 z-10",onClick:a=>a.stopPropagation(),children:e.jsxs(Se,{children:[e.jsx(De,{asChild:!0,children:e.jsx("button",{className:"p-1.5 bg-black/50 hover:bg-black/70 rounded-full backdrop-blur-sm",children:e.jsx(ge,{className:"w-4 h-4 text-white"})})}),e.jsxs(Ee,{align:"end",children:[e.jsxs(se,{onClick:()=>{N({id:s.id,title:s.title||"",caption:s.caption||"",recipeUrl:s.recipe_url||"",imageUrl:s.image_url||null,videoUrl:s.video_url||null})},className:"cursor-pointer",children:[e.jsx(fe,{className:"w-4 h-4 mr-2"}),"Edit post"]}),e.jsxs(se,{onClick:()=>H(s.id),className:"cursor-pointer text-red-600",children:[e.jsx(V,{className:"w-4 h-4 mr-2"}),"Delete post"]})]})]})})]},s.id)})})]}),e.jsx(re,{open:Me,onOpenChange:F,children:e.jsxs(ae,{className:"max-w-lg max-h-[90vh] overflow-y-auto",children:[e.jsxs(Ie,{children:[e.jsx(qe,{children:"Edit Profile"}),e.jsx(ts,{children:"Max 40 characters per line • Max 3 lines"})]}),e.jsxs("div",{className:"space-y-4 sm:space-y-5 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(K,{htmlFor:"username",children:"Username"}),e.jsxs("div",{className:"space-y-1",children:["// In the Edit Profile dialog, change:",e.jsx(be,{id:"username",value:L,onChange:s=>{le(s.target.value),X(null)},placeholder:"max 15 chars, no spaces",maxLength:15,className:Q?"border-red-500":""}),Q&&e.jsx("p",{className:"text-xs text-red-600 font-medium",children:Q}),e.jsxs("p",{className:"text-xs text-gray-500",children:[L.length,"/15 • letters, numbers, _ ."]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(K,{htmlFor:"bio",children:"Bio"}),e.jsxs("span",{className:`text-xs font-medium ${U.length>120||U.split(`
`).length>3?"text-red-600":"text-gray-500"}`,children:[U.length,"/120 • ",U.split(`
`).length,"/3 lines"]})]}),e.jsx(we,{id:"bio",value:U,onChange:s=>{let r=s.target.value;const t=r.split(`
`);t.length>3&&(r=t.slice(0,3).join(`
`)),r=r.split(`
`).map(a=>a.slice(0,40)).join(`
`),te(r)},placeholder:"place bio here",className:"min-h-[110px] resize-none text-center font-medium",rows:3}),e.jsx("p",{className:"text-xs text-gray-500 text-center -mt-2",children:"Press Enter for new line"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(K,{htmlFor:"link",children:"Link"}),e.jsx(be,{id:"link",value:W,onChange:s=>ie(s.target.value),placeholder:"https://example.com",type:"url"})]}),e.jsxs("div",{className:"flex gap-2",children:[n.avatar_url&&e.jsxs(E,{variant:"outline",onClick:Re,disabled:C,className:"flex-1 text-red-600",children:[e.jsx(V,{className:"w-4 h-4 mr-2"})," Remove Avatar"]}),n.banner_url&&e.jsxs(E,{variant:"outline",onClick:Te,disabled:C,className:"flex-1 text-red-600",children:[e.jsx(V,{className:"w-4 h-4 mr-2"})," Remove Banner"]})]})]}),e.jsxs(is,{children:[e.jsx(E,{variant:"outline",onClick:()=>F(!1),children:"Cancel"}),e.jsx(E,{onClick:He,children:"Save Changes"})]})]})}),z&&e.jsx(re,{open:!!z,onOpenChange:()=>B(null),children:e.jsxs(ae,{className:"max-w-lg p-0 overflow-hidden bg-black relative max-h-[90vh]",children:[e.jsx(ns,{postId:z,isOpen:!0,onClose:()=>B(null)}),e.jsxs("div",{className:"absolute inset-x-0 top-0 z-[100] flex items-center justify-between px-4 pt-4 pb-6 pointer-events-none",children:[e.jsx("button",{onClick:()=>B(null),className:"pointer-events-auto p-2 sm:p-3 bg-black/50 backdrop-blur-md hover:bg-black/70 rounded-full transition-all shadow-lg",children:e.jsx(ls,{className:"w-5 h-5 sm:w-6 sm:h-6 text-white"})}),(P||G)&&d===((ue=f.find(s=>s.id===z))==null?void 0:ue.user_id)&&e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>{const s=f.find(r=>r.id===z);s&&N({id:s.id,title:s.title||"",caption:s.caption||"",recipeUrl:s.recipe_url||"",imageUrl:s.image_url||null,videoUrl:s.video_url||null}),B(null)},className:"pointer-events-auto p-2 sm:p-3 bg-black/50 backdrop-blur-md hover:bg-orange-600/70 rounded-full transition-all shadow-lg",title:"Edit post",children:e.jsx(fe,{className:"w-4 h-4 sm:w-5 sm:h-5 text-white"})}),e.jsx("button",{onClick:()=>{H(z),B(null)},className:"pointer-events-auto p-2 sm:p-3 bg-black/50 backdrop-blur-md hover:bg-red-600/70 rounded-full transition-all shadow-lg",title:"Delete post",children:e.jsx(V,{className:"w-4 h-4 sm:w-5 sm:h-5 text-white"})})]})]})]})}),e.jsx(ve,{open:!!u,onOpenChange:s=>!s&&N(null),children:e.jsxs(ye,{className:"max-h-[85vh] overflow-y-auto",children:[e.jsxs(Ne,{children:[e.jsx(_e,{children:"Edit post"}),e.jsx(ke,{children:"Update your caption and recipe link."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Caption"}),e.jsx(we,{value:(u==null?void 0:u.caption)||"",onChange:s=>N(r=>r?{...r,caption:s.target.value}:null),placeholder:"Write a caption...",className:"resize-none",rows:3})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Recipe URL"}),e.jsx("input",{type:"url",value:(u==null?void 0:u.recipeUrl)||"",onChange:s=>N(r=>r?{...r,recipeUrl:s.target.value}:null),placeholder:"https://...",className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium mb-2 block",children:"Change Photo/Video (Upload from device)"}),e.jsx("input",{type:"file",accept:"image/*,video/*",onChange:Ve,disabled:ce,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-orange-500"}),ce&&e.jsx("p",{className:"text-sm text-gray-500 mt-1",children:"Uploading..."}),e.jsxs("div",{className:"flex flex-wrap gap-3 mt-3",children:[(u==null?void 0:u.imageUrl)&&e.jsxs("div",{className:"relative inline-block",children:[e.jsx("img",{src:u.imageUrl,alt:"Photo preview",className:"w-32 h-32 object-cover rounded-lg",loading:"lazy"}),e.jsx("button",{onClick:We,className:"absolute -top-2 -right-2 bg-red-600 hover:bg-red-700 text-white rounded-full p-1.5 shadow-lg transition-colors",type:"button",title:"Remove photo",children:e.jsx(pe,{className:"w-4 h-4"})})]}),(u==null?void 0:u.videoUrl)&&e.jsxs("div",{className:"relative inline-block",children:[e.jsx("video",{src:u.videoUrl,className:"w-32 h-32 object-cover rounded-lg",controls:!0,playsInline:!0}),e.jsx("button",{onClick:Ge,className:"absolute -top-2 -right-2 bg-red-600 hover:bg-red-700 text-white rounded-full p-1.5 shadow-lg transition-colors",type:"button",title:"Remove video",children:e.jsx(pe,{className:"w-4 h-4"})})]})]})]})]}),e.jsxs(Ue,{children:[e.jsx(Ce,{children:"Cancel"}),e.jsx(Pe,{onClick:Je,className:"bg-orange-600 hover:bg-orange-700",children:"Save changes"})]})]})}),e.jsx(ve,{open:!!T,onOpenChange:s=>!s&&H(null),children:e.jsxs(ye,{children:[e.jsxs(Ne,{children:[e.jsx(_e,{children:"Delete post"}),e.jsx(ke,{children:"Are you sure you want to delete this post? This action cannot be undone."})]}),e.jsxs(Ue,{children:[e.jsx(Ce,{children:"Cancel"}),e.jsx(Pe,{onClick:Qe,className:"bg-red-600 hover:bg-red-700",children:"Delete"})]})]})}),e.jsx(cs,{isOpen:$e,onClose:()=>Z(!1),userId:b||"",type:Fe}),M&&e.jsx(ds,{media:M.media,initialIndex:M.initialIndex,postId:M.postId,open:!!M,onOpenChange:s=>{s||oe(null)},onLikeUpdate:async()=>{if(b){const{data:s}=await c.from("posts").select("id, user_id, title, image_url, video_url, caption, recipe_url, recipe_id, created_at").eq("user_id",b).order("created_at",{ascending:!1});k(s||[])}}})]}):e.jsx("div",{className:"text-center py-20 text-gray-500",children:"Profile not found"})}export{Us as Profile};
