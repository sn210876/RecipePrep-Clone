import{r as q,j as e,aQ as U,aV as J,aW as z,aX as _,av as A,aq as y}from"./react-vendor-z9ssXL8w.js";import{B as p,C as l,a as i,b as d,g as b,c as o,h as v}from"./page-addrecipe-Pb6dTsbS.js";import{u as r}from"./vendor-Clj4czuh.js";import{y as w,z as $,A as E,B as O,C as F,D as Q,E as R}from"./services-BpcRR5rK.js";import"./ui-vendor-BA32w1ww.js";import"./capacitor-vendor-Dh3Cr3CD.js";import"./supabase-vendor-DpDh9Ika.js";import"./page-grocerylist-9H8dAkfw.js";import"./page-adminproducts-DimmU9B1.js";import"./page-adminpayouts-D8abdeR0.js";import"./page-blog-DTt-yulm.js";function ae({onNavigate:t}){const[N,k]=q.useState(!1),[D,B]=q.useState(null);if(q.useEffect(()=>{(()=>{const f=localStorage.getItem("checkout_data");if(f)try{const c=JSON.parse(f);B(c)}catch(c){console.error("Failed to parse checkout data:",c),r.error("Failed to load checkout data"),t==null||t("grocery-list")}else r.error("No checkout data found"),t==null||t("grocery-list")})()},[t]),!D)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 to-amber-50 flex items-center justify-center p-4",children:e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"text-gray-600",children:"Loading checkout..."})})});const{instacartItems:m,amazonItems:h,amazonFreshItems:u,amazonGroceryItems:j,wholeFoodsItems:g,userId:C,deliveryAddress:L}=D,G=[...h,...u,...j,...g],P=m.length+G.length,W=async()=>{if(m.length===0){r.error("No items for Instacart delivery");return}k(!0);try{r.info("Finding matching products for Instacart...");const s=[];for(const n of m){const a=await $(n.name,1);a.length>0&&s.push({product:a[0],quantity:n.quantity.toString(),unit:n.unit,deliveryService:"instacart"})}s.length>0&&(await E(C,s),r.success(`Added ${s.length} items to cart for Instacart`));const f=m.map(n=>({product_id:n.id,quantity:n.quantity,unit:n.unit})),c=await O(f,C,L);window.open(c.checkout_url,"_blank"),r.success("Checkout window opened - you can return anytime")}catch(s){console.error("Error creating Instacart cart:",s),r.error("Failed to create Instacart cart. Please try again.")}finally{k(!1)}},I=async(s,f)=>{if(f.length===0){r.error(`No items for ${F(s)}`);return}k(!0);try{r.info("Finding matching Amazon products...");const c=[],n=[];for(const x of f){const S=await $(x.name,1);S.length>0?(n.push({product:S[0],quantity:x.quantity.toString(),unit:x.unit,deliveryService:s}),c.push({name:x.name,quantity:x.quantity.toString(),unit:x.unit,asin:S[0].asin})):c.push({name:x.name,quantity:x.quantity.toString(),unit:x.unit,asin:null})}n.length>0&&await E(C,n),await Q(C,s,n.length);const a=R(c,s);localStorage.setItem("checkout_results",JSON.stringify({result:a,serviceName:F(s)})),t==null||t("checkout-results"),a.hasCartItems&&!a.hasUnmappedItems?r.success(`Added ${a.mappedItems.length} items to ${F(s)} cart`):a.hasCartItems&&a.hasUnmappedItems?r.info(`${a.mappedItems.length} items ready, ${a.unmappedItems.length} need manual search`):a.hasUnmappedItems&&r.info(`${a.unmappedItems.length} items need manual search on Amazon`)}catch(c){console.error(`Error processing ${s}:`,c),r.error("Failed to process items")}finally{k(!1)}};return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-orange-50 to-amber-50",children:e.jsxs("div",{className:"max-w-3xl mx-auto p-4 pb-safe",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs(p,{variant:"ghost",onClick:()=>t==null?void 0:t("grocery-list"),className:"mb-4",children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),"Back to Grocery List"]}),e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(J,{className:"w-6 h-6 text-orange-600"}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Choose Delivery Service"})]}),e.jsxs("p",{className:"text-gray-600",children:["We've automatically sorted your ",P," items by freshness and delivery service"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[m.length>0&&e.jsxs(l,{children:[e.jsxs(i,{className:"pb-3",children:[e.jsxs(d,{className:"text-base flex items-center gap-2",children:[e.jsx(z,{className:"w-4 h-4 text-green-600"}),"Instacart"]}),e.jsx(b,{children:"Quick delivery"})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:m.length}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"items"})]})]}),u.length>0&&e.jsxs(l,{children:[e.jsxs(i,{className:"pb-3",children:[e.jsxs(d,{className:"text-base flex items-center gap-2",children:[e.jsx(_,{className:"w-4 h-4 text-green-600"}),"Amazon Fresh"]}),e.jsx(b,{children:"Same-day delivery"})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:u.length}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"items"})]})]}),j.length>0&&e.jsxs(l,{children:[e.jsxs(i,{className:"pb-3",children:[e.jsxs(d,{className:"text-base flex items-center gap-2",children:[e.jsx(A,{className:"w-4 h-4 text-orange-600"}),"Amazon Grocery"]}),e.jsx(b,{children:"Standard shipping"})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:j.length}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"items"})]})]}),g.length>0&&e.jsxs(l,{children:[e.jsxs(i,{className:"pb-3",children:[e.jsxs(d,{className:"text-base flex items-center gap-2",children:[e.jsx(z,{className:"w-4 h-4 text-emerald-600"}),"Whole Foods"]}),e.jsx(b,{children:"Premium organic"})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold text-emerald-600",children:g.length}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"items"})]})]}),h.length>0&&e.jsxs(l,{children:[e.jsxs(i,{className:"pb-3",children:[e.jsxs(d,{className:"text-base flex items-center gap-2",children:[e.jsx(A,{className:"w-4 h-4 text-orange-600"}),"Amazon"]}),e.jsx(b,{children:"General items"})]}),e.jsxs(o,{children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:h.length}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"items"})]})]})]}),m.length>0&&e.jsxs(l,{children:[e.jsx(i,{children:e.jsxs(d,{className:"text-sm flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-4 h-4 text-green-600"}),"Instacart Items (",m.length,")"]}),e.jsxs(p,{size:"sm",onClick:W,disabled:N,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(y,{className:"w-3 h-3 mr-1"}),"Checkout"]})]})}),e.jsx(o,{children:e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:m.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg bg-green-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:w(s.category)}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:s.name}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.quantity," ",s.unit]})]})]}),e.jsx(v,{variant:"outline",className:"text-xs",children:s.category})]},s.id))})})]}),u.length>0&&e.jsxs(l,{children:[e.jsx(i,{children:e.jsxs(d,{className:"text-sm flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(_,{className:"w-4 h-4 text-green-600"}),"Amazon Fresh (",u.length,")"]}),e.jsxs(p,{size:"sm",onClick:()=>I("amazon_fresh",u),disabled:N,className:"bg-green-600 hover:bg-green-700",children:[e.jsx(y,{className:"w-3 h-3 mr-1"}),"Checkout"]})]})}),e.jsx(o,{children:e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:u.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg bg-green-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:w(s.category)}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:s.name}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.quantity," ",s.unit]})]})]}),e.jsx(v,{variant:"outline",className:"text-xs",children:s.category})]},s.id))})})]}),j.length>0&&e.jsxs(l,{children:[e.jsx(i,{children:e.jsxs(d,{className:"text-sm flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"w-4 h-4 text-orange-600"}),"Amazon Grocery (",j.length,")"]}),e.jsxs(p,{size:"sm",onClick:()=>I("amazon_grocery",j),disabled:N,className:"bg-orange-600 hover:bg-orange-700",children:[e.jsx(y,{className:"w-3 h-3 mr-1"}),"Checkout"]})]})}),e.jsx(o,{children:e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:j.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg bg-orange-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:w(s.category)}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:s.name}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.quantity," ",s.unit]})]})]}),e.jsx(v,{variant:"outline",className:"text-xs",children:s.category})]},s.id))})})]}),g.length>0&&e.jsxs(l,{children:[e.jsx(i,{children:e.jsxs(d,{className:"text-sm flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-4 h-4 text-emerald-600"}),"Whole Foods (",g.length,")"]}),e.jsxs(p,{size:"sm",onClick:()=>I("whole_foods",g),disabled:N,className:"bg-emerald-600 hover:bg-emerald-700",children:[e.jsx(y,{className:"w-3 h-3 mr-1"}),"Checkout"]})]})}),e.jsx(o,{children:e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:g.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg bg-emerald-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:w(s.category)}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:s.name}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.quantity," ",s.unit]})]})]}),e.jsx(v,{variant:"outline",className:"text-xs",children:s.category})]},s.id))})})]}),h.length>0&&e.jsxs(l,{children:[e.jsx(i,{children:e.jsxs(d,{className:"text-sm flex items-center justify-between",children:[e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx(A,{className:"w-4 h-4 text-orange-600"}),"Amazon (",h.length,")"]}),e.jsxs(p,{size:"sm",onClick:()=>I("amazon",h),disabled:N,className:"bg-orange-600 hover:bg-orange-700",children:[e.jsx(y,{className:"w-3 h-3 mr-1"}),"Checkout"]})]})}),e.jsx(o,{children:e.jsx("div",{className:"space-y-2 max-h-48 overflow-y-auto",children:h.map(s=>e.jsxs("div",{className:"flex items-center justify-between p-2 rounded-lg bg-orange-50",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:w(s.category)}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-sm",children:s.name}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[s.quantity," ",s.unit]})]})]}),e.jsx(v,{variant:"outline",className:"text-xs",children:s.category})]},s.id))})})]})]})]})})}export{ae as Checkout};
