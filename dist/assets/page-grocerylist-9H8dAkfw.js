import{r as m,j as e,av as ve,aY as dt,aq as mt,Q as ht,N as ut,aS as pt,aV as xt,a6 as le,by as ke,bz as ce,aW as gt,bA as ft,bB as Ce,bC as bt,bD as yt,bE as jt,bF as Nt,bG as wt,bH as vt,bI as kt,bJ as Ct}from"./react-vendor-z9ssXL8w.js";import{u as n}from"./vendor-Clj4czuh.js";import{D as Y,i as V,j as H,k as W,t as X,C as J,c as K,h as Z,l as oe,B as p,A as It,s as ie,L as B,I as P,a as St,b as Dt,S as Ie,o as Se,p as De,q as Be,r as Ee}from"./page-addrecipe-Pb6dTsbS.js";import{C as Bt}from"./page-adminproducts-DimmU9B1.js";import{z as Ae,w as Et,P as At,Q as Rt,R as T,S as E,T as Tt,U as Ft,A as _t,V as Pt,W as zt,x as Gt}from"./services-BpcRR5rK.js";const $t={cup:{type:"volume",toBase:240},cups:{type:"volume",toBase:240},c:{type:"volume",toBase:240},tablespoon:{type:"volume",toBase:15},tablespoons:{type:"volume",toBase:15},tbsp:{type:"volume",toBase:15},teaspoon:{type:"volume",toBase:5},teaspoons:{type:"volume",toBase:5},tsp:{type:"volume",toBase:5},milliliter:{type:"volume",toBase:1},milliliters:{type:"volume",toBase:1},ml:{type:"volume",toBase:1},liter:{type:"volume",toBase:1e3},liters:{type:"volume",toBase:1e3},l:{type:"volume",toBase:1e3},"fluid ounce":{type:"volume",toBase:30},"fluid ounces":{type:"volume",toBase:30},"fl oz":{type:"volume",toBase:30},pint:{type:"volume",toBase:480},pints:{type:"volume",toBase:480},pt:{type:"volume",toBase:480},quart:{type:"volume",toBase:960},quarts:{type:"volume",toBase:960},qt:{type:"volume",toBase:960},gallon:{type:"volume",toBase:3840},gallons:{type:"volume",toBase:3840},gal:{type:"volume",toBase:3840},gram:{type:"weight",toBase:1},grams:{type:"weight",toBase:1},g:{type:"weight",toBase:1},kilogram:{type:"weight",toBase:1e3},kilograms:{type:"weight",toBase:1e3},kg:{type:"weight",toBase:1e3},ounce:{type:"weight",toBase:28.35},ounces:{type:"weight",toBase:28.35},oz:{type:"weight",toBase:28.35},pound:{type:"weight",toBase:453.59},pounds:{type:"weight",toBase:453.59},lb:{type:"weight",toBase:453.59},lbs:{type:"weight",toBase:453.59},milligram:{type:"weight",toBase:.001},milligrams:{type:"weight",toBase:.001},mg:{type:"weight",toBase:.001},piece:{type:"count",toBase:1},pieces:{type:"count",toBase:1},whole:{type:"count",toBase:1},item:{type:"count",toBase:1},items:{type:"count",toBase:1},clove:{type:"count",toBase:1},cloves:{type:"count",toBase:1},slice:{type:"count",toBase:1},slices:{type:"count",toBase:1},"":{type:"count",toBase:1}};function qt(r){return r.toLowerCase().trim()}function de(r){const h=qt(r);return $t[h]||null}function Jt(r,h){const l=de(r),u=de(h);return!l||!u?!1:l.type===u.type}function Kt(r,h){const l=de(h);return l?r*l.toBase:null}function Zt(r,h){return h==="volume"?r>=3840?{quantity:r/3840,unit:"gallon"}:r>=960?{quantity:r/960,unit:"quart"}:r>=240?{quantity:r/240,unit:"cup"}:r>=15?{quantity:r/15,unit:"tbsp"}:{quantity:r/5,unit:"tsp"}:h==="weight"?r>=1e3?{quantity:r/1e3,unit:"kg"}:r>=453.59?{quantity:r/453.59,unit:"lb"}:r>=28.35?{quantity:r/28.35,unit:"oz"}:{quantity:r,unit:"g"}:{quantity:r,unit:""}}function Qt(r){if(r=r.trim(),r.includes("/")){const l=r.split(/\s+/);let u=0;for(const f of l)if(f.includes("/")){const[N,b]=f.split("/").map(v=>parseFloat(v));!isNaN(N)&&!isNaN(b)&&b!==0&&(u+=N/b)}else{const N=parseFloat(f);isNaN(N)||(u+=N)}return u}const h=parseFloat(r);return isNaN(h)?0:h}function Lt(r){if(r===Math.floor(r))return r.toString();const h={"0.25":"1/4","0.33":"1/3","0.5":"1/2","0.66":"2/3","0.67":"2/3","0.75":"3/4"},l=Math.floor(r),u=r-l,f=u.toFixed(2);return h[f]?l>0?`${l} ${h[f]}`:h[f]:u<.01?l.toString():r.toFixed(2).replace(/\.?0+$/,"")}function Ot({open:r,onOpenChange:h,ingredientName:l,quantity:u,unit:f,onSelect:N}){const[b,v]=m.useState([]),[z,k]=m.useState(!1),[g,w]=m.useState(null);m.useEffect(()=>{r&&l&&G()},[r,l]);const G=async()=>{k(!0);try{const o=await Ae(l,5);v(o),o.length===0&&n.info("No exact matches found. Showing general results.")}catch(o){console.error("Error loading products:",o),n.error("Failed to load product suggestions")}finally{k(!1)}},$=()=>{g&&(N(g),h(!1),w(null))};return e.jsx(Y,{open:r,onOpenChange:h,children:e.jsxs(V,{className:"max-w-2xl max-h-[80vh] overflow-hidden flex flex-col",onInteractOutside:o=>o.preventDefault(),onEscapeKeyDown:o=>o.preventDefault(),children:[e.jsxs(H,{children:[e.jsxs(W,{children:['Select Product for "',l,'"']}),e.jsxs(X,{children:["Choose an Amazon product to add to your cart (",u," ",f,")"]})]}),e.jsx("div",{className:"flex-1 overflow-y-auto pr-2",children:z?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-600"})}):b.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(ve,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsxs("p",{className:"mb-2",children:['No products found for "',l,'"']}),e.jsx("p",{className:"text-sm",children:"Try browsing the product catalog in the Cart page"})]}):e.jsx("div",{className:"space-y-3",children:b.map(o=>e.jsx(J,{className:`cursor-pointer transition-all hover:shadow-md ${(g==null?void 0:g.id)===o.id?"border-2 border-orange-500 bg-orange-50":"border border-gray-200"}`,onClick:()=>w(o),children:e.jsx(K,{className:"p-4",children:e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"w-24 h-24 bg-gray-100 rounded-lg flex items-center justify-center shrink-0",children:o.image_url?e.jsx("img",{src:o.image_url,alt:o.product_name,className:"w-full h-full object-contain p-2"}):e.jsx(ve,{className:"w-12 h-12 text-gray-300"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[e.jsx("h3",{className:"font-semibold text-sm line-clamp-2",children:o.product_name}),(g==null?void 0:g.id)===o.id&&e.jsx(dt,{className:"w-5 h-5 text-orange-600 shrink-0"})]}),o.brand&&e.jsx("p",{className:"text-xs text-gray-600 mb-1",children:o.brand}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-2",children:[o.package_size&&e.jsx(Z,{variant:"secondary",className:"text-xs",children:o.package_size}),o.is_prime&&e.jsx(Z,{className:"bg-blue-500 text-white text-xs",children:"Prime"})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[o.price&&e.jsxs("p",{className:"text-lg font-bold text-orange-600",children:["$",o.price.toFixed(2)]}),e.jsxs("a",{href:Et(o.amazon_url),target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:text-blue-800 text-sm flex items-center gap-1",onClick:q=>q.stopPropagation(),children:[e.jsx("span",{children:"View on Amazon"}),e.jsx(mt,{className:"w-3 h-3"})]})]})]})]})})},o.id))})}),e.jsxs(oe,{className:"flex gap-2 pt-4 border-t",children:[e.jsx(p,{variant:"outline",onClick:()=>{h(!1),w(null)},children:"Cancel"}),e.jsx(p,{onClick:$,disabled:!g,className:"bg-orange-600 hover:bg-orange-700 text-white",children:"Add to Cart"})]})]})})}function Ut({onNavigate:r}={}){const{state:h,dispatch:l}=It(),[u,f]=m.useState(At()),[N,b]=m.useState(!1),[v,z]=m.useState(null),[k,g]=m.useState(null),[w,G]=m.useState(""),[$,o]=m.useState(""),[q,me]=m.useState(""),[L,he]=m.useState(""),[Re,O]=m.useState(!1),[U,ue]=m.useState(""),[Q,Te]=m.useState(new Date().toISOString().split("T")[0]),[ee,Fe]=m.useState(new Date(Date.now()+7*24*60*60*1e3).toISOString().split("T")[0]),[_e,te]=m.useState(!1),[F,pe]=m.useState(null),[Pe,ae]=m.useState(null),[ze,xe]=m.useState(!1),[C,Ge]=m.useState(null),[c,$e]=m.useState(null),[se,qe]=m.useState({}),[Mt,Le]=m.useState(!1),y=h.groceryList;m.useEffect(()=>{(async()=>{const{data:s}=await ie.auth.getUser();if(s.user){$e(s.user.id);try{const t=await T(s.user.id);l({type:"UPDATE_GROCERY_LIST",payload:t});const i=await Tt();Le(i);const d=await Ft(s.user.id);d!=null&&d.deliveryAddress&&qe(d.deliveryAddress)}catch(t){console.error("Error loading grocery items:",t)}}})()},[]);const Oe=!0;function Ue(a,s){const t=a.toLowerCase().trim(),i={salt:e.jsx("span",{className:"text-lg",children:"ðŸ§‚"}),"black pepper":e.jsx("span",{className:"text-lg",children:"ðŸŒ¶ï¸"}),pepper:e.jsx("span",{className:"text-lg",children:"ðŸŒ¶ï¸"}),paprika:e.jsx("span",{className:"text-lg",children:"ðŸŒ¶ï¸"}),water:e.jsx(Ce,{className:"w-5 h-5 text-blue-500"}),duck:e.jsx("span",{className:"text-lg",children:"ðŸ¦†"})};return i[t]?i[t]:t.match(/\b(duck|goose|quail|pheasant|turkey|chicken|poultry|wing|drumstick|breast|thigh)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ—"}):t.match(/\b(cumin|coriander|turmeric|cardamom|clove|nutmeg|saffron|curry|chili|cayenne|red pepper|crushed pepper|pepper flake)/)?e.jsx(ft,{className:"w-5 h-5 text-red-600"}):t.match(/\b(basil|oregano|thyme|rosemary|sage|dill|parsley|cilantro|mint|bay leaf|herb)/)?e.jsx("span",{className:"text-lg",children:"ðŸŒ¿"}):t.match(/\b(cinnamon|vanilla|allspice|anise|fennel)/)?e.jsx("span",{className:"text-lg",children:"ðŸŒ°"}):t.match(/\b(garlic|onion powder|garlic powder|shallot powder)/)?e.jsx("span",{className:"text-lg",children:"ðŸ§„"}):t.match(/\b(sesame oil|olive oil|vegetable oil|canola oil|coconut oil|peanut oil|avocado oil|oil)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ«—"}):t.match(/\b(butter|ghee|lard|shortening)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ§ˆ"}):t.match(/\b(water|h2o)\b/)?e.jsx(Ce,{className:"w-5 h-5 text-blue-500"}):t.match(/\b(milk|whole milk|skim milk|2%|almond milk|soy milk|oat milk)\b/)?e.jsx(bt,{className:"w-5 h-5 text-blue-400"}):t.match(/\b(juice|lemon juice|lime juice|orange juice)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ§ƒ"}):t.match(/\b(wine|beer|sake|liquor|vodka|rum|whiskey|brandy)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ·"}):t.match(/\b(stock|broth|bouillon)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ¥£"}):t.match(/\b(soy sauce|tamari|worcestershire|fish sauce|oyster sauce|hoisin|teriyaki)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ¥«"}):t.match(/\b(ketchup|mustard|mayo|mayonnaise|aioli|relish)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ¯"}):t.match(/\b(vinegar|balsamic|rice vinegar|apple cider vinegar)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ§ª"}):t.match(/\b(hot sauce|sriracha|tabasco|salsa|pico de gallo)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸŒ¶ï¸"}):t.match(/\b(tomato|tomatoes)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ…"}):t.match(/\b(onion|onions|red onion|white onion|yellow onion|sweet onion)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ§…"}):t.match(/\b(garlic|garlic clove)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ§„"}):t.match(/\b(carrot|carrots)\b/)?e.jsx(yt,{className:"w-5 h-5 text-orange-500"}):t.match(/\b(potato|potatoes|russet|yukon)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ¥”"}):t.match(/\b(sweet potato|yam)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ "}):t.match(/\b(lettuce|romaine|iceberg|arugula|salad|greens)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ¥¬"}):t.match(/\b(spinach|kale|chard|collard)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ¥¬"}):t.match(/\b(broccoli)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ¥¦"}):t.match(/\b(cauliflower)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ¥¦"}):t.match(/\b(corn|maize)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸŒ½"}):t.match(/\b(pepper|bell pepper|capsicum|jalapeÃ±o|serrano)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ«‘"}):t.match(/\b(cucumber|cukes)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ¥’"}):t.match(/\b(eggplant|aubergine)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ†"}):t.match(/\b(zucchini|courgette|squash)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ¥’"}):t.match(/\b(mushroom|shiitake|portobello|cremini)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ„"}):t.match(/\b(asparagus)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ¥¦"}):t.match(/\b(peas|snap pea|snow pea)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ«›"}):t.match(/\b(bean|green bean|kidney bean|black bean|pinto|chickpea|garbanzo)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ«˜"}):t.match(/\b(celery)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ¥¬"}):t.match(/\b(radish)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸŒ±"}):t.match(/\b(ginger|ginger root)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ«š"}):t.match(/\b(avocado)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ¥‘"}):t.match(/\b(apple|apples)\b/)?e.jsx(jt,{className:"w-5 h-5 text-red-500"}):t.match(/\b(banana|bananas)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸŒ"}):t.match(/\b(orange|oranges)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸŠ"}):t.match(/\b(lemon|lemons)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ‹"}):t.match(/\b(lime|limes)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ‹"}):t.match(/\b(strawberry|strawberries)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ“"}):t.match(/\b(blueberry|blueberries)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ«"}):t.match(/\b(grape|grapes)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ‡"}):t.match(/\b(watermelon)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ‰"}):t.match(/\b(mango|mangoes)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ¥­"}):t.match(/\b(pineapple)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ"}):t.match(/\b(peach|peaches)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ‘"}):t.match(/\b(cherry|cherries)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ’"}):t.match(/\b(pear|pears)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ"}):t.match(/\b(berry|berries|raspberry|blackberry)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ“"}):t.match(/\b(beef|steak|ribeye|sirloin|chuck|brisket|ground beef)\b/)?e.jsx(Nt,{className:"w-5 h-5 text-red-700"}):t.match(/\b(pork|ham|bacon|sausage|chorizo|pepperoni)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ¥“"}):t.match(/\b(lamb|mutton)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ–"}):t.match(/\b(fish|salmon|tuna|cod|tilapia|halibut|trout)\b/)?e.jsx(wt,{className:"w-5 h-5 text-blue-500"}):t.match(/\b(shrimp|prawn|crab|lobster|scallop|clam|mussel|oyster|seafood)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ¦ž"}):t.match(/\b(egg|eggs)\b/)?e.jsx(vt,{className:"w-5 h-5 text-yellow-600"}):t.match(/\b(tofu|tempeh|seitan)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ¥¡"}):t.match(/\b(cheese|cheddar|mozzarella|parmesan|feta|gouda|brie)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ§€"}):t.match(/\b(yogurt|yoghurt)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ¥›"}):t.match(/\b(cream|heavy cream|sour cream|whipping cream)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ¥›"}):t.match(/\b(rice|basmati|jasmine|brown rice|white rice)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸš"}):t.match(/\b(pasta|spaghetti|penne|rigatoni|linguine|fettuccine|noodle|macaroni)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ"}):t.match(/\b(bread|baguette|roll|bun|loaf|sourdough|wheat bread)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ¥–"}):t.match(/\b(flour|all-purpose|wheat|bread flour|cake flour)\b/)?e.jsx(kt,{className:"w-5 h-5 text-amber-600"}):t.match(/\b(tortilla|wrap|pita|flatbread|naan)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ«“"}):t.match(/\b(cereal|oat|oatmeal|granola)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ¥£"}):t.match(/\b(quinoa|couscous|barley|farro)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸŒ¾"}):t.match(/\b(sugar|brown sugar|powdered sugar|confectioner)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ¬"}):t.match(/\b(honey|maple syrup|agave|molasses)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ¯"}):t.match(/\b(chocolate|cocoa|cacao)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ«"}):t.match(/\b(cookie|biscuit)\b/)?e.jsx(Ct,{className:"w-5 h-5 text-amber-700"}):t.match(/\b(cake|cupcake|muffin|pastry|brownie)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ°"}):t.match(/\b(baking powder|baking soda|yeast)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ§ª"}):t.match(/\b(almond|peanut|walnut|cashew|pistachio|pecan|hazelnut|nut)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸ¥œ"}):t.match(/\b(seed|sesame|sunflower|pumpkin|chia|flax)\b/)?e.jsx("span",{className:"text-lg",children:"ðŸŒ»"}):s==="produce"?e.jsx("span",{className:"text-lg",children:"ðŸ¥¬"}):s==="meat"?e.jsx("span",{className:"text-lg",children:"ðŸ¥©"}):s==="dairy"?e.jsx("span",{className:"text-lg",children:"ðŸ¥›"}):s==="pantry"?e.jsx("span",{className:"text-lg",children:"ðŸ¥«"}):s==="frozen"?e.jsx("span",{className:"text-lg",children:"ðŸ§Š"}):s==="bakery"?e.jsx("span",{className:"text-lg",children:"ðŸ¥–"}):s==="snacks"?e.jsx("span",{className:"text-lg",children:"ðŸ¿"}):s==="beverages"?e.jsx("span",{className:"text-lg",children:"ðŸ¥¤"}):e.jsx("span",{className:"text-lg",children:"ðŸ›’"})}m.useEffect(()=>{c&&ge()},[Q,ee,c]);async function ge(){if(c)try{const a=await Rt(c),s=await T(c),t=new Date(Q);t.setHours(0,0,0,0);const i=new Date(ee);i.setHours(23,59,59,999);const d=a.filter(x=>{const j=new Date(x.date);return j.setHours(0,0,0,0),j>=t&&j<=i});if(d.length===0){l({type:"UPDATE_GROCERY_LIST",payload:s}),n.info("No meals planned in selected date range");return}const I=[...new Set(d.map(x=>x.recipeId))],{data:S,error:M}=await ie.from("public_recipes").select("*").in("id",I);if(M){console.error("Error fetching recipes:",M),n.error("Failed to fetch recipes from meal planner");return}const R={};d.forEach(x=>{const j=S.find(we=>we.id===x.recipeId);j&&j.ingredients&&(Array.isArray(j.ingredients)?j.ingredients:[]).forEach(D=>{const _=`${D.name.toLowerCase()}-${D.unit||""}`;if(R[_])R[_].quantity+=parseFloat(D.quantity)||0,R[_].sourceRecipeIds.includes(j.id)||R[_].sourceRecipeIds.push(j.id);else{const ot=fe(D.name);R[_]={id:`item-${Date.now()}-${Math.random()}`,name:D.name,quantity:parseFloat(D.quantity)||1,unit:D.unit||"",categoryId:ot,checked:!1,sourceRecipeIds:[j.id]}}})});const it=new Set(s.map(x=>`${x.name.toLowerCase()}-${x.unit}`)),ne=Object.values(R).filter(x=>!it.has(`${x.name.toLowerCase()}-${x.unit}`));if(ne.length>0){const x=[...s,...ne];await E(c,x),l({type:"UPDATE_GROCERY_LIST",payload:x}),n.success(`Added ${ne.length} items from meal planner`)}else l({type:"UPDATE_GROCERY_LIST",payload:s}),n.info("All meal planner items already in grocery list")}catch(a){console.error("Error loading meal planner items:",a),n.error("Failed to load meal planner items")}}function fe(a){const s=a.toLowerCase();return s.match(/\b(apple|banana|orange|berry|fruit|lettuce|tomato|carrot|onion|vegetable|pepper|cucumber|zucchini|potato|spinach|broccoli|mushroom|garlic|avocado|cilantro|parsley|basil|lemon|lime)\b/)?"cat-0":s.match(/\b(chicken|beef|pork|turkey|salmon|shrimp|fish|bacon|sausage|meat|seafood)\b/)?"cat-1":s.match(/\b(milk|cheese|yogurt|butter|cream|egg|dairy|cheddar|mozzarella|parmesan)\b/)?"cat-2":s.match(/\b(bread|tortilla|buns|rolls|bagels|croissant|bakery)\b/)?"cat-3":s.match(/\b(rice|pasta|flour|sugar|salt|pepper|oil|vinegar|sauce|beans|chickpeas|lentils|broth|stock|honey|peanut butter|spice|seasoning)\b/)?"cat-4":s.match(/\b(frozen|ice cream)\b/)?"cat-5":s.match(/\b(water|juice|coffee|tea|soda|beverage|drink)\b/)?"cat-6":"cat-7"}async function Me(a){if(c)try{const s=y.map(t=>t.id===a?{...t,checked:!t.checked}:t);await E(c,s),l({type:"TOGGLE_GROCERY_ITEM",payload:a})}catch(s){console.error("Error toggling item:",s),n.error("Failed to update item")}}async function Ye(a){if(c)try{const s=y.filter(t=>t.id!==a);await E(c,s),l({type:"REMOVE_GROCERY_ITEM",payload:a}),ae(null)}catch(s){console.error("Error deleting item:",s),n.error("Failed to delete item")}}async function Ve(){if(!c)return;const a=y.filter(s=>!s.checked);try{await E(c,a),l({type:"UPDATE_GROCERY_LIST",payload:a})}catch(s){console.error("Error clearing checked items:",s),n.error("Failed to clear checked items")}}async function He(){if(c&&window.confirm("Are you sure you want to clear all items from your grocery list?"))try{await zt(c),l({type:"UPDATE_GROCERY_LIST",payload:[]}),n.success("Grocery list cleared")}catch(a){console.error("Error clearing grocery list:",a),n.error("Failed to clear grocery list")}}async function We(){if(!c||!w.trim()||!L)return;const a={id:`item-${Date.now()}-${Math.random()}`,name:w.trim(),quantity:parseFloat($)||1,unit:q||"",categoryId:L,checked:!1,sourceRecipeIds:[]};try{const t=[...await T(c),a];await E(c,t);const i=await T(c);l({type:"UPDATE_GROCERY_LIST",payload:i}),b(!1),G(""),o(""),me(""),he("")}catch(s){console.error("Error adding item:",s),n.error("Failed to add item")}}async function Xe(){if(!c||!U)return;const a=h.savedRecipes.find(t=>t.id===U);if(!a){n.error("Recipe not found");return}const s=a.ingredients.map((t,i)=>{const d=fe(t.name);return{id:`item-${Date.now()}-${Math.random()}-${i}`,name:t.name,quantity:parseFloat(t.quantity)||1,unit:t.unit||"",categoryId:d,checked:!1,sourceRecipeIds:[a.id]}});try{const i=[...await T(c),...s];await E(c,i);const d=await T(c);l({type:"UPDATE_GROCERY_LIST",payload:d}),n.success(`Added ${s.length} ingredients from ${a.title}`),O(!1),ue("")}catch(t){console.error("Error adding recipe:",t),n.error("Failed to add recipe ingredients")}}async function be(a,s){if(c)try{const t=y.map(i=>i.id===a?{...i,categoryId:s}:i);await E(c,t),l({type:"UPDATE_GROCERY_LIST",payload:t})}catch(t){console.error("Error moving item:",t),n.error("Failed to move item")}}function Je(a){pe(a),te(!0)}function Ke(a){z(a)}function ye(a){a.preventDefault()}function Ze(a){v&&(be(v,a),z(null))}function Qe(a){g(a)}async function et(a){if(!k||k===a){g(null);return}const s=u.findIndex(S=>S.id===k),t=u.findIndex(S=>S.id===a);if(s===-1||t===-1)return;const i=[...u],[d]=i.splice(s,1);i.splice(t,0,d);const I=i.map((S,M)=>({...S,sortOrder:M}));f(I),g(null)}async function tt(){try{const{data:a}=await ie.auth.getUser();if(!a.user){n.error("Please sign in to add items to cart");return}if(y.length===0){n.error("No items to send to cart");return}n.info("Finding matching Amazon products...");const s=[],t=[];for(const d of y){const I=await Ae(d.name,1);I.length>0?(t.push({product:I[0],quantity:d.quantity.toString(),unit:d.unit}),s.push({name:d.name,quantity:d.quantity.toString(),unit:d.unit,asin:I[0].asin})):s.push({name:d.name,quantity:d.quantity.toString(),unit:d.unit,asin:null})}t.length>0&&(await _t(a.user.id,t),n.success(`Added ${t.length} items to cart!`));const i=s.filter(d=>!d.asin).length;i>0&&n.info(`${i} items couldn't be found and need manual search`),r&&setTimeout(()=>r("cart"),1e3)}catch(a){console.error("Failed to send to cart:",a),n.error("Failed to send items to cart")}}const at=a=>{if(!c){n.error("Please sign in to add items to cart");return}Ge(a),xe(!0)},st=async a=>{if(!(!c||!C))try{await Gt(c,a,C.quantity.toString(),C.unit),n.success(`Added ${a.product_name} to cart`)}catch(s){console.error("Failed to add to cart:",s),n.error("Failed to add item to cart")}},rt=async()=>{if(!c){n.error("Please sign in to order delivery");return}if(y.length===0){n.error("No items in grocery list");return}if(!se||!se.street){n.error("Please set your delivery address in settings first");return}try{n.info("Routing items to delivery services...");const{instacartItems:a,amazonItems:s,amazonFreshItems:t,amazonGroceryItems:i,wholeFoodsItems:d}=await Pt(y,c);localStorage.setItem("checkout_data",JSON.stringify({instacartItems:a,amazonItems:s,amazonFreshItems:t,amazonGroceryItems:i,wholeFoodsItems:d,userId:c,deliveryAddress:se})),r==null||r("checkout")}catch(a){console.error("Error routing items:",a),n.error("Failed to route items. Please try again.")}};let je=0,Ne=0;function nt(a,s){je=a.targetTouches[0].clientX}function lt(a,s){Ne=a.changedTouches[0].clientX;const t=je-Ne;t>100?ae(s):t<-50&&ae(null)}const ct=u.reduce((a,s)=>(a[s.id]=y.filter(t=>t.categoryId===s.id),a),{}),re=y.filter(a=>a.checked).length,A=y.length;return e.jsxs("div",{className:"max-w-4xl mx-auto px-4 pt-2 pb-24",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs("div",{className:"flex flex-col gap-4 mb-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gray-900",children:"Grocery List"}),e.jsxs("p",{className:"text-sm text-gray-500 mt-1",children:[re," of ",A," items checked"]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(p,{variant:"outline",onClick:()=>b(!0),className:"h-10 text-sm border-2 border-gray-300 bg-white hover:bg-gray-100 hover:border-gray-500 hover:text-gray-900",children:[e.jsx(ht,{className:"w-4 h-4 mr-1"}),"Add Item"]}),e.jsxs(p,{variant:"outline",onClick:()=>O(!0),className:"h-10 text-sm border-2 border-gray-300 bg-white hover:bg-gray-100 hover:border-gray-500 hover:text-gray-900",children:[e.jsx(ut,{className:"w-4 h-4 mr-1"}),"Add Recipe"]})]}),(re>0||A>0)&&e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[A>0&&e.jsxs(p,{variant:"outline",onClick:tt,className:"h-10 text-sm border-2 border-gray-300 bg-white hover:bg-gray-100 hover:border-gray-500 hover:text-gray-900",children:[e.jsx(pt,{className:"w-4 h-4 mr-1"}),"Amazon Cart"]}),A>0&&Oe&&e.jsxs(p,{variant:"outline",onClick:rt,className:"h-10 text-sm border-2 border-green-300 bg-white hover:bg-green-50 hover:border-green-500 hover:text-green-900",children:[e.jsx(xt,{className:"w-4 h-4 mr-1"}),"Order Delivery"]}),A>0&&e.jsxs(p,{variant:"destructive",onClick:He,className:"h-10 text-sm",children:[e.jsx(le,{className:"w-4 h-4 mr-1"}),"Clear All"]}),re>0&&e.jsxs(p,{variant:"outline",onClick:Ve,className:"h-10 text-sm border-2 border-gray-300 bg-white hover:bg-gray-100 hover:border-gray-500 hover:text-gray-900 col-span-2",children:[e.jsx(le,{className:"w-4 h-4 mr-1"}),"Clear Checked"]})]})]}),e.jsx(J,{className:"bg-gradient-to-r from-blue-50 to-indigo-50 border-4 border-orange-500",children:e.jsx(K,{className:"pt-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ke,{className:"w-5 h-5 text-blue-600"}),e.jsx("p",{className:"text-sm font-medium text-gray-700",children:"Auto-populate from Meal Planner"})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx(B,{className:"text-xs text-gray-600",children:"From:"}),e.jsx(P,{type:"date",value:Q,onChange:a=>Te(a.target.value),className:"w-full h-12"})]}),e.jsxs("div",{className:"flex-1",children:[e.jsx(B,{className:"text-xs text-gray-600",children:"To:"}),e.jsx(P,{type:"date",value:ee,onChange:a=>Fe(a.target.value),className:"w-full h-12"})]}),e.jsx(p,{onClick:ge,className:"h-12 sm:self-end",children:"Refresh"})]})]})})})]}),A===0?e.jsx(J,{className:"border-4 border-orange-500",children:e.jsxs(K,{className:"py-12 text-center",children:[e.jsx("p",{className:"text-gray-500 mb-4",children:"Your grocery list is empty. Add recipes to your meal plan to automatically generate a grocery list."}),e.jsxs(p,{onClick:()=>r==null?void 0:r("meal-planner"),className:"h-12",children:[e.jsx(ke,{className:"w-4 h-4 mr-2"}),"Go to Meal Planner"]})]})}):e.jsx("div",{className:"space-y-4",children:u.map(a=>{const s=ct[a.id]||[];return s.length===0?null:e.jsxs(J,{draggable:!0,onDragStart:()=>Qe(a.id),onDragOver:ye,onDrop:()=>et(a.id),className:`transition-all border-4 border-orange-500 ${k===a.id?"opacity-50":""}`,children:[e.jsx(St,{className:"pb-3 cursor-move",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4 text-gray-400"}),e.jsx(Dt,{className:"text-lg",children:a.name}),e.jsx(Z,{variant:"secondary",children:s.length})]})})}),e.jsx(K,{onDragOver:ye,onDrop:()=>Ze(a.id),children:e.jsx("div",{className:"space-y-2",children:s.map(t=>e.jsxs("div",{draggable:!0,onDragStart:()=>Ke(t.id),onTouchStart:i=>nt(i,t.id),onTouchEnd:i=>lt(i,t.id),className:`relative flex items-center gap-3 p-3 rounded-lg hover:bg-gray-50 transition-all ${v===t.id?"opacity-50":""} ${t.checked?"opacity-60":""} ${Pe===t.id?"bg-red-50":""}`,children:[e.jsx(ce,{className:"w-4 h-4 text-gray-400 cursor-move hidden md:block"}),e.jsx("button",{onClick:()=>Je(t),className:"md:hidden p-2 -ml-2",children:e.jsx(ce,{className:"w-5 h-5 text-gray-400"})}),e.jsx(Bt,{checked:t.checked,onCheckedChange:()=>Me(t.id),className:"h-6 w-6"}),e.jsx("div",{className:"shrink-0",children:Ue(t.name,t.categoryId)}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx("span",{className:`font-medium text-base ${t.checked?"line-through text-gray-500":"text-gray-900"}`,children:t.name}),t.sourceRecipeIds.length>1&&e.jsxs(Z,{variant:"outline",className:"text-xs",children:[t.sourceRecipeIds.length," recipes"]})]}),e.jsxs("p",{className:"text-sm text-gray-600",children:[Lt(t.quantity)," ",t.unit]})]}),e.jsxs("div",{className:"flex gap-1",children:[e.jsx(p,{variant:"ghost",size:"icon",onClick:()=>at(t),className:"shrink-0 h-10 w-10",title:"Add to Cart",children:e.jsx(gt,{className:"w-5 h-5 text-orange-500"})}),e.jsx(p,{variant:"ghost",size:"icon",onClick:()=>Ye(t.id),className:"shrink-0 h-10 w-10",children:e.jsx(le,{className:"w-5 h-5 text-red-500"})})]})]},t.id))})})]},a.id)})}),e.jsx(Y,{open:_e,onOpenChange:te,children:e.jsxs(V,{children:[e.jsxs(H,{children:[e.jsx(W,{children:"Move to Category"}),e.jsxs(X,{children:['Select a new category for "',F==null?void 0:F.name,'"']})]}),e.jsx("div",{className:"space-y-2 py-4",children:u.map(a=>e.jsx(p,{variant:"outline",className:"w-full h-14 justify-start text-left",onClick:()=>{F&&be(F.id,a.id),te(!1),pe(null)},children:e.jsx("span",{className:"text-base font-medium",children:a.name})},a.id))})]})}),e.jsx(Y,{open:N,onOpenChange:b,children:e.jsxs(V,{children:[e.jsxs(H,{children:[e.jsx(W,{children:"Add Item"}),e.jsx(X,{children:"Add a new item to your grocery list."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"itemName",children:"Item Name *"}),e.jsx(P,{id:"itemName",value:w,onChange:a=>G(a.target.value),placeholder:"e.g., Milk, Eggs",className:"h-12"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"itemQuantity",children:"Quantity"}),e.jsx(P,{id:"itemQuantity",type:"number",value:$,onChange:a=>o(a.target.value),placeholder:"1",className:"h-12"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"itemUnit",children:"Unit"}),e.jsx(P,{id:"itemUnit",value:q,onChange:a=>me(a.target.value),placeholder:"e.g., cups, lbs",className:"h-12"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"itemCategory",children:"Category *"}),e.jsxs(Ie,{value:L,onValueChange:he,children:[e.jsx(Se,{className:"h-12",children:e.jsx(De,{placeholder:"Select category"})}),e.jsx(Be,{children:u.map(a=>e.jsx(Ee,{value:a.id,children:a.name},a.id))})]})]})]}),e.jsxs(oe,{children:[e.jsx(p,{variant:"outline",onClick:()=>b(!1),className:"h-12",children:"Cancel"}),e.jsx(p,{onClick:We,disabled:!w.trim()||!L,className:"h-12",children:"Add Item"})]})]})}),e.jsx(Y,{open:Re,onOpenChange:O,children:e.jsxs(V,{className:"z-[300]",children:[e.jsxs(H,{children:[e.jsx(W,{children:"Add Recipe to Grocery List"}),e.jsx(X,{children:"Select a recipe to add its ingredients to your grocery list."})]}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(B,{htmlFor:"recipeSelect",children:"Recipe *"}),e.jsxs(Ie,{value:U,onValueChange:ue,children:[e.jsx(Se,{className:"h-12",children:e.jsx(De,{placeholder:"Select a recipe"})}),e.jsx(Be,{className:"z-[350]",children:h.savedRecipes.map(a=>e.jsx(Ee,{value:a.id,children:a.title},a.id))})]})]})}),e.jsxs(oe,{children:[e.jsx(p,{variant:"outline",onClick:()=>O(!1),className:"h-12",children:"Cancel"}),e.jsx(p,{onClick:Xe,disabled:!U,className:"h-12",children:"Add Ingredients"})]})]})}),C&&e.jsx(Ot,{open:ze,onOpenChange:xe,ingredientName:C.name,quantity:C.quantity.toString(),unit:C.unit,onSelect:st})]})}const ea=Object.freeze(Object.defineProperty({__proto__:null,GroceryList:Ut},Symbol.toStringTag,{value:"Module"}));export{ea as G,Kt as a,Zt as b,Jt as c,de as g,qt as n,Qt as p};
