import{r as l,j as e,H as S,M as K,bP as X,ak as A,b1 as I,bm as Q,aR as W,$ as L,K as Z}from"./react-vendor-z9ssXL8w.js";import{C as c,a as d,b as u,c as m,g as M,I as q,B as j,D as ee,J as se,i as ae,j as re,k as te,t as ie,L as F,S as le,o as ne,p as oe,q as ce,r as g,h as de}from"./page-addrecipe-Pb6dTsbS.js";import{d as n}from"./services-BpcRR5rK.js";import"./ui-vendor-BA32w1ww.js";import"./vendor-Clj4czuh.js";import"./capacitor-vendor-Dh3Cr3CD.js";import"./supabase-vendor-DpDh9Ika.js";import"./page-grocerylist-9H8dAkfw.js";import"./page-adminproducts-DimmU9B1.js";import"./page-adminpayouts-D8abdeR0.js";import"./page-blog-DTt-yulm.js";const ue=1,me=1e6;let b=0;function xe(){return b=(b+1)%Number.MAX_SAFE_INTEGER,b.toString()}const w=new Map,$=r=>{if(w.has(r))return;const t=setTimeout(()=>{w.delete(r),f({type:"REMOVE_TOAST",toastId:r})},me);w.set(r,t)},he=(r,t)=>{switch(t.type){case"ADD_TOAST":return{...r,toasts:[t.toast,...r.toasts].slice(0,ue)};case"UPDATE_TOAST":return{...r,toasts:r.toasts.map(i=>i.id===t.toast.id?{...i,...t.toast}:i)};case"DISMISS_TOAST":{const{toastId:i}=t;return i?$(i):r.toasts.forEach(s=>{$(s.id)}),{...r,toasts:r.toasts.map(s=>s.id===i||i===void 0?{...s,open:!1}:s)}}case"REMOVE_TOAST":return t.toastId===void 0?{...r,toasts:[]}:{...r,toasts:r.toasts.filter(i=>i.id!==t.toastId)}}},y=[];let N={toasts:[]};function f(r){N=he(N,r),y.forEach(t=>{t(N)})}function pe({...r}){const t=xe(),i=x=>f({type:"UPDATE_TOAST",toast:{...x,id:t}}),s=()=>f({type:"DISMISS_TOAST",toastId:t});return f({type:"ADD_TOAST",toast:{...r,id:t,open:!0,onOpenChange:x=>{x||s()}}}),{id:t,dismiss:s,update:i}}function fe(){const[r,t]=l.useState(N);return l.useEffect(()=>(y.push(t),()=>{const i=y.indexOf(t);i>-1&&y.splice(i,1)}),[r]),{...r,toast:pe,dismiss:i=>f({type:"DISMISS_TOAST",toastId:i})}}function Ee(){var O;const{toast:r}=fe(),[t,i]=l.useState(""),[s,x]=l.useState(null),[_,U]=l.useState([]),[H,T]=l.useState(!0),[V,C]=l.useState(!1),[E,R]=l.useState(!1),[h,z]=l.useState("paypal"),[v,D]=l.useState("");l.useEffect(()=>{P()},[]);const P=async()=>{T(!0);try{const[a,o,p]=await Promise.all([n.getUserReferralCode(),n.getUserReferralStats(),n.getPayoutHistory()]);a&&i(a),o&&x(o),U(p)}catch(a){console.error("Error loading referral data:",a),r({title:"Error",description:"Failed to load referral data",variant:"destructive"})}finally{T(!1)}},k=()=>{if(!t)return;const a=n.getReferralLink(t);navigator.clipboard.writeText(a),r({title:"Copied!",description:"Referral link copied to clipboard"})},B=async()=>{if(!t)return;const a=n.getReferralLink(t);if(navigator.share)try{await navigator.share({title:"Join MealScrape!",text:"Check out this amazing recipe app! Use my referral link:",url:a})}catch{console.log("Share cancelled or failed")}else k()},Y=async()=>{if(!v.trim()){r({title:"Error",description:"Please enter your payout email",variant:"destructive"});return}R(!0);try{const a=await n.requestPayout(h,v);a.success?(r({title:"Payout Requested!",description:"Your payout request has been submitted and will be processed soon."}),C(!1),D(""),P()):r({title:"Error",description:a.error||"Failed to request payout",variant:"destructive"})}catch{r({title:"Error",description:"Failed to request payout",variant:"destructive"})}finally{R(!1)}},G=a=>{const o={pending:{variant:"secondary",icon:Z,label:"Pending"},processing:{variant:"default",icon:S,label:"Processing"},paid:{variant:"default",icon:I,label:"Paid"},failed:{variant:"destructive",icon:L,label:"Failed"},cancelled:{variant:"outline",icon:L,label:"Cancelled"}},p=o[a]||o.pending,J=p.icon;return e.jsxs(de,{variant:p.variant,className:"flex items-center gap-1",children:[e.jsx(J,{className:"h-3 w-3"}),p.label]})};return H?e.jsx("div",{className:"container mx-auto p-4 max-w-6xl",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx(S,{className:"h-8 w-8 animate-spin"})})}):e.jsxs("div",{className:"container mx-auto p-4 max-w-6xl space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"Referral Rewards"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Earn $5 for every 10 friends who join using your referral link!"})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-4",children:[e.jsxs(c,{className:"border-4 border-orange-500",children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"Total Referrals"}),e.jsx(K,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(m,{children:[e.jsx("div",{className:"text-2xl font-bold",children:(s==null?void 0:s.completed_referrals)||0}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[(s==null?void 0:s.pending_referrals)||0," pending"]})]})]}),e.jsxs(c,{className:"border-4 border-orange-500",children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"Unrewarded"}),e.jsx(X,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(m,{children:[e.jsx("div",{className:"text-2xl font-bold",children:(s==null?void 0:s.unrewarded_referrals)||0}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Next payout at ",(s==null?void 0:s.next_payout_at)||10]})]})]}),e.jsxs(c,{className:"border-4 border-orange-500",children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"Total Earned"}),e.jsx(A,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(m,{children:[e.jsxs("div",{className:"text-2xl font-bold",children:["$",((O=s==null?void 0:s.total_earned)==null?void 0:O.toFixed(2))||"0.00"]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[(s==null?void 0:s.rewards_claimed)||0," payouts claimed"]})]})]}),e.jsxs(c,{className:"border-4 border-orange-500",children:[e.jsxs(d,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(u,{className:"text-sm font-medium",children:"Next Reward"}),e.jsx(I,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(m,{children:[e.jsx("div",{className:"text-2xl font-bold",children:s!=null&&s.eligible_for_payout?"$5.00":"$0.00"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:s!=null&&s.eligible_for_payout?"Ready!":"Keep referring"})]})]})]}),e.jsxs(c,{className:"border-4 border-orange-500",children:[e.jsxs(d,{children:[e.jsx(u,{children:"Your Referral Link"}),e.jsx(M,{children:"Share this link with friends. You earn $5 for every 10 people who sign up!"})]}),e.jsxs(m,{className:"space-y-4",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(q,{readOnly:!0,value:t?n.getReferralLink(t):"Loading...",className:"font-mono"}),e.jsx(j,{onClick:k,variant:"outline",size:"icon",children:e.jsx(Q,{className:"h-4 w-4"})}),e.jsx(j,{onClick:B,variant:"outline",size:"icon",children:e.jsx(W,{className:"h-4 w-4"})})]}),e.jsxs(ee,{open:V,onOpenChange:C,children:[e.jsx(se,{asChild:!0,children:e.jsxs(j,{className:"w-full",disabled:!(s!=null&&s.eligible_for_payout),children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),"Request $5 Payout"]})}),e.jsxs(ae,{children:[e.jsxs(re,{children:[e.jsx(te,{children:"Request Payout"}),e.jsx(ie,{children:"Enter your payment details to receive your $5 reward"})]}),e.jsxs("div",{className:"space-y-4 pt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"payout-method",children:"Payment Method"}),e.jsxs(le,{value:h,onValueChange:z,children:[e.jsx(ne,{id:"payout-method",children:e.jsx(oe,{})}),e.jsxs(ce,{children:[e.jsx(g,{value:"paypal",children:"PayPal"}),e.jsx(g,{value:"venmo",children:"Venmo"}),e.jsx(g,{value:"cashapp",children:"Cash App"}),e.jsx(g,{value:"other",children:"Other"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(F,{htmlFor:"payout-email",children:"Email / Username"}),e.jsx(q,{id:"payout-email",type:"text",placeholder:"your@email.com or @username",value:v,onChange:a=>D(a.target.value)}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Enter your ",h==="paypal"?"PayPal email":h==="venmo"?"Venmo username":h==="cashapp"?"Cash App tag":"payment details"]})]}),e.jsx(j,{className:"w-full",onClick:Y,disabled:E,children:E?e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"h-4 w-4 mr-2 animate-spin"}),"Submitting..."]}):e.jsx(e.Fragment,{children:"Submit Request"})})]})]})]})]})]}),e.jsxs(c,{className:"border-4 border-orange-500",children:[e.jsxs(d,{children:[e.jsx(u,{children:"Payout History"}),e.jsx(M,{children:"Track all your referral payout requests"})]}),e.jsx(m,{children:_.length===0?e.jsx("div",{className:"text-center py-8 text-muted-foreground",children:"No payout history yet. Start referring friends to earn rewards!"}):e.jsx("div",{className:"space-y-4",children:_.map(a=>e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"font-medium",children:["$",a.reward_amount.toFixed(2)]}),G(a.payout_status)]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[a.payout_method&&e.jsx("span",{className:"capitalize",children:a.payout_method}),a.payout_email&&e.jsxs("span",{children:[" • ",a.payout_email]})]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Requested: ",new Date(a.requested_at).toLocaleDateString(),a.paid_at&&e.jsxs(e.Fragment,{children:[" • Paid: ",new Date(a.paid_at).toLocaleDateString()]})]}),a.failure_reason&&e.jsx("div",{className:"text-xs text-destructive",children:a.failure_reason})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:[a.referral_count," referrals"]})]},a.id))})})]})]})}export{Ee as default};
