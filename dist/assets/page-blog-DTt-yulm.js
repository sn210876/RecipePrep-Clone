import{ax as H,ay as J,r as n,j as e,az as K,aA as A,aB as E,aC as B,aD as Q,aE as L,aF as U,aG as z,n as G,aH as F,aI as V,aJ as R,aK as W,U as X,X as Y,a4 as Z,Q as ee,aL as te,a6 as se,aM as ae,aN as $,ap as re}from"./react-vendor-z9ssXL8w.js";import{f as b,D as oe,i as ne,j as ie,k as le,L as k,I as ce,B as f,T as de,v as me,w as ue,u as pe,s as T,C as _}from"./page-addrecipe-Pb6dTsbS.js";import{A as he,d as ge,e as xe}from"./page-adminpayouts-D8abdeR0.js";import{h as fe,j as be,k as je}from"./services-BpcRR5rK.js";import{u as p,b as ye}from"./vendor-Clj4czuh.js";const we=H,ve=J,Ne=n.forwardRef(({className:t,inset:a,children:r,...o},l)=>e.jsxs(B,{ref:l,className:b("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",a&&"pl-8",t),...o,children:[r,e.jsx(Q,{className:"ml-auto h-4 w-4"})]}));Ne.displayName=B.displayName;const Ce=n.forwardRef(({className:t,...a},r)=>e.jsx(L,{ref:r,className:b("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...a}));Ce.displayName=L.displayName;const O=n.forwardRef(({className:t,sideOffset:a=4,...r},o)=>e.jsx(K,{children:e.jsx(A,{ref:o,sideOffset:a,className:b("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",t),...r})}));O.displayName=A.displayName;const q=n.forwardRef(({className:t,inset:a,...r},o)=>e.jsx(E,{ref:o,className:b("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",a&&"pl-8",t),...r}));q.displayName=E.displayName;const Se=n.forwardRef(({className:t,children:a,checked:r,...o},l)=>e.jsxs(U,{ref:l,className:b("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),checked:r,...o,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(z,{children:e.jsx(G,{className:"h-4 w-4"})})}),a]}));Se.displayName=U.displayName;const Pe=n.forwardRef(({className:t,children:a,...r},o)=>e.jsxs(F,{ref:o,className:b("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",t),...r,children:[e.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:e.jsx(z,{children:e.jsx(V,{className:"h-4 w-4 fill-current"})})}),a]}));Pe.displayName=F.displayName;const ke=n.forwardRef(({className:t,inset:a,...r},o)=>e.jsx(R,{ref:o,className:b("px-2 py-1.5 text-sm font-semibold",a&&"pl-8",t),...r}));ke.displayName=R.displayName;const Me=n.forwardRef(({className:t,...a},r)=>e.jsx(W,{ref:r,className:b("-mx-1 my-1 h-px bg-muted",t),...a}));Me.displayName=W.displayName;function ze(t){return t.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"")}function Ie(t){const a=`${t.title} | MealScrape`,r=t.url||window.location.href,o=t.image||`${window.location.origin}/Woodenspoon.png`;document.title=a;const l={description:t.description,"og:title":a,"og:description":t.description,"og:image":o,"og:url":r,"og:type":t.type||"website","twitter:card":"summary_large_image","twitter:title":a,"twitter:description":t.description,"twitter:image":o};t.author&&(l.author=t.author),t.publishedTime&&(l["article:published_time"]=t.publishedTime),Object.entries(l).forEach(([g,h])=>{const x=g.startsWith("og:")||g.startsWith("article:")?"property":"name";let m=document.querySelector(`meta[${x}="${g}"]`);m||(m=document.createElement("meta"),m.setAttribute(x,g),document.head.appendChild(m)),m.setAttribute("content",h)});let c=document.querySelector('link[rel="canonical"]');c||(c=document.createElement("link"),c.setAttribute("rel","canonical"),document.head.appendChild(c)),c.setAttribute("href",r)}function Fe(t){const a={"@context":"https://schema.org","@type":"Article",headline:t.title,description:t.description,image:t.image||`${window.location.origin}/Woodenspoon.png`,author:{"@type":"Person",name:t.author,url:t.authorUrl},publisher:{"@type":"Organization",name:"MealScrape",logo:{"@type":"ImageObject",url:`${window.location.origin}/Woodenspoon.png`}},datePublished:t.publishedTime,dateModified:t.modifiedTime||t.publishedTime,mainEntityOfPage:{"@type":"WebPage","@id":t.url}};let r=document.querySelector('script[type="application/ld+json"]');r||(r=document.createElement("script"),r.setAttribute("type","application/ld+json"),document.head.appendChild(r)),r.textContent=JSON.stringify(a)}function Te(t,a){return t.length<=a?t:t.substring(0,a).trim()+"..."}function _e(t,a=200){const r=document.createElement("div");r.innerHTML=t;const o=r.textContent||r.innerText||"";return Te(o,a)}function De({open:t,onClose:a,onPostCreated:r}){const[o,l]=n.useState(""),[c,g]=n.useState(""),[h,x]=n.useState(null),[m,S]=n.useState(!1),[v,P]=n.useState(!1),[D,j]=n.useState(null),M=async s=>{var u;const i=(u=s.target.files)==null?void 0:u[0];if(i){if(!i.type.startsWith("image/")){p.error("Please select an image file");return}if(i.size>10*1024*1024){p.error("Image must be less than 10MB");return}S(!0);try{const d=await me(i,{maxSizeMB:.2,maxWidthOrHeight:1200,useWebWorker:!0,fileType:"image/jpeg",initialQuality:.85}),y=await ue(d.file,"blog-covers");x(y),j(d.file),p.success(`Cover image uploaded! (${Math.round(d.compressedSize/1024)}KB)`)}catch(d){console.error("Error uploading image:",d),p.error("Failed to upload image")}finally{S(!1)}}},I=async()=>{if(!o.trim()){p.error("Please enter a title");return}if(!c.trim()){p.error("Please enter some content");return}P(!0);try{const s=_e(c,200),i=await fe({title:o.trim(),content:{html:c},excerpt:s,cover_image:h||void 0});p.success("Post published!"),r(i.slug),N()}catch(s){console.error("Error creating post:",s),p.error("Failed to create post")}finally{P(!1)}},N=()=>{l(""),g(""),x(null),j(null),a()};return e.jsx(oe,{open:t,onOpenChange:N,children:e.jsxs(ne,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsx(ie,{children:e.jsx(le,{className:"text-2xl font-bold",children:"Create New Blog Post"})}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"title",children:"Title *"}),e.jsx(ce,{id:"title",placeholder:"Enter an engaging title...",value:o,onChange:s=>l(s.target.value),className:"text-lg"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"cover",children:"Cover Image"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(f,{type:"button",variant:"outline",className:"w-full",disabled:m,onClick:()=>{var s;return(s=document.getElementById("cover-upload"))==null?void 0:s.click()},children:[e.jsx(X,{className:"h-4 w-4 mr-2"}),m?"Uploading...":h?"Change Cover":"Upload Cover"]}),e.jsx("input",{id:"cover-upload",type:"file",accept:"image/*",className:"hidden",onChange:M})]}),h&&e.jsx("div",{className:"relative mt-2 flex justify-center",children:e.jsxs("div",{className:"relative w-full max-w-xs",children:[e.jsx("img",{src:h,alt:"Cover preview",className:"w-full aspect-square object-cover rounded-lg"}),e.jsx(f,{variant:"destructive",size:"sm",className:"absolute top-2 right-2",onClick:()=>{x(null),j(null)},children:e.jsx(Y,{className:"h-4 w-4"})})]})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"content",children:"Content *"}),e.jsx(de,{id:"content",placeholder:`Write your post content here... (Markdown supported)

**Bold text**
*Italic text*
[Link text](https://example.com)

- List item 1
- List item 2`,value:c,onChange:s=>g(s.target.value),className:"min-h-[300px] font-mono text-sm"}),e.jsx("p",{className:"text-xs text-gray-500",children:"Tip: Use markdown formatting for better readability"})]}),c&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{children:"Preview"}),e.jsx("div",{className:"border rounded-lg p-4 prose prose-sm max-w-none",children:e.jsx("div",{className:"whitespace-pre-wrap",dangerouslySetInnerHTML:{__html:c.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/\[(.*?)\]\((.*?)\)/g,'<a href="$2" class="text-orange-600 hover:underline" target="_blank" rel="noopener noreferrer">$1</a>').replace(new RegExp('(?<!href="|src=")(https?:\\/\\/[^\\s<]+)',"g"),'<a href="$1" class="text-orange-600 hover:underline" target="_blank" rel="noopener noreferrer">$1</a>').replace(/^- (.+)$/gm,"<li>$1</li>").replace(/(<li>.*<\/li>\n?)+/g,'<ul class="list-disc pl-4">$&</ul>').replace(/\n\n/g,'</p><p class="mt-2">').replace(/^(.+)$/,"<p>$1</p>")}})})]})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx(f,{variant:"outline",onClick:N,disabled:v,children:"Cancel"}),e.jsx(f,{onClick:I,disabled:v||!o.trim()||!c.trim(),children:v?"Publishing...":"Publish Post"})]})]})})}function $e({onNavigate:t}){const{user:a}=pe(),[r,o]=n.useState([]),[l,c]=n.useState(!0),[g,h]=n.useState(!1),[x,m]=n.useState(1),[S,v]=n.useState(!0),[P,D]=n.useState(!1);n.useEffect(()=>{Ie({title:"Blog & Discussion Board",description:"Join the MealScrape community. Share recipes, cooking tips, and food stories with fellow food enthusiasts.",type:"website"})},[]),n.useEffect(()=>{a&&T.from("profiles").select("is_admin").eq("id",a.id).single().then(({data:s})=>D((s==null?void 0:s.is_admin)===!0))},[a]),n.useEffect(()=>{j()},[x]),n.useEffect(()=>{const s=T.channel("blog-posts-changes").on("postgres_changes",{event:"INSERT",schema:"public",table:"blog_posts"},()=>{j(!0)}).subscribe();return()=>{T.removeChannel(s)}},[]);const j=async(s=!1)=>{try{const i=await be(s?1:x,20);if(s){const u=Array.from(new Map(i.map(d=>[d.id,d])).values());o(u),m(1)}else{const u=[...r,...i],d=Array.from(new Map(u.map(y=>[y.id,y])).values());o(d)}v(i.length===20)}catch(i){console.error("Error loading posts:",i),p.error("Failed to load posts")}finally{c(!1)}},M=s=>{t(`blog:${s}`)},I=s=>{t(`blog:${s}`)},N=async(s,i)=>{if(i.stopPropagation(),!!confirm("Are you sure you want to delete this post?"))try{await je(s),p.success("Post deleted successfully"),j(!0)}catch(u){console.error("Error deleting post:",u),p.error("Failed to delete post")}};return l&&r.length===0?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-white to-slate-50",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 pt-2 pb-8",children:e.jsx("div",{className:"space-y-6",children:[...Array(5)].map((s,i)=>e.jsxs(_,{className:"p-6 animate-pulse border-4 border-orange-500",children:[e.jsx("div",{className:"h-6 bg-gray-200 rounded w-3/4 mb-4"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-full mb-2"}),e.jsx("div",{className:"h-4 bg-gray-200 rounded w-2/3"})]},i))})})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-white to-slate-50",children:[e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("h1",{className:"text-2xl sm:text-4xl font-bold text-gray-900 mb-2 flex items-center justify-center gap-2",children:[e.jsx(Z,{className:"h-6 w-6 sm:h-8 sm:w-8 text-orange-500"}),"Blog & Discussions"]}),e.jsx("p",{className:"text-sm sm:text-base text-gray-600 mb-4 text-center",children:"Share your cooking stories with the community"}),a&&e.jsxs(f,{onClick:()=>h(!0),className:"w-full sm:w-auto bg-gradient-to-r from-orange-500 to-red-600 hover:from-orange-600 hover:to-red-700",children:[e.jsx(ee,{className:"h-4 w-4 mr-2"}),"New Post"]})]}),!a&&e.jsx(_,{className:"p-6 mb-6 bg-gradient-to-r from-orange-50 to-amber-50 border-4 border-orange-500",children:e.jsxs("p",{className:"text-center text-gray-700",children:[e.jsx("strong",{children:"Join the conversation!"})," Log in to create posts, comment, and vote."]})}),e.jsx("div",{className:"space-y-6",children:r.map(s=>{var i,u,d,y;return e.jsx(_,{className:"p-6 hover:shadow-lg transition-shadow cursor-pointer border-4 border-orange-500",onClick:()=>I(s.slug),children:e.jsxs("div",{className:"flex gap-4",children:[s.cover_image&&e.jsx("div",{className:"flex-shrink-0 w-32 h-32 rounded-lg overflow-hidden",children:e.jsx("img",{src:s.cover_image,alt:s.title,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-2",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 hover:text-orange-600 transition-colors flex-1",children:s.title}),((a==null?void 0:a.id)===s.user_id||P)&&e.jsxs(we,{children:[e.jsx(ve,{asChild:!0,onClick:w=>w.stopPropagation(),children:e.jsx(f,{variant:"ghost",size:"sm",className:"h-8 w-8 p-0",children:e.jsx(te,{className:"h-4 w-4"})})}),e.jsx(O,{align:"end",children:e.jsxs(q,{onClick:w=>N(s.id,w),className:"text-red-600 focus:text-red-600",children:[e.jsx(se,{className:"h-4 w-4 mr-2"}),"Delete Post"]})})]})]}),s.excerpt&&e.jsx("p",{className:"text-gray-600 mb-3 line-clamp-2",children:s.excerpt}),e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsxs(he,{className:"h-6 w-6 cursor-pointer",onClick:w=>{var C;w.stopPropagation(),(C=s.author)!=null&&C.username&&t(`profile:${s.author.username}`)},children:[e.jsx(ge,{src:((i=s.author)==null?void 0:i.avatar_url)||void 0}),e.jsx(xe,{children:((d=(u=s.author)==null?void 0:u.username)==null?void 0:d.charAt(0).toUpperCase())||"U"})]}),e.jsx("button",{onClick:w=>{var C;w.stopPropagation(),(C=s.author)!=null&&C.username&&t(`profile:${s.author.username}`)},className:"text-sm font-medium text-gray-700 hover:text-orange-600 hover:underline cursor-pointer transition-colors",children:((y=s.author)==null?void 0:y.username)||"Anonymous"}),e.jsx("span",{className:"text-sm text-gray-500",children:ye(new Date(s.created_at),{addSuffix:!0})})]}),e.jsxs("div",{className:"flex items-center gap-4 text-sm text-gray-500",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(ae,{className:"h-4 w-4"}),s.like_count||0]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx($,{className:"h-4 w-4"}),s.comment_count||0]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(re,{className:"h-4 w-4"}),s.views||0]})]})]})]})},s.id)})}),S&&e.jsx("div",{className:"text-center mt-8",children:e.jsx(f,{variant:"outline",onClick:()=>m(s=>s+1),disabled:l,children:l?"Loading...":"Load More"})}),r.length===0&&!l&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx($,{className:"h-16 w-16 text-gray-300 mx-auto mb-4"}),e.jsx("h3",{className:"text-xl font-semibold text-gray-900 mb-2",children:"No posts yet"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Be the first to share something!"}),a&&e.jsx(f,{onClick:()=>h(!0),children:"Create First Post"})]})]}),e.jsx(De,{open:g,onClose:()=>h(!1),onPostCreated:M})]})}const Re=Object.freeze(Object.defineProperty({__proto__:null,Blog:$e},Symbol.toStringTag,{value:"Module"}));export{Re as B,we as D,ve as a,O as b,q as c,ze as d,Fe as g,Ie as s};
