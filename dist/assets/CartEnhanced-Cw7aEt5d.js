import{r as x,s as g,f as n,j as e,C as b,t as re,v as te,B as h,S as F,m as j,I,z as $}from"./index-CszYBrAc.js";import{S as oe,a as ne,b as ie,c as le,d as M}from"./select-Aq1vXrLK.js";import{B}from"./badge-CmO85WUZ.js";import{g as ce,s as de,d as me,a as w,c as xe}from"./amazonProductService-F6ZpEDeC.js";import{S as he}from"./search-CNFZqBbl.js";import{P as U}from"./package-CqXo43dc.js";import{E as L}from"./external-link-CqVywin7.js";import{M as ue}from"./minus-CUIdhV7G.js";import{T as ge}from"./trash-2-BS36MvRs.js";import{C as pe}from"./credit-card-DTyzDlJg.js";import"./react-icons.esm-BWhy9aFv.js";import"./index-CPFPrqsW.js";import"./index-BdQq_4o_.js";import"./index-Cvn5MteN.js";import"./index-JfGWjFaP.js";import"./index-3lgl-fBe.js";import"./index-BUU1IXpw.js";import"./index-CWDofaGI.js";import"./index-BKvbpLp9.js";function O(){const t=navigator.userAgent||navigator.vendor||window.opera||"",d=/iPad|iPhone|iPod/.test(t)&&!window.MSStream,i=/android/i.test(t),y=/(tablet|ipad|playbook|silk)|(android(?!.*mobi))/i.test(t),_=(d||i)&&!y;let m="unknown";/chrome|chromium|crios/i.test(t)?m="chrome":/firefox|fxios/i.test(t)?m="firefox":/safari/i.test(t)&&!/chrome/i.test(t)?m="safari":/edg/i.test(t)?m="edge":/samsung/i.test(t)&&(m="samsung");let u="unknown";return d?u="ios":i?u="android":/windows/i.test(t)?u="windows":/mac/i.test(t)?u="macos":/linux/i.test(t)&&(u="linux"),{isMobile:_,isIOS:d,isAndroid:i,isTablet:y,browser:m,os:u}}function N(t){if(O().isMobile){const i=document.createElement("a");i.href=t,i.target="_blank",i.rel="noopener noreferrer",i.style.display="none",document.body.appendChild(i),i.click(),setTimeout(()=>{document.body.removeChild(i)},100)}else window.open(t,"_blank","noopener,noreferrer")}function $e({onNavigate:t}={}){const[d,i]=x.useState([]),[y,_]=x.useState(!0),[m,u]=x.useState(null),[R,Q]=x.useState([]),[S,V]=x.useState([]),[p,D]=x.useState("all"),[v,Y]=x.useState(""),[G,A]=x.useState(!1),[C,H]=x.useState(!0),P=x.useRef(null),W=()=>{var s;(s=P.current)==null||s.scrollIntoView({behavior:"smooth",block:"start"})};x.useEffect(()=>{E(),J(),q()},[]),x.useEffect(()=>{q()},[p,v]);const E=async()=>{try{const{data:s}=await g.auth.getUser();if(!s.user)return;u(s.user.id);const{data:a,error:r}=await g.from("cart_items").select("*").eq("user_id",s.user.id).order("created_at",{ascending:!1});if(r)throw r;i(a||[])}catch(s){console.error("Error loading cart:",s),n.error("Failed to load cart")}finally{_(!1)}},J=async()=>{try{const s=await ce();Q(s)}catch(s){console.error("Error loading categories:",s)}},q=async()=>{A(!0);try{let s;if(v.trim())s=await de(v,p==="all"?void 0:p);else if(p!=="all")s=await me(p);else{const{data:a,error:r}=await g.from("amazon_products").select("*").eq("is_active",!0).order("popularity_score",{ascending:!1}).limit(16);if(r)throw r;s=a||[]}V(s)}catch(s){console.error("Error loading products:",s),n.error("Failed to load products")}finally{A(!1)}},K=async s=>{if(!m){n.error("Please sign in to add items to cart");return}try{await xe(m,s,"1",s.package_size||""),await E(),n.success(`Added ${s.product_name} to cart`)}catch(a){console.error("Error adding to cart:",a),n.error("Failed to add item to cart")}},k=async(s,a)=>{try{const{error:r}=await g.from("cart_items").update({quantity:a}).eq("id",s);if(r)throw r;i(l=>l.map(o=>o.id===s?{...o,quantity:a}:o)),n.success("Quantity updated")}catch(r){console.error("Error updating quantity:",r),n.error("Failed to update quantity")}},X=async s=>{try{const{error:a}=await g.from("cart_items").delete().eq("id",s);if(a)throw a;i(r=>r.filter(l=>l.id!==s)),n.success("Item removed from cart")}catch(a){console.error("Error removing item:",a),n.error("Failed to remove item")}},Z=async()=>{if(m&&confirm("Are you sure you want to clear your entire cart?"))try{const{error:s}=await g.from("cart_items").delete().eq("user_id",m);if(s)throw s;i([]),n.success("Cart cleared")}catch(s){console.error("Error clearing cart:",s),n.error("Failed to clear cart")}},T=()=>d.reduce((s,a)=>{const r=a.price||0,l=parseFloat(a.quantity)||1;return s+r*l},0),ee=async()=>{if(d.length===0){n.error("Your cart is empty");return}const s=O(),a=d.filter(o=>o.asin),r=d.filter(o=>!o.asin&&o.amazon_product_url),l=s.isMobile?"mobile_browser_forced":"desktop_cart_api";if(m&&await ae(l,s),s.isMobile){a.length>0&&n.info("Opening items in browser for best affiliate tracking...");const o=[...a.map(c=>({url:`https://www.amazon.com/dp/${c.asin}`,name:c.amazon_product_name||c.ingredient_name})),...r.map(c=>({url:c.amazon_product_url,name:c.amazon_product_name||c.ingredient_name}))];o.forEach((c,f)=>{setTimeout(()=>{const z=w(c.url,{mobile:!0,source:"mobile_cart"});N(z)},f*400)}),n.success(`Opening ${o.length} items in browser to preserve affiliate tracking`)}else if(a.length>0){const o=se(a);N(o),r.length>0?(n.success(`Added ${a.length} items to Amazon cart. Opening ${r.length} additional items...`),r.forEach((c,f)=>{setTimeout(()=>{N(w(c.amazon_product_url,{mobile:!1}))},(f+1)*300)})):n.success(`Added ${a.length} items to Amazon cart!`)}else r.length>0?(r.forEach((o,c)=>{setTimeout(()=>{N(w(o.amazon_product_url,{mobile:!1}))},c*300)}),n.success("Opening Amazon product pages...")):n.error("No Amazon products in cart")},se=s=>{const a="mealscrape-20",r="https://www.amazon.com/gp/aws/cart/add.html",l=new URLSearchParams;return s.forEach((o,c)=>{const f=c+1;l.append(`ASIN.${f}`,o.asin);const z=parseInt(o.quantity)||1;l.append(`Quantity.${f}`,z.toString())}),l.append("tag",a),l.append("linkCode","ll1"),l.append("ref","nosim"),l.append("utm_source","mealscrape"),l.append("utm_medium","web_cart"),`${r}?${l.toString()}`},ae=async(s,a)=>{try{await g.from("amazon_service_clicks").insert({user_id:m,service_type:"amazon",clicked_at:new Date().toISOString(),item_count:d.length,estimated_value:T(),checkout_method:s,device_type:a.isMobile?"mobile":"desktop",os:a.os,browser:a.browser})}catch(r){console.error("Error tracking checkout:",r)}};return y?e.jsx("div",{className:"flex items-center justify-center h-screen bg-gradient-to-br from-slate-50 via-white to-orange-50",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-orange-600"})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-white to-orange-50 pb-32",children:e.jsxs("div",{className:"max-w-7xl mx-auto p-4 md:p-6",children:[e.jsxs(b,{className:"mb-6 border-4 border-orange-500",children:[e.jsx(re,{className:"bg-gradient-to-r from-orange-50 to-amber-50 text-center",children:e.jsxs("div",{children:[e.jsx(te,{className:"text-lg sm:text-xl mb-2",children:"Amazon Product Catalog"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Browse and add pantry staples to your cart"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-2 justify-center",children:[e.jsxs(h,{variant:"outline",size:"sm",onClick:()=>H(!C),className:"w-full sm:w-auto",children:[C?"Hide":"Show"," Catalog"]}),e.jsxs(h,{variant:"outline",size:"sm",onClick:W,className:"w-full sm:w-auto bg-orange-50 hover:bg-orange-100 border-orange-300",children:[e.jsx(F,{className:"w-4 h-4 mr-2"}),"Show Cart"]})]})]})}),C&&e.jsxs(j,{className:"pt-6",children:[e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(he,{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx(I,{type:"text",placeholder:"Search products...",value:v,onChange:s=>Y(s.target.value),className:"pl-10 h-12"})]}),e.jsxs(oe,{value:p,onValueChange:D,children:[e.jsx(ne,{className:"h-12",children:e.jsx(ie,{placeholder:"All Categories"})}),e.jsxs(le,{children:[e.jsx(M,{value:"all",children:"All Categories"}),R.map(s=>e.jsx(M,{value:s.id,children:e.jsxs("span",{className:"flex items-center gap-2",children:[e.jsx("span",{children:s.icon}),e.jsx("span",{children:s.name})]})},s.id))]})]})]}),G?e.jsx("div",{className:"flex justify-center py-12",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-orange-600"})}):S.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx(U,{className:"w-12 h-12 mx-auto mb-3 text-gray-300"}),e.jsx("p",{children:"No products found. Try a different search or category."})]}):e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4",children:S.map(s=>e.jsxs(b,{className:"overflow-hidden hover:shadow-lg transition-shadow group border-4 border-orange-500",children:[e.jsx("div",{className:"aspect-square bg-gray-100 flex items-center justify-center p-4",children:s.image_url?e.jsx("img",{src:s.image_url,alt:s.product_name,className:"w-full h-full object-contain",loading:"lazy",decoding:"async"}):e.jsx(U,{className:"w-16 h-16 text-gray-300"})}),e.jsxs(j,{className:"p-3",children:[e.jsx("h3",{className:"font-semibold text-sm line-clamp-2 mb-1 min-h-[2.5rem]",children:s.product_name}),s.brand&&e.jsx("p",{className:"text-xs text-gray-500 mb-2",children:s.brand}),s.package_size&&e.jsx(B,{variant:"secondary",className:"text-xs mb-2",children:s.package_size}),s.price&&e.jsxs("p",{className:"text-lg font-bold text-orange-600 mb-2",children:["$",s.price.toFixed(2)]}),s.is_prime&&e.jsx(B,{className:"bg-blue-500 text-white text-xs mb-2",children:"Prime"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(h,{size:"sm",className:"flex-1 bg-orange-500 hover:bg-orange-600 text-white",onClick:()=>K(s),children:[e.jsx($,{className:"w-4 h-4 mr-1"}),"Add"]}),e.jsx(h,{size:"sm",variant:"outline",asChild:!0,children:e.jsx("a",{href:w(s.amazon_url),target:"_blank",rel:"noopener noreferrer",children:e.jsx(L,{className:"w-4 h-4"})})})]})]})]},s.id))})]})]}),e.jsx("div",{ref:P,children:d.length===0?e.jsx(b,{className:"w-full max-w-sm mx-auto border-4 border-orange-500",children:e.jsxs(j,{className:"flex flex-col items-center justify-center py-12 px-6",children:[e.jsx(F,{className:"w-16 h-16 text-gray-300 mb-4"}),e.jsx("p",{className:"text-gray-500 text-center mb-4 text-sm md:text-base",children:"Your cart is empty. Browse products above or add items from your meal planner!"}),e.jsx(h,{onClick:()=>t==null?void 0:t("meal-planner"),className:"bg-orange-600 hover:bg-orange-700 text-white",children:"Go to Meal Planner"})]})}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Your Cart"}),e.jsx(h,{variant:"outline",size:"sm",onClick:Z,className:"text-xs md:text-sm border-red-500 text-red-600 hover:bg-red-50 hover:text-red-700 hover:border-red-600",children:"Clear All"})]}),e.jsx("div",{className:"space-y-3 md:space-y-4 mb-6",children:d.map(s=>e.jsx(b,{className:"overflow-hidden hover:shadow-md transition-shadow border-4 border-orange-500",children:e.jsx(j,{className:"p-3 md:p-4",children:e.jsxs("div",{className:"flex gap-3 md:gap-4",children:[s.image_url&&e.jsx("div",{className:"shrink-0",children:e.jsx("img",{src:s.image_url,alt:s.amazon_product_name||s.ingredient_name,className:"w-20 h-20 md:w-24 md:h-24 object-cover rounded-lg bg-slate-100",loading:"lazy",decoding:"async"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"font-semibold text-sm md:text-lg text-slate-900 line-clamp-2 mb-1",children:s.amazon_product_name||s.ingredient_name}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 bg-slate-100 rounded-lg w-fit p-1",children:[e.jsx(h,{size:"sm",variant:"ghost",onClick:()=>{const a=parseFloat(s.quantity)||1;a>1&&k(s.id,(a-1).toString())},className:"h-7 w-7 p-0 hover:bg-slate-200",children:e.jsx(ue,{className:"w-3 h-3"})}),e.jsx(I,{type:"text",value:s.quantity,onChange:a=>k(s.id,a.target.value),className:"w-12 md:w-16 text-center text-sm h-7 border-0 bg-transparent"}),e.jsx(h,{size:"sm",variant:"ghost",onClick:()=>{const a=parseFloat(s.quantity)||1;k(s.id,(a+1).toString())},className:"h-7 w-7 p-0 hover:bg-slate-200",children:e.jsx($,{className:"w-3 h-3"})})]}),e.jsx("span",{className:"text-xs md:text-sm text-gray-600",children:s.unit})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2 justify-between",children:[s.price&&e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:"text-sm md:text-lg font-semibold text-orange-600",children:["$",(s.price*(parseFloat(s.quantity)||1)).toFixed(2)]}),e.jsxs("div",{className:"text-xs text-gray-500",children:["$",s.price.toFixed(2)," each"]})]}),e.jsxs("div",{className:"flex gap-1 flex-col",children:[s.amazon_product_url&&e.jsxs("a",{href:w(s.amazon_product_url),target:"_blank",rel:"noopener noreferrer",className:"flex items-center justify-center gap-1 text-xs md:text-sm text-blue-600 hover:text-blue-800 hover:bg-blue-50 rounded px-2 py-1 transition-colors",children:[e.jsx(L,{className:"w-3 h-3"}),e.jsx("span",{className:"hidden sm:inline",children:"View"})]}),e.jsxs(h,{size:"sm",variant:"ghost",onClick:()=>X(s.id),className:"text-red-600 hover:text-red-700 hover:bg-red-50 text-xs md:text-sm h-7 px-2",children:[e.jsx(ge,{className:"w-3 h-3 md:w-4 md:h-4 mr-1"}),e.jsx("span",{className:"hidden sm:inline",children:"Remove"})]})]})]})]})})},s.id))}),e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsx(b,{className:"mb-4 bg-slate-50 border-4 border-orange-500",children:e.jsx(j,{className:"p-4 md:p-6",children:e.jsxs("div",{className:"space-y-2 text-sm md:text-base",children:[e.jsxs("div",{className:"flex justify-between text-slate-700",children:[e.jsxs("span",{children:["Subtotal (",d.length," items)"]}),e.jsxs("span",{className:"font-medium",children:["$",T().toFixed(2)]})]}),e.jsx("div",{className:"flex justify-between text-slate-600 text-xs md:text-sm",children:e.jsx("span",{children:"Prices from Amazon â€¢ Shipping & taxes calculated at checkout"})})]})})}),e.jsx("div",{className:"fixed bottom-[80px] lg:relative lg:bottom-0 left-0 right-0 z-[150] lg:z-10 pointer-events-none",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 py-3 pointer-events-auto flex flex-col items-center",children:[e.jsxs(h,{className:"w-auto bg-gradient-to-r from-orange-600 to-red-600 hover:from-orange-700 hover:to-red-700 text-white font-semibold h-12 md:h-14 shadow-lg rounded-full transition-all transform active:scale-95 px-6",size:"lg",onClick:ee,children:[e.jsx(pe,{className:"w-5 h-5 mr-2"}),"Send To Amazon Cart"]}),e.jsx("p",{className:"text-xs text-center text-gray-500 mt-2"})]})})]})]})})]})})}export{$e as Cart};
