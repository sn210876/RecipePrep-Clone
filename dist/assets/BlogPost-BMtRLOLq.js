import{c as M,a as T,r as o,s as L,j as e,B as n,aa as U,f as l}from"./index-RGevgwjF.js";import{T as R}from"./textarea-CnwKZdsq.js";import{A as V,a as z,b as q,E as O}from"./avatar-BSlstRtK.js";import{S as J}from"./separator-CM6c2Ye3.js";import{D as W,a as G,b as K,c as Q}from"./dropdown-menu-BvvK_LCr.js";import{f as F,v as X,a as Y,b as I,s as Z,h as ee,i as se,j as re,t as te}from"./blogService-ljgM8adp.js";import{E as ae}from"./ellipsis-vertical-CorHMKbX.js";import{T as oe}from"./trash-2-DWyej3uh.js";import{A as le}from"./arrow-left-CpzMF15a.js";import{H as ie}from"./heart-C7eJqSIc.js";import{S as ne}from"./share-2-CiKAOrw1.js";import"./index-DhQPTewI.js";import"./index-BVKgznXt.js";import"./react-icons.esm-DqgUiC3K.js";import"./index-DiTSLmcl.js";import"./index-JJzPj6J5.js";import"./index-BDlrHxGN.js";import"./index-iak_7qCj.js";import"./index-CbwlRqvT.js";import"./index-DQcHIW_f.js";import"./en-US-wfBU2YNu.js";/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=M("ArrowDown",[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=M("ArrowUp",[["path",{d:"m5 12 7-7 7 7",key:"hav0vg"}],["path",{d:"M12 19V5",key:"x0mq9r"}]]);function H({comment:t,postId:c,onCommentAdded:p,depth:s=0,onNavigate:m}){var $;const{user:i}=T(),[S,v]=o.useState(!1),[j,u]=o.useState(""),[w,N]=o.useState(!1),[d,h]=o.useState(t.vote_score||0),[x,g]=o.useState(t.user_vote),[C,k]=o.useState(!1);o.useEffect(()=>{i&&L.from("profiles").select("is_admin").eq("id",i.id).single().then(({data:a})=>k((a==null?void 0:a.is_admin)===!0))},[i]);const f=async a=>{if(!i){l.error("Please log in to vote");return}try{const y=x===a,A=x;y?(g(null),h(d+(a==="up"?-1:1))):(g(a),h(A?d+(a==="up"?2:-2):d+(a==="up"?1:-1))),await X(t.id,a)}catch(y){console.error("Error voting:",y),g(t.user_vote),h(t.vote_score||0),l.error("Failed to vote")}},E=async()=>{if(!i){l.error("Please log in to comment");return}if(!j.trim()){l.error("Comment cannot be empty");return}N(!0);try{await I(c,j,t.id),u(""),v(!1),l.success("Reply posted!"),p()}catch(a){console.error("Error posting reply:",a),l.error("Failed to post reply")}finally{N(!1)}},P=async()=>{if(confirm("Are you sure you want to delete this comment?"))try{await Y(t.id),l.success("Comment deleted successfully"),p()}catch(a){console.error("Error deleting comment:",a),l.error("Failed to delete comment")}},_=s<5;return e.jsx("div",{className:`${s>0?"ml-8 mt-4":"mt-4"}`,children:e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("div",{className:"flex flex-col items-center gap-1 pt-1",children:[e.jsx(n,{variant:"ghost",size:"sm",className:`h-6 w-6 p-0 ${x==="up"?"text-orange-500":"text-gray-400"}`,onClick:()=>f("up"),children:e.jsx(me,{className:"h-4 w-4"})}),e.jsx("span",{className:`text-xs font-medium ${d>0?"text-orange-500":d<0?"text-blue-500":"text-gray-500"}`,children:d}),e.jsx(n,{variant:"ghost",size:"sm",className:`h-6 w-6 p-0 ${x==="down"?"text-blue-500":"text-gray-400"}`,onClick:()=>f("down"),children:e.jsx(ce,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs(V,{className:"h-6 w-6 cursor-pointer",onClick:()=>t.author.username&&(m==null?void 0:m(`profile:${t.author.username}`)),children:[e.jsx(z,{src:t.author.avatar_url||void 0}),e.jsx(q,{children:(($=t.author.username)==null?void 0:$.charAt(0).toUpperCase())||"U"})]}),e.jsx("button",{onClick:()=>t.author.username&&(m==null?void 0:m(`profile:${t.author.username}`)),className:"text-sm font-medium text-gray-900 hover:text-orange-600 hover:underline cursor-pointer transition-colors",children:t.author.username||"Anonymous"}),e.jsx("span",{className:"text-xs text-gray-500",children:F(new Date(t.created_at),{addSuffix:!0})}),((i==null?void 0:i.id)===t.user_id||C)&&e.jsxs(W,{children:[e.jsx(G,{asChild:!0,children:e.jsx(n,{variant:"ghost",size:"sm",className:"h-6 w-6 p-0 ml-auto",children:e.jsx(ae,{className:"h-3 w-3"})})}),e.jsx(K,{align:"end",children:e.jsxs(Q,{onClick:P,className:"text-red-600 focus:text-red-600",children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"Delete Comment"]})})]})]}),e.jsx("p",{className:"text-sm text-gray-700 mb-2 whitespace-pre-wrap",children:t.content}),e.jsx("div",{className:"flex items-center gap-2",children:_&&e.jsxs(n,{variant:"ghost",size:"sm",className:"h-7 px-2 text-xs",onClick:()=>v(!S),children:[e.jsx(U,{className:"h-3 w-3 mr-1"}),"Reply"]})}),S&&e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx(R,{placeholder:"Write a reply...",value:j,onChange:a=>u(a.target.value),className:"min-h-[80px] text-sm"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(n,{size:"sm",onClick:E,disabled:w||!j.trim(),children:w?"Posting...":"Post Reply"}),e.jsx(n,{size:"sm",variant:"ghost",onClick:()=>{v(!1),u("")},children:"Cancel"})]})]}),t.replies&&t.replies.length>0&&e.jsx("div",{className:"mt-2",children:t.replies.map(a=>e.jsx(H,{comment:a,postId:c,onCommentAdded:p,depth:s+1,onNavigate:m},a.id))})]})]})})}function Le({slug:t,onNavigate:c}){var a,y,A,D;const{user:p}=T(),[s,m]=o.useState(null),[i,S]=o.useState([]),[v,j]=o.useState(!0),[u,w]=o.useState(""),[N,d]=o.useState(!1),[h,x]=o.useState(!1),[g,C]=o.useState(0);o.useEffect(()=>{k()},[t]),o.useEffect(()=>{var r,b;s&&(Z({title:s.title,description:s.excerpt||"Read this post on MealScrape",image:s.cover_image||void 0,url:`${window.location.origin}/blog/${s.slug}`,type:"article",author:((r=s.author)==null?void 0:r.username)||"MealScrape User",publishedTime:s.created_at}),ee({title:s.title,description:s.excerpt||"",image:s.cover_image||void 0,author:((b=s.author)==null?void 0:b.username)||"MealScrape User",authorUrl:s.author?`${window.location.origin}/${s.author.username}`:void 0,publishedTime:s.created_at,modifiedTime:s.updated_at,url:`${window.location.origin}/blog/${s.slug}`}))},[s]),o.useEffect(()=>{if(!s)return;const r=L.channel(`blog-post-${s.id}`).on("postgres_changes",{event:"*",schema:"public",table:"blog_comments",filter:`post_id=eq.${s.id}`},()=>{f()}).on("postgres_changes",{event:"*",schema:"public",table:"blog_likes",filter:`post_id=eq.${s.id}`},()=>{k()}).subscribe();return()=>{L.removeChannel(r)}},[s==null?void 0:s.id]);const k=async()=>{try{const r=await se(t);if(!r){l.error("Post not found"),c("blog");return}m(r),x(r.user_has_liked||!1),C(r.like_count||0),f()}catch(r){console.error("Error loading post:",r),l.error("Failed to load post")}finally{j(!1)}},f=async()=>{if(s)try{const r=await re(s.id);S(r)}catch(r){console.error("Error loading comments:",r)}},E=async()=>{if(!p){l.error("Please log in to like posts");return}if(!s)return;const r=h;x(!h),C(g+(r?-1:1));try{await te(s.id)}catch(b){console.error("Error toggling like:",b),x(r),C(g),l.error("Failed to like post")}},P=async()=>{if(!p){l.error("Please log in to comment");return}if(s){if(!u.trim()){l.error("Comment cannot be empty");return}d(!0);try{await I(s.id,u),w(""),l.success("Comment posted!"),f()}catch(r){console.error("Error posting comment:",r),l.error("Failed to post comment")}finally{d(!1)}}},B=async()=>{if(!s)return;const r=`${window.location.origin}/blog/${s.slug}`;if(navigator.share)try{await navigator.share({title:s.title,text:s.excerpt||s.title,url:r})}catch(b){b.name!=="AbortError"&&_(r)}else _(r)},_=r=>{navigator.clipboard.writeText(r),l.success("Link copied to clipboard!")};if(v)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-white to-slate-50",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 pt-2 pb-8",children:e.jsxs("div",{className:"animate-pulse space-y-6",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4"}),e.jsx("div",{className:"h-12 bg-gray-200 rounded w-3/4"}),e.jsx("div",{className:"h-64 bg-gray-200 rounded"})]})})});if(!s)return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-white to-slate-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Post not found"}),e.jsx(n,{onClick:()=>c("blog"),children:"Back to Blog"})]})});const $=r=>typeof r=="string"?r:r.html?e.jsx("div",{className:"prose prose-lg max-w-none",dangerouslySetInnerHTML:{__html:r.html.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/\[(.*?)\]\((.*?)\)/g,'<a href="$2" class="text-orange-600 hover:underline" target="_blank" rel="noopener noreferrer">$1</a>').replace(new RegExp('(?<!href="|src=")(https?:\\/\\/[^\\s<]+)',"g"),'<a href="$1" class="text-orange-600 hover:underline" target="_blank" rel="noopener noreferrer">$1</a>').replace(/^- (.+)$/gm,"<li>$1</li>").replace(/(<li>.*<\/li>\n?)+/g,'<ul class="list-disc pl-4 my-4">$&</ul>').replace(/\n\n/g,'</p><p class="mt-4">').replace(/^(.+)$/,"<p>$1</p>")}}):JSON.stringify(r);return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-white to-slate-50",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 pt-2 pb-8",children:[e.jsxs(n,{variant:"ghost",onClick:()=>c("blog"),className:"mb-6",children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),"Back to Blog"]}),e.jsxs("article",{children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-gray-900 mb-6",children:s.title}),e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(V,{className:"h-10 w-10 cursor-pointer",onClick:()=>{var r;return((r=s.author)==null?void 0:r.username)&&c(`profile:${s.author.username}`)},children:[e.jsx(z,{src:((a=s.author)==null?void 0:a.avatar_url)||void 0}),e.jsx(q,{children:((A=(y=s.author)==null?void 0:y.username)==null?void 0:A.charAt(0).toUpperCase())||"U"})]}),e.jsxs("div",{children:[e.jsx("button",{onClick:()=>{var r;return((r=s.author)==null?void 0:r.username)&&c(`profile:${s.author.username}`)},className:"font-medium text-gray-900 hover:text-orange-600 hover:underline cursor-pointer transition-colors",children:((D=s.author)==null?void 0:D.username)||"Anonymous"}),e.jsx("p",{className:"text-sm text-gray-500",children:F(new Date(s.created_at),{addSuffix:!0})})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(n,{variant:"ghost",size:"sm",onClick:E,className:h?"text-red-500":"",children:[e.jsx(ie,{className:`h-5 w-5 mr-1 ${h?"fill-red-500":""}`}),g]}),e.jsxs(n,{variant:"ghost",size:"sm",onClick:B,children:[e.jsx(ne,{className:"h-5 w-5 mr-1"}),"Share"]})]})]}),s.cover_image&&e.jsx("div",{className:"flex justify-center mb-8",children:e.jsx("img",{src:s.cover_image,alt:s.title,className:"w-full max-w-md aspect-square object-cover rounded-xl shadow-lg"})}),e.jsx("div",{className:"prose prose-lg max-w-none mb-8",children:$(s.content)}),e.jsxs("div",{className:"flex items-center gap-6 text-sm text-gray-500 mb-8",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(O,{className:"h-4 w-4"}),s.views," views"]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(U,{className:"h-4 w-4"}),i.length," comments"]})]}),e.jsx(J,{className:"my-8"}),e.jsxs("div",{className:"mt-8",children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900 mb-6",children:["Comments (",i.length,")"]}),p?e.jsxs("div",{className:"mb-8 space-y-3",children:[e.jsx(R,{placeholder:"Share your thoughts...",value:u,onChange:r=>w(r.target.value),className:"min-h-[100px]"}),e.jsx(n,{onClick:P,disabled:N||!u.trim(),children:N?"Posting...":"Post Comment"})]}):e.jsx("div",{className:"mb-8 p-4 bg-gray-50 rounded-lg text-center",children:e.jsx("p",{className:"text-gray-600",children:"Please log in to leave a comment"})}),e.jsxs("div",{className:"space-y-4",children:[i.map(r=>e.jsx(H,{comment:r,postId:s.id,onCommentAdded:f,onNavigate:c},r.id)),i.length===0&&e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No comments yet. Be the first to comment!"})]})]})]})]})})}export{Le as BlogPostPage};
