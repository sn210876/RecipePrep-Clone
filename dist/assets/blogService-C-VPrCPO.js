import{t as l,c as q,g as v,e as D,a as y,d as M,f as p}from"./en-US-wfBU2YNu.js";import{s as i}from"./index-CFcEIvk0.js";function w(e,t){const o=l(e),r=l(t),n=o.getTime()-r.getTime();return n<0?-1:n>0?1:n}function x(e){return q(e,Date.now())}function S(e,t){const o=l(e),r=l(t),n=o.getFullYear()-r.getFullYear(),a=o.getMonth()-r.getMonth();return n*12+a}function k(e){return t=>{const r=(e?Math[e]:Math.trunc)(t);return r===0?0:r}}function T(e,t){return+l(e)-+l(t)}function C(e){const t=l(e);return t.setHours(23,59,59,999),t}function E(e){const t=l(e),o=t.getMonth();return t.setFullYear(t.getFullYear(),o+1,0),t.setHours(23,59,59,999),t}function O(e){const t=l(e);return+C(t)==+E(t)}function N(e,t){const o=l(e),r=l(t),n=w(o,r),a=Math.abs(S(o,r));let c;if(a<1)c=0;else{o.getMonth()===1&&o.getDate()>27&&o.setDate(30),o.setMonth(o.getMonth()-n*a);let s=w(o,r)===-n;O(l(e))&&a===1&&w(e,r)===1&&(s=!1),c=n*(a-Number(s))}return c===0?0:c}function P(e,t,o){const r=T(e,t)/1e3;return k(o==null?void 0:o.roundingMethod)(r)}function A(e,t,o){const r=v(),n=(o==null?void 0:o.locale)??r.locale??D,a=2520,c=w(e,t);if(isNaN(c))throw new RangeError("Invalid time value");const s=Object.assign({},o,{addSuffix:o==null?void 0:o.addSuffix,comparison:c});let d,u;c>0?(d=l(t),u=l(e)):(d=l(e),u=l(t));const m=P(u,d),h=(y(u)-y(d))/1e3,f=Math.round((m-h)/60);let g;if(f<2)return o!=null&&o.includeSeconds?m<5?n.formatDistance("lessThanXSeconds",5,s):m<10?n.formatDistance("lessThanXSeconds",10,s):m<20?n.formatDistance("lessThanXSeconds",20,s):m<40?n.formatDistance("halfAMinute",0,s):m<60?n.formatDistance("lessThanXMinutes",1,s):n.formatDistance("xMinutes",1,s):f===0?n.formatDistance("lessThanXMinutes",1,s):n.formatDistance("xMinutes",f,s);if(f<45)return n.formatDistance("xMinutes",f,s);if(f<90)return n.formatDistance("aboutXHours",1,s);if(f<M){const _=Math.round(f/60);return n.formatDistance("aboutXHours",_,s)}else{if(f<a)return n.formatDistance("xDays",1,s);if(f<p){const _=Math.round(f/M);return n.formatDistance("xDays",_,s)}else if(f<p*2)return g=Math.round(f/p),n.formatDistance("aboutXMonths",g,s)}if(g=N(u,d),g<12){const _=Math.round(f/p);return n.formatDistance("xMonths",_,s)}else{const _=g%12,b=Math.trunc(g/12);return _<3?n.formatDistance("aboutXYears",b,s):_<9?n.formatDistance("overXYears",b,s):n.formatDistance("almostXYears",b+1,s)}}function $(e,t){return A(e,x(e),t)}function U(e){return e.toLowerCase().trim().replace(/[^\w\s-]/g,"").replace(/[\s_-]+/g,"-").replace(/^-+|-+$/g,"")}function Y(e){const t=`${e.title} | MealScrape`,o=e.url||window.location.href,r=e.image||`${window.location.origin}/Woodenspoon.png`;document.title=t;const n={description:e.description,"og:title":t,"og:description":e.description,"og:image":r,"og:url":o,"og:type":e.type||"website","twitter:card":"summary_large_image","twitter:title":t,"twitter:description":e.description,"twitter:image":r};e.author&&(n.author=e.author),e.publishedTime&&(n["article:published_time"]=e.publishedTime),Object.entries(n).forEach(([c,s])=>{const d=c.startsWith("og:")||c.startsWith("article:")?"property":"name";let u=document.querySelector(`meta[${d}="${c}"]`);u||(u=document.createElement("meta"),u.setAttribute(d,c),document.head.appendChild(u)),u.setAttribute("content",s)});let a=document.querySelector('link[rel="canonical"]');a||(a=document.createElement("link"),a.setAttribute("rel","canonical"),document.head.appendChild(a)),a.setAttribute("href",o)}function F(e){const t={"@context":"https://schema.org","@type":"Article",headline:e.title,description:e.description,image:e.image||`${window.location.origin}/Woodenspoon.png`,author:{"@type":"Person",name:e.author,url:e.authorUrl},publisher:{"@type":"Organization",name:"MealScrape",logo:{"@type":"ImageObject",url:`${window.location.origin}/Woodenspoon.png`}},datePublished:e.publishedTime,dateModified:e.modifiedTime||e.publishedTime,mainEntityOfPage:{"@type":"WebPage","@id":e.url}};let o=document.querySelector('script[type="application/ld+json"]');o||(o=document.createElement("script"),o.setAttribute("type","application/ld+json"),document.head.appendChild(o)),o.textContent=JSON.stringify(t)}function X(e,t){return e.length<=t?e:e.substring(0,t).trim()+"..."}function j(e,t=200){const o=document.createElement("div");o.innerHTML=e;const r=o.textContent||o.innerText||"";return X(r,t)}async function H(e=1,t=20){const o=(e-1)*t,{data:r,error:n}=await i.from("blog_posts").select(`
      *,
      profiles!blog_posts_user_id_profiles_fkey(id, username, avatar_url)
    `).eq("published",!0).order("created_at",{ascending:!1}).range(o,o+t-1);if(n)throw n;return await Promise.all((r||[]).map(async c=>{const[s,d,u]=await Promise.all([i.from("blog_likes").select("*",{count:"exact",head:!0}).eq("post_id",c.id),i.from("blog_comments").select("*",{count:"exact",head:!0}).eq("post_id",c.id),(async()=>{const{data:{user:m}}=await i.auth.getUser();return m?i.from("blog_likes").select("*").eq("post_id",c.id).eq("user_id",m.id).maybeSingle():null})()]);return{...c,author:c.profiles,like_count:s.count||0,comment_count:d.count||0,user_has_liked:!!(u!=null&&u.data)}}))}async function R(e){const{data:t,error:o}=await i.from("blog_posts").select(`
      *,
      profiles!blog_posts_user_id_profiles_fkey(id, username, avatar_url)
    `).eq("slug",e).eq("published",!0).single();if(o||!t)return null;await i.rpc("increment_blog_post_views",{post_id:t.id});const[r,n,a]=await Promise.all([i.from("blog_likes").select("*",{count:"exact",head:!0}).eq("post_id",t.id),i.from("blog_comments").select("*",{count:"exact",head:!0}).eq("post_id",t.id),(async()=>{const{data:{user:c}}=await i.auth.getUser();return c?i.from("blog_likes").select("*").eq("post_id",t.id).eq("user_id",c.id).maybeSingle():null})()]);return{...t,author:t.profiles,like_count:r.count||0,comment_count:n.count||0,user_has_liked:!!(a!=null&&a.data)}}async function z(e){const{data:{user:t}}=await i.auth.getUser();if(!t)throw new Error("Not authenticated");let o=U(e.title);const{data:r}=await i.from("blog_posts").select("slug").eq("slug",o).single();r&&(o=`${o}-${Date.now()}`);const{data:n,error:a}=await i.from("blog_posts").insert({user_id:t.id,title:e.title,slug:o,content:e.content,excerpt:e.excerpt,cover_image:e.cover_image}).select(`
      *,
      profiles!blog_posts_user_id_profiles_fkey(id, username, avatar_url)
    `).single();if(a)throw a;return{...n,author:n.profiles,like_count:0,comment_count:0,user_has_liked:!1}}async function L(e){const{data:{user:t}}=await i.auth.getUser();if(!t)throw new Error("Not authenticated");const{data:o}=await i.from("blog_likes").select("*").eq("post_id",e).eq("user_id",t.id).maybeSingle();return o?(await i.from("blog_likes").delete().eq("post_id",e).eq("user_id",t.id),!1):(await i.from("blog_likes").insert({post_id:e,user_id:t.id}),!0)}async function I(e){const{data:t,error:o}=await i.from("blog_comments").select(`
      *,
      profiles!blog_comments_user_id_profiles_fkey(id, username, avatar_url)
    `).eq("post_id",e).order("created_at",{ascending:!0});if(o)throw o;const{data:{user:r}}=await i.auth.getUser(),n=await Promise.all((t||[]).map(async s=>{var h;const[d,u,m]=await Promise.all([i.from("blog_comment_votes").select("*",{count:"exact",head:!0}).eq("comment_id",s.id).eq("vote_type","up"),i.from("blog_comment_votes").select("*",{count:"exact",head:!0}).eq("comment_id",s.id).eq("vote_type","down"),r?i.from("blog_comment_votes").select("vote_type").eq("comment_id",s.id).eq("user_id",r.id).maybeSingle():Promise.resolve({data:null})]);return{...s,author:s.profiles,vote_score:(d.count||0)-(u.count||0),user_vote:((h=m.data)==null?void 0:h.vote_type)||null}})),a=new Map,c=[];return n.forEach(s=>{a.set(s.id,{...s,replies:[]})}),n.forEach(s=>{const d=a.get(s.id);if(s.parent_id){const u=a.get(s.parent_id);u&&(u.replies=u.replies||[],u.replies.push(d))}else c.push(d)}),c}async function V(e,t,o){const{data:{user:r}}=await i.auth.getUser();if(!r)throw new Error("Not authenticated");const{data:n,error:a}=await i.from("blog_comments").insert({post_id:e,user_id:r.id,parent_id:o||null,content:t}).select(`
      *,
      profiles!blog_comments_user_id_profiles_fkey(id, username, avatar_url)
    `).single();if(a)throw a;return{...n,author:n.profiles,vote_score:0,user_vote:null,replies:[]}}async function J(e,t){const{data:{user:o}}=await i.auth.getUser();if(!o)throw new Error("Not authenticated");const{data:r}=await i.from("blog_comment_votes").select("*").eq("comment_id",e).eq("user_id",o.id).maybeSingle();r?r.vote_type===t?await i.from("blog_comment_votes").delete().eq("comment_id",e).eq("user_id",o.id):await i.from("blog_comment_votes").update({vote_type:t}).eq("comment_id",e).eq("user_id",o.id):await i.from("blog_comment_votes").insert({comment_id:e,user_id:o.id,vote_type:t})}async function G(e){const{data:{user:t}}=await i.auth.getUser();if(!t)throw new Error("Not authenticated");const{data:o}=await i.from("profiles").select("is_admin").eq("id",t.id).single(),{data:r}=await i.from("blog_posts").select("user_id").eq("id",e).single();if(!r)throw new Error("Post not found");const n=r.user_id===t.id,a=(o==null?void 0:o.is_admin)===!0;if(!n&&!a)throw new Error("Not authorized to delete this post");const{error:c}=await i.from("blog_posts").delete().eq("id",e);if(c)throw c}async function K(e){const{data:{user:t}}=await i.auth.getUser();if(!t)throw new Error("Not authenticated");const{data:o}=await i.from("profiles").select("is_admin").eq("id",t.id).single(),{data:r}=await i.from("blog_comments").select("user_id").eq("id",e).single();if(!r)throw new Error("Comment not found");const n=r.user_id===t.id,a=(o==null?void 0:o.is_admin)===!0;if(!n&&!a)throw new Error("Not authorized to delete this comment");const{error:c}=await i.from("blog_comments").delete().eq("id",e);if(c)throw c}export{K as a,V as b,z as c,G as d,j as e,$ as f,H as g,F as h,R as i,I as j,Y as s,L as t,J as v};
