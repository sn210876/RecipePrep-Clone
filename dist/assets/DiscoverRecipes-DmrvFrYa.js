import{c as R,u as Ce,a as Se,r as a,g as Re,j as e,B as w,I as ke,X as Ae,M as Te,b as _e,d as Ee,e as Pe,f as p,s as b}from"./index-DVwpH2fI.js";import{R as ee}from"./RecipeCard--hmc8jWc.js";import{C as Le}from"./RecipeDetailModal-CDyD8_1T.js";import{C as De}from"./CommentModal-Cwmoea_h.js";import{S as Fe}from"./search-DPViS08-.js";import{T as Ie}from"./trending-up-CuiZbALH.js";import{L as ze}from"./leaf-Bi-QvtGY.js";import{H as Ve}from"./heart-DErz6Qra.js";import"./badge-BkWGMm2S.js";import"./textarea-BLVCNVEC.js";import"./dialog-99F_NYXR.js";import"./index-6KIGwICh.js";import"./index-Cys3cZiM.js";import"./react-icons.esm-C0YfxzY2.js";import"./index-DI7neGSw.js";import"./index-CmMSLvOd.js";import"./index-BQIfC9AS.js";import"./ellipsis-vertical-CeuI1Ggs.js";import"./square-pen-DPlMZ5qw.js";import"./trash-2-CfXlPzL9.js";import"./clock-CW5VIQeu.js";import"./separator-PGCrgck6.js";import"./checkbox-CC1IoS72.js";import"./index-BfqclHMW.js";import"./external-link-3Ylf3M5k.js";import"./volume-2-DfdsF56R.js";import"./arrow-left-BkrnaK2C.js";import"./users-CW3odQ9I.js";import"./minus-DoxQ_1yo.js";import"./circle-check-DPhbWwQO.js";import"./play-DOLgYGga.js";import"./chevron-right-Dtap8oXv.js";import"./circle-play-LzBuqxNU.js";import"./send-CJou6lD9.js";/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Be=R("Cake",[["path",{d:"M20 21v-8a2 2 0 0 0-2-2H6a2 2 0 0 0-2 2v8",key:"1w3rig"}],["path",{d:"M4 16s.5-1 2-1 2.5 2 4 2 2.5-2 4-2 2.5 2 4 2 2-1 2-1",key:"n2jgmb"}],["path",{d:"M2 21h20",key:"1nyx9w"}],["path",{d:"M7 8v3",key:"1qtyvj"}],["path",{d:"M12 8v3",key:"hwp4zt"}],["path",{d:"M17 8v3",key:"1i6e5u"}],["path",{d:"M7 4h.01",key:"1bh4kh"}],["path",{d:"M12 4h.01",key:"1ujb9j"}],["path",{d:"M17 4h.01",key:"1upcoc"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=R("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=R("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=R("Zap",[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]]),Qe=()=>e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden animate-pulse",children:[e.jsx("div",{className:"bg-gray-300 aspect-square w-full"}),e.jsxs("div",{className:"p-4 space-y-3",children:[e.jsx("div",{className:"h-5 bg-gray-300 rounded w-3/4"}),e.jsx("div",{className:"h-4 bg-gray-300 rounded w-1/2"}),e.jsxs("div",{className:"flex items-center gap-4 mt-4",children:[e.jsx("div",{className:"h-8 w-20 bg-gray-300 rounded-full"}),e.jsx("div",{className:"h-8 w-20 bg-gray-300 rounded-full"})]}),e.jsxs("div",{className:"flex gap-2 mt-3",children:[e.jsx("div",{className:"h-6 w-16 bg-gray-300 rounded-full"}),e.jsx("div",{className:"h-6 w-16 bg-gray-300 rounded-full"}),e.jsx("div",{className:"h-6 w-16 bg-gray-300 rounded-full"})]})]})]});function Ss({onNavigate:se}){const{state:h,dispatch:qe,saveRecipe:te,removeRecipe:ae}=Ce(),{user:$,isAdmin:H}=Se(),[u,ie]=a.useState(""),[d,N]=a.useState(null),[Q,oe]=a.useState(null),[i,k]=a.useState([]),[A,q]=a.useState(null),[r,le]=a.useState(window.innerWidth<768),[J,re]=a.useState(new Map),[T,_]=a.useState(!1);a.useEffect(()=>{const s=()=>le(window.innerWidth<768);return window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]),a.useEffect(()=>{const s=t=>{q(t.detail)};return window.addEventListener("open-shared-post",s),()=>{window.removeEventListener("open-shared-post",s)}},[]);const ne=async s=>{var t,n,l;try{console.log("[Discover] Batch loading social posts...");const c=s.map(o=>o.id),{data:j}=await b.from("posts").select("*").in("recipe_id",c),{data:g}=await b.from("public_recipes").select("id, video_url, image_url").in("id",c).not("video_url","is",null),C=(g==null?void 0:g.map(o=>o.video_url).filter(Boolean))||[],{data:f}=C.length>0?await b.from("posts").select("*").in("recipe_url",C):{data:[]},y=new Map,S=new Map(s.map(o=>[o.id,o.imageUrl]));j==null||j.forEach(o=>{o.recipe_id&&(!o.image_url&&S.has(o.recipe_id)&&(o.image_url=S.get(o.recipe_id)),y.set(o.recipe_id,o))});const be=new Map((g==null?void 0:g.map(o=>[o.video_url,o.id]))||[]);f==null||f.forEach(o=>{const v=be.get(o.recipe_url);v&&!y.has(v)&&(!o.image_url&&S.has(v)&&(o.image_url=S.get(v)),y.set(v,o))});const z=Array.from(y.values()).map(o=>o.id);if(z.length>0){const[o,v,je]=await Promise.all([b.from("profiles").select("id, username, avatar_url").in("id",Array.from(y.values()).map(m=>m.user_id)),b.from("likes").select("post_id, user_id").in("post_id",z),b.from("comments").select("post_id").in("post_id",z)]),Ne=new Map(((t=o.data)==null?void 0:t.map(m=>[m.id,m]))||[]),V=new Map;(n=v.data)==null||n.forEach(m=>{V.set(m.post_id,(V.get(m.post_id)||0)+1)});const B=new Map;(l=je.data)==null||l.forEach(m=>{B.set(m.post_id,(B.get(m.post_id)||0)+1)});const G=new Map;y.forEach((m,Me)=>{G.set(Me,{...m,profiles:Ne.get(m.user_id),_count:{likes:V.get(m.id)||0,comments:B.get(m.id)||0}})}),re(G),console.log("[Discover] ✅ Loaded",G.size,"social posts with images")}}catch(c){console.error("[Discover] Failed to batch load social posts:",c)}};a.useEffect(()=>{const s=async()=>{try{console.log("[Discover] Loading recipes from database...");const l=await _e();console.log("[Discover] Loaded",l.length,"recipes from database"),k(l),await ne(l)}catch(l){console.error("Failed to load recipes:",l),k([])}};s();const t=()=>{document.visibilityState==="visible"&&s()},n=()=>{console.log("[Discover] Recipe created event received, refreshing..."),s()};return document.addEventListener("visibilitychange",t),window.addEventListener("recipe-created",n),()=>{document.removeEventListener("visibilitychange",t),window.removeEventListener("recipe-created",n)}},[]);const O=async s=>{try{await Pe(s),k(i.filter(t=>t.id!==s)),p.success("Recipe deleted successfully")}catch(t){console.error("Failed to delete recipe:",t),p.error("Failed to delete recipe")}},W=s=>{window.location.href=`/add-recipe?edit=${s}`},K=a.useMemo(()=>{const s=new Set(i.map(t=>t.cuisineType));return Array.from(s).sort()},[i]),M=a.useMemo(()=>i.filter(s=>{const t=u===""||s.title.toLowerCase().includes(u.toLowerCase())||s.tags.some(l=>l.toLowerCase().includes(u.toLowerCase()))||s.ingredients.some(l=>l.name.toLowerCase().includes(u.toLowerCase())),n=!d||s.cuisineType===d;return t&&n}),[u,d,i]),[E,ce]=a.useState(!1),[P,de]=a.useState(!1),[L,me]=a.useState(!1),[D,pe]=a.useState(!1),[F,ue]=a.useState(!1),[I,ge]=a.useState(!1),he=a.useMemo(()=>{const s=[...i].sort((t,n)=>(n.popularity||0)-(t.popularity||0));return E?s:s.slice(0,r?6:12)},[i,E,r]),xe=a.useMemo(()=>{const s=i.filter(t=>t.prepTime+t.cookTime<=30&&t.difficulty==="Easy");return P?s:s.slice(0,r?6:12)},[i,P,r]),fe=a.useMemo(()=>{const s=i.filter(t=>t.dietaryTags.includes("Vegetarian")||t.dietaryTags.includes("Vegan"));return L?s:s.slice(0,r?6:12)},[i,L,r]),ve=a.useMemo(()=>{const s=["Thai","Japanese","Korean","Indian","Middle Eastern","Mexican","Vietnamese","Filipino","Vegan/Vegetarian"],t=i.filter(n=>s.includes(n.cuisineType));return D?t:t.slice(0,r?6:12)},[i,D,r]),Y=a.useMemo(()=>{const s=i.filter(t=>t.cuisineType==="Pet Meals");return F?s:s.slice(0,r?6:12)},[i,F,r]),Z=a.useMemo(()=>{const s=i.filter(t=>t.cuisineType==="Culinary/Baked Goods");return I?s:s.slice(0,r?6:12)},[i,I,r]),[X,ye]=a.useState([]);a.useEffect(()=>{(()=>{const t=Ee(i,h.savedRecipes,h.userPreferences,6);ye(t)})()},[i,h.savedRecipes,h.userPreferences,r]);const we=a.useMemo(()=>Re(h.savedRecipes),[h.savedRecipes]),U=async s=>{if(!$){p.error("Please sign up or log in to save recipes");return}const t=i.find(n=>n.id===s);if(t){const n=h.savedRecipes.some(l=>l.id===s);try{n?(await ae(s),p.success("Recipe removed from collection")):(await te(t),p.success("Recipe saved to your collection"))}catch(l){console.error("[DiscoverRecipes] Error saving/removing recipe:",l);const c=(l==null?void 0:l.message)||"";c.includes("session")||c.includes("expired")||c.includes("401")?p.error("Your session has expired. Please log in again."):c.includes("mismatch")||c.includes("authentication")?p.error("Authentication error. Please log out and log back in."):c.includes("network")||c.includes("fetch")?p.error("Network error. Please check your connection and try again."):p.error(c||"Failed to update recipe. Please try again.")}}},x=({title:s,subtitle:t,icon:n,recipes:l,showAll:c,onToggle:j,allCount:g,buttonColor:C})=>e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6",children:[e.jsx("div",{className:`bg-gradient-to-r ${C} p-2 rounded-lg`,children:e.jsx(n,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl md:text-3xl font-bold text-gray-900",children:s}),e.jsx("p",{className:"text-sm md:text-base text-gray-600",children:t})]})]}),e.jsx("div",{className:`grid gap-0 md:gap-0 auto-rows-fr ${r?"grid-cols-2":"grid-cols-3"}`,children:l.map(f=>e.jsx(ee,{recipe:f,onSave:U,onDelete:O,onEdit:W,isAdmin:H,showReviewButton:!0,preloadedSocialPost:J.get(f.id)||null},f.id))}),g>(r?6:12)&&e.jsx("div",{className:"text-center mt-8",children:e.jsx(w,{onClick:()=>j(!c),variant:"outline",size:"lg",className:"text-sm md:text-base",children:c?"Show Less":"Show More"})})]});return i.length===0&&!u&&!d?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-white to-slate-50",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-2 pb-8",children:[e.jsxs("div",{className:"text-center mb-12",children:[e.jsx("div",{className:"h-12 bg-gray-300 rounded-xl w-96 mx-auto mb-4 animate-pulse"}),e.jsx("div",{className:"h-6 bg-gray-300 rounded-lg w-80 mx-auto animate-pulse"})]}),e.jsx("div",{className:"mb-12",children:e.jsx("div",{className:"h-14 bg-gray-200 rounded-2xl w-full max-w-2xl mx-auto animate-pulse"})}),e.jsx("div",{className:"space-y-16",children:[...Array(6)].map((s,t)=>e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center gap-4 mb-8",children:[e.jsx("div",{className:"w-14 h-14 bg-gray-300 rounded-xl animate-pulse"}),e.jsxs("div",{children:[e.jsx("div",{className:"h-9 bg-gray-300 rounded-lg w-72 animate-pulse"}),e.jsx("div",{className:"h-6 bg-gray-300 rounded-lg w-56 mt-3 animate-pulse"})]})]}),e.jsx("div",{className:`grid gap-0 ${r?"grid-cols-2":"grid-cols-3"} auto-rows-fr`,children:[...Array(r?4:8)].map((n,l)=>e.jsx(Qe,{},l))})]},t))})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-slate-50 via-white to-slate-50",children:[e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 pt-2 pb-8",children:[!$&&e.jsx("div",{className:"mb-6 bg-gradient-to-r from-orange-500 to-amber-500 text-white rounded-2xl p-6 shadow-lg",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{className:"text-center md:text-left",children:[e.jsx("h3",{className:"text-xl font-bold mb-1",children:"Join MealScrape Today!"}),e.jsx("p",{className:"text-sm opacity-90",children:"Sign up to save recipes, create meal plans, and connect with food lovers"})]}),e.jsx(w,{onClick:()=>se("discover"),className:"bg-white text-orange-600 hover:bg-gray-100 font-semibold px-8 py-3 rounded-full shadow-md",children:"Sign Up Free"})]})}),e.jsxs("div",{className:"text-center mb-8 md:mb-12",children:[e.jsx("h1",{className:"text-3xl md:text-5xl font-bold text-gray-900 mb-3 md:mb-4",children:"Discover Amazing Recipes"}),e.jsxs("p",{className:"text-sm md:text-base text-gray-600 max-w-2xl mx-auto mb-2",children:["Recipes scraped from ",e.jsx("span",{className:"font-semibold text-blue-600",children:"Social Media"})," and the ",e.jsx("span",{className:"font-semibold text-blue-600",children:"Web"})]}),e.jsx("p",{className:"text-xs md:text-sm text-gray-500 max-w-2xl mx-auto",children:"Meal Calendar • Shopping List • Social Community"})]}),e.jsxs("div",{className:"mb-8 md:mb-12 space-y-4 md:space-y-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx(Fe,{className:"absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 w-5 h-5"}),e.jsx(ke,{type:"text",placeholder:"Search recipes, ingredients...",value:u,onChange:s=>ie(s.target.value),className:"pl-12 h-12 md:h-14 text-base border-gray-300 focus:border-orange-500 focus:ring-orange-500 shadow-sm"})]}),r?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("button",{onClick:()=>_(!T),className:"w-full flex items-center justify-between px-4 py-3 bg-white border border-gray-300 rounded-lg hover:bg-gray-50",children:[e.jsx("span",{className:"font-medium text-gray-900",children:d?`Cuisine: ${d}`:"Filter by Cuisine"}),T?e.jsx(Ae,{className:"w-5 h-5"}):e.jsx(Te,{className:"w-5 h-5"})]}),T&&e.jsxs("div",{className:"space-y-2 bg-white border border-gray-200 rounded-lg p-3",children:[e.jsx(w,{variant:d===null?"default":"outline",onClick:()=>{N(null),_(!1)},size:"sm",className:`w-full justify-start ${d===null?"bg-orange-500 hover:bg-orange-600":""}`,children:"All Cuisines"}),K.map(s=>e.jsx(w,{variant:d===s?"default":"outline",onClick:()=>{N(s),_(!1)},size:"sm",className:`w-full justify-start text-sm ${d===s?"bg-orange-500 hover:bg-orange-600":""}`,children:s},s))]})]}):e.jsxs("div",{className:"flex flex-wrap gap-2 justify-center",children:[e.jsx(w,{variant:d===null?"default":"outline",onClick:()=>N(null),size:"sm",className:d===null?"bg-orange-500 hover:bg-orange-600":"",children:"All Cuisines"}),K.map(s=>e.jsx(w,{variant:d===s?"default":"outline",onClick:()=>N(s),size:"sm",className:d===s?"bg-orange-500 hover:bg-orange-600":"",children:s},s))]})]}),u===""&&d===null?e.jsxs("div",{className:"space-y-12 md:space-y-16",children:[e.jsx(x,{title:"Trending Now",subtitle:"Most popular recipes this week",icon:Ie,recipes:he,showAll:E,onToggle:ce,allCount:i.length,buttonColor:"from-orange-500 to-rose-500"}),e.jsx(x,{title:"Quick & Easy",subtitle:"Delicious meals ready in 30 minutes or less",icon:He,recipes:xe,showAll:P,onToggle:de,allCount:i.filter(s=>s.prepTime+s.cookTime<=30&&s.difficulty==="Easy").length,buttonColor:"from-emerald-500 to-teal-500"}),e.jsx(x,{title:"Healthy Options",subtitle:"Vegetarian and vegan recipes for a lighter meal",icon:ze,recipes:fe,showAll:L,onToggle:me,allCount:i.filter(s=>s.dietaryTags.includes("Vegetarian")||s.dietaryTags.includes("Vegan")).length,buttonColor:"from-green-500 to-emerald-500"}),e.jsx(x,{title:"International Flavors",subtitle:"Explore cuisines from around the world",icon:Ge,recipes:ve,showAll:D,onToggle:pe,allCount:i.filter(s=>["Thai","Japanese","Korean","Indian","Middle Eastern","Mexican","Vietnamese","Filipino"].includes(s.cuisineType)).length,buttonColor:"from-amber-500 to-orange-500"}),Y.length>0&&e.jsx(x,{title:"Pet Meals & Treats",subtitle:"Homemade recipes for your furry friends",icon:Ve,recipes:Y,showAll:F,onToggle:ue,allCount:i.filter(s=>s.cuisineType==="Pet Meals").length,buttonColor:"from-pink-500 to-rose-500"}),Z.length>0&&e.jsx(x,{title:"Culinary & Baked Goods",subtitle:"From artisan breads to elegant pastries",icon:Be,recipes:Z,showAll:I,onToggle:ge,allCount:i.filter(s=>s.cuisineType==="Culinary/Baked Goods").length,buttonColor:"from-amber-500 to-orange-500"}),e.jsx(x,{title:"Recommended for You",subtitle:we,icon:$e,recipes:X,showAll:!1,onToggle:()=>{},allCount:X.length,buttonColor:"from-blue-500 to-cyan-500"})]}):e.jsxs("section",{children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Search Results"}),e.jsxs("p",{className:"text-gray-600",children:["Found ",M.length," recipe",M.length!==1?"s":""]})]}),M.length>0?e.jsx("div",{className:`grid gap-px md:gap-px auto-rows-fr ${r?"grid-cols-2":"grid-cols-3"}`,children:M.map(s=>e.jsx(ee,{recipe:s,onSave:U,onDelete:O,onEdit:W,isAdmin:H,showReviewButton:!0,preloadedSocialPost:J.get(s.id)||null},s.id))}):e.jsx("div",{className:"text-center py-12",children:e.jsx("p",{className:"text-lg text-gray-500",children:"No recipes found. Try adjusting your search."})})]})]}),Q&&e.jsx(Le,{recipe:Q,onClose:()=>oe(null)}),A&&e.jsx(De,{postId:A,isOpen:!!A,onClose:()=>q(null),onCommentPosted:()=>{}})]})}export{Ss as Discover};
